import{o as $f,E as qf,A as Ld,aL as vi,a7 as st,aM as Rd}from"./B3UcTGKf.js";import{B as Zf,_ as lc}from"./lGFOwfWW.js";function jm(B,O,...ie){var se=new Zf(B);$f(()=>{const ae=O()??null;se.ensure(ae,ae&&(fe=>ae(fe,...ie)))},qf)}/*! Capacitor: https://capacitorjs.com/ - MIT License */const Gf=B=>{const O=new Map;O.set("web",{name:"web"});const ie=B.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:O},se=(fe,C)=>{ie.platforms.set(fe,C)},ae=fe=>{ie.platforms.has(fe)&&(ie.currentPlatform=ie.platforms.get(fe))};return ie.addPlatform=se,ie.setPlatform=ae,ie},Hf=B=>B.CapacitorPlatforms=Gf(B),Bd=Hf(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});Bd.addPlatform;Bd.setPlatform;var Un;(function(B){B.Unimplemented="UNIMPLEMENTED",B.Unavailable="UNAVAILABLE"})(Un||(Un={}));class ku extends Error{constructor(O,ie,se){super(O),this.message=O,this.code=ie,this.data=se}}const Wf=B=>{var O,ie;return B!=null&&B.androidBridge?"android":!((ie=(O=B==null?void 0:B.webkit)===null||O===void 0?void 0:O.messageHandlers)===null||ie===void 0)&&ie.bridge?"ios":"web"},Xf=B=>{var O,ie,se,ae,fe;const C=B.CapacitorCustomPlatform||null,p=B.Capacitor||{},Ye=p.Plugins=p.Plugins||{},Qe=B.CapacitorPlatforms,At=()=>C!==null?C.name:Wf(B),ge=((O=Qe==null?void 0:Qe.currentPlatform)===null||O===void 0?void 0:O.getPlatform)||At,ue=()=>ge()!=="web",Dr=((ie=Qe==null?void 0:Qe.currentPlatform)===null||ie===void 0?void 0:ie.isNativePlatform)||ue,br=ut=>{const Mt=sa.get(ut);return!!(Mt!=null&&Mt.platforms.has(ge())||Gi(ut))},Zi=((se=Qe==null?void 0:Qe.currentPlatform)===null||se===void 0?void 0:se.isPluginAvailable)||br,xr=ut=>{var Mt;return(Mt=p.PluginHeaders)===null||Mt===void 0?void 0:Mt.find(Qt=>Qt.name===ut)},Gi=((ae=Qe==null?void 0:Qe.currentPlatform)===null||ae===void 0?void 0:ae.getPluginHeader)||xr,aa=ut=>B.console.error(ut),pi=(ut,Mt,Qt)=>Promise.reject(`${Qt} does not have an implementation of "${Mt}".`),sa=new Map,Di=(ut,Mt={})=>{const Qt=sa.get(ut);if(Qt)return console.warn(`Capacitor plugin "${ut}" already registered. Cannot register plugins twice.`),Qt.proxy;const Li=ge(),at=Gi(ut);let wi;const Gt=async()=>(!wi&&Li in Mt?wi=typeof Mt[Li]=="function"?wi=await Mt[Li]():wi=Mt[Li]:C!==null&&!wi&&"web"in Mt&&(wi=typeof Mt.web=="function"?wi=await Mt.web():wi=Mt.web),wi),ei=(Et,gt)=>{var Rt,fi;if(at){const ti=at==null?void 0:at.methods.find(Bt=>gt===Bt.name);if(ti)return ti.rtype==="promise"?Bt=>p.nativePromise(ut,gt.toString(),Bt):(Bt,ar)=>p.nativeCallback(ut,gt.toString(),Bt,ar);if(Et)return(Rt=Et[gt])===null||Rt===void 0?void 0:Rt.bind(Et)}else{if(Et)return(fi=Et[gt])===null||fi===void 0?void 0:fi.bind(Et);throw new ku(`"${ut}" plugin is not implemented on ${Li}`,Un.Unimplemented)}},Ri=Et=>{let gt;const Rt=(...fi)=>{const ti=Gt().then(Bt=>{const ar=ei(Bt,Et);if(ar){const Ht=ar(...fi);return gt=Ht==null?void 0:Ht.remove,Ht}else throw new ku(`"${ut}.${Et}()" is not implemented on ${Li}`,Un.Unimplemented)});return Et==="addListener"&&(ti.remove=async()=>gt()),ti};return Rt.toString=()=>`${Et.toString()}() { [capacitor code] }`,Object.defineProperty(Rt,"name",{value:Et,writable:!1,configurable:!1}),Rt},Lr=Ri("addListener"),Bi=Ri("removeListener"),Ia=(Et,gt)=>{const Rt=Lr({eventName:Et},gt),fi=async()=>{const Bt=await Rt;Bi({eventName:Et,callbackId:Bt},gt)},ti=new Promise(Bt=>Rt.then(()=>Bt({remove:fi})));return ti.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await fi()},ti},rr=new Proxy({},{get(Et,gt){switch(gt){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return at?Ia:Lr;case"removeListener":return Bi;default:return Ri(gt)}}});return Ye[ut]=rr,sa.set(ut,{name:ut,proxy:rr,platforms:new Set([...Object.keys(Mt),...at?[Li]:[]])}),rr},Hi=((fe=Qe==null?void 0:Qe.currentPlatform)===null||fe===void 0?void 0:fe.registerPlugin)||Di;return p.convertFileSrc||(p.convertFileSrc=ut=>ut),p.getPlatform=ge,p.handleError=aa,p.isNativePlatform=Dr,p.isPluginAvailable=Zi,p.pluginMethodNoop=pi,p.registerPlugin=Hi,p.Exception=ku,p.DEBUG=!!p.DEBUG,p.isLoggingEnabled=!!p.isLoggingEnabled,p.platform=p.getPlatform(),p.isNative=p.isNativePlatform(),p},Kf=B=>B.Capacitor=Xf(B),nc=Kf(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),qs=nc.registerPlugin;nc.Plugins;class Fd{constructor(O){this.listeners={},this.retainedEventArguments={},this.windowListeners={},O&&(console.warn(`Capacitor WebPlugin "${O.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=O)}addListener(O,ie){let se=!1;this.listeners[O]||(this.listeners[O]=[],se=!0),this.listeners[O].push(ie);const fe=this.windowListeners[O];fe&&!fe.registered&&this.addWindowListener(fe),se&&this.sendRetainedArgumentsForEvent(O);const C=async()=>this.removeListener(O,ie);return Promise.resolve({remove:C})}async removeAllListeners(){this.listeners={};for(const O in this.windowListeners)this.removeWindowListener(this.windowListeners[O]);this.windowListeners={}}notifyListeners(O,ie,se){const ae=this.listeners[O];if(!ae){if(se){let fe=this.retainedEventArguments[O];fe||(fe=[]),fe.push(ie),this.retainedEventArguments[O]=fe}return}ae.forEach(fe=>fe(ie))}hasListeners(O){return!!this.listeners[O].length}registerWindowListener(O,ie){this.windowListeners[ie]={registered:!1,windowEventName:O,pluginEventName:ie,handler:se=>{this.notifyListeners(ie,se)}}}unimplemented(O="not implemented"){return new nc.Exception(O,Un.Unimplemented)}unavailable(O="not available"){return new nc.Exception(O,Un.Unavailable)}async removeListener(O,ie){const se=this.listeners[O];if(!se)return;const ae=se.indexOf(ie);this.listeners[O].splice(ae,1),this.listeners[O].length||this.removeWindowListener(this.windowListeners[O])}addWindowListener(O){window.addEventListener(O.windowEventName,O.handler),O.registered=!0}removeWindowListener(O){O&&(window.removeEventListener(O.windowEventName,O.handler),O.registered=!1)}sendRetainedArgumentsForEvent(O){const ie=this.retainedEventArguments[O];ie&&(delete this.retainedEventArguments[O],ie.forEach(se=>{this.notifyListeners(O,se)}))}}const Id=B=>encodeURIComponent(B).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),kd=B=>B.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Jf extends Fd{async getCookies(){const O=document.cookie,ie={};return O.split(";").forEach(se=>{if(se.length<=0)return;let[ae,fe]=se.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");ae=kd(ae).trim(),fe=kd(fe).trim(),ie[ae]=fe}),ie}async setCookie(O){try{const ie=Id(O.key),se=Id(O.value),ae=`; expires=${(O.expires||"").replace("expires=","")}`,fe=(O.path||"/").replace("path=",""),C=O.url!=null&&O.url.length>0?`domain=${O.url}`:"";document.cookie=`${ie}=${se||""}${ae}; path=${fe}; ${C};`}catch(ie){return Promise.reject(ie)}}async deleteCookie(O){try{document.cookie=`${O.key}=; Max-Age=0`}catch(ie){return Promise.reject(ie)}}async clearCookies(){try{const O=document.cookie.split(";")||[];for(const ie of O)document.cookie=ie.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(O){return Promise.reject(O)}}async clearAllCookies(){try{await this.clearCookies()}catch(O){return Promise.reject(O)}}}qs("CapacitorCookies",{web:()=>new Jf});const Yf=async B=>new Promise((O,ie)=>{const se=new FileReader;se.onload=()=>{const ae=se.result;O(ae.indexOf(",")>=0?ae.split(",")[1]:ae)},se.onerror=ae=>ie(ae),se.readAsDataURL(B)}),Qf=(B={})=>{const O=Object.keys(B);return Object.keys(B).map(ae=>ae.toLocaleLowerCase()).reduce((ae,fe,C)=>(ae[fe]=B[O[C]],ae),{})},em=(B,O=!0)=>B?Object.entries(B).reduce((se,ae)=>{const[fe,C]=ae;let p,Ye;return Array.isArray(C)?(Ye="",C.forEach(Qe=>{p=O?encodeURIComponent(Qe):Qe,Ye+=`${fe}=${p}&`}),Ye.slice(0,-1)):(p=O?encodeURIComponent(C):C,Ye=`${fe}=${p}`),`${se}&${Ye}`},"").substr(1):null,tm=(B,O={})=>{const ie=Object.assign({method:B.method||"GET",headers:B.headers},O),ae=Qf(B.headers)["content-type"]||"";if(typeof B.data=="string")ie.body=B.data;else if(ae.includes("application/x-www-form-urlencoded")){const fe=new URLSearchParams;for(const[C,p]of Object.entries(B.data||{}))fe.set(C,p);ie.body=fe.toString()}else if(ae.includes("multipart/form-data")||B.data instanceof FormData){const fe=new FormData;if(B.data instanceof FormData)B.data.forEach((p,Ye)=>{fe.append(Ye,p)});else for(const p of Object.keys(B.data))fe.append(p,B.data[p]);ie.body=fe;const C=new Headers(ie.headers);C.delete("content-type"),ie.headers=C}else(ae.includes("application/json")||typeof B.data=="object")&&(ie.body=JSON.stringify(B.data));return ie};class im extends Fd{async request(O){const ie=tm(O,O.webFetchExtra),se=em(O.params,O.shouldEncodeUrlParams),ae=se?`${O.url}?${se}`:O.url,fe=await fetch(ae,ie),C=fe.headers.get("content-type")||"";let{responseType:p="text"}=fe.ok?O:{};C.includes("application/json")&&(p="json");let Ye,Qe;switch(p){case"arraybuffer":case"blob":Qe=await fe.blob(),Ye=await Yf(Qe);break;case"json":Ye=await fe.json();break;case"document":case"text":default:Ye=await fe.text()}const At={};return fe.headers.forEach((ge,ue)=>{At[ue]=ge}),{data:Ye,headers:At,status:fe.status,url:fe.url}}async get(O){return this.request(Object.assign(Object.assign({},O),{method:"GET"}))}async post(O){return this.request(Object.assign(Object.assign({},O),{method:"POST"}))}async put(O){return this.request(Object.assign(Object.assign({},O),{method:"PUT"}))}async patch(O){return this.request(Object.assign(Object.assign({},O),{method:"PATCH"}))}async delete(O){return this.request(Object.assign(Object.assign({},O),{method:"DELETE"}))}}const rm=qs("CapacitorHttp",{web:()=>new im}),am=qs("App",{web:()=>lc(()=>import("./BryGuFVn.js"),[],import.meta.url).then(B=>new B.AppWeb)}),$m=vi({top:0,bottom:0,left:0,right:0}),ls=(()=>{const{subscribe:B,update:O}=vi([]);return{subscribe:B,add:async(se,ae=3e3)=>{if(!(await am.getState()).isActive)return;const fe=Math.random();O(C=>[...C,{msg:se,id:fe}].slice(-3)),setTimeout(()=>O(C=>C.filter(p=>p.id!==fe)),ae)}}})(),Pu=Ld([]),qm=B=>{let O=()=>{const ie=Pu.findIndex(se=>se.dismiss===O);ie!==-1&&Pu.splice(ie,1)};Pu.push({snippet:B,dismiss:O})},Yt=qs("Preferences",{web:()=>lc(()=>import("./CQhxb5dj.js"),[],import.meta.url).then(B=>new B.PreferencesWeb)}),js=vi(),Pd={theme:"system",locale:"system"};async function Zm(){const B=(await Yt.get({key:"settings/distanceLock"})).value!=="false",O=(await Yt.get({key:"settings/mockUnlock"})).value!=="false",ie=(await Yt.get({key:"settings/backgroundLocation"})).value!=="false",ae=(await Yt.get({key:"settings/theme"})).value||Pd.theme,C=(await Yt.get({key:"settings/locale"})).value||Pd.locale;js.set({distanceLock:B,mockUnlock:O,backgroundLocation:ie,theme:ae,locale:C}),js.subscribe(async p=>{await Promise.all([Yt.set({key:"settings/distanceLock",value:p.distanceLock.toString()}),Yt.set({key:"settings/mockUnlock",value:p.mockUnlock.toString()}),Yt.set({key:"settings/backgroundLocation",value:p.backgroundLocation.toString()}),Yt.set({key:"settings/theme",value:p.theme}),Yt.set({key:"settings/locale",value:p.locale})])})}const Gm={addListener:(B,O)=>({remove:()=>{}}),removeAllListeners:()=>Promise.resolve(),hide:()=>Promise.resolve(),show:()=>Promise.resolve()},Hm={setOverlaysWebView:B=>Promise.resolve(),setStyle:B=>Promise.resolve(),setBackgroundColor:B=>Promise.resolve(),show:()=>Promise.resolve(),hide:()=>Promise.resolve()};var sm=(B=>(B.Dark="DARK",B.Light="LIGHT",B.Default="DEFAULT",B))(sm||{});const Wm={setTransparency:B=>Promise.resolve(),setColor:B=>Promise.resolve(),show:()=>Promise.resolve(),hide:()=>Promise.resolve()},Xm={lock:B=>Promise.resolve(),unlock:()=>Promise.resolve(),orientation:()=>Promise.resolve({type:"portrait-primary"}),addListener:(B,O)=>({remove:()=>{}}),removeAllListeners:()=>Promise.resolve()},nm=35,om=20,cc="https://c2g091p01.emel.pt/auth",Lu="https://c2g091p01.emel.pt/api",uc="wss://c2g091p01.emel.pt/ws",Od={"Serviço indisponível. Horário de utilização entre as 06:00 e as 02:00.":{message:"service_hours_error",retry:!1},trip_interval_limit:{message:"trip_interval_limit_error",retry:!1},not_enough_balance:{message:"negative_balance_error",retry:!1},has_no_active_subscriptions:{message:"no_active_subscription_error",retry:!1},already_active_trip:{message:"already_active_trip_error",retry:!1},already_has_active_trip:{message:"already_active_trip_error",retry:!1},unable_to_start_trip:{message:"bike_unlock_error",retry:!0},trip_not_found:{message:"trip_not_found_error",retry:!1},invalid_arguments:{retry:!1},bike_already_in_trip:{message:"bike_already_in_trip_error",retry:!1},bike_already_reserved:{message:"bike_already_reserved_error",retry:!1},no_bike_found:{message:"no_bike_found_error",retry:!1},bike_on_repair:{message:"bike_in_repair_error",retry:!1},bike_in_repair:{message:"bike_in_repair_error",retry:!1}};async function hc(B){var C;const O=st(Wd),ie=O?Lu:uc.replace("wss","https"),se={"User-Agent":"Gira/3.4.3 (Android 34)","content-type":"application/json",authorization:`Bearer ${(C=st(zr))==null?void 0:C.accessToken}`};O&&(se["x-firebase-token"]=O);const ae={url:ie+"/graphql",method:"post",headers:se,data:B},fe=await il(ae,!0);return fe==null?void 0:fe.data.data}async function jn(B){var C;const O=st(Wd),ie=O?Lu:uc.replace("wss","https"),se={"User-Agent":"Gira/3.4.3 (Android 34)","content-type":"application/json",authorization:`Bearer ${(C=st(zr))==null?void 0:C.accessToken}`};O&&(se["x-firebase-token"]=O);const ae={url:ie+"/graphql",method:"post",headers:se,data:B},fe=await il(ae,!0);return fe==null?void 0:fe.data.data}async function lm(){return jn({operationName:"getStations",variables:{},query:"query getStations {getStations {code, description, latitude, longitude, name, bikes, docks, serialNumber, assetStatus }}"})}function Km(B){return jn({variables:{input:B},query:`query { 
				getBikes(input: "${B}") { battery, code, name, kms, serialNumber, type, parent }
				getDocks(input: "${B}") { ledStatus, lockStatus, serialNumber, code, name }
		}`})}async function Vd(B){return hc({variables:{input:B},query:"mutation ($input: String) { reserveBike(input: $input) }"})}async function cm(){return hc({variables:{},query:"mutation { startTrip }"})}async function um(){return jn({variables:{},query:"query { activeTrip { user, startDate, endDate, startLocation, endLocation, distance, rating, photo, cost, startOccupation, endOccupation, totalBonus, client, costBonus, comment, compensationTime, endTripDock, tripStatus, code, name, description, creationDate, createdBy, updateDate, updatedBy, defaultOrder, version } }"})}async function hm(B,O){return jn({variables:{input:{_pageNum:B,_pageSize:O}},query:"query ($input: PageInput) { tripHistory(pageInput: $input) { code, startDate, endDate, rating, bikeName, startLocation, endLocation, bonus, usedPoints, cost, bikeType } }"})}async function dm(B,O){return jn({variables:{input:{_pageNum:B,_pageSize:O}},query:"query ($input: PageInput) { unratedTrips(pageInput: $input) { code, startDate, endDate, rating, startLocation, endLocation, cost, costBonus, asset } }"})}async function pm(B){return hc({variables:{input:B},query:"mutation ($input: String) { tripPayWithNoPoints(input: $input) }"})}async function Ru(B){return hc({variables:{input:B},query:"mutation ($input: String) { tripPayWithPoints(input: $input) }"})}async function fm(){let B="query {";return B+="getStations {code, description, latitude, longitude, name, bikes, docks, serialNumber, assetStatus } ",B+="client { balance, bonus } ",B+="activeUserSubscriptions { expirationDate subscriptionStatus name type active } ",B+="activeTrip { user, startDate, endDate, startLocation, endLocation, distance, rating, photo, cost, startOccupation, endOccupation, totalBonus, client, costBonus, comment, compensationTime, endTripDock, tripStatus, code, name, description, creationDate, createdBy, updateDate, updatedBy, defaultOrder, version } ",B+="unratedTrips(pageInput: { _pageNum: 0, _pageSize: 1 }) { code, startDate, endDate, rating, startLocation, endLocation, cost, costBonus, asset } ",B+="tripHistory(pageInput: { _pageNum: 0, _pageSize: 1 }) { code, startDate, endDate, rating, bikeName, startLocation, endLocation, bonus, usedPoints, cost, bikeType } ",B+="}",await jn({variables:{},query:B})}async function Jm(){}async function mm(B,O){}async function el(B,O=null){}const gm=["en","pt","ar"];function _m(){const B=st(js),O=B.locale==="system"?navigator.language.split("-")[0]:B.locale;return gm.includes(O)?O:"en"}const cs=Rd(js,()=>(B,O={})=>{const ie=_m();if(!B)return"";const se=ym[B],ae=se[ie]??se.en;return ae?ae.replace(/{{(.*?)}}/g,(fe,C)=>O[C.trim()]??""):(console.warn(`Translation not found for key: ${String(B)} in locale: ${ie}`),String(B))}),ym={ok_button:{en:"Ok",pt:"Ok",ar:"موافق"},ignore_button:{en:"Ignore this version",pt:"Ignorar esta versão",ar:"تجاهل هذا الإصدار"},new_version_available:{en:"New version available!",pt:"Nova versão disponível!",ar:"إصدار جديد متاح!"},see_release_notes:{en:"See release notes",pt:"Veja as novidades",ar:"عرض ملاحظات الإصدار"},update_warning_setting_note:{en:"You can disable this warning in the settings.",pt:"Pode desativar este aviso nas configurações.",ar:"يمكنك تعطيل هذا التحذير في الإعدادات."},distance_traveled:{en:"Distance Traveled",pt:"Distância Percorrida",ar:"المسافة المقطوعة"},average_speed:{en:"Average Speed",pt:"Velocidade Média",ar:"متوسط السرعة"},distance_left:{en:"Distance Left",pt:"Distância em Falta",ar:"المسافة المتبقية"},time_left:{en:"Time Left",pt:"Tempo em Falta",ar:"الوقت المتبقي"},arrival_time:{en:"Arrival Time",pt:"Hora de Chegada",ar:"وقت الوصول"},rate_trip_error:{en:"Error rating trip",pt:"Erro ao avaliar viagem",ar:"خطأ في تقييم الرحلة"},last_trip_question:{en:"How was your last trip?",pt:"Como foi a sua última viagem?",ar:"كيف كانت رحلتك الأخيرة؟"},station_label:{en:"Station",pt:"Estação",ar:"محطة"},bikes_label:{en:"BIKES",pt:"BICICLETAS",ar:"دراجات"},free_docks_label:{en:`FREE
DOCKS`,pt:`DOCAS
LIVRES`,ar:`محطات
متاحة`},duration_label:{en:"DURATION",pt:"DURAÇÃO",ar:"المدة"},hours_label:{en:"h",pt:"h",ar:"س"},minutes_label:{en:"min",pt:"min",ar:"د"},trips_label:{en:"Trips",pt:"Viagens",ar:"رحلات"},no_trips_label:{en:"No trips",pt:"Nenhuma viagem",ar:"لا توجد رحلات"},no_trips_registered_label:{en:"No trips registered",pt:"Não há viagens registadas",ar:"لا توجد رحلات مسجلة"},about_label:{en:"About",pt:"Sobre",ar:"حول"},app_description:{en:"Gira++ is a community-driven enhancement of the official Gira bike-sharing app. Built by listening to real feedback from cyclists in Lisbon who were frustrated with bugs, crashes, and missing features. This is what Gira should have been — faster, smoother, and actually works.",pt:"Gira++ é uma melhoria da app oficial Gira, feita pela comunidade. Construída ouvindo feedback real de ciclistas em Lisboa frustrados com bugs, crashes e funcionalidades em falta. Isto é o que a Gira deveria ter sido — mais rápida, mais fluida, e que realmente funciona.",ar:"Gira++ هو تحسين مجتمعي لتطبيق Gira الرسمي. تم بناؤه من خلال الاستماع إلى ملاحظات حقيقية من راكبي الدراجات في لشبونة."},not_official_disclaimer:{en:"The application is unofficial and not affiliated in any way with EMEL or Câmara Municipal de Lisboa.",pt:"A aplicação não é oficial, não estando afiliada de modo algum à EMEL ou à Câmara Municipal de Lisboa.",ar:"هذا التطبيق غير رسمي وليس له أي علاقة بـ EMEL أو بلدية لشبونة."},find_out_more_at:{en:"Find out more at ",pt:"Saiba mais em ",ar:"اكتشف المزيد على "},made_by:{en:"Made by",pt:"Desenvolvido por",ar:"صنع بواسطة"},open_source_license:{en:"Open-source project under the GPL-3.0 license",pt:"Projeto open-source sob a licença GPL-3.0",ar:"مشروع مفتوح المصدر بموجب ترخيص GPL-3.0"},user_label:{en:"User",pt:"Utilizador",ar:"مستخدم"},balance_label:{en:"Balance",pt:"Saldo",ar:"الرصيد"},points_label:{en:"Points",pt:"Pontos",ar:"نقاط"},no_subscription_label:{en:"No subscription",pt:"Sem subscrição",ar:"لا يوجد اشتراك"},annual_pass_label:{en:"Annual Pass",pt:"Passe Anual",ar:"اشتراك سنوي"},monthly_pass_label:{en:"Monthly Pass",pt:"Passe Mensal",ar:"اشتراك شهري"},daily_pass_label:{en:"Daily Pass",pt:"Passe Diário",ar:"اشتراك يومي"},valid_until_label:{en:"Valid until {{date}}",pt:"Válido até {{date}}",ar:"صالح حتى {{date}}"},history_label:{en:"History",pt:"Histórico",ar:"السجل"},settings_label:{en:"Settings",pt:"Configurações",ar:"الإعدادات"},feedback_label:{en:"Feedback",pt:"Feedback",ar:"ملاحظات"},contribute_label:{en:"Contribute",pt:"Contribuir",ar:"المساهمة"},star_label:{en:"Leave a star",pt:"Deixar uma estrela",ar:"اترك نجمة"},exit_label:{en:"LOGOUT",pt:"SAIR",ar:"تسجيل الخروج"},welcome_message:{en:"Welcome to Gira++",pt:"Bem-vindo ao Gira++",ar:"مرحبا بك في Gira++"},email_label:{en:"Email",pt:"Email",ar:"البريد الإلكتروني"},email_placeholder:{en:"example@example.com",pt:"exemplo@exemplo.com",ar:"example@example.com"},password_label:{en:"Password",pt:"Password",ar:"كلمة المرور"},invalid_credentials_error:{en:"Invalid credentials",pt:"Credenciais inválidas",ar:"بيانات الاعتماد غير صالحة"},unknown_error:{en:"Unknown error",pt:"Erro desconhecido",ar:"خطأ غير معروف"},login_button:{en:"Login",pt:"Login",ar:"تسجيل الدخول"},login_disclaimer:{en:"This application is not official and is not affiliated with EMEL. Your credentials are not shared with us or any third party.",pt:"Esta aplicação não é oficial e não está afiliada à EMEL. As suas credenciais não são partilhadas connosco ou com terceiros.",ar:"هذا التطبيق غير رسمي وغير تابع لـ EMEL. لا تتم مشاركة بيانات اعتمادك معنا أو مع أي طرف ثالث."},history_subtext:{en:"List of previous trips",pt:"Lista de viagens anteriores",ar:"قائمة الرحلات السابقة"},settings_subtext:{en:"Application settings",pt:"Definições da aplicação",ar:"إعدادات التطبيق"},feedback_subtext:{en:"Problems and suggestions",pt:"Problemas e sugestões",ar:"المشاكل والاقتراحات"},about_subtext:{en:"Information about the application",pt:"Informação acerca da aplicação",ar:"معلومات حول التطبيق"},contribute_subtext:{en:"Support the project's development",pt:"Apoiar o desenvolvimento do projeto",ar:"دعم تطوير المشروع"},star_subtext:{en:"Leave us a star on GitHub",pt:"Deixa-nos uma estrela no GitHub",ar:"اترك لنا نجمة على GitHub"},dock_label:{en:"DOCK",pt:"DOCA",ar:"محطة"},theme_setting_label:{en:"Theme",pt:"Tema",ar:"المظهر"},theme_setting_description:{en:"Application color scheme",pt:"Esquema de cores da aplicação",ar:"نظام ألوان التطبيق"},system_theme:{en:"System",pt:"Sistema",ar:"النظام"},light_theme:{en:"Light",pt:"Claro",ar:"فاتح"},dark_theme:{en:"Dark",pt:"Escuro",ar:"داكن"},daylight_theme:{en:"Daylight",pt:"Luz do dia",ar:"ضوء النهار"},locale_setting_label:{en:"Language",pt:"Idioma",ar:"اللغة"},locale_setting_description:{en:"Application language",pt:"Idioma da aplicação",ar:"لغة التطبيق"},system_locale:{en:"System",pt:"Sistema",ar:"النظام"},lock_distance_setting_label:{en:"Limit unlocking",pt:"Limitar desbloqueio",ar:"تحديد فتح القفل"},lock_distance_setting_description:{en:"Restrict bicycle unlocking distance to {{distance}} meters",pt:"Restringir a distância de desbloqueio de bicicletas a {{distance}} metros",ar:"تقييد مسافة فتح القفل إلى {{distance}} متر"},background_location_setting_label:{en:"Background location",pt:"Localização em segundo plano",ar:"الموقع في الخلفية"},background_location_setting_description:{en:"Continue updating the location while the device is locked or the app is in the background",pt:"Continuar a atualizar a localização enquanto o dispositivo está bloqueado ou a aplicação está em segundo plano",ar:"الاستمرار في تحديث الموقع أثناء قفل الجهاز أو التطبيق في الخلفية"},analytics_setting_label:{en:"Contribute to statistics",pt:"Contribuir para estatísticas",ar:"المساهمة في الإحصائيات"},analytics_setting_description:{en:"Contribute with the collection of anonymous events: app opening, trip starts and errors",pt:"Contribuir com a coleção de eventos anónimos: abertura da aplicação, começo de viagens e erros",ar:"المساهمة في جمع الأحداث المجهولة: فتح التطبيق، بدء الرحلات والأخطاء"},mock_unlock_setting_label:{en:"Simulate unlocking",pt:"Simular desbloqueio",ar:"محاكاة فتح القفل"},mock_unlock_setting_description:{en:"Simulate reservation and unlocking of bicycles in development mode",pt:"Simular a reserva e desbloqueio de bicicletas em modo de desenvolvimento",ar:"محاكاة الحجز وفتح القفل في وضع التطوير"},report_ratings_setting_label:{en:"Share trip ratings",pt:"Partilhar avaliações de viagens",ar:"مشاركة تقييمات الرحلات"},report_ratings_setting_description:{en:"Share your trip ratings with us so we can warn about bike conditions",pt:"Partilhar as suas avaliações de viagens connosco para que possamos avisar sobre o estado das bicicletas",ar:"شارك تقييماتك لنتمكن من التحذير بشأن حالة الدراجات"},ui_settings_section:{en:"Interface",pt:"Interface",ar:"الواجهة"},location_settings_section:{en:"Location",pt:"Localização",ar:"الموقع"},warnings_settings_section:{en:"Warnings",pt:"Avisos",ar:"التحذيرات"},statistics_settings_section:{en:"Statistics",pt:"Estatísticas",ar:"الإحصائيات"},development_settings_section:{en:"Development",pt:"Desenvolvimento",ar:"التطوير"},no_tokens_available_error:{en:"No tokens available",pt:"Sem tokens disponíveis",ar:"لا توجد رموز متاحة"},token_encryption_error:{en:"Error encrypting the token",pt:"Erro ao encriptar o token",ar:"خطأ في تشفير الرمز"},token_fetch_error:{en:"Error obtaining a token",pt:"Erro ao obter um token",ar:"خطأ في الحصول على رمز"},auth_api_communication_error:{en:"Could not communicate with the authentication API. The service may be temporarily unavailable.",pt:"Não foi possível comunicar com a API de autenticação da Gira. O serviço pode estar temporariamente indisponível.",ar:"تعذر الاتصال بواجهة برمجة المصادقة. قد تكون الخدمة غير متاحة مؤقتاً."},gira_api_communication_error:{en:"Could not communicate with the Gira service API. The service may be temporarily unavailable.",pt:"Não foi possível comunicar com a API do serviço Gira. O serviço pode estar temporariamente indisponível.",ar:"تعذر الاتصال بواجهة برمجة خدمة Gira. قد تكون الخدمة غير متاحة مؤقتاً."},auth_api_communication_error_retry:{en:"Could not communicate with the authentication API. Retrying...",pt:"Não foi possível comunicar com a API de autenticação da Gira. A tentar novamente...",ar:"تعذر الاتصال بواجهة برمجة المصادقة. جاري إعادة المحاولة..."},gira_api_communication_error_retry:{en:"Could not communicate with the Gira service API. Retrying...",pt:"Não foi possível comunicar com a API do serviço Gira. A tentar novamente...",ar:"تعذر الاتصال بواجهة برمجة خدمة Gira. جاري إعادة المحاولة..."},no_active_subscription_error:{en:"You don't have an active subscription",pt:"Não tem uma subscrição ativa",ar:"ليس لديك اشتراك نشط"},negative_balance_error:{en:"It's not possible to unlock bicycles if your balance is negative",pt:"Não é possível desbloquear bicicletas se o seu saldo for negativo",ar:"لا يمكن فتح قفل الدراجات إذا كان رصيدك سالباً"},location_determination_error:{en:"It was not possible to determine your position",pt:"Não foi possível determinar a sua posição",ar:"لم يكن من الممكن تحديد موقعك"},not_close_enough_error:{en:"You're not close enough to the station",pt:"Não está perto o suficiente da estação",ar:"أنت لست قريباً بما يكفي من المحطة"},bike_unlock_error:{en:"It was not possible to unlock the bicycle",pt:"Não foi possível desbloquear a bicicleta",ar:"لم يكن من الممكن فتح قفل الدراجة"},bike_unlock_no_serial_error:{en:"Bike identification number not found",pt:"Numero de identificação da bicicleta não encontrado",ar:"لم يتم العثور على رقم تعريف الدراجة"},service_hours_error:{en:"Service unavailable. Hours of operation between 06:00 and 02:00.",pt:"Serviço indisponível. Horário de utilização entre as 06:00 e as 02:00.",ar:"الخدمة غير متوفرة. ساعات العمل بين 06:00 و 02:00."},trip_interval_limit_error:{en:"You have to wait 5 minutes between trips",pt:"Tem que esperar 5 minutos entre viagens",ar:"يجب أن تنتظر 5 دقائق بين الرحلات"},already_active_trip_error:{en:"You already have an active trip",pt:"Já tem uma viagem ativa",ar:"لديك رحلة نشطة بالفعل"},trip_not_found_error:{en:"Trip not found",pt:"Viagem não encontrada",ar:"الرحلة غير موجودة"},bike_already_in_trip_error:{en:"This bike is already in a trip",pt:"Esta bicicleta já está numa viagem",ar:"هذه الدراجة في رحلة بالفعل"},bike_already_reserved_error:{en:"This bike is already reserved",pt:"Esta bicicleta já está reservada",ar:"هذه الدراجة محجوزة بالفعل"},no_bike_found_error:{en:"No bike found",pt:"Não foi possível encontrar a bicicleta",ar:"لم يتم العثور على دراجة"},bike_in_repair_error:{en:"This bike is in repair",pt:"Esta bicicleta está em reparação",ar:"هذه الدراجة قيد الإصلاح"},network_offline_warning:{en:"You are currently offline",pt:"Não está ligado à Internet",ar:"أنت غير متصل بالإنترنت حالياً"},update_warning_setting_label:{en:"Update warning",pt:"Aviso de atualização",ar:"تحذير التحديث"},update_warning_setting_description:{en:"Show a warning when a new version of the app is available",pt:"Mostrar um aviso quando uma nova versão da aplicação estiver disponível",ar:"عرض تحذير عند توفر إصدار جديد من التطبيق"},no_bikes_found:{en:"No bikes found",pt:"Nenhuma bicicleta encontrada",ar:"لم يتم العثور على دراجات"},search_other_bikes:{en:"Search for other bikes",pt:"Procurar outras bicicletas",ar:"ابحث عن دراجات أخرى"},ghost_bike_title:{en:"Missing bikes",pt:"Bicicletas em falta",ar:"دراجات مفقودة"},ghost_bike_description:{en:"You can try to retrieve bikes with a green light that do not appear in the system through their number.",pt:"Pode tentar retirar bicicletas com luz verde que não aparecem no sistema através do seu número.",ar:"يمكنك محاولة استرداد الدراجات ذات الضوء الأخضر التي لا تظهر في النظام من خلال رقمها."},ghost_dismiss_label:{en:"Attempt to unlock",pt:"Tentar retirar",ar:"محاولة فتح القفل"},bike_unlock_invalid_id_error:{en:"Invalid bike ID. It should be a 4-digit number.",pt:"ID de bicicleta inválido. Deve ser um número de 4 dígitos.",ar:"معرف الدراجة غير صالح. يجب أن يكون رقماً مكوناً من 4 أرقام."},privacy_section:{en:"Privacy",pt:"Privacidade",ar:"الخصوصية"},privacy_title:{en:"Your Privacy Matters",pt:"A Sua Privacidade Importa",ar:"خصوصيتك مهمة"},privacy_message:{en:"We believe your cycling journey is yours alone. Unlike other apps, we don't collect analytics, track your rides, or share your data with third parties. Your privacy isn't a feature – it's a promise. Ride free. Ride private.",pt:"Acreditamos que a sua jornada de ciclismo é só sua. Ao contrário de outras apps, não recolhemos estatísticas, não rastreamos as suas viagens, nem partilhamos os seus dados com terceiros. A sua privacidade não é uma funcionalidade – é uma promessa. Pedale livre. Pedale em privado.",ar:"نؤمن بأن رحلتك على الدراجة ملكك وحدك. على عكس التطبيقات الأخرى، لا نجمع إحصائيات، ولا نتتبع رحلاتك، ولا نشارك بياناتك. خصوصيتك ليست ميزة بل وعد."},disclaimer_title:{en:"Disclaimer",pt:"Aviso",ar:"إخلاء مسؤولية"},modified_app_disclaimer:{en:"This is a modified version of the original Gira application. This app has no official affiliation with EMEL, Câmara Municipal de Lisboa, or the original Gira service. It was created independently to provide an enhanced user experience based on community feedback.",pt:"Esta é uma versão modificada da aplicação Gira original. Esta app não tem qualquer afiliação oficial com a EMEL, Câmara Municipal de Lisboa, ou o serviço Gira original. Foi criada de forma independente para proporcionar uma experiência de utilizador melhorada com base no feedback da comunidade.",ar:"هذه نسخة معدلة من تطبيق جيرا الأصلي. لا علاقة رسمية بـ EMEL أو بلدية لشبونة."},developer_bio:{en:"Tech enthusiast with a peculiar hobby: fixing things that companies left broken. When users in Lisbon started complaining about Gira's endless bugs and crashes, I saw a puzzle worth solving. Some people collect stamps, I collect bug fixes. This app is proof that one person with too much free time can sometimes do what a whole team couldn't.",pt:"Entusiasta de tecnologia com um hobby peculiar: arranjar coisas que as empresas deixaram estragadas. Quando os utilizadores em Lisboa começaram a queixar-se dos bugs e crashes infinitos da Gira, vi um puzzle que valia a pena resolver. Algumas pessoas colecionam selos, eu coleciono correções de bugs. Esta app é prova de que uma pessoa com tempo livre demais às vezes consegue fazer o que uma equipa inteira não conseguiu.",ar:"متحمس للتكنولوجيا بهواية غريبة: إصلاح ما تركه الآخرون معطلاً."},support_development:{en:"Support Development ❤️",pt:"Apoiar o Desenvolvimento ❤️",ar:"❤️ دعم التطوير"}},Bu=qs("Network",{web:()=>lc(()=>import("./Dw5_WlVP.js"),[],import.meta.url).then(B=>new B.NetworkWeb)}),Cu=qs("Geolocation",{web:()=>lc(()=>import("./M7rWK9O2.js"),[],import.meta.url).then(B=>new B.GeolocationWeb)}),bm=new Map(Object.entries({E0001:"41db86c6da",E0002:"6e598f5de5",E0003:"e4db95c06a",E0004:"5ddb9e322a",E0005:"39597d3825",E0006:"f8db8e379a",E0007:"a45f398e4c",E0008:"0adb8dc69a",E0009:"d69cef9c39",E0010:"a0db9647aa",E0011:"c3597ae505",E0012:"a0db83f20a",E0013:"4f598e5dc5",E0014:"92597709b5",E0015:"11db88d89a",E0016:"1e59792b15",E0017:"3090f0eaba",E0018:"145976fec5",E0019:"84dba1c43a",E0020:"b459901865",E0021:"47db93b5ba",E0022:"10db99683a",E0023:"25db998dea",E0024:"b259789605",E0025:"4edba1ae9a",E0026:"38597dd9c5",E0027:"da598d6b65",E0028:"6359818e35",E0029:"8959947135",E0030:"68db8a83ba",E0031:"bddb919d6a",E0032:"f159838ea5",E0033:"45597b2245",E0034:"dbdb8d67ea",E0035:"b0598b2745",E0036:"ab14d75931",E0037:"c3597a7595",E0038:"81db8363ba",E0039:"afdb8719ea",E0040:"3adb8ce78a",E0041:"dddba418ba",E0042:"d7dba3258a",E0043:"d4597f8775",E0044:"f5a2703e19",E0045:"84599991d5",E0046:"3459781005",E0047:"eedba54ada",E0048:"f8598bbf95",E0049:"adf36ae9dd",E0050:"90597f43f5",E0051:"f95979ac75",E0052:"b3599a7505",E0053:"be5998cab5",E0054:"f1597e63b5",E0055:"86a2959829",E0056:"845995cd85",E0057:"addb8834ca",E0058:"addb85c93a",E0059:"bf5981e285",E0060:"4559825bc5",E0061:"34db9c790a",E0062:"71db9e1e2a",E0063:"d359923d25",E0064:"6edba4dbca",E0065:"e2db9e6dca",E0066:"61db8e7e4a",E0067:"cba2966699",E0069:"61a23c56a9",E0070:"84db84b16a",C0071:"ae5998bad5",C0072:"61db8f6f5a",E0073:"195978fdc5",C0074:"cf2e0cb15c",E0075:"b090e2c80a",E0076:"68598cd865",E0077:"02dba3f08a",E0078:"e6f3839b0d",C0079:"0bdb8d570a",C0080:"87db9d5b9a",E0081:"31a264ae59",E0084:"ef5979ea25",E0085:"525994aa35",E0086:"38597a3e25",E0087:"3b5978ffe5",E0088:"555977ee95",E0089:"6990ef3c2a",E0090:"6659860cb5",E0091:"17f37ca53d",E0092:"fe59793be5",E0093:"99db8e76ba",E0094:"27597a7175",E0095:"b559975e25",E0096:"5cdb9f928a",E0097:"d05992fee5",E0098:"3e5977b5a5",E0099:"4990e98aba",E0100:"c0597ed235",C0101:"d69cef9c39",E0103:"e990d7248a",E0104:"a1597ad755",E0105:"a1db84748a",E0106:"6edb938caa",E0107:"5A2E0DB5CC",C0108:"0490f19ffa",E0109:"9b90e4658a",E0110:"f92e065d8c",E0111:"c259834d55",E0112:"31a26b21d9",E0113:"de90ee9a3a",E0114:"cedb98b73a",E0115:"2ea2974259",C0116:"4f598e5dc5",E0118:"87a25d3149",E0121:"192E100B2C",E0122:"6090ecc6da",E0123:"7d90f1869a",E0124:"0d2e09567c",E0125:"86db9a5d9a",E0126:"2a90e989da",E0127:"e62e0d894c",E0128:"0b90ef5e2a",E0129:"b79cfffd29",E0131:"eedb93bc1a",E0132:"7590ee919a",E0134:"4090d71d1a",E0136:"2790f2ffba",C0137:"3ddb8a86ea",C0138:"f45985cde5",E0139:"73dba2909a",E0140:"5da2582e89",E0141:"7b5977a0f5",E0142:"fa90f2f26a",E0143:"1f90ecd9ba",E0144:"75598851f5",E0145:"73f386cbcd",E0146:"bb59802745",E0147:"435997b835",E0149:"e7db8bbd0a",E0151:"1E2E0B271C",E0152:"f0598c7055",E0153:"eda270e6d9",E0154:"bd59910075",C0156:"54db8d585a",E0157:"9f5980f3b5",E0158:"422e06563c",E0159:"0bdb8d570a",E0160:"015980bd65",E0163:"a1db9535da",E0164:"91db8dbd7a",E0165:"4a5477b2db",C0166:"dbdb8d67ea",E0167:"9d597c7dc5",C0168:"73db97b58a",E0170:"24598931c5",E0171:"0f59996aa5",E0172:"a590f3ac6a",E0173:"aa9cf27db9",E0174:"1359944b95",C0175:"e2db84b70a",E0176:"2990f3b0fa",E0177:"bda2950389",E0178:"162e0afecc",E0179:"70db8afbda",E0180:"d4597901f5",E0182:"702e0bf9ac",E0183:"06f36ac25d",E0184:"26db9c7b1a",E0185:"5590f44b7a",E0187:"0490f19ffa",C0188:"50db9e2f3a",C0189:"55a2803e49",C0190:"acdb85c83a",E0191:"002e0e5c7c",E0192:"baf382b67d",E0193:"3df38596dd",E0194:"66db9fc8ea",E0195:"c5db9c68ea",E0196:"96db95429a",E0198:"30db96b7ca",E0199:"aa59999ff5",E0200:"b4db9550aa",E0201:"1ff37b5acd",E0202:"8b597a2d85",E0203:"d42dfce9ec",E0204:"34db9a7f0a",E0205:"bb90e0519a",E0206:"addb814dba",E0207:"8f598390c5",E0208:"5edb9ae5fa",E0209:"2edb8dc2ba",E0211:"4d5979a8c5",E0212:"8e2df0bfec",C0213:"efdb8cb20a",C0214:"f5db8a2e8a",E0216:"33597a8595",E0217:"aadba378aa",E0218:"a1db9ece2a",E0219:"7cd4aca6a2",E0220:"3edb93dcaa",E0221:"9390ed04ea",E0222:"1659928855",E0223:"8159802d75",E0224:"262E0FABAC",E0225:"76dba4d3da",E0226:"6b59767135",E0228:"ac597e7ef5",C0229:"02db8182da",E0230:"a159926f05",E0231:"4ddb99b5ba",E0232:"30db86177a",C0233:"75db87f3da",E0234:"74a2926d29",E0235:"f4db8da80a",E0236:"9d599a3b65",E0237:"03db90125a",E0238:"c0db9b2aaa",E0239:"dadb9e45da",E0240:"36db86c1aa",C0241:"a1db84748a",E0242:"ffdb847ada",E0243:"7914d4b801",E0244:"09597c7955",C0245:"c7db8fe97a",E0247:"c5db9662ea",E0248:"73db91033a",E0249:"d4db9a7fea",C0250:"5cdb9f928a",E0251:"da5480b5bb",E0252:"1a597b8db5",E0253:"acdb8f827a",E0254:"59597db8c5",E0255:"28597cf8f5",E0256:"6690e71b0a",E0257:"3fdb9ef08a",E0259:"29599520c5",E0261:"4b2e16afdc",E0262:"c39d092e79",C0264:"ed597908c5",C0265:"a2db9003ea",E0266:"eb59999eb5",E0267:"52f3732ffd",E0268:"6ddb9e321a",E0269:"312e07342c",C0270:"8f598192c5",C0271:"729cfe4959",E0273:"6d90f0070a",E0274:"ab90e203da",E0275:"f7dba1c74a",E0276:"e8db846dda",E0277:"7390eda4aa",E0278:"7fdb96281a",C0279:"f8db8e379a",C0286:"bbdb92a85a",C0287:"d7dba3258a",E0288:"abf38326fd",E0290:"67a27b8739",E0291:"f690d9e55a",E0292:"8ddba12dda",E0293:"18a285e6d9",E0294:"0190dc377a",E0295:"8f90e8cd3a",C0296:"4edba1ae9a",E0297:"8a5985c395",E0298:"d5db81e56a",C0299:"b759861d75",E0300:"49db9ed6da",E0302:"dadb8a61ea",C0303:"b259789605",E0304:"3ddb8e620a",E0305:"4a599a5cd5",E0306:"70a2966d29",E0308:"4cdb99848a",E0309:"77db8b1d3a",C0311:"28597cf8f5",E0312:"c95977e205",E0313:"1f598467a5",E0314:"12db97b4ea",E0315:"41598f1285",E0316:"38db8ce58a",E0317:"6b598d6ad5",C0318:"2390d9d0ba",C0319:"c0597ed235",E0320:"39db9bd3aa",E0321:"a0f37c321d",E0322:"f6db87e04a",E0323:"392e0af1ec",E0324:"28db85dcaa",E0326:"699cf10d09",E0327:"7b2e16afec",E0328:"62598b9525",E0329:"99db821ada",E0330:"b5db8723ca",E0331:"bb5999ceb5",E0332:"e2db84b70a",C0333:"d4597f8775",C0334:"45597b2245",E0335:"3ddb8a86ea",E0336:"8a59947235",E0337:"672e02377c",E0338:"98dba45dba",E0339:"0edb8fe0ba",E0340:"6fdb98b69a",E0341:"4ca27027b9",E0342:"abdb9f856a",E0343:"dedb86991a",E0344:"74d4c2b0d2",E0345:"75db8d496a",E0346:"27db893f4a",E0348:"dbdb89139a",E0349:"8ff34beadd",C0350:"1a597e6855",E0351:"8659800a55",E0352:"13db92005a",C0353:"61a23c56a9",E0354:"75db87f3da",E0355:"6bdb912b0a",E0356:"ccdb8dc05a",C0357:"addb8834ca",C0358:"be5998cab5",E0359:"addb978b6a",E0361:"b759877c15",E0362:"42db98bbba",E0363:"09597f8aa5",E0364:"2759802bd5",C0365:"8259946a25",E0367:"3fdb96b8ca",E0368:"875979c265",E0369:"13db91b3ea",E0370:"d55988b1b5",E0371:"e159877a45",E0372:"2c597e7e75",E0373:"1aa272f339",E0374:"02dba2f18a",C0375:"d6597de715",E0376:"1e597b1925",E0377:"425994aa25",E0378:"f1db88d87a",E0379:"1a59805695",E0380:"c6599a2025",C0381:"b65982b8d5",E0382:"5adb93889a",E0383:"15598ae325",E0384:"64dba0657a",E0386:"a7a2580459",E0387:"be59889af5",E0388:"31db9c7c0a",C0389:"0259946aa5",E0390:"61a2966c39",E0392:"2c5990a045",E0393:"2e598527d5",E0394:"1fdb8d632a",E0395:"7d2e0699cc",E0396:"6b597a3d75",E0397:"bbdb912bda",E0398:"6759860db5",E0399:"e4dba5a03a",C0400:"7b5977a0f5",E0401:"ce2e0e52bc",E0402:"c659931915",C0403:"0bdb92783a",E0404:"caa29d4cb9",C0406:"f95979ac75",E0407:"3edb952a5a",E0408:"58db9d544a",E0409:"a25979c745",E0411:"90597a76c5",E0413:"d25978a655",E0415:"eadb9fc46a",E0416:"b3597d32a5",E0417:"89db8cf42a",E0420:"eadb92d97a",E0421:"dbdba59f3a",E0422:"b8598f0b65",E0424:"2edb854a3a",E0425:"b9db8c14fa",C0427:"4590ea655a",E0428:"a0db87768a",C0429:"3390ef662a",E0430:"54a23dd219",E0431:"c2f377fbbd",E0432:"b059975b25",E0433:"e959799c55",C0434:"8c90ee788a",E0435:"99db964e9a",E0436:"f0dba0911a",E0437:"85dba5b14a",E0438:"169d00b239",E0439:"79db97ffca",E0443:"95db87438a",E0446:"3edb96b9ca",E0447:"8290ed05fa",E0448:"c4db986dea",E0449:"2d598e7f85",E0451:"955997bee5",E0452:"47598e8515",E0453:"265980ca35",C0454:"1359944b95",C0455:"b3599a7505",C0456:"d290f1992a",E0457:"8f5981a2f5",E0458:"33db8a680a",E0459:"cf598e3d25",E0460:"d7f37c356d",C0461:"7790f18c9a",E0463:"f7597922f5",E0464:"12dba2f19a",E0466:"b190df54aa",C0467:"c490eb55ea",E0468:"d0db9c7dea",E0470:"7f2e0f326c",E0471:"f659841e35",E0472:"d42e090ffc",E0473:"d6597de715",E0475:"5559869f15",E0477:"7490e2acaa",E0478:"f9598bbe95",E0479:"0bdb92783a",E0480:"b0f37d330d",E0481:"50db81808a",C0482:"9159802d65",C0483:"5c59767605",C0484:"0adb8dc69a",E0485:"ca597d3bd5",C0486:"86a2959829",E0487:"0259946aa5",C0488:"b6db8512fa",E0489:"ebdb817bca",E0490:"b759861d75",E0491:"f6598a5075",E0493:"bcdb9a37ca",E0494:"bbdb92a85a",E0495:"2edb953a5a",E0496:"1559804985",C0497:"2b5978fff5",E0498:"0f2e02dffc",C0499:"8d2e0fc06c",E0500:"315978b5a5",E0501:"8590f44baa",E0502:"0cdb9f125a",E0503:"f6db92e55a",E0504:"48dba30a3a",E0505:"682e03c98c",E0506:"c359885745",E0507:"51599835a5",C0508:"2c597e7e75",E0509:"a1db9d6d8a",E0510:"45db93474a",E0511:"9b597c7bc5",E0512:"b4dba5a06a",E0513:"055991a865",E0514:"00db9b2a6a",E0515:"54db8d585a",E0516:"51597bc6b5",E0517:"61db8f6f5a",E0518:"c19ceeea59",E0519:"c4a29d02f9",E0521:"08db86bfea",E0522:"9fdb817fba",C0523:"ac59798905",E0524:"9159853875",C0525:"569cf91a29",E0526:"ae5998bad5",E0527:"e159869ba5",C0528:"52db85464a",E0529:"bb59901765",E0530:"2ba23b9b29",E0531:"2659902ac5",E0533:"6adb83487a",E0535:"c8db89a03a",C0536:"dcdba37eda",E0537:"0bdb876d3a",E0538:"dd5994b5a5",E0539:"f85978fc25",E0540:"4edba38cba",E0541:"532df072fc",E0542:"96db97e03a",E0543:"825998b6f5",E0544:"1adba07b1a",E0546:"612dffdf6c",E0547:"e5db95c16a",E0548:"2ea276e319",C0549:"31db9c7c0a",E0550:"8d2dfb673c",E0552:"6f598a09b5",C0553:"96598ad095",E0554:"bfdb90be4a",E0555:"4e90d7d3da",E0556:"a9db9df51a",E0557:"e3db98ca6a",E0558:"e5db8652ea",E0559:"1759915a85",E0560:"a7db988e6a",E0561:"21db91214a",E0562:"2d5993d235",E0563:"f159945965",E0564:"c290ef47fa",C0565:"3edb952a5a",E0566:"58a27625a9",E0568:"3cdb82dfba",E0569:"c4d450a2e2",C0570:"22db88cbba",E0571:"4bdb849e8a",E0572:"00db82530a",C0574:"30db96b7ca",E0575:"8e2e0e42ec",E0576:"bfdb8957ba",C0577:"1edb9f90ca",E0579:"5559829b15",E0580:"b8db8c15fa",C0581:"e8db98913a",E0582:"f05986eac5",E0585:"aa2e063ebc",C0586:"d3598bd4d5",E0587:"ed59997855",E0588:"3cf366f45d",E0589:"d3598bd4d5",C0590:"bbdb93d92a",E0591:"5459794135",E0592:"63db9a381a",E0593:"2dd455ae02",E0594:"70db90211a",E0595:"1190f2f98a",E0596:"f159827f55",E0597:"f259951b25",E0599:"93db8f0dca",E0601:"b5db8baf4a",E0602:"16db94134a",E0605:"06597b91b5",E0606:"6adb8d86ba",E0607:"b32e04c55c",E0608:"d82e09738c",E0610:"fa5996b085",E0611:"28db8a136a",E0613:"5ef37272ad",E0614:"5e598123a5",E0615:"86f37d050d",E0616:"9c2e06f84c",E0617:"312e0c2f3c",E0618:"5e598260e5",E0619:"502e0ffd8c",E0620:"90598db1f5",E0621:"42db92212a",E0622:"6f598112a5",E0623:"ec59855565",E0624:"ef2e0e438c",E0625:"3adb874c2a",E0626:"04598D8555",E0627:"b2db9e6d9a",E0628:"6edb8c132a",E0631:"6edb89b68a",E0632:"10a2a01b09",E0633:"7159893495",E0634:"f52dfdf9dc",E0635:"e5d4c8bb42",E0637:"a759777cf5",E0639:"29db8da5da",C0640:"47db93b5ba",E0642:"aca270f789",E0643:"652E0493DC",E0646:"c02e05e70c",E0649:"005994a865",E0650:"18598fdb15",E0651:"2edb85daaa",E0652:"90597dc175",E0653:"a459800875",C0654:"8e2ec36201",E0655:"16597ec4f5",E0657:"0e598062b5",E0658:"06a26f62a9",E0660:"012e08cbec",E0661:"8da261f7b9",E0662:"d75999e2f5",E0663:"4690d71b1a",E0665:"56597f4535",E0666:"c92e101bec",E0667:"c1dba0902a",E0669:"f6a23fe289",C0670:"c1db93830a",E0671:"68599672d5",E0672:"6e598b2995",E0673:"4e2e0eb2dc",E0674:"3459948c75",E0675:"6a5985b305",E0676:"bd59801175",E0677:"fddb961aaa",E0679:"905980cc85",E0680:"2edba1aefa",E0681:"d859794db5",E0682:"e4db9065ca",E0683:"63db83013a",E0685:"30db8e7f1a",E0687:"c5597ad335",E0689:"155998a175",E0690:"a6db98df3a",E0691:"8ddb861aca",E0692:"7edba08f8a",E0693:"25db87532a",C0694:"98dba45dba",E0695:"1c2e19b79c",E0696:"60a2a46f09",E0699:"882e03b91c",E0701:"24598db545",C0702:"f1597e63b5",E0703:"2da23b9d29",E0704:"64598b9325",E0705:"432E0E6F0C",E0706:"2bdb81abda",E0707:"9fa2401469",E0708:"A32E1C2DBC",E0709:"00a23d0699",E0710:"622E05F5BC",E0711:"8a597a1cb5",E0712:"f7db9fa91a",E0713:"9b597a3d85",E0714:"1fdba4daba",E0715:"4adb89a2ba",E0716:"9ea29dd879",E0717:"9890dcee3a",E0718:"0d599031f5",E0719:"a0db84758a",E0720:"bb5989ee85",E0721:"f9dba4fc7a",E0722:"ab90eb2afa",E0723:"9ea27ffab9",E0724:"02a26f4689",E0725:"a5db883cca",E0726:"2d597e7f75",E0727:"21db9a7a1a",E0728:"56db9ed9ca",E0729:"e1db8363da",E0730:"0c598939e5",E0731:"24dba1a4fa",E0732:"77598a51f5",E0733:"44597f4725",E0737:"5e59940695",E0738:"aaf37c785d",E0739:"b0db84759a",E0740:"8459933b75",E0741:"f5dba1c54a",E0742:"d159923f25",E0743:"e12e0ead6c",E0744:"8fdb8b25fa",E0746:"e8597a7eb5",E0747:"815998d595",E0748:"185979cdf5",E0750:"3c90de780a",E0752:"78db855c7a",E0753:"cea28aff19",E0754:"7a90f2425a",E0755:"de59902235",E0756:"345982da35",E0757:"abdba1db0a",E0758:"6c598afa45",E0760:"95f3612a2d",E0763:"ab59952245",E0765:"4ddb98949a",E0767:"8fdb8c924a",E0769:"27db90d6ba",E0770:"b390dab34a",E0771:"ce598ae8f5",E0772:"26598933c5",E0773:"e9db95dd7a",E0774:"5ca29bacc9",E0775:"51db89b9ba",E0776:"f85981f5d5",E0777:"8ddb936faa",E0778:"2659819b65",E0779:"892e08c36c",E0780:"355981e805",E0781:"252e12b5ac",E0782:"562e085c2c",E0783:"6d2e019edc",E0784:"4c2e0ab4dc",E0786:"f4a2922de9",E0787:"eb2e09408c",E0788:"43db988a8a",E0789:"f42e02548c",E0790:"c12e1003fc",E0791:"8a2e0fb71c",E0792:"502e03a1dc",E0793:"dfdb86b83a",E0794:"81598c0155",E0795:"a0598f1365",E0796:"c2f38c70cd",E0797:"dc2e00be4c",E0798:"9c2e19b71c",E0799:"762e0f7b2c",E0800:"c3597c43a5",E0801:"61f37a957d",E0802:"c1db8f6ffa",E0803:"65599940e5",E0805:"132e1a1b3c",E0806:"322e00001c",E0807:"8e2e070bac",E0808:"962e03972c",E0809:"7e2df00fac",E0810:"7b2e0db4ec",E0811:"d02e0b897c",E0812:"db2e0da45c",E0813:"0a2e0f173c",E0814:"f82e066cbc",E0815:"202e097b7c",E0816:"c12e11629c",E0817:"9c2e0e902c",E0818:"822dffbcec",E0819:"b82e16cc4c",E0820:"7e2e02beec",E0821:"b82e066cfc",E0822:"ba2e0d45dc",E0823:"852e0255fc",E0824:"A12E0457DC",E0825:"bc59799905",E0826:"082e0b715c",E0827:"f1db8dbd1a",E0828:"a52e12b52c",E0829:"b32dff7d1c",E0830:"432e0f2e4c",E0831:"c52df9bdac",E0832:"76db82f5da",E0833:"a090d67c9a",E0834:"2b599017f5",E0835:"c4599a0205",E0836:"b25977b925",E0837:"2f90d92c4a",E0838:"cddba1fd4a",E0839:"fadb83d87a",E0840:"6c2e0f410c",E0841:"102dff8e4c",E0842:"7f2e072a7c",E0843:"5c2e1a84ec",E0844:"7cdb80fdda",E0845:"805980cc95",E0846:"112e0ead9c",E0847:"1D2E0EA19C",E0848:"1a90e8c8aa",E0849:"e6598dc7f5",E0850:"225985ab55",E0851:"eb2e067fbc",E0852:"4c2e0cc2ac",E0853:"8c2e1907bc",E0854:"082e11dbec",E0855:"fa59786eb5",E0856:"b5db9723da",E0857:"fcdb874aea",E0858:"e9598782b5",E0859:"7c2e0c92cc",E0860:"f42defdaec",E0861:"222e0e6e6c",E0862:"ae2e0d119c",E0863:"c32dffbdac",E0864:"bb2defc5bc",E0865:"542e09dfac",E0866:"f0d46680c2",E0867:"642e11570c",E0868:"322dfffc1c",E0869:"372e0f5a4c",E0870:"de2e0fb34c",E0871:"c92e106b9c",E0872:"7b2e043d6c",E0873:"682e1d376c",E0874:"202e05575c",E0875:"2f2e06fbfc",E0876:"c72e1005fc",E0877:"472e0aef8c",E0878:"3b2e069f8c",E0879:"b3dba2905a",E0880:"1f5998eb35",E0881:"6b90f5040a",E0882:"0fdb835d0a",E0883:"11dba1016a",E0884:"91f379f6ed",E0885:"0cdb835e0a",E0886:"a2db9003ea",E0887:"1359832ce5",E0888:"96598ad095",E0889:"37db9adcaa",E0890:"e35990af85",E0891:"a059946805",E0892:"e8db98913a",E0893:"c7db8fe97a",E0894:"b990eb589a",E0895:"b35998d7a5",E0896:"93db8e7cba",E0897:"0adba2691a",E0898:"5cdb94998a",E0899:"9d597667d5",E0900:"569cf91a29",E0901:"2b5978fff5",E0902:"d290f1992a",E0903:"badb9b40ba",E0904:"5c59767605",E0905:"c3db9d8f0a",E0906:"8d2e0fc06c",E0907:"ad59798805",E0908:"90597f3385",E0909:"3a59868065",E0910:"4590ea655a",E0911:"7d598e3f95",E0912:"ae5991b3d5",E0913:"73db97b58a",E0914:"cf2e0cb15c",E0915:"ed597908c5",E0916:"2a90dd0d6a",E0917:"fa597c4a95",E0918:"86db82c51a",E0919:"b65982b8d5",E0920:"24597ae2e5",E0921:"addb9bb75a",E0922:"9b59987f25",E0923:"b190e71cda",E0924:"1e597a7845",E0925:"bbdb93d92a",E0926:"8259946a25",E0927:"a659777df5",E0928:"be59994b35",E0929:"7790f18c9a",E0930:"02db8182da",E0931:"03db9c9eda",E0932:"c25997b9b5",E0933:"36dba1f6ba",E0934:"87db9d5b9a",E0935:"68597db9f5",E0936:"8c59935315",E0937:"33db85177a",E0938:"c9a273a1b9",E0939:"efdb8cb20a",E0940:"23db91234a",E0941:"fedb918e3a",E0942:"8e2ec36201",E0943:"315985c825",E0944:"f45985cde5",E0945:"01db8f4f1a",E0946:"a5dba3479a",E0947:"ea597630f5",E0948:"6fdb901e3a",E0949:"55a2803e49",E0950:"88db98915a",E0951:"d65976cc35",E0952:"3cdb9a374a",E0953:"ab2e0c058c",E0954:"1e5978aa95",E0955:"b059952955",E0956:"fedb8f309a",E0957:"8c90ee788a",E0958:"d65993b9a5",E0959:"e1597c31f5",E0960:"532e06374c",E0961:"3390ef662a",E0962:"22597b2525",E0963:"c3db9042ca",E0964:"c490eb55ea",E0965:"8f598192c5",E0966:"a9db835baa",E0967:"0f59889b45",E0968:"ac5977a725",E0969:"1edb9f90ca",E0970:"a2db9bb85a",E0971:"c6db97e06a",E0972:"48db95fcfa",E0973:"5859991d85",E0974:"31db81a1ca",E0975:"bd597d4cd5",E0976:"b4597f27b5",E0977:"d1db84b43a",E0978:"f5db8a2e8a",E0979:"3c547f4c5b",E0980:"a359789715",E0981:"c3a2969e69",E0982:"b15993ee95",E0983:"50db9e2f3a",E0984:"5390f44d7a",E0985:"bd59900175",E0986:"fddb8e52fa",E0987:"52db85464a",E0988:"bc598adab5",E0989:"2a2e062e2c",E0990:"5ba2804039",E0991:"f659971d25",E0992:"b05981ed85",E0993:"5990de9d8a",E0994:"acdb85c83a",E0995:"45597d0465",E0996:"4a598cea75",E0997:"4e598537a5",E0998:"09597b1e35",E0999:"07597c87a5",E1002:"942e02249c",E1003:"e92e0c27ec",E1004:"662e05f1bc",E1005:"cb2e042dcc",E1006:"3ed4ac5412",E1007:"a5598e87f5",E1008:"80d4a721d2",E1009:"bad4b4c812",E1010:"a7d4c53482",E1011:"6cd4502ac2",E1012:"b8d4a31dd2",E1013:"7fd4b29b82",E1014:"30d4b13762",E1015:"fad46dd192",E1016:"4fdba4faca",E1017:"02d4b24622",E1018:"c0d4b3c562",E1019:"85d4a26192",E1020:"1f2e0fc2fc",E1021:"3ed4c1a982",E1022:"9bd4a78a62",E1024:"c3d4c005d2",E1025:"dc2e044abc",E1026:"d7d4a6f752",E1027:"21d4c95e62",E1030:"44d4ab1922",E1031:"c1db80e07a",E1032:"0c2e000e2c",E1033:"c7d4c24392",E1034:"59d4b36c52",E1035:"41d4a46352",E1036:"e6d4b89812",E1037:"3fd4b70e52",E1038:"fed4a4ac22",E1039:"74d4a29092",E1040:"7fd4b8d1c2",E1041:"ecd4d349a2",E1042:"78d4c896f2",E1043:"f3d4a9cc42",E1044:"56d4b44472",E1045:"70d46ddb12",E1046:"b8d4d1ef52",E1047:"64d4a74552",E1048:"fbd4514c32",E1049:"24d4a77522",E1050:"ca598bbda5",E1051:"01d4b4a3c2",E1052:"43d4b14462",E1053:"67d4b09192",E1054:"99d4a89772",E1055:"57d4b594a2",E1056:"8bd4a7da22",E1057:"71d4668142",E1058:"f12e03a07c",E1059:"56d4a50522",E1060:"b9d4d18e32",E1061:"9ad4d9f562",E1062:"c5d4586b22",E1063:"e1d4b423a2",E1064:"46d4b15172",E1065:"69d4aa0512",E1066:"dbd4aa3792",E1067:"a5d4a427f2",E1068:"c6d459b9f2",E1069:"25d4b8db92",E1070:"d92e0952ac",E1071:"4bd45964a2",E1073:"16d455e572",E1074:"3bd4aa0742",E1075:"54a2530ca9",E1076:"62d4a2b6a2",E1077:"d1d4512672",E1078:"a3d4514462",E1079:"a7d4a425f2",E1080:"4d2e07482c",E1082:"bed4c169c2",E1083:"2BD4AE3362",E1084:"91d4b96e92",E1085:"a8d457d9f2",E1086:"e0d46ddb82",E1087:"7a2e062e7c",E1088:"07d469e852",E1089:"78d4df91e2",E1090:"6dd4bdf6f2",E1091:"12d4aa9ef2",E1092:"a6a2873ab9",E1094:"d4d4b82a92",E1095:"ffd4b48d12",E1096:"0ad4520e82",E1098:"D72E0702FC",E1099:"f4d4520072",E1100:"622e0ccc8c",E1101:"3dd4593282",E1102:"6cd4715b92",E1103:"1ea27acf09",E1104:"24d4ac0e52",E1105:"882e006acc",E1106:"edd4b68d02",E1107:"ae2e0fa32c",E1108:"2ed4b28ac2",E1109:"38d4dfa192",E1110:"542df075fc",E1112:"302e0f8d9c",E1113:"c8d4a947f2",E1116:"dbd4ab66c2",E1117:"d0d4a442e2",E1118:"4e2e105c2c",E1119:"a9d4538ca2",E1120:"932e0647fc",E1121:"7dd4650ec2",E1122:"eed46e6632",E1123:"17d4a2c3a2",E1124:"9bd4767b42",E1125:"6e2e0df1bc",E1126:"2bd4abf6a2",E1128:"1959928755",E1129:"472e0ebbdc",E1130:"8bd4c9e472",E1131:"a5d45380a2",E1132:"55d4cf1c52",E1134:"fb2df07a5c",E1135:"2e2e06fafc",E1136:"81d4ca2db2",E1139:"55d4ad3e12",E1140:"3fd4cc0522",E1141:"065980da05",E1142:"b6d4bb8b52",E1143:"e7d4c8b942",E1144:"f4d4b4a632",E1145:"77d4a2f3f2",E1146:"2dd45358f2",E1147:"52d4c82c62",E1148:"6fd4bf9692",E1149:"d2597a7485",E1150:"6fdb90ae8a",E1151:"53d45fba62",E1152:"88d450aea2",E1153:"c3d4ab6ed2",E1154:"e12e0300cc",E1155:"c1d46ddaa2",E1157:"0fd4c97062",E1158:"b0d4b2a472",E1159:"f1d4b93ea2",E1160:"8cd4d88202",E1161:"f72e0faa7c",E1162:"eed4d34ba2",E1163:"05d462a112",E1164:"61d4ab9c82",E1165:"83d4badf32",E1166:"28d4a46a32",E1167:"e3d4b732b2",E1168:"29d4bcf3b2",E1169:"04d463b102",E1170:"f2d4b652c2",E1171:"34d4bc1e42",E1172:"5dd4a27952",E1173:"c2d4d1a562",E1174:"22d4668212",E1175:"132e06172c",E1176:"2ea2689d79",E1177:"f1d4b4a332",E1179:"d6d4ba8a32",E1180:"a059893545",E1182:"06d4b37312",E1183:"edd4a41f82",E1184:"57d4d899c2",E1185:"15d4b1b2c2",E1186:"61597ff2b5",E1187:"c6d450f0b2",E1188:"c12e0b58bc",E1189:"f2d4a69212",E1190:"92d4cde962",E1191:"b2d4b226f2",E1192:"37d45766d2",E1194:"2ad4b5f9b2",E1195:"b8d4623c32",E1196:"2cd4b45e12",E1197:"36d4bd5d02",E1198:"1a2e07cffc",E1199:"3fd457fe42",E1200:"412e03a0cc",E1201:"aad464a8b2",E1202:"c7d4a78632",E1203:"16d4c23232",E1204:"2cd4c52f12",E1205:"c3d4d500c2",E1206:"a4d4aac812",E1207:"c6dba0b70a",E1208:"99d4c70882",E1211:"07d45dac22",E1212:"f2d4b86cf2",E1213:"ecd4516b02",E1216:"1a2e024a7c",E1217:"d5d4a2c162",E1219:"64d4bffdf2",E1220:"f12e0ead7c",E1221:"3cd4b02a72",E1222:"5ad4cbe7a2",E1224:"e32e0071bc",E1225:"24d4a684d2",E1226:"5ed4c9c182",E1227:"75d4649752",E1228:"9bd4bf02f2",E1229:"132dffdd1c",E1230:"eed4a3eb72",E1233:"C62DF0C7DC",E1234:"afd4b47db2",E1235:"0da2922419",E1236:"d2d45befb2",E1237:"38d45e70c2",E1238:"6a2e05dd9c",E1239:"bbd4a7ba72",E1240:"43d4aa7f42",E1241:"bad4cdf152",E1242:"7adb97fcca",E1243:"59d4acb392",E1245:"b1d465b2b2",E1246:"bad46d7172",E1247:"a7d4c302b2",E1248:"65d45ffc12",E1249:"33db95275a",E1250:"bbd4d419a2",E1251:"34d4c1b392",E1252:"fad4b18d12",E1253:"c4d4ccde02",E1254:"fbd4b18c12",E1255:"5ed4adc5e2",E1257:"d4d450c292",E1258:"6ed4c4dca2",E1259:"23d4b90c42",E1260:"f9d4a54ac2",E1261:"41d4ac8bb2",E1262:"b02e0745dc",E1263:"efd4a920b2",E1264:"87d4b97892",E1265:"43d4b6b392",E1266:"27d4ccad92",E1267:"bd2dff137c",E1268:"7b2dff852c",E1269:"e3d4665302",E1270:"7d59771645",E1271:"edd4d36882",E1272:"ffd4df8672",E1273:"212e0b787c",E1274:"7c2e053b6c",E1275:"db2e06df2c",E1276:"93d4c4d152",E1277:"03d4d1d4d2",E1278:"37d4c95872",E1279:"4bd4b95472",E1280:"a62e11a53c",E1281:"b6db92e51a",E1282:"522E00A0DC",E1283:"2ed4b01852",E1284:"aed4b2fa32",E1285:"60d4c11762",E1286:"82d4b48062",E1287:"d2d4b90db2",E1288:"71d45e6992",E1289:"15d4cfbcb2",E1290:"db2e067f8c",E1291:"64d4a67462",E1292:"a1d4cdba02",E1294:"8cd4b44ea2",E1295:"45d4e04332",E1296:"6ed4b5cdc2",E1297:"eed4a3fb62",E1298:"d0d4aafc52",E1299:"74d46f2de2",E1300:"3ad4b86432",E1301:"78d4ab7572",E1302:"d2d4cc8842",E1303:"38d465db52",E1305:"8ed4c32bb2",E1306:"83d4cc79e2",E1307:"efd4510862",E1308:"3b2e05fcec",E1309:"25d4bd5e12",E1310:"34d4cab892",E1311:"332E00716C",E1313:"61d45f38d2",E1314:"65d46ead72",E1315:"ab2e00098c",E1316:"04d4ae1c62",E1317:"5a2e042c5c",E1318:"34d4ac4e02",E1319:"115993be65",E1320:"fad4a448c2",E1321:"24d4bd3f72",E1322:"2fd4c4dde2",E1323:"14d4b43642",E1324:"2ad4a46832",E1325:"292E06CDCC",E1326:"9bd471bc82",E1327:"412e09badc",E1328:"c72df0e6fc",E1329:"7dd4c56e02",E1331:"bcd459c3f2",E1332:"812e06a50c",E1334:"132e00013c",E1336:"0dd4a2a9d2",E1338:"0cd4b1bbd2",E1339:"0cd4a6ccb2",E1340:"73d4bd6872",E1341:"9bd4b845b2",E1342:"f6d4515122",E1343:"ad2e02ed6c",E1344:"e1d4c49362",E1345:"41d46dfa02",E1347:"b6d4aa0ac2",E1348:"e92e0863ac",E1349:"01d4d8bfb2",E1350:"25d4ab1842",E1351:"75d4c8fb92",E1352:"a9d4df10b2",E1353:"8ed4758da2",E1354:"4ad4cf7322",E1355:"0cd4acd6a2",E1356:"0e2dfbd40c",E1357:"34d4b17322",E1358:"1A2E0CD4EC",E1359:"692e0f440c",E1360:"c2d4d9ed22",E1361:"44d4b36142",E1362:"5cd4c8a2e2",E1364:"39d468c742",E1365:"562e0397ec",E1366:"37d4b081d2",E1367:"fbd473fea2",E1368:"4cd4b27852",E1369:"53d4cb0e42",E1370:"20d4d1f7d2",E1371:"afd4aa03d2",E1372:"5fd4a74e62",E1373:"e8d4623c62",E1374:"65d4566582",E1375:"6dd4a88392",E1376:"97d4b6c732",E1377:"12d4b13542",E1378:"27d4c04172",E1380:"f2d4b94dd2",E1381:"e5d475a6e2",E1383:"222e16b6ac",E1384:"dbd4a4e942",E1385:"1fd4c1b8b2",E1386:"c1d4ab4cf2",E1387:"552E0E89FC",E1390:"d8d469e782",E1391:"81d4afe812",E1392:"3ed4c1d9f2",E1393:"cf2e00bd5c",E1395:"66d450f012",E1396:"63d4af8a92",E1398:"43d4b3d6f2",E1400:"092e0e557c",E1401:"d82e03c93c",E1402:"58d4b67842",E1403:"21d45ed972",E1404:"9ad4a63ad2",E1405:"6bd4bb1612",E1406:"70d4b5f3e2",E1407:"0ad4c14d52",E1408:"20d46c8a12",E1409:"0dd4b62d42",E1410:"c6d4c14192",E1411:"88d4b3ed02",E1412:"01d46017a2",E1413:"7d2e256a1c",E1414:"4dd4c43f62",E1416:"a5d4c6f542",E1417:"b3d4a8ad62",E1418:"282dffe61c",E1419:"87d4cd5cc2",E1420:"ead4a7ab32",E1421:"afd4b28b42",E1422:"88d4c1bf22",E1423:"c4d4ad4ff2",E1424:"8c2e09d77c",E1425:"42d4685ca2",E1426:"AC2E00EE6C",E1427:"88db946daa",E1428:"63d4c00572",E1429:"90db93528a",E1430:"9a2e0df54c",E1432:"a82e0b911c",E1433:"a9d4c916a2",E1434:"9bd4c21f92",E1435:"fad46d81c2",E1437:"1ed4d19982",E1440:"cad4a7fb42",E1441:"4ed4c5fda2",E1442:"22d4b05412",E1443:"5ad4b41822",E1444:"17d4b4e592",E1445:"28d4a64812",E1446:"6ad4bed2d2",E1447:"4a2e01690c",E1448:"5ddba599ba",E1449:"6cd4c24832",E1450:"a4d45bc9e2",E1451:"e52e05c20c",E1452:"c3d4be2b82",E1454:"dad460ec82",E1455:"1fd4b27b02",E1456:"cf2e0ed33c",E1457:"b89cf5c819",E1458:"eea2a18469",E1460:"a1a299d349",E1461:"70f3615fbd",E1462:"b5a25c2269",E1463:"48a24340e9",E1464:"1ca27136f9",E1465:"31a2628879",E1466:"a2a24fb6f9",E1467:"aba277c7b9",E1469:"779d03f019",E1470:"f29d03f599",E1471:"eaa25ccdd9",E1472:"1a2e0e566c",E1473:"75a2974909",E1474:"3c9cf36a39",E1475:"36a2720fe9",E1476:"8f2eb77761",E1478:"91a2508ae9",E1479:"c1a2969c69",E1480:"909d0afef9",E1481:"079cf42649",E1482:"e19cface49",E1484:"e3a2915989",E1485:"f3a2930bc9",E1486:"342e08aebc",E1487:"e8a23f3c49",E1488:"bea28732a9",E1489:"5ba24d4df9",E1490:"ef9cf1db59",E1491:"aaa27fceb9",E1492:"f6a2966ba9",E1493:"39a2515399",E1494:"539cf77149",E1495:"d4a244bb89",E1496:"5ca2a186d9",E1497:"eca272e5d9",E1498:"35a240ce19",E1499:"aca23e5969",E1500:"5fa25b4fe9",E1502:"532e09b8cc",E1503:"25a24fb179",E1504:"7aa2471689",E1505:"e0d46ddb82",E1506:"949d0b0b09",E1507:"7fa26bef59",E1508:"d3a28df509",E1509:"b4a2465909",E1511:"56a2549939",E1512:"dfa266f2e9",E1513:"d8a2a04399",E1514:"BE2E0C009C",E1515:"baa25eefa9",E1519:"159d0243c9",E1520:"972df1377c",E1521:"819d01a4b9",E1522:"f9a28c4e99",E1523:"eca2713609",E1524:"4da28e3859",E1525:"0a9d0b0599",E1526:"549d0a6aa9",E1527:"519cf05469",E1528:"78a2490a99",E1529:"eca26f4869",E1530:"49a2579529",E1531:"21a26b6189",E1532:"c3a266eee9",E1533:"27a2837f79",E1534:"c5a2986699",E1535:"72a2966f29",E1536:"c6f37d450d",E1537:"aea27b7e09",E1538:"4d14c9c151",E1539:"9fa2770349",E1540:"40f3543add",E1543:"40a2715ac9",E1544:"aa9d018fb9",E1546:"57a2409c29",E1547:"2c14b99011",E1548:"2c9cfd7439",E1549:"b79cf6a479",E1550:"32f379a51d",E1551:"762e04500c",E1552:"6714bd3ff1",E1553:"ebf3788ded",E1554:"aa9d018fb9",E1555:"7fa298fcb9",E1556:"032e05c4ec",E1558:"35a294bab9",E1559:"062e06d2fc",E1560:"8ef373030d",E1561:"b2f3735f6d",E1562:"6114b5d111",E1563:"d0a23dc689",E1564:"472E0D98FC",E1565:"f1a23f5539",E1566:"bef36acaed",E1567:"d214c3d4d1",E1568:"b5f36ab19d",E1570:"2514d6c621",E1572:"32f382ce8d",E1573:"42a276cf59",E1574:"c0f383cd7d",E1575:"289cf84509",E1576:"4af37d599d",E1577:"13f36a971d",E1579:"89a2887ad9",E1580:"06f37d55dd",E1581:"869d086a79",E1582:"59a23fdd19",E1584:"b114ba3e21",E1585:"5ca28c4b39",E1586:"9af382b65d",E1587:"37a28d2139",E1588:"1759804b85",E1589:"5f9cf1cbf9",E1590:"0da2557389",E1591:"b1f36ae5cd",E1592:"ff9d09c2a9",E1593:"979d064549",E1595:"49f36afd2d",E1596:"fda24c4a59",E1597:"0fa25ce819",E1599:"33a29aa2a9",E1600:"9cf36ae8ed",E1602:"72f38c303d",E1604:"502E0BF98C",E1605:"c5f37d561d",E1606:"83a29159e9",E1607:"5ba25dfd59",E1608:"50a29d3659",E1609:"c8f382a41d",E1610:"86a2469bf9",E1611:"b4f36af0dd",E1612:"ef14ba90d1",E1613:"e1a29aa079",E1614:"50f37b954d",E1615:"a3d45e4b62",E1617:"d5f382d97d",E1618:"b3a29ae269",E1619:"40a29c7709",E1620:"dfa27b7f79",E1621:"b3f38c814d",E1623:"83f3775a5d",E1624:"6a14ba05c1",E1625:"06a293dee9",E1627:"9ef37d4d5d",E1628:"d1a2918b69",E1629:"d1f3732c7d",E1630:"6e9cfc7779",E1631:"6fa288ace9",E1632:"87a24c5039",E1633:"98a271c289",E1634:"1da26cea39",E1635:"49a28af899",E1636:"f4d4a2e062",E1637:"47a23d01d9",E1638:"a69cf102c9",E1639:"06d4ce2e32",E1640:"d8a24dfec9",E1641:"adf37e2d0d",E1642:"f9a253c1c9",E1643:"8e14c9d281",E1644:"26d4befeb2",E1645:"be9cf11ac9",E1646:"0c9cf27b19",E1647:"dd9cf1d969",E1648:"26a27a17e9",E1649:"979cf4f609",E1650:"fca25ccbc9",E1651:"bd9cfff729",E1652:"65a277c979",E1653:"919cf28679",E1654:"0ea272e739",E1656:"d314ccdad1",E1657:"40a27b8019",E1658:"7aa285d489",E1659:"66a28c5119",E1660:"3ca2871009",E1662:"f8a28af929",E1663:"b79d032009",E1664:"2d9cf76f29",E1665:"3f9cf84219",E1666:"4bd4ca5702",E1667:"76a2467be9",E1669:"d2f37f732d",E1672:"a75993b8d5",E1673:"c59d0190c9",E1674:"4aa2990879",E1675:"48a2720199",E1676:"2fd4b089c2",E1679:"dfd4d871a2",E1680:"962df0a7ec",E1681:"fdd4cdb652",E1683:"a3a2870f89",E1684:"f4d459dba2",E1685:"a4a28d62e9",E1686:"05d4511292",E1687:"bba2950589",E1689:"a1a2a0ea49",E1691:"bca26ceb99",E1692:"262E0C282C",E1693:"fda24badb9",E1694:"a89cfbb679",E1695:"b7a25c2069",E1696:"2af382a6fd",E1697:"e9a29f8d59",E1698:"9df37a594d",E1699:"55a24e3089",E1700:"26a25a77a9",E1702:"41a26cd659",E1704:"c3a2754d59",E1705:"c1d4c007d2",E1706:"8fa2869239",E1707:"99d4cde262",E1709:"6ba26dad09",E1710:"63d4d8cda2",E1711:"77a295d999",E1712:"7ca25ccb49",E1713:"fad4b6ea72",E1714:"f2d4a450d2",E1717:"c4a255fac9",E1718:"a99cfca069",E1719:"b8a2730069",E1720:"3ca245c219",E1721:"7ca28acd99",E1722:"30a272d939",E1723:"839cfbad49",E1726:"01d4596ee2",E1727:"f2d4d602f2",E1729:"949d0b0b09",E1730:"78d4b7e9f2",E1731:"8d2e043b9c",E1732:"b12e1ffc7c",E1733:"142e1284ac",E1734:"632defbd1c",E1735:"442e07117c",E1736:"8e2e05c96c",E1737:"012e0a795c",E1738:"782e0ee4bc",E1739:"e42e11578c",E1740:"c52e08bf5c",E1741:"812e1003bc",E1742:"1f2e0c714c",E1743:"a82e1c861c",E1744:"712e0ae9bc",E1745:"b22defccbc",E1746:"012defff3c",E1747:"672e0de8ac",E1748:"982e02982c",E1749:"582e19036c",E1750:"502dff8e0c",E1751:"d22df0e3ec",E1752:"002e00022c",E1753:"6a2e02fabc",E1754:"b62e16b23c",E1755:"dc2e026c9c",E1756:"612e05561c",E1757:"da2e0c04fc",E1758:"ac2e02bc3c",E1759:"dc2e0ab44c",E1760:"ac2df9a4dc",E1761:"5f2defc15c",E1762:"4d2df0cc5c",E1763:"442e11a7dc",E1764:"b22dff9cfc",E1765:"c12dfbdbcc",E1766:"442e0d6b0c",E1767:"142e093f0c",E1768:"aa2e05dd5c",E1769:"172e07122c",E1770:"6f2e25680c",E1771:"f72e02a77c",E1772:"3f2df12fcc",E1773:"9e2e018d3c",E1774:"712e06257c",E1775:"e22e04c40c",E1776:"6b2e0db4fc",E1777:"022e11c1fc",E1778:"b92e000b9c",E1779:"442e05432c",E1780:"1e2e025e6c",E1781:"312dfbab4c",E1782:"c12e06658c",E1783:"ca2e1c847c",E1784:"482e0298fc",E1785:"3c2e06b8ac",E1786:"0f2e027f5c",E1787:"f52dff7b5c",E1788:"2f2e0ec3cc",E1789:"392e101b1c",E1790:"5f2e0ee39c",E1791:"e42e0d5b9c",E1792:"6d597a3b75",E1793:"ba2e05cd5c",E1794:"df2e0954ac",E1795:"032e09d8fc",E1796:"a72e09bc3c",E1797:"be2def205c",E1798:"0f2e19142c",E1799:"f02e095b8c",E1800:"ae2dfe710c",E1801:"a42e0b1d9c",E1802:"bf2e0eb32c",E1803:"ff2e0f528c",E1804:"c32e0fbe5c",E1805:"1b2e060f3c",E1806:"202dfebf4c",E1807:"672e099cdc",E1808:"9d2e043b8c",E1809:"072e00755c",E1810:"272e0cc9cc",E1811:"582e09b3cc",E1812:"6b2e0cc58c",E1813:"a32e0c3dbc",E1814:"be2e0f23bc",E1815:"762e04500c",E1816:"e42e01975c",E1817:"e12e0f7cbc",E1818:"0e2e026e4c",E1819:"512e10335c",E1820:"3a2e0a223c",E1821:"ec2e19578c",E1822:"ac2dfcf18c",E1823:"872e0b0eac",E1824:"d42e0e986c",E1825:"aa2e1169fc",E1826:"042e0ea88c",E1827:"762e02267c",E1828:"bd2e057aec",E1829:"462e15c1bc",E1830:"7e2e0cc09c",E1831:"da2e01f90c",E1832:"1d2e06d9ec",E1833:"8e2e19b50c",E1834:"952dff7b3c",E1835:"662dffe85c",E1836:"ae2e0f73fc",E1837:"dd2e0ab54c",E1838:"7a2e0a025c",E1839:"a12e06a52c",E1840:"fd2dfe725c",E1841:"052e07507c",E1842:"842e0701ac",E1843:"e12e1ffc2c",E1844:"f02e03c11c",E1845:"3c2e0d031c",E1846:"852e1275cc",E1847:"3d2e049b8c",E1848:"eb2e05bc7c",E1849:"552df0b43c",E1850:"ec2e0fb17c",E1851:"2e2df0ef1c",E1852:"a12e09fa7c",E1853:"4c2e0d630c",E1854:"3c2df02dcc",E1855:"d42e1c5abc",E1856:"412e09ea8c",E1857:"112e0b88bc",E1858:"7f2e02affc",E1859:"642e093f7c",E1860:"5b2e0b621c",E1861:"392e02d9cc",E1862:"912e00338c",E1863:"d62e2004dc",E1864:"492e05aecc",E1865:"6e2e02befc",E1866:"4a2e070f6c",E1867:"9b2e0fa61c",E1868:"032e05e4cc",E1869:"f52e0cdb0c",E1870:"a72e07129c",E1871:"bd2e026dfc",E1872:"222df0738c",E1873:"e62e02e62c",E1874:"902def1e4c",E1875:"682e0b014c",E1876:"552e06a1dc",E1877:"612e09eaac",E1878:"d42e0c0afc",E1879:"dc2e0d936c",E1880:"312e03504c",E1881:"9a2e0dd56c",E1882:"7f2e25681c",E1883:"ce2e0cf01c",E1884:"162e25617c",E1885:"1a2e06cefc",E1886:"e62e0074bc",E1887:"552df9bd3c",E1888:"f32e1b2aec",E1889:"9d2dfb773c",E1890:"7d2e119edc",E1891:"d42e0b1dec",E1892:"972e0005bc",E1893:"0e2e02defc",E1894:"1f2e05a89c",E1895:"022e0e4e6c",E1896:"c52e09de3c",E1897:"cc2e128c7c",E1898:"cb2e0910fc",E1899:"4e2e09a5cc",E1900:"d12e2566bc",E1901:"b72e05b02c",E1902:"702e09bbec",E1903:"f72e0ebb6c",E1904:"1b2e00695c",E1905:"d12e0dde2c",E1906:"d32dff0d0c",E1907:"2c2e0bb5bc",E1908:"d02e0012ec",E1909:"d62e0c28dc",E1910:"1f2e0df0cc",E1911:"e72e06f33c",E1912:"722e0ccc9c",E1913:"592dfcb43c",E1914:"912e0e1dac",E1915:"de2e0ed22c",E1916:"432e0faecc",E1917:"9f2e0f328c",E1918:"002e0d8fac",E1919:"722dffac0c",E1920:"5e2dfab53c",E1921:"f72e06e33c",E1922:"a22e0dbd3c",E1923:"6f2e0ed39c",E1924:"b62dfdbadc",E1925:"b62e0eea7c",E1926:"ad2e126dfc",E1927:"5b2e09304c",E1928:"742e0d9bcc",E1929:"ff2e0a27fc",E1930:"f52e0abd6c",E1931:"ba2e070f9c",E1932:"292e06adac",E1933:"d62e01857c",E1934:"ed2e0de22c",E1935:"5e2e176b0c",E1936:"002e00c2ec",E1937:"dd2e128d6c",E1938:"d72e02877c",E1939:"852e1c5bec",E1940:"642e0c8acc",E1941:"662e00541c",E1942:"942e0b1dac",E1943:"302e0d8f9c",E1944:"cb2e0da44c",E1945:"282def26cc",E1946:"b02e0072ec",E1947:"942e1274dc",E1948:"402dfdcc5c",E1949:"8b2e0069cc",E1950:"702e08baec",E1951:"e12e01529c",E1952:"f62e03a77c",E1953:"692e0ea5ec",E1954:"2f2e19140c",E1955:"062e06e2cc",E1956:"e92e106bbc",E1957:"862e0afe5c",E1958:"502e0b691c",E1959:"172e00053c",E1960:"fb2e0d449c",E1961:"002e02301c",E1962:"7c2e0da3fc",E1963:"4c2e09d7bc",E1964:"622dff0cbc",E1965:"842e0f298c",E1966:"6e2e026e2c",E1967:"d12e0fec1c",E1968:"d72e0dd82c",E1969:"b12e1162ec",E1970:"d92e0f748c",E1971:"802e1ffd4c",E1972:"a02e06048c",E1973:"7b2e05ecbc",E1974:"9f2e15b81c",E1975:"262e02969c",E1976:"4a2e0f375c",E1977:"cc2dfdc0dc",E1978:"272e1f5a4c",E1979:"6f2cdc43dc",E1980:"0f2e039ebc",E1981:"1d2e0c83bc",E1982:"562e0185fc",E1983:"c32e0524cc",E1984:"622e0dadec",E1985:"262e00444c",E1986:"132e0baa9c",E1987:"192e08635c",E1988:"db2e04dd2c",E1989:"002e07052c",E1990:"762DFF983C",E1991:"2d2ce15cbc",E1992:"2a2e0c747c",E1993:"842e19bf0c",E1994:"e42e0c5a9c",E1995:"e42e1771ac",E1996:"1f2dfab47c",E1997:"242e0dabac",E1998:"a32e03129c",E1999:"732df99b3c",E2000:"532e1c3d5c",E2001:"202def8e6c",E2002:"952e0eb90c",E2003:"742e07015c",E2004:"dd2e11ae4c",E2005:"a42df98cfc",E2006:"af2df0becc",E2007:"502e0af88c",E2008:"c02e0af81c",E2009:"2b2e02bbbc",E2010:"382e03a9bc",E2011:"152e1285ac",E2012:"dd2e000ffc",E2013:"972e0ebb0c",E2014:"6d2e06d99c",E2015:"a02e0edc5c",E2016:"a02e097bfc",E2017:"af2e072aac",E2018:"862e195dec",E2019:"e52e0fb87c",E2020:"3a2dfb806c",E2021:"b12e094adc",E2022:"882e10ba0c",E2023:"e72e1d28fc",E2024:"312dfcac4c",E2025:"632e0697dc",E2026:"6d2e12adfc",E2027:"6b2e11b8ec",E2028:"322e04948c",E2029:"b42df0a5cc",E2030:"962e1e6acc",E2031:"6c2e09571c",E2032:"132e07360c",E2033:"cd2dff534c",E2034:"3c2df0cd2c",E2035:"832e0ccd6c",E2036:"522e2090cc",E2037:"1a2e0d457c",E2038:"ba2df02b4c",E2039:"702e06c49c",E2040:"7e2e0d91cc",E2041:"0d2df0cc1c",E2042:"9d2e06e95c",E2043:"662e0fbbfc",E2044:"9c2df9a4ec",E2045:"df2e15a84c",E2046:"522e02027c",E2047:"812df1316c",E2048:"b92e077cec",E2049:"3e2e007c6c",E2050:"922e0747fc",E2051:"da2e0df50c",E2052:"2f2e031e1c",E2053:"282e000a0c",E2054:"cf2e00bd5c",E2055:"372e0f1a0c",E2056:"962e20049c",E2057:"ec2e025c9c",E2058:"a22def8cec",E2059:"d42df0353c",E2060:"da2df01b1c",E2061:"b42e0cea7c",E2062:"692dffd76c",E2063:"a82e15cf5c",E2064:"842e0b1dbc",E2065:"232e0f7e7c",E2066:"802e02802c",E2067:"c52dffcbdc",E2068:"cb2e067f9c",E2069:"ff2e0b26fc",E2070:"f72e0f4a9c",E2071:"8c2df0cd9c",E2072:"c22e00b05c",E2073:"662df0f74c",E2074:"bb2e11d85c",E2075:"602e0e4c0c",E2076:"822e0b2b8c",E2077:"752e02f5ac",E2078:"da2df0dbdc",E2079:"e02e0ba96c",E2080:"e32e0dbc7c",E2081:"8a2df00b5c",E2082:"a92e03189c",E2083:"a72e06d35c",E2084:"9e2e0fb30c",E2085:"9f2defe1bc",E2086:"342e09dfcc",E2087:"4d2e0db2dc",E2088:"182e06ccfc",E2089:"2e2e1e726c",E2090:"b22e06861c",E2091:"5c2e0d631c",E2092:"502e00c2bc",E2093:"7f2e0e530c",E2094:"0d2e057a5c",E2095:"e62dff98ac",E2096:"952e0e992c",E2097:"f42e0e78ac",E2098:"812e0457fc",E2099:"542e02f48c",E2100:"a52dfb5f2c",E2101:"572e0c592c",E2102:"d42e02847c",E2103:"392e09021c",E2104:"252e0deaec",E2105:"eb2e16af7c",E2106:"b12e08fb6c",E2107:"b72e02b72c",E2108:"962e195dfc",E2109:"8a2e0ba30c",E2110:"c22df0e3fc",E2111:"062df0b76c",E2112:"062e0581ac",E2113:"bc2e053bac",E2114:"3b2e19101c",E2115:"5e2e08c4bc",E2116:"bd2e06990c",E2117:"b22e06a63c",E2118:"9d2e0ea11c",E2119:"3b2e0f263c",E2120:"e72dfcfacc",E2121:"e32e0ecf0c",E2122:"262e0c080c",E2123:"0c2e0eb09c",E2124:"562e09ed9c",E2125:"d82e05df2c",E2126:"d92e0ed52c",E2127:"842e05238c",E2128:"a22e0545cc",E2129:"0d2e10cffc",E2130:"cc2defe2ec",E2131:"9e2e0df14c",E2132:"d32e0c3dcc",E2133:"b22e00009c",E2134:"a12e0b088c",E2135:"342e0debfc",E2136:"4b2dffc55c",E2137:"652e0b2c6c",E2138:"512e1ffc9c",E2139:"e92e076cac",E2140:"fe2df0dffc",E2141:"802e06b41c",E2142:"f42e0f19cc",E2143:"962e02368c",E2144:"8c2dfdb0ec",E2145:"0a2e09113c",E2146:"3e2e119d9c",E2147:"292e0f444c",E2148:"cc2e0ef01c",E2149:"dc2e19c72c",E2150:"5f2df0be3c",E2151:"f82e0319cc",E2152:"6b2dffe55c",E2153:"c12e0dae4c",E2154:"e22e0bab6c",E2155:"d02e0032cc",E2156:"122e02c2fc",E2157:"182e018bbc",E2158:"152e0d6a5c",E2159:"6f2e1e732c",E2160:"d62e05f10c",E2161:"ed2dfdb18c",E2162:"f32e11d01c",E2163:"192e105b7c",E2164:"812e02d17c",E2165:"2d2e126d7c",E2166:"172e0d98ac",E2167:"582e08c2bc",E2168:"5a2e04ec9c",E2169:"b62e06b22c",E2170:"f22e0717cc",E2171:"c32e02f31c",E2172:"792dff872c",E2173:"ae2dfbe49c",E2174:"bb2e0ef76c",E2175:"ea2e0de52c",E2176:"642e0c7a3c",E2177:"8e2e0f03ac",E2178:"212e1ffcec",E2179:"f22e0676ac",E2180:"622e01612c",E2181:"142e0e784c",E2183:"8d2dfb772c",E2184:"a72e02b73c",E2185:"e52e02f53c",E2186:"ca2e09c12c",E2187:"802e1072cc",E2188:"182e05efdc",E2189:"1e2e071b2c",E2190:"6f2e0c612c",E2191:"b72dfdeb8c",E2192:"8b2e0cf55c",E2193:"312e03b0ac",E2194:"6c2defe24c",E2195:"6d2dfb67dc",E2196:"122e09b98c",E2197:"0a2e01597c",E2198:"fe2e000cdc",E2199:"882e073d9c",E2200:"f32e0dfc2c",E2201:"552df98d0c",E2202:"a12e0f7cfc",E2203:"d32e0ffe0c",E2204:"6c2e04ca8c",E2205:"d22e0e6e9c",E2206:"e12e05b67c",E2207:"c52e0d6a8c",E2208:"d42e190fec",E2209:"2e2e027e7c",E2210:"ca2e01f91c",E2211:"022e06466c",E2212:"4a2e0c741c",E2213:"402e03c1ac",E2214:"982e00ca7c",E2215:"eb2e10b96c",E2216:"f22e1909cc",E2217:"612e0c2f6c",E2218:"7c2e0af4ac",E2219:"402e25672c",E2220:"212e11627c",E2221:"f92e0f34ec",E2222:"6d2df0bc0c",E2223:"b82e03198c",E2224:"212e06757c",E2225:"522defcc5c",E2226:"352e09eefc",E2227:"dc2e114fac",E2228:"2a2e071f1c",E2229:"b82e0e64fc",E2230:"872e0f4aec",E2231:"4e90d7c3ca",E2232:"0c59771735",E2233:"ca90ec2c9a",E2234:"5d59940595",E2235:"fb2dff95bc",E2236:"68db8ca59a",E2237:"61db92725a",E2238:"02a2472ec9",E2239:"0d59764765",E2240:"38a25172b9",E2241:"822e0b2b8c",E2242:"c1db90b03a",E2243:"9d597819a5",E2244:"a95990a5c5",E2245:"0ba29e0e39",E2246:"2059819d65",E2247:"cd90d92eaa",E2248:"1a597e6855",E2249:"77597e7525",E2250:"cca29d4ab9",E2251:"27db9f294a",E2252:"7bdb8e547a",E2253:"64599961c5",E2254:"dcdba37eda",E2255:"2390d9d0ba",E2256:"a490d9e70a",E2257:"75db998dba",E2258:"cb5990e7e5",E2259:"1e5982b075",E2260:"729cfe4959",E2261:"de2e004cbc",E2262:"952df0e4ac",E2263:"702e06742c",E2264:"662e03a7ec",E2265:"be2e0cf06c",E2266:"0b2e124b7c",E2267:"bc2e0bb52c",E2268:"532e0faedc",E2269:"26597fa5a5",E2270:"ff2e0fd20c",E2271:"26db97402a",E2272:"0edb82fdaa",E2273:"8459805805",E2274:"8c2e01af0c",E2275:"2c5976b6b5",E2276:"acdb8835ca",E2277:"eedb814efa",E2278:"d159847975",E2279:"74db97a29a",E2280:"dfdb90ae3a",E2281:"4d90ea7d4a",E2282:"50db8e3f3a",E2283:"3959992cd5",E2284:"28547d4a4b",E2285:"922e09398c",E2286:"2f2dfbe51c",E2287:"752dfb5ffc",E2288:"dd2e0619ec",E2289:"322e0bebfc",E2290:"d42e0abc4c",E2291:"9c2e02dc6c",E2292:"b02e093bac",E2293:"912dff7f3c",E2294:"762e0eca9c",E2295:"cc2df13c2c",E2296:"032e0ffedc",E2297:"412e13106c",E2298:"702e07356c",E2299:"ea2e0a824c",E2300:"b62e02861c",E2301:"f32dffedcc",E2302:"832e04c56c",E2303:"d72e0451ac",E2304:"952e195efc",E2305:"012e186b5c",E2306:"3d2dfe729c",E2307:"4f2e0cc1ac",E2308:"992e067dcc",E2309:"0c2defb27c",E2310:"502dffce4c",E2311:"522e0aea9c",E2312:"ad2e043bbc",E2313:"042e0fd9fc",E2314:"5e2e0bd7ac",E2315:"3f2e19040c",E2316:"952e0047fc",E2317:"1a2e0e86bc",E2318:"c92e077c9c",E2319:"032e02634c",E2320:"792dfdd57c",E2321:"aa2e01f97c",E2322:"382e067c6c",E2323:"c12df1312c",E2324:"162e02566c",E2325:"c42e09ef0c",E2326:"7b2e04dd8c",E2327:"ed2e027dbc",E2328:"e62e099d5c",E2329:"8b2e11a81c",E2330:"872e05b01c",E2331:"eb2e05fc3c",E2332:"ef2defb19c",E2334:"232e06373c",E2335:"942dffbafc",E2336:"172e00350c",E2337:"fd2dfe022c",E2338:"272e0de8ec",E2339:"662e02f6bc",E2340:"8d2e126ddc",E2341:"602dfebf0c",E2342:"0f2e0b062c",E2343:"fe2e08c41c",E2344:"3a2e064e5c",E2345:"0a2e071f3c",E2346:"bc2e027cec",E2347:"db2df07a7c",E2348:"532e04f58c",E2349:"982e0e14ac",E2350:"502e05473c",E2351:"7c2e0ab4ec",E2352:"392e067d6c",E2353:"082dffa67c",E2354:"cd2df9c5dc",E2355:"6e2e02aeec",E2356:"722e04e4bc",E2357:"a62e0f0b8c",E2358:"732e07164c",E2359:"4c2e009efc",E2361:"9b2e06cf7c",E2362:"a52e10d74c",E2363:"142e190f2c",E2364:"852e0443ec",E2365:"de2e022edc",E2366:"622e03632c",E2367:"2c2e0b252c",E2368:"922e0363dc",E2369:"572dfddb5c",E2370:"282e071d1c",E2371:"532e0c6d1c",E2372:"d92df0080c",E2373:"fc2e08b66c",E2374:"2f2e02dfdc",E2375:"e62e03a76c",E2376:"df2e028f7c",E2377:"9f2e01cc7c",E2378:"6c2e124c1c",E2379:"7c2e0b356c",E2380:"582e00cabc",E2381:"7b2e069fcc",E2382:"312e06756c",E2383:"342e12747c",E2384:"6a2e0df5bc",E2385:"fa2e0b23fc",E2386:"532e0ccdbc",E2387:"6a2e030b4c",E2388:"4c2e02dcbc",E2389:"962e00c47c",E2390:"942e0cca7c",E2391:"812e1013ac",E2392:"082e1c360c",E2393:"962e06a21c",E2394:"a72e0ce96c",E2395:"492df0d84c",E2396:"972e0613ac",E2397:"652df0348c",E2398:"472e0cb9dc",E2399:"9b2e036adc",E2400:"ee2e02ae6c",E2401:"292e0b707c",E2402:"5c2e1b254c",E2403:"792e0b005c",E2404:"972e1d288c",E2405:"152e09ae9c",E2406:"be2e0945dc",E2407:"7c2df9943c",E2408:"752df0c46c",E2409:"dd2df0dcdc",E2410:"482e0de78c",E2411:"be2dffe08c",E2412:"eb2df993ac",E2413:"0d2dfb578c",E2414:"742e09cf9c",E2415:"822e0ddd7c",E2416:"162e0296ac",E2417:"ba2dff84ec",E2418:"172dffe92c",E2419:"942e0c5aec",E2420:"862e0c78dc",E2421:"752e0deabc",E2422:"a62e1226bc",E2423:"ea2e05dd1c",E2424:"d42e05738c",E2425:"9c2e0db30c",E2426:"ff2e05984c",E2427:"042e0c6a4c",E2428:"ca2dff746c",E2429:"c22def7c7c",E2430:"6a2e0ba3ec",E2431:"162e0397ac",E2432:"4f2e06abcc",E2433:"4d2e0df29c",E2434:"ad2e0df27c",E2435:"772dfddb7c",E2436:"2b2dffd52c",E2437:"282e0ea4ac",E2438:"af2dff512c",E2439:"112E03A09C",E2440:"742e1f692c",E2441:"c92e05de3c",E2442:"ee2e1e72ac",E2443:"aa2e02fa7c",E2444:"702e07257c",E2445:"732e0abbec",E2446:"2f2df0ce3c",E2447:"022e07d7fc",E2448:"632e0baaec",E2449:"0f2e19043c",E2450:"7f2e0ed38c",E2451:"c72e01846c",E2452:"902defce9c",E2453:"6c2e001e5c",E2454:"392e100b0c",E2455:"542df0c54c",E2456:"5c2e00becc",E2457:"292e0e656c",E2458:"6a2e19217c",E2459:"192e03c8fc",E2460:"432e11d0ac",E2461:"df2e1904ec",E2462:"d42e0dab5c",E2463:"d12e0dbe4c",E2464:"7c2df13c9c",E2465:"af2e06ab2c",E2466:"3a2e0e564c",E2467:"8c2e1f61dc",E2468:"072e25606c",E2469:"322e02524c",E2470:"fc2e06885c",E2471:"7e2e0b570c",E2472:"d22e03f30c",E2473:"0c2e0da38c",E2474:"492e0ed5bc",E2475:"4b2e0ba2cc",E2476:"502e02d0ac",E2477:"392dfff71c",E2478:"6e2dfff04c",E2479:"d42e0b2ddc",E2480:"e92e116abc",E2481:"382e1d373c",E2482:"7f2dfdb31c",E2483:"922dffdc9c",E2484:"2d2e035c5c",E2485:"022e07476c",E2486:"4d2dff63fc",E2487:"622e11712c",E2488:"092e09527c",E2489:"f62df0775c",E2490:"bc2e19b73c",E2491:"9a2e0e269c",E2492:"362e02564c",E2493:"292e071c1c",E2494:"1a2e02cafc",E2495:"fc2e09e73c",E2496:"a82e02d85c",E2497:"f92e067dac",E2498:"692e070c4c",E2499:"872e0f2a8c",E2500:"d82e09b34c",E2501:"7d2dfb67cc",E2502:"f42e0d5b8c",E2504:"5e2e0d116c",E2505:"d02e0f2ddc",E2506:"de2e119d7c",E2507:"212e00333c",E2508:"c92e0ef51c",E2509:"8c2e042a8c",E2510:"602e15b7ec",E2511:"692e12792c",E2512:"822df0732c",E2513:"7c2dfff25c",E2514:"d52e11b65c",E2515:"fc2df9a48c",E2516:"682e0e044c",E2517:"3a2e043c2c",E2518:"862e1e6adc",E2519:"d72e0de81c",E2520:"042e0284ac",E2521:"bc2e0f41dc",E2522:"192e09526c",E2523:"622e04c48c",E2524:"782e02a8fc",E2525:"7e2e039fcc",E2526:"a42e0533bc",E2527:"232e04b5bc",E2528:"7c2e0e90cc",E2529:"742def7acc",E2530:"4e2dfff06c",E2531:"582dfca52c",E2532:"352dfb6f8c",E2533:"eb2df0daec",E2534:"7c2e123c7c",E2535:"f12e0e1dcc",E2536:"f52e0235ec",E2537:"872e0277dc",E2538:"c92e0cc72c",E2540:"fb2e0e77ac",E2541:"e42e05834c",E2543:"132e1c3d1c",E2544:"352e0f283c",E2545:"b82e0dd74c",E2546:"ad2e07088c",E2547:"482e04fe9c",E2548:"3b2e09405c",E2549:"282e1d372c",E2550:"4c2e025c3c",E2551:"212dffdf2c",E2552:"032e06577c",E2553:"b12dffbfdc",E2554:"dc2e0f41bc",E2555:"ae2e0955dc",E2556:"a92e02d95c",E2557:"d02dfcadac",E2558:"5a2e04acdc",E2559:"e42e07d11c",E2560:"082e067c5c",E2561:"202e02505c",E2562:"102e01536c",E2563:"e42df0c5fc",E2564:"432e1283fc",E2565:"742df0c56c",E2566:"db2e05cc3c",E2567:"982def461c",E2568:"e42e0315dc",E2569:"992e0f74cc",E2570:"3f2e08a5bc",E2571:"012e094a6c",E2572:"d92e0b10ec",E2574:"632dff7dcc",E2575:"1a2e0db58c",E2576:"ee2df0dfec",E2577:"652e01a6ec",E2578:"8f2e09842c",E2580:"7f2dfcf25c",E2581:"f62e0703dc",E2582:"d12e0300fc",E2584:"cd2e126d9c"})),zi=vi(null),Fu=vi({currentRating:null});let Au=!1;async function xm(B){var O;st(zi)!==null&&((await Vd(B)).reserveBike?zi.set(null):(O=st(zi))!=null&&O.confirmed||tl())}async function Ym(B,O,ie){if(O==null&&(O=bm.get(B)??null),O==null)return ls.add(st(cs)("bike_unlock_no_serial_error")),el("bike_unlock_no_serial_error",B),!1;try{if(st(js).distanceLock){const ae=st($s);if(ae==null)return ls.add(st(cs)("location_determination_error")),!1;if(Gd(ae.coords.latitude,ae.coords.longitude,ie.latitude,ie.longitude)>nm/1e3)return ls.add(st(cs)("not_close_enough_error")),!1}if((await Vd(O)).reserveBike)if((await cm()).startTrip){mm(O,ie.serialNumber);for(let C=15e3;C<=3e4;C+=5e3)setTimeout(()=>xm(O),C);const fe=st($s);return zi.set({code:"",arrivalTime:null,bikePlate:B,traveledDistanceKm:0,destination:null,distanceLeft:null,speed:0,startDate:new Date,startPos:fe?{lng:fe.coords.longitude,lat:fe.coords.latitude}:null,predictedEndDate:null,finished:!1,confirmed:!1,pathTaken:fe?[{lng:fe.coords.longitude,lat:fe.coords.latitude,time:new Date}]:[],lastUpdate:new Date}),Em(),!0}else return ls.add(st(cs)("bike_unlock_error")),el("bike_unlock_error"),!1;return!1}catch(se){const ae=se;let fe=!1;if(ae&&ae.errors){for(const C of ae.errors){const p=Od[C.message];"message"in p&&(ls.add(st(cs)(p.message)),fe=!0),el("gira_api_error",C.message)}fe||ls.add(st(cs)("bike_unlock_error"))}return console.error(ae),!1}}function vm(){var se;if(Au)return;const B=(se=st(zi))==null?void 0:se.lastUpdate;if(!B||Date.now()-B.getTime()<1e3*30)return;const O=st(zr);if(!O)return;JSON.parse(window.atob(O.accessToken.split(".")[1])).exp*1e3-Date.now()<30*1e3?(Au=!0,ju().then(tl).finally(()=>Au=!1)):tl()}async function wm(){const B=st(zi);B&&Ru(B.code),zi.set(null),Zd({unratedTrips:(await dm(0,1)).unratedTrips,tripHistory:(await hm(0,1)).tripHistory})}const $s=vi(null),Qm=vi(!1),eg=vi(0);$s.subscribe(async B=>{B&&zi.update(O=>{if(!O)return O;if(O.pathTaken.push({lat:B.coords.latitude,lng:B.coords.longitude,time:new Date(B.timestamp)}),O.pathTaken.length>1){const ie=O.pathTaken[O.pathTaken.length-2],se=Gd(ie.lat,ie.lng,B.coords.latitude,B.coords.longitude);O.traveledDistanceKm+=se;const ae=O.traveledDistanceKm/((B.timestamp-O.startDate.getTime())/1e3)*3600;O.traveledDistanceKm>=om/1e3&&(O.speed=ae)}return O})});const Cd=qs("BackgroundGeolocation");let Yo=null,Qo=null;async function Em(){if((await Cu.checkPermissions()).location==="granted")if(st(zi)!==null&&st(js).backgroundLocation){if(Qo!==null)return;Yo!==null&&(await Cu.clearWatch({id:Yo}),Yo=null),Qo=await Cd.addWatcher({backgroundTitle:"Active Trip",backgroundMessage:"Tracking location in background"},O=>{O&&$s.set({coords:{...O,heading:O.bearing},timestamp:O.time??Date.now()}),vm()})}else{if(Yo!==null)return;Qo!==null&&(await Cd.removeWatcher({id:Qo}),Qo=null),Yo=await Cu.watchPosition({enableHighAccuracy:!0,timeout:2e3,minimumUpdateInterval:0},O=>{O&&$s.set(O)})}}function Sm(B,O=100,ie=1500){const se=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});return{width:O,height:O,data:new Uint8Array(O*O*4),onAdd:function(){const ae=document.createElement("canvas");ae.width=this.width,ae.height=this.height},render:function(){const ae=performance.now()%ie/ie,fe=O/2*.3,C=O/2*.7*ae+fe;return se.clearRect(0,0,this.width,this.height),se.beginPath(),se.arc(this.width/2,this.height/2,C,0,Math.PI*2),se.fillStyle=`${qr("--color-primary")}${Math.round((1-ae)/2*255).toString(16).padStart(2,"0")}`,se.fill(),se.beginPath(),se.arc(this.width/2,this.height/2,fe,0,Math.PI*2),se.fillStyle=qr("--color-primary"),se.strokeStyle="white",se.lineWidth=2+4*(1-ae),se.fill(),se.stroke(),this.data=se.getImageData(0,0,this.width,this.height).data,B.triggerRepaint(),!0}}}const Tm=Rd(js,(B,O)=>{if(!B)return;const ie=()=>B.theme==="system"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":B.theme;O(ie());const se=window.matchMedia("(prefers-color-scheme: dark)"),ae=()=>O(ie());return B.theme==="system"&&se.addEventListener("change",ae),()=>{se.removeEventListener("change",ae)}});var Im=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function km(B){return B&&B.__esModule&&Object.prototype.hasOwnProperty.call(B,"default")?B.default:B}var Nd={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(B,O){(function(ie,se){B.exports=se()})(Im,function(){var ie={},se={};function ae(C,p,Ye){if(se[C]=Ye,C==="index"){var Qe="var sharedModule = {}; ("+se.shared+")(sharedModule); ("+se.worker+")(sharedModule);",At={};return se.shared(At),se.index(ie,At),typeof window<"u"&&ie.setWorkerUrl(window.URL.createObjectURL(new Blob([Qe],{type:"text/javascript"}))),ie}}ae("shared",["exports"],function(C){function p(i,t,r,s){return new(r||(r=Promise))(function(l,h){function d(b){try{g(s.next(b))}catch(x){h(x)}}function f(b){try{g(s.throw(b))}catch(x){h(x)}}function g(b){var x;b.done?l(b.value):(x=b.value,x instanceof r?x:new r(function(w){w(x)})).then(d,f)}g((s=s.apply(i,t||[])).next())})}function Ye(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var Qe=At;function At(i,t){this.x=i,this.y=t}At.prototype={clone:function(){return new At(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),r=Math.sin(i),s=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,t){var r=Math.cos(i),s=Math.sin(i),l=t.y+s*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-s*(this.y-t.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},At.convert=function(i){return i instanceof At?i:Array.isArray(i)?new At(i[0],i[1]):i};var ge=Ye(Qe),ue=Dr;function Dr(i,t,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=s}Dr.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<t)return r;var h=this.sampleCurveDerivativeX(r);if(Math.abs(h)<1e-6)break;r-=l/h}var d=0,f=1;for(r=i,s=0;s<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<t));s++)i>l?d=r:f=r,r=.5*(f-d)+d;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var br=Ye(ue);let Zi,xr;function Gi(){return Zi==null&&(Zi=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Zi}function aa(){if(xr==null&&(xr=!1,Gi())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let s=0;s<5*5;s++){const l=4*s;t.fillStyle=`rgb(${l},${l+1},${l+2})`,t.fillRect(s%5,Math.floor(s/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&r[s]!==s){xr=!0;break}}}return xr||!1}function pi(i,t,r,s){const l=new br(i,t,r,s);return h=>l.solve(h)}const sa=pi(.25,.1,.25,1);function Di(i,t,r){return Math.min(r,Math.max(t,i))}function Hi(i,t,r){const s=r-t,l=((i-t)%s+s)%s+t;return l===t?r:l}function ut(i,...t){for(const r of t)for(const s in r)i[s]=r[s];return i}let Mt=1;function Qt(i,t,r){const s={};for(const l in i)s[l]=t.call(this,i[l],l,i);return s}function Li(i,t,r){const s={};for(const l in i)t.call(this,i[l],l,i)&&(s[l]=i[l]);return s}function at(i){return Array.isArray(i)?i.map(at):typeof i=="object"&&i?Qt(i,at):i}const wi={};function Gt(i){wi[i]||(typeof console<"u"&&console.warn(i),wi[i]=!0)}function ei(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function Ri(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Lr=null;function Bi(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Ia="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function rr(i,t,r,s,l){return p(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const h=new VideoFrame(i,{timestamp:0});try{const d=h==null?void 0:h.format;if(!d||!d.startsWith("BGR")&&!d.startsWith("RGB"))throw new Error(`Unrecognized format ${d}`);const f=d.startsWith("BGR"),g=new Uint8ClampedArray(s*l*4);if(yield h.copyTo(g,function(b,x,w,T,P){const M=4*Math.max(-x,0),z=(Math.max(0,w)-w)*T*4+M,V=4*T,$=Math.max(0,x),te=Math.max(0,w);return{rect:{x:$,y:te,width:Math.min(b.width,x+T)-$,height:Math.min(b.height,w+P)-te},layout:[{offset:z,stride:V}]}}(i,t,r,s,l)),f)for(let b=0;b<g.length;b+=4){const x=g[b];g[b]=g[b+2],g[b+2]=x}return g}finally{h.close()}})}let Et,gt;const Rt="AbortError";function fi(){return new Error(Rt)}const ti={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Bt(i){return ti.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const ar="global-dispatcher";class Ht extends Error{constructor(t,r,s,l){super(`AJAXError: ${r} (${t}): ${s}`),this.status=t,this.statusText=r,this.url=s,this.body=l}}const sr=()=>Ri(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,na=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const s=Bt(i.url);if(s)return s(i,t);if(Ri(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:ar},t)}if(!(/^file:/.test(r=i.url)||/^file:/.test(sr())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(s,l){return p(this,void 0,void 0,function*(){const h=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:sr(),signal:l.signal});s.type!=="json"||h.headers.has("Accept")||h.headers.set("Accept","application/json");const d=yield fetch(h);if(!d.ok){const b=yield d.blob();throw new Ht(d.status,d.statusText,s.url,b)}let f;f=s.type==="arrayBuffer"||s.type==="image"?d.arrayBuffer():s.type==="json"?d.json():d.text();const g=yield f;if(l.signal.aborted)throw fi();return{data:g,cacheControl:d.headers.get("Cache-Control"),expires:d.headers.get("Expires")}})}(i,t);if(Ri(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:ar},t)}var r;return function(s,l){return new Promise((h,d)=>{var f;const g=new XMLHttpRequest;g.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(g.responseType="arraybuffer");for(const b in s.headers)g.setRequestHeader(b,s.headers[b]);s.type==="json"&&(g.responseType="text",!((f=s.headers)===null||f===void 0)&&f.Accept||g.setRequestHeader("Accept","application/json")),g.withCredentials=s.credentials==="include",g.onerror=()=>{d(new Error(g.statusText))},g.onload=()=>{if(!l.signal.aborted)if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let b=g.response;if(s.type==="json")try{b=JSON.parse(g.response)}catch(x){return void d(x)}h({data:b,cacheControl:g.getResponseHeader("Cache-Control"),expires:g.getResponseHeader("Expires")})}else{const b=new Blob([g.response],{type:g.getResponseHeader("Content-Type")});d(new Ht(g.status,g.statusText,s.url,b))}},l.signal.addEventListener("abort",()=>{g.abort(),d(fi())}),g.send(s.body)})}(i,t)};function oa(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function us(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function Rr(i,t,r){if(r&&r[i]){const s=r[i].indexOf(t);s!==-1&&r[i].splice(s,1)}}class Zr{constructor(t,r={}){ut(this,r),this.type=t}}class Gr extends Zr{constructor(t,r={}){super("error",ut({error:t},r))}}class ka{on(t,r){return this._listeners=this._listeners||{},us(t,r,this._listeners),this}off(t,r){return Rr(t,r,this._listeners),Rr(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},us(t,r,this._oneTimeListeners),this):new Promise(s=>this.once(t,s))}fire(t,r){typeof t=="string"&&(t=new Zr(t,r||{}));const s=t.type;if(this.listens(s)){t.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const f of l)f.call(this,t);const h=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const f of h)Rr(s,f,this._oneTimeListeners),f.call(this,t);const d=this._eventedParent;d&&(ut(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(t))}else t instanceof Gr&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var oe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const la=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function hs(i,t){const r={};for(const s in i)s!=="ref"&&(r[s]=i[s]);return la.forEach(s=>{s in t&&(r[s]=t[s])}),r}function ht(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!ht(i[r],t[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const r in i)if(!ht(i[r],t[r]))return!1;return!0}return i===t}function zt(i,t){i.push(t)}function ds(i,t,r){zt(r,{command:"addSource",args:[i,t[i]]})}function Hr(i,t,r){zt(t,{command:"removeSource",args:[i]}),r[i]=!0}function Br(i,t,r,s){Hr(i,r,s),ds(i,t,r)}function Pa(i,t,r){let s;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!ht(i[r][s],t[r][s]))return!1;for(s in t[r])if(Object.prototype.hasOwnProperty.call(t[r],s)&&s!=="data"&&!ht(i[r][s],t[r][s]))return!1;return!0}function Wi(i,t,r,s,l,h){i=i||{},t=t||{};for(const d in i)Object.prototype.hasOwnProperty.call(i,d)&&(ht(i[d],t[d])||r.push({command:h,args:[s,d,t[d],l]}));for(const d in t)Object.prototype.hasOwnProperty.call(t,d)&&!Object.prototype.hasOwnProperty.call(i,d)&&(ht(i[d],t[d])||r.push({command:h,args:[s,d,t[d],l]}))}function ps(i){return i.id}function fs(i,t){return i[t.id]=t,i}class ye{constructor(t,r,s,l){this.message=(t?`${t}: `:"")+s,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function vr(i,...t){for(const r of t)for(const s in r)i[s]=r[s];return i}class mi extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class wr{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[s,l]of r)this.bindings[s]=l}concat(t){return new wr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Wr={kind:"null"},we={kind:"number"},Xe={kind:"string"},je={kind:"boolean"},Ei={kind:"color"},nr={kind:"object"},Ge={kind:"value"},Er={kind:"collator"},Fr={kind:"formatted"},Xr={kind:"padding"},Sr={kind:"resolvedImage"},j={kind:"variableAnchorOffsetCollection"};function k(i,t){return{kind:"array",itemType:i,N:t}}function I(i){if(i.kind==="array"){const t=I(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const D=[Wr,we,Xe,je,Ei,Fr,nr,k(Ge),Xr,Sr,j];function N(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!N(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const r of D)if(!N(r,t))return null}}return`Expected ${I(i)} but found ${I(t)} instead.`}function X(i,t){return t.some(r=>r.kind===i.kind)}function J(i,t){return t.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function ee(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const G=.96422,ce=.82521,pe=4/29,ne=6/29,be=3*ne*ne,Oe=ne*ne*ne,Ve=Math.PI/180,nt=180/Math.PI;function He(i){return(i%=360)<0&&(i+=360),i}function ot([i,t,r,s]){let l,h;const d=jt((.2225045*(i=et(i))+.7168786*(t=et(t))+.0606169*(r=et(r)))/1);i===t&&t===r?l=h=d:(l=jt((.4360747*i+.3850649*t+.1430804*r)/G),h=jt((.0139322*i+.0971045*t+.7141733*r)/ce));const f=116*d-16;return[f<0?0:f,500*(l-d),200*(d-h),s]}function et(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function jt(i){return i>Oe?Math.pow(i,1/3):i/be+pe}function Dt([i,t,r,s]){let l=(i+16)/116,h=isNaN(t)?l:l+t/500,d=isNaN(r)?l:l-r/200;return l=1*ft(l),h=G*ft(h),d=ce*ft(d),[Ke(3.1338561*h-1.6168667*l-.4906146*d),Ke(-.9787684*h+1.9161415*l+.033454*d),Ke(.0719453*h-.2289914*l+1.4052427*d),s]}function Ke(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function ft(i){return i>ne?i*i*i:be*(i-pe)}function Ct(i){return parseInt(i.padEnd(2,i),16)/255}function Wt(i,t){return ii(t?i/100:i,0,1)}function ii(i,t,r){return Math.min(Math.max(t,i),r)}function gi(i){return!i.some(Number.isNaN)}const Ca={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class mt{constructor(t,r,s,l=1,h=!0){this.r=t,this.g=r,this.b=s,this.a=l,h||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[t,r,s,l]))}static parse(t){if(t instanceof mt)return t;if(typeof t!="string")return;const r=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=Ca[s];if(l){const[d,f,g]=l;return[d/255,f/255,g/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const d=s.length<6?1:2;let f=1;return[Ct(s.slice(f,f+=d)),Ct(s.slice(f,f+=d)),Ct(s.slice(f,f+=d)),Ct(s.slice(f,f+d)||"ff")]}if(s.startsWith("rgb")){const d=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[f,g,b,x,w,T,P,M,z,V,$,te]=d,W=[x||" ",P||" ",V].join("");if(W==="  "||W==="  /"||W===",,"||W===",,,"){const Q=[b,T,z].join(""),le=Q==="%%%"?100:Q===""?255:0;if(le){const me=[ii(+g/le,0,1),ii(+w/le,0,1),ii(+M/le,0,1),$?Wt(+$,te):1];if(gi(me))return me}}return}}const h=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(h){const[d,f,g,b,x,w,T,P,M]=h,z=[g||" ",x||" ",T].join("");if(z==="  "||z==="  /"||z===",,"||z===",,,"){const V=[+f,ii(+b,0,100),ii(+w,0,100),P?Wt(+P,M):1];if(gi(V))return function([$,te,W,Q]){function le(me){const Pe=(me+$/30)%12,Ne=te*Math.min(W,1-W);return W-Ne*Math.max(-1,Math.min(Pe-3,9-Pe,1))}return $=He($),te/=100,W/=100,[le(0),le(8),le(4),Q]}(V)}}}(t);return r?new mt(...r,!1):void 0}get rgb(){const{r:t,g:r,b:s,a:l}=this,h=l||1/0;return this.overwriteGetter("rgb",[t/h,r/h,s/h,l])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,s,l,h]=ot(t),d=Math.sqrt(s*s+l*l);return[Math.round(1e4*d)?He(Math.atan2(l,s)*nt):NaN,d,r,h]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ot(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,s,l]=this.rgb;return`rgba(${[t,r,s].map(h=>Math.round(255*h)).join(",")},${l})`}}mt.black=new mt(0,0,0,1),mt.white=new mt(1,1,1,1),mt.transparent=new mt(0,0,0,0),mt.red=new mt(1,0,0,1);class $n{constructor(t,r,s){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class qn{constructor(t,r,s,l,h){this.text=t,this.image=r,this.scale=s,this.fontStack=l,this.textColor=h}}class Fi{constructor(t){this.sections=t}static fromString(t){return new Fi([new qn(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Fi?t:Fi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Oi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Oi)return t;if(typeof t=="number")return new Oi([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Oi(t)}}toString(){return JSON.stringify(this.values)}}const dc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Xi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Xi)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const s=t[r],l=t[r+1];if(typeof s!="string"||!dc.has(s)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new Xi(t)}}toString(){return JSON.stringify(this.values)}}class Vi{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Vi({name:t,available:!1}):null}}function Aa(i,t,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,t,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,t,r,s]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ca(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof mt||i instanceof $n||i instanceof Fi||i instanceof Oi||i instanceof Xi||i instanceof Vi)return!0;if(Array.isArray(i)){for(const t of i)if(!ca(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!ca(i[t]))return!1;return!0}return!1}function $t(i){if(i===null)return Wr;if(typeof i=="string")return Xe;if(typeof i=="boolean")return je;if(typeof i=="number")return we;if(i instanceof mt)return Ei;if(i instanceof $n)return Er;if(i instanceof Fi)return Fr;if(i instanceof Oi)return Xr;if(i instanceof Xi)return j;if(i instanceof Vi)return Sr;if(Array.isArray(i)){const t=i.length;let r;for(const s of i){const l=$t(s);if(r){if(r===l)continue;r=Ge;break}r=l}return k(r||Ge,t)}return nr}function ms(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof mt||i instanceof Fi||i instanceof Oi||i instanceof Xi||i instanceof Vi?i.toString():JSON.stringify(i)}class or{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ca(t[1]))return r.error("invalid value");const s=t[1];let l=$t(s);const h=r.expectedType;return l.kind!=="array"||l.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(l=h),new or(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Nt{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Zs={string:Xe,number:we,boolean:je,object:nr};class lr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let s,l=1;const h=t[0];if(h==="array"){let f,g;if(t.length>2){const b=t[1];if(typeof b!="string"||!(b in Zs)||b==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);f=Zs[b],l++}else f=Ge;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);g=t[2],l++}s=k(f,g)}else{if(!Zs[h])throw new Error(`Types doesn't contain name = ${h}`);s=Zs[h]}const d=[];for(;l<t.length;l++){const f=r.parse(t[l],l,Ge);if(!f)return null;d.push(f)}return new lr(s,d)}evaluate(t){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(t);if(!N(this.type,$t(s)))return s;if(r===this.args.length-1)throw new Nt(`Expected value to be of type ${I(this.type)}, but found ${I($t(s))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Zn={"to-boolean":je,"to-color":Ei,"to-number":we,"to-string":Xe};class cr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[0];if(!Zn[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&t.length!==2)return r.error("Expected one argument.");const l=Zn[s],h=[];for(let d=1;d<t.length;d++){const f=r.parse(t[d],d,Ge);if(!f)return null;h.push(f)}return new cr(l,h)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,s;for(const l of this.args){if(r=l.evaluate(t),s=null,r instanceof mt)return r;if(typeof r=="string"){const h=t.parseColor(r);if(h)return h}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Aa(r[0],r[1],r[2],r[3]),!s))return new mt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Nt(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(t);const l=Oi.parse(r);if(l)return l}throw new Nt(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(t);const l=Xi.parse(r);if(l)return l}throw new Nt(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(t),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new Nt(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Fi.fromString(ms(this.args[0].evaluate(t)));case"resolvedImage":return Vi.fromString(ms(this.args[0].evaluate(t)));default:return ms(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const pc=["Unknown","Point","LineString","Polygon"];class Gs{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?pc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=mt.parse(t)),r}}class ua{constructor(t,r,s=[],l,h=new wr,d=[]){this.registry=t,this.path=s,this.key=s.map(f=>`[${f}]`).join(""),this.scope=h,this.errors=d,this.expectedType=l,this._isConstant=r}parse(t,r,s,l,h={}){return r?this.concat(r,s,l)._parse(t,h):this._parse(t,h)}_parse(t,r){function s(l,h,d){return d==="assert"?new lr(h,[l]):d==="coerce"?new cr(h,[l]):l}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=t[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[l];if(h){let d=h.parse(t,this);if(!d)return null;if(this.expectedType){const f=this.expectedType,g=d.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||g.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string")if(f.kind!=="padding"||g.kind!=="value"&&g.kind!=="number"&&g.kind!=="array")if(f.kind!=="variableAnchorOffsetCollection"||g.kind!=="value"&&g.kind!=="array"){if(this.checkSubtype(f,g))return null}else d=s(d,f,r.typeAnnotation||"coerce");else d=s(d,f,r.typeAnnotation||"coerce");else d=s(d,f,r.typeAnnotation||"coerce");else d=s(d,f,r.typeAnnotation||"assert")}if(!(d instanceof or)&&d.type.kind!=="resolvedImage"&&this._isConstant(d)){const f=new Gs;try{d=new or(d.type,d.evaluate(f))}catch(g){return this.error(g.message),null}}return d}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,s){const l=typeof t=="number"?this.path.concat(t):this.path,h=s?this.scope.concat(s):this.scope;return new ua(this.registry,this._isConstant,l,r||null,h,this.errors)}error(t,...r){const s=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new mi(s,t))}checkSubtype(t,r){const s=N(t,r);return s&&this.error(s),s}}class Kr{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let h=1;h<t.length-1;h+=2){const d=t[h];if(typeof d!="string")return r.error(`Expected string, but found ${typeof d} instead.`,h);if(/[^a-zA-Z0-9_]/.test(d))return r.error("Variable names must contain only alphanumeric characters or '_'.",h);const f=r.parse(t[h+1],h+1);if(!f)return null;s.push([d,f])}const l=r.parse(t[t.length-1],t.length-1,r.expectedType,s);return l?new Kr(s,l):null}outputDefined(){return this.result.outputDefined()}}class dt{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=t[1];return r.scope.has(s)?new dt(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Gn{constructor(t,r,s){this.type=t,this.index=r,this.input=s}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,we),l=r.parse(t[2],2,k(r.expectedType||Ge));return s&&l?new Gn(l.type.itemType,s,l):null}evaluate(t){const r=this.index.evaluate(t),s=this.input.evaluate(t);if(r<0)throw new Nt(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new Nt(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new Nt(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Hn{constructor(t,r){this.type=je,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,Ge),l=r.parse(t[2],2,Ge);return s&&l?X(s.type,[je,Xe,we,Wr,Ge])?new Hn(s,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${I(s.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!J(r,["boolean","string","number","null"]))throw new Nt(`Expected first argument to be of type boolean, string, number or null, but found ${I($t(r))} instead.`);if(!J(s,["string","array"]))throw new Nt(`Expected second argument to be of type array or string, but found ${I($t(s))} instead.`);return s.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Ma{constructor(t,r,s){this.type=we,this.needle=t,this.haystack=r,this.fromIndex=s}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,Ge),l=r.parse(t[2],2,Ge);if(!s||!l)return null;if(!X(s.type,[je,Xe,we,Wr,Ge]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${I(s.type)} instead`);if(t.length===4){const h=r.parse(t[3],3,we);return h?new Ma(s,l,h):null}return new Ma(s,l)}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!J(r,["boolean","string","number","null"]))throw new Nt(`Expected first argument to be of type boolean, string, number or null, but found ${I($t(r))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(t)),J(s,["string"])){const h=s.indexOf(r,l);return h===-1?-1:[...s.slice(0,h)].length}if(J(s,["array"]))return s.indexOf(r,l);throw new Nt(`Expected second argument to be of type array or string, but found ${I($t(s))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Wn{constructor(t,r,s,l,h,d){this.inputType=t,this.type=r,this.input=s,this.cases=l,this.outputs=h,this.otherwise=d}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let s,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const h={},d=[];for(let b=2;b<t.length-1;b+=2){let x=t[b];const w=t[b+1];Array.isArray(x)||(x=[x]);const T=r.concat(b);if(x.length===0)return T.error("Expected at least one branch label.");for(const M of x){if(typeof M!="number"&&typeof M!="string")return T.error("Branch labels must be numbers or strings.");if(typeof M=="number"&&Math.abs(M)>Number.MAX_SAFE_INTEGER)return T.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof M=="number"&&Math.floor(M)!==M)return T.error("Numeric branch labels must be integer values.");if(s){if(T.checkSubtype(s,$t(M)))return null}else s=$t(M);if(h[String(M)]!==void 0)return T.error("Branch labels must be unique.");h[String(M)]=d.length}const P=r.parse(w,b,l);if(!P)return null;l=l||P.type,d.push(P)}const f=r.parse(t[1],1,Ge);if(!f)return null;const g=r.parse(t[t.length-1],t.length-1,l);return g?f.type.kind!=="value"&&r.concat(1).checkSubtype(s,f.type)?null:new Wn(s,l,f,h,d,g):null}evaluate(t){const r=this.input.evaluate(t);return($t(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Hs{constructor(t,r,s){this.type=t,this.branches=r,this.otherwise=s}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const l=[];for(let d=1;d<t.length-1;d+=2){const f=r.parse(t[d],d,je);if(!f)return null;const g=r.parse(t[d+1],d+1,s);if(!g)return null;l.push([f,g]),s=s||g.type}const h=r.parse(t[t.length-1],t.length-1,s);if(!h)return null;if(!s)throw new Error("Can't infer output type");return new Hs(s,l,h)}evaluate(t){for(const[r,s]of this.branches)if(r.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,s]of this.branches)t(r),t(s);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class gs{constructor(t,r,s,l){this.type=t,this.input=r,this.beginIndex=s,this.endIndex=l}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,Ge),l=r.parse(t[2],2,we);if(!s||!l)return null;if(!X(s.type,[k(Ge),Xe,Ge]))return r.error(`Expected first argument to be of type array or string, but found ${I(s.type)} instead`);if(t.length===4){const h=r.parse(t[3],3,we);return h?new gs(s.type,s,l,h):null}return new gs(s.type,s,l)}evaluate(t){const r=this.input.evaluate(t),s=this.beginIndex.evaluate(t);let l;if(this.endIndex&&(l=this.endIndex.evaluate(t)),J(r,["string"]))return[...r].slice(s,l).join("");if(J(r,["array"]))return r.slice(s,l);throw new Nt(`Expected first argument to be of type array or string, but found ${I($t(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ws(i,t){const r=i.length-1;let s,l,h=0,d=r,f=0;for(;h<=d;)if(f=Math.floor((h+d)/2),s=i[f],l=i[f+1],s<=t){if(f===r||t<l)return f;h=f+1}else{if(!(s>t))throw new Nt("Input is not a number.");d=f-1}return 0}class za{constructor(t,r,s){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[l,h]of s)this.labels.push(l),this.outputs.push(h)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(t[1],1,we);if(!s)return null;const l=[];let h=null;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);for(let d=1;d<t.length;d+=2){const f=d===1?-1/0:t[d],g=t[d+1],b=d,x=d+1;if(typeof f!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(l.length&&l[l.length-1][0]>=f)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);const w=r.parse(g,x,h);if(!w)return null;h=h||w.type,l.push([f,w])}return new za(h,s,l)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return s[0].evaluate(t);const h=r.length;return l>=r[h-1]?s[h-1].evaluate(t):s[Ws(r,l)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function rl(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var fc=al;function al(i,t,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=s}al.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<t)return r;var h=this.sampleCurveDerivativeX(r);if(Math.abs(h)<1e-6)break;r-=l/h}var d=0,f=1;for(r=i,s=0;s<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<t));s++)i>l?d=r:f=r,r=.5*(f-d)+d;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var mc=rl(fc);function ha(i,t,r){return i+r*(t-i)}function _s(i,t,r){return i.map((s,l)=>ha(s,t[l],r))}const Si={number:ha,color:function(i,t,r,s="rgb"){switch(s){case"rgb":{const[l,h,d,f]=_s(i.rgb,t.rgb,r);return new mt(l,h,d,f,!1)}case"hcl":{const[l,h,d,f]=i.hcl,[g,b,x,w]=t.hcl;let T,P;if(isNaN(l)||isNaN(g))isNaN(l)?isNaN(g)?T=NaN:(T=g,d!==1&&d!==0||(P=b)):(T=l,x!==1&&x!==0||(P=h));else{let te=g-l;g>l&&te>180?te-=360:g<l&&l-g>180&&(te+=360),T=l+r*te}const[M,z,V,$]=function([te,W,Q,le]){return te=isNaN(te)?0:te*Ve,Dt([Q,Math.cos(te)*W,Math.sin(te)*W,le])}([T,P??ha(h,b,r),ha(d,x,r),ha(f,w,r)]);return new mt(M,z,V,$,!1)}case"lab":{const[l,h,d,f]=Dt(_s(i.lab,t.lab,r));return new mt(l,h,d,f,!1)}}},array:_s,padding:function(i,t,r){return new Oi(_s(i.values,t.values,r))},variableAnchorOffsetCollection:function(i,t,r){const s=i.values,l=t.values;if(s.length!==l.length)throw new Nt(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const h=[];for(let d=0;d<s.length;d+=2){if(s[d]!==l[d])throw new Nt(`Cannot interpolate values containing mismatched anchors. from[${d}]: ${s[d]}, to[${d}]: ${l[d]}`);h.push(s[d]);const[f,g]=s[d+1],[b,x]=l[d+1];h.push([ha(f,b,r),ha(g,x,r)])}return new Xi(h)}};class Ti{constructor(t,r,s,l,h){this.type=t,this.operator=r,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[d,f]of h)this.labels.push(d),this.outputs.push(f)}static interpolationFactor(t,r,s,l){let h=0;if(t.name==="exponential")h=Xs(r,t.base,s,l);else if(t.name==="linear")h=Xs(r,1,s,l);else if(t.name==="cubic-bezier"){const d=t.controlPoints;h=new mc(d[0],d[1],d[2],d[3]).solve(Xs(r,1,s,l))}return h}static parse(t,r){let[s,l,h,...d]=t;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const b=l[1];if(typeof b!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:b}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const b=l.slice(1);if(b.length!==4||b.some(x=>typeof x!="number"||x<0||x>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:b}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(h=r.parse(h,2,we),!h)return null;const f=[];let g=null;s==="interpolate-hcl"||s==="interpolate-lab"?g=Ei:r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let b=0;b<d.length;b+=2){const x=d[b],w=d[b+1],T=b+3,P=b+4;if(typeof x!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(f.length&&f[f.length-1][0]>=x)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',T);const M=r.parse(w,P,g);if(!M)return null;g=g||M.type,f.push([x,M])}return ee(g,we)||ee(g,Ei)||ee(g,Xr)||ee(g,j)||ee(g,k(we))?new Ti(g,s,l,h,f):r.error(`Type ${I(g)} is not interpolatable.`)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return s[0].evaluate(t);const h=r.length;if(l>=r[h-1])return s[h-1].evaluate(t);const d=Ws(r,l),f=Ti.interpolationFactor(this.interpolation,l,r[d],r[d+1]),g=s[d].evaluate(t),b=s[d+1].evaluate(t);switch(this.operator){case"interpolate":return Si[this.type.kind](g,b,f);case"interpolate-hcl":return Si.color(g,b,f,"hcl");case"interpolate-lab":return Si.color(g,b,f,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Xs(i,t,r,s){const l=s-r,h=i-r;return l===0?0:t===1?h/l:(Math.pow(t,h)-1)/(Math.pow(t,l)-1)}class Ks{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let s=null;const l=r.expectedType;l&&l.kind!=="value"&&(s=l);const h=[];for(const f of t.slice(1)){const g=r.parse(f,1+h.length,s,void 0,{typeAnnotation:"omit"});if(!g)return null;s=s||g.type,h.push(g)}if(!s)throw new Error("No output type");const d=l&&h.some(f=>N(l,f.type));return new Ks(d?Ge:s,h)}evaluate(t){let r,s=null,l=0;for(const h of this.args)if(l++,s=h.evaluate(t),s&&s instanceof Vi&&!s.available&&(r||(r=s.name),s=null,l===this.args.length&&(s=r)),s!==null)break;return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Js(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function sl(i,t,r,s){return s.compare(t,r)===0}function Da(i,t,r){const s=i!=="=="&&i!=="!=";return class Ud{constructor(h,d,f){this.type=je,this.lhs=h,this.rhs=d,this.collator=f,this.hasUntypedArgument=h.type.kind==="value"||d.type.kind==="value"}static parse(h,d){if(h.length!==3&&h.length!==4)return d.error("Expected two or three arguments.");const f=h[0];let g=d.parse(h[1],1,Ge);if(!g)return null;if(!Js(f,g.type))return d.concat(1).error(`"${f}" comparisons are not supported for type '${I(g.type)}'.`);let b=d.parse(h[2],2,Ge);if(!b)return null;if(!Js(f,b.type))return d.concat(2).error(`"${f}" comparisons are not supported for type '${I(b.type)}'.`);if(g.type.kind!==b.type.kind&&g.type.kind!=="value"&&b.type.kind!=="value")return d.error(`Cannot compare types '${I(g.type)}' and '${I(b.type)}'.`);s&&(g.type.kind==="value"&&b.type.kind!=="value"?g=new lr(b.type,[g]):g.type.kind!=="value"&&b.type.kind==="value"&&(b=new lr(g.type,[b])));let x=null;if(h.length===4){if(g.type.kind!=="string"&&b.type.kind!=="string"&&g.type.kind!=="value"&&b.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(x=d.parse(h[3],3,Er),!x)return null}return new Ud(g,b,x)}evaluate(h){const d=this.lhs.evaluate(h),f=this.rhs.evaluate(h);if(s&&this.hasUntypedArgument){const g=$t(d),b=$t(f);if(g.kind!==b.kind||g.kind!=="string"&&g.kind!=="number")throw new Nt(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${g.kind}, ${b.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const g=$t(d),b=$t(f);if(g.kind!=="string"||b.kind!=="string")return t(h,d,f)}return this.collator?r(h,d,f,this.collator.evaluate(h)):t(h,d,f)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}}}const gc=Da("==",function(i,t,r){return t===r},sl),nl=Da("!=",function(i,t,r){return t!==r},function(i,t,r,s){return!sl(0,t,r,s)}),ol=Da("<",function(i,t,r){return t<r},function(i,t,r,s){return s.compare(t,r)<0}),_c=Da(">",function(i,t,r){return t>r},function(i,t,r,s){return s.compare(t,r)>0}),yc=Da("<=",function(i,t,r){return t<=r},function(i,t,r,s){return s.compare(t,r)<=0}),ll=Da(">=",function(i,t,r){return t>=r},function(i,t,r,s){return s.compare(t,r)>=0});class ys{constructor(t,r,s){this.type=Er,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const s=t[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const l=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,je);if(!l)return null;const h=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,je);if(!h)return null;let d=null;return s.locale&&(d=r.parse(s.locale,1,Xe),!d)?null:new ys(l,h,d)}evaluate(t){return new $n(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Xn{constructor(t,r,s,l,h){this.type=Xe,this.number=t,this.locale=r,this.currency=s,this.minFractionDigits=l,this.maxFractionDigits=h}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const s=r.parse(t[1],1,we);if(!s)return null;const l=t[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let h=null;if(l.locale&&(h=r.parse(l.locale,1,Xe),!h))return null;let d=null;if(l.currency&&(d=r.parse(l.currency,1,Xe),!d))return null;let f=null;if(l["min-fraction-digits"]&&(f=r.parse(l["min-fraction-digits"],1,we),!f))return null;let g=null;return l["max-fraction-digits"]&&(g=r.parse(l["max-fraction-digits"],1,we),!g)?null:new Xn(s,h,d,f,g)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ys{constructor(t){this.type=Fr,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const l=[];let h=!1;for(let d=1;d<=t.length-1;++d){const f=t[d];if(h&&typeof f=="object"&&!Array.isArray(f)){h=!1;let g=null;if(f["font-scale"]&&(g=r.parse(f["font-scale"],1,we),!g))return null;let b=null;if(f["text-font"]&&(b=r.parse(f["text-font"],1,k(Xe)),!b))return null;let x=null;if(f["text-color"]&&(x=r.parse(f["text-color"],1,Ei),!x))return null;const w=l[l.length-1];w.scale=g,w.font=b,w.textColor=x}else{const g=r.parse(t[d],1,Ge);if(!g)return null;const b=g.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,l.push({content:g,scale:null,font:null,textColor:null})}}return new Ys(l)}evaluate(t){return new Fi(this.sections.map(r=>{const s=r.content.evaluate(t);return $t(s)===Sr?new qn("",s,null,null,null):new qn(ms(s),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class Kn{constructor(t){this.type=Sr,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const s=r.parse(t[1],1,Xe);return s?new Kn(s):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),s=Vi.fromString(r);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(r)>-1),s}eachChild(t){t(this.input)}outputDefined(){return!1}}class Jn{constructor(t){this.type=we,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=r.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${I(s.type)} instead.`):new Jn(s):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Nt(`Expected value to be of type string or array, but found ${I($t(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Tr=8192;function bc(i,t){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(r*l*Tr),Math.round(s*l*Tr)]}function Yn(i,t){const r=Math.pow(2,t.z);return[(l=(i[0]/Tr+t.x)/r,360*l-180),(s=(i[1]/Tr+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90)];var s,l}function da(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function Jr(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function pt(i,t,r){const s=i[0]-t[0],l=i[1]-t[1],h=i[0]-r[0],d=i[1]-r[1];return s*d-h*l==0&&s*h<=0&&l*d<=0}function Qs(i,t,r,s){return(l=[s[0]-r[0],s[1]-r[1]])[0]*(h=[t[0]-i[0],t[1]-i[1]])[1]-l[1]*h[0]!=0&&!(!ul(i,t,r,s)||!ul(r,s,i,t));var l,h}function xc(i,t,r){for(const s of r)for(let l=0;l<s.length-1;++l)if(Qs(i,t,s[l],s[l+1]))return!0;return!1}function La(i,t,r=!1){let s=!1;for(const f of t)for(let g=0;g<f.length-1;g++){if(pt(i,f[g],f[g+1]))return r;(h=f[g])[1]>(l=i)[1]!=(d=f[g+1])[1]>l[1]&&l[0]<(d[0]-h[0])*(l[1]-h[1])/(d[1]-h[1])+h[0]&&(s=!s)}var l,h,d;return s}function vc(i,t){for(const r of t)if(La(i,r))return!0;return!1}function cl(i,t){for(const r of i)if(!La(r,t))return!1;for(let r=0;r<i.length-1;++r)if(xc(i[r],i[r+1],t))return!1;return!0}function wc(i,t){for(const r of t)if(cl(i,r))return!0;return!1}function ul(i,t,r,s){const l=s[0]-r[0],h=s[1]-r[1],d=(i[0]-r[0])*h-l*(i[1]-r[1]),f=(t[0]-r[0])*h-l*(t[1]-r[1]);return d>0&&f<0||d<0&&f>0}function Qn(i,t,r){const s=[];for(let l=0;l<i.length;l++){const h=[];for(let d=0;d<i[l].length;d++){const f=bc(i[l][d],r);da(t,f),h.push(f)}s.push(h)}return s}function hl(i,t,r){const s=[];for(let l=0;l<i.length;l++){const h=Qn(i[l],t,r);s.push(h)}return s}function dl(i,t,r,s){if(i[0]<r[0]||i[0]>r[2]){const l=.5*s;let h=i[0]-r[0]>l?-s:r[0]-i[0]>l?s:0;h===0&&(h=i[0]-r[2]>l?-s:r[2]-i[0]>l?s:0),i[0]+=h}da(t,i)}function pl(i,t,r,s){const l=Math.pow(2,s.z)*Tr,h=[s.x*Tr,s.y*Tr],d=[];for(const f of i)for(const g of f){const b=[g.x+h[0],g.y+h[1]];dl(b,t,r,l),d.push(b)}return d}function fl(i,t,r,s){const l=Math.pow(2,s.z)*Tr,h=[s.x*Tr,s.y*Tr],d=[];for(const g of i){const b=[];for(const x of g){const w=[x.x+h[0],x.y+h[1]];da(t,w),b.push(w)}d.push(b)}if(t[2]-t[0]<=l/2){(f=t)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(const g of d)for(const b of g)dl(b,t,r,l)}var f;return d}class pa{constructor(t,r){this.type=je,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ca(t[1])){const s=t[1];if(s.type==="FeatureCollection"){const l=[];for(const h of s.features){const{type:d,coordinates:f}=h.geometry;d==="Polygon"&&l.push(f),d==="MultiPolygon"&&l.push(...f)}if(l.length)return new pa(s,{type:"MultiPolygon",coordinates:l})}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new pa(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new pa(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(s.type==="Polygon"){const f=Qn(s.coordinates,h,d),g=pl(r.geometry(),l,h,d);if(!Jr(l,h))return!1;for(const b of g)if(!La(b,f))return!1}if(s.type==="MultiPolygon"){const f=hl(s.coordinates,h,d),g=pl(r.geometry(),l,h,d);if(!Jr(l,h))return!1;for(const b of g)if(!vc(b,f))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(s.type==="Polygon"){const f=Qn(s.coordinates,h,d),g=fl(r.geometry(),l,h,d);if(!Jr(l,h))return!1;for(const b of g)if(!cl(b,f))return!1}if(s.type==="MultiPolygon"){const f=hl(s.coordinates,h,d),g=fl(r.geometry(),l,h,d);if(!Jr(l,h))return!1;for(const b of g)if(!wc(b,f))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ml=class{constructor(i=[],t=(r,s)=>r<s?-1:r>s?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:r}=this,s=t[i];for(;i>0;){const l=i-1>>1,h=t[l];if(r(s,h)>=0)break;t[i]=h,i=l}t[i]=s}_down(i){const{data:t,compare:r}=this,s=this.length>>1,l=t[i];for(;i<s;){let h=1+(i<<1);const d=h+1;if(d<this.length&&r(t[d],t[h])<0&&(h=d),r(t[h],l)>=0)break;t[i]=t[h],i=h}t[i]=l}};function Ec(i,t,r,s,l){gl(i,t,r,s||i.length-1,l||Sc)}function gl(i,t,r,s,l){for(;s>r;){if(s-r>600){var h=s-r+1,d=t-r+1,f=Math.log(h),g=.5*Math.exp(2*f/3),b=.5*Math.sqrt(f*g*(h-g)/h)*(d-h/2<0?-1:1);gl(i,t,Math.max(r,Math.floor(t-d*g/h+b)),Math.min(s,Math.floor(t+(h-d)*g/h+b)),l)}var x=i[t],w=r,T=s;for(bs(i,r,t),l(i[s],x)>0&&bs(i,r,s);w<T;){for(bs(i,w,T),w++,T--;l(i[w],x)<0;)w++;for(;l(i[T],x)>0;)T--}l(i[r],x)===0?bs(i,r,T):bs(i,++T,s),T<=t&&(r=T+1),t<=T&&(s=T-1)}}function bs(i,t,r){var s=i[t];i[t]=i[r],i[r]=s}function Sc(i,t){return i<t?-1:i>t?1:0}function en(i,t){if(i.length<=1)return[i];const r=[];let s,l;for(const h of i){const d=Ic(h);d!==0&&(h.area=Math.abs(d),l===void 0&&(l=d<0),l===d<0?(s&&r.push(s),s=[h]):s.push(h))}if(s&&r.push(s),t>1)for(let h=0;h<r.length;h++)r[h].length<=t||(Ec(r[h],t,1,r[h].length-1,Tc),r[h]=r[h].slice(0,t));return r}function Tc(i,t){return t.area-i.area}function Ic(i){let t=0;for(let r,s,l=0,h=i.length,d=h-1;l<h;d=l++)r=i[l],s=i[d],t+=(s.x-r.x)*(r.y+s.y);return t}const _l=1/298.257223563,yl=_l*(2-_l),bl=Math.PI/180;class eo{constructor(t){const r=6378.137*bl*1e3,s=Math.cos(t*bl),l=1/(1-yl*(1-s*s)),h=Math.sqrt(l);this.kx=r*h*s,this.ky=r*h*l*(1-yl)}distance(t,r){const s=this.wrap(t[0]-r[0])*this.kx,l=(t[1]-r[1])*this.ky;return Math.sqrt(s*s+l*l)}pointOnLine(t,r){let s,l,h,d,f=1/0;for(let g=0;g<t.length-1;g++){let b=t[g][0],x=t[g][1],w=this.wrap(t[g+1][0]-b)*this.kx,T=(t[g+1][1]-x)*this.ky,P=0;w===0&&T===0||(P=(this.wrap(r[0]-b)*this.kx*w+(r[1]-x)*this.ky*T)/(w*w+T*T),P>1?(b=t[g+1][0],x=t[g+1][1]):P>0&&(b+=w/this.kx*P,x+=T/this.ky*P)),w=this.wrap(r[0]-b)*this.kx,T=(r[1]-x)*this.ky;const M=w*w+T*T;M<f&&(f=M,s=b,l=x,h=g,d=P)}return{point:[s,l],index:h,t:Math.max(0,Math.min(1,d))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function xl(i,t){return t[0]-i[0]}function tn(i){return i[1]-i[0]+1}function Or(i,t){return i[1]>=i[0]&&i[1]<t}function to(i,t){if(i[0]>i[1])return[null,null];const r=tn(i);if(t){if(r===2)return[i,null];const l=Math.floor(r/2);return[[i[0],i[0]+l],[i[0]+l,i[1]]]}if(r===1)return[i,null];const s=Math.floor(r/2)-1;return[[i[0],i[0]+s],[i[0]+s+1,i[1]]]}function io(i,t){if(!Or(t,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let s=t[0];s<=t[1];++s)da(r,i[s]);return r}function ro(i){const t=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const s of r)da(t,s);return t}function rn(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function ao(i,t,r){if(!rn(i)||!rn(t))return NaN;let s=0,l=0;return i[2]<t[0]&&(s=t[0]-i[2]),i[0]>t[2]&&(s=i[0]-t[2]),i[1]>t[3]&&(l=i[1]-t[3]),i[3]<t[1]&&(l=t[1]-i[3]),r.distance([0,0],[s,l])}function fa(i,t,r){const s=r.pointOnLine(t,i);return r.distance(i,s.point)}function so(i,t,r,s,l){const h=Math.min(fa(i,[r,s],l),fa(t,[r,s],l)),d=Math.min(fa(r,[i,t],l),fa(s,[i,t],l));return Math.min(h,d)}function kc(i,t,r,s,l){if(!Or(t,i.length)||!Or(s,r.length))return 1/0;let h=1/0;for(let d=t[0];d<t[1];++d){const f=i[d],g=i[d+1];for(let b=s[0];b<s[1];++b){const x=r[b],w=r[b+1];if(Qs(f,g,x,w))return 0;h=Math.min(h,so(f,g,x,w,l))}}return h}function Ft(i,t,r,s,l){if(!Or(t,i.length)||!Or(s,r.length))return NaN;let h=1/0;for(let d=t[0];d<=t[1];++d)for(let f=s[0];f<=s[1];++f)if(h=Math.min(h,l.distance(i[d],r[f])),h===0)return h;return h}function Pc(i,t,r){if(La(i,t,!0))return 0;let s=1/0;for(const l of t){const h=l[0],d=l[l.length-1];if(h!==d&&(s=Math.min(s,fa(i,[d,h],r)),s===0))return s;const f=r.pointOnLine(l,i);if(s=Math.min(s,r.distance(i,f.point)),s===0)return s}return s}function Je(i,t,r,s){if(!Or(t,i.length))return NaN;for(let h=t[0];h<=t[1];++h)if(La(i[h],r,!0))return 0;let l=1/0;for(let h=t[0];h<t[1];++h){const d=i[h],f=i[h+1];for(const g of r)for(let b=0,x=g.length,w=x-1;b<x;w=b++){const T=g[w],P=g[b];if(Qs(d,f,T,P))return 0;l=Math.min(l,so(d,f,T,P,s))}}return l}function an(i,t){for(const r of i)for(const s of r)if(La(s,t,!0))return!0;return!1}function vt(i,t,r,s=1/0){const l=ro(i),h=ro(t);if(s!==1/0&&ao(l,h,r)>=s)return s;if(Jr(l,h)){if(an(i,t))return 0}else if(an(t,i))return 0;let d=1/0;for(const f of i)for(let g=0,b=f.length,x=b-1;g<b;x=g++){const w=f[x],T=f[g];for(const P of t)for(let M=0,z=P.length,V=z-1;M<z;V=M++){const $=P[V],te=P[M];if(Qs(w,T,$,te))return 0;d=Math.min(d,so(w,T,$,te,r))}}return d}function _t(i,t,r,s,l,h){if(!h)return;const d=ao(io(s,h),l,r);d<t&&i.push([d,h,[0,0]])}function ma(i,t,r,s,l,h,d){if(!h||!d)return;const f=ao(io(s,h),io(l,d),r);f<t&&i.push([f,h,d])}function xs(i,t,r,s,l=1/0){let h=Math.min(s.distance(i[0],r[0][0]),l);if(h===0)return h;const d=new ml([[0,[0,i.length-1],[0,0]]],xl),f=ro(r);for(;d.length>0;){const g=d.pop();if(g[0]>=h)continue;const b=g[1],x=t?50:100;if(tn(b)<=x){if(!Or(b,i.length))return NaN;if(t){const w=Je(i,b,r,s);if(isNaN(w)||w===0)return w;h=Math.min(h,w)}else for(let w=b[0];w<=b[1];++w){const T=Pc(i[w],r,s);if(h=Math.min(h,T),h===0)return 0}}else{const w=to(b,t);_t(d,h,s,i,f,w[0]),_t(d,h,s,i,f,w[1])}}return h}function vs(i,t,r,s,l,h=1/0){let d=Math.min(h,l.distance(i[0],r[0]));if(d===0)return d;const f=new ml([[0,[0,i.length-1],[0,r.length-1]]],xl);for(;f.length>0;){const g=f.pop();if(g[0]>=d)continue;const b=g[1],x=g[2],w=t?50:100,T=s?50:100;if(tn(b)<=w&&tn(x)<=T){if(!Or(b,i.length)&&Or(x,r.length))return NaN;let P;if(t&&s)P=kc(i,b,r,x,l),d=Math.min(d,P);else if(t&&!s){const M=i.slice(b[0],b[1]+1);for(let z=x[0];z<=x[1];++z)if(P=fa(r[z],M,l),d=Math.min(d,P),d===0)return d}else if(!t&&s){const M=r.slice(x[0],x[1]+1);for(let z=b[0];z<=b[1];++z)if(P=fa(i[z],M,l),d=Math.min(d,P),d===0)return d}else P=Ft(i,b,r,x,l),d=Math.min(d,P)}else{const P=to(b,t),M=to(x,s);ma(f,d,l,i,r,P[0],M[0]),ma(f,d,l,i,r,P[0],M[1]),ma(f,d,l,i,r,P[1],M[0]),ma(f,d,l,i,r,P[1],M[1])}}return d}function no(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class ga{constructor(t,r){this.type=we,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ca(t[1])){const s=t[1];if(s.type==="FeatureCollection")return new ga(s,s.features.map(l=>no(l.geometry)).flat());if(s.type==="Feature")return new ga(s,no(s.geometry));if("type"in s&&"coordinates"in s)return new ga(s,no(s))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,s){const l=r.geometry(),h=l.flat().map(g=>Yn([g.x,g.y],r.canonical));if(l.length===0)return NaN;const d=new eo(h[0][1]);let f=1/0;for(const g of s){switch(g.type){case"Point":f=Math.min(f,vs(h,!1,[g.coordinates],!1,d,f));break;case"LineString":f=Math.min(f,vs(h,!1,g.coordinates,!0,d,f));break;case"Polygon":f=Math.min(f,xs(h,!1,g.coordinates,d,f))}if(f===0)return f}return f}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,s){const l=r.geometry(),h=l.flat().map(g=>Yn([g.x,g.y],r.canonical));if(l.length===0)return NaN;const d=new eo(h[0][1]);let f=1/0;for(const g of s){switch(g.type){case"Point":f=Math.min(f,vs(h,!0,[g.coordinates],!1,d,f));break;case"LineString":f=Math.min(f,vs(h,!0,g.coordinates,!0,d,f));break;case"Polygon":f=Math.min(f,xs(h,!0,g.coordinates,d,f))}if(f===0)return f}return f}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,s){const l=r.geometry();if(l.length===0||l[0].length===0)return NaN;const h=en(l,0).map(g=>g.map(b=>b.map(x=>Yn([x.x,x.y],r.canonical)))),d=new eo(h[0][0][0][1]);let f=1/0;for(const g of s)for(const b of h){switch(g.type){case"Point":f=Math.min(f,xs([g.coordinates],!1,b,d,f));break;case"LineString":f=Math.min(f,xs(g.coordinates,!0,b,d,f));break;case"Polygon":f=Math.min(f,vt(b,g.coordinates,d,f))}if(f===0)return f}return f}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Ra={"==":gc,"!=":nl,">":_c,"<":ol,">=":ll,"<=":yc,array:lr,at:Gn,boolean:lr,case:Hs,coalesce:Ks,collator:ys,format:Ys,image:Kn,in:Hn,"index-of":Ma,interpolate:Ti,"interpolate-hcl":Ti,"interpolate-lab":Ti,length:Jn,let:Kr,literal:or,match:Wn,number:lr,"number-format":Xn,object:lr,slice:gs,step:za,string:lr,"to-boolean":cr,"to-color":cr,"to-number":cr,"to-string":cr,var:dt,within:pa,distance:ga};class Ki{constructor(t,r,s,l){this.name=t,this.type=r,this._evaluate=s,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const s=t[0],l=Ki.definitions[s];if(!l)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(l)?l[0]:l.type,d=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,f=d.filter(([b])=>!Array.isArray(b)||b.length===t.length-1);let g=null;for(const[b,x]of f){g=new ua(r.registry,ws,r.path,null,r.scope);const w=[];let T=!1;for(let P=1;P<t.length;P++){const M=t[P],z=Array.isArray(b)?b[P-1]:b.type,V=g.parse(M,1+w.length,z);if(!V){T=!0;break}w.push(V)}if(!T)if(Array.isArray(b)&&b.length!==w.length)g.error(`Expected ${b.length} arguments, but found ${w.length} instead.`);else{for(let P=0;P<w.length;P++){const M=Array.isArray(b)?b[P]:b.type,z=w[P];g.concat(P+1).checkSubtype(M,z.type)}if(g.errors.length===0)return new Ki(s,h,x,w)}}if(f.length===1)r.errors.push(...g.errors);else{const b=(f.length?f:d).map(([w])=>{return T=w,Array.isArray(T)?`(${T.map(I).join(", ")})`:`(${I(T.type)}...)`;var T}).join(" | "),x=[];for(let w=1;w<t.length;w++){const T=r.parse(t[w],1+x.length);if(!T)return null;x.push(I(T.type))}r.error(`Expected arguments of type ${b}, but found (${x.join(", ")}) instead.`)}return null}static register(t,r){Ki.definitions=r;for(const s in r)t[s]=Ki}}function oo(i,[t,r,s,l]){t=t.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const h=l?l.evaluate(i):1,d=Aa(t,r,s,h);if(d)throw new Nt(d);return new mt(t/255,r/255,s/255,h,!1)}function lo(i,t){return i in t}function co(i,t){const r=t[i];return r===void 0?null:r}function _a(i){return{type:i}}function ws(i){if(i instanceof dt)return ws(i.boundExpression);if(i instanceof Ki&&i.name==="error"||i instanceof ys||i instanceof pa||i instanceof ga)return!1;const t=i instanceof cr||i instanceof lr;let r=!0;return i.eachChild(s=>{r=t?r&&ws(s):r&&s instanceof or}),!!r&&Es(i)&&Ss(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Es(i){if(i instanceof Ki&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof pa||i instanceof ga)return!1;let t=!0;return i.eachChild(r=>{t&&!Es(r)&&(t=!1)}),t}function Ba(i){if(i instanceof Ki&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(r=>{t&&!Ba(r)&&(t=!1)}),t}function Ss(i,t){if(i instanceof Ki&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!Ss(s,t)&&(r=!1)}),r}function sn(i){return{result:"success",value:i}}function Fa(i){return{result:"error",value:i}}function Oa(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function vl(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function uo(i){return!!i.expression&&i.expression.interpolated}function lt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function nn(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Cc(i){return i}function wl(i,t){const r=t.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",l=s||!(s||i.property!==void 0),h=i.type||(uo(t)?"exponential":"interval");if(r||t.type==="padding"){const x=r?mt.parse:Oi.parse;(i=vr({},i)).stops&&(i.stops=i.stops.map(w=>[w[0],x(w[1])])),i.default=x(i.default?i.default:t.default)}if(i.colorSpace&&(d=i.colorSpace)!=="rgb"&&d!=="hcl"&&d!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var d;let f,g,b;if(h==="exponential")f=Sl;else if(h==="interval")f=on;else if(h==="categorical"){f=El,g=Object.create(null);for(const x of i.stops)g[x[0]]=x[1];b=typeof i.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);f=Tl}if(s){const x={},w=[];for(let M=0;M<i.stops.length;M++){const z=i.stops[M],V=z[0].zoom;x[V]===void 0&&(x[V]={zoom:V,type:i.type,property:i.property,default:i.default,stops:[]},w.push(V)),x[V].stops.push([z[0].value,z[1]])}const T=[];for(const M of w)T.push([x[M].zoom,wl(x[M],t)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Ti.interpolationFactor.bind(void 0,P),zoomStops:T.map(M=>M[0]),evaluate:({zoom:M},z)=>Sl({stops:T,base:i.base},t,M).evaluate(M,z)}}if(l){const x=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:Ti.interpolationFactor.bind(void 0,x),zoomStops:i.stops.map(w=>w[0]),evaluate:({zoom:w})=>f(i,t,w,g,b)}}return{kind:"source",evaluate(x,w){const T=w&&w.properties?w.properties[i.property]:void 0;return T===void 0?Va(i.default,t.default):f(i,t,T,g,b)}}}function Va(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function El(i,t,r,s,l){return Va(typeof r===l?s[r]:void 0,i.default,t.default)}function on(i,t,r){if(lt(r)!=="number")return Va(i.default,t.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const l=Ws(i.stops.map(h=>h[0]),r);return i.stops[l][1]}function Sl(i,t,r){const s=i.base!==void 0?i.base:1;if(lt(r)!=="number")return Va(i.default,t.default);const l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];const h=Ws(i.stops.map(x=>x[0]),r),d=function(x,w,T,P){const M=P-T,z=x-T;return M===0?0:w===1?z/M:(Math.pow(w,z)-1)/(Math.pow(w,M)-1)}(r,s,i.stops[h][0],i.stops[h+1][0]),f=i.stops[h][1],g=i.stops[h+1][1],b=Si[t.type]||Cc;return typeof f.evaluate=="function"?{evaluate(...x){const w=f.evaluate.apply(void 0,x),T=g.evaluate.apply(void 0,x);if(w!==void 0&&T!==void 0)return b(w,T,d,i.colorSpace)}}:b(f,g,d,i.colorSpace)}function Tl(i,t,r){switch(t.type){case"color":r=mt.parse(r);break;case"formatted":r=Fi.fromString(r.toString());break;case"resolvedImage":r=Vi.fromString(r.toString());break;case"padding":r=Oi.parse(r);break;default:lt(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return Va(r,i.default,t.default)}Ki.register(Ra,{error:[{kind:"error"},[Xe],(i,[t])=>{throw new Nt(t.evaluate(i))}],typeof:[Xe,[Ge],(i,[t])=>I($t(t.evaluate(i)))],"to-rgba":[k(we,4),[Ei],(i,[t])=>{const[r,s,l,h]=t.evaluate(i).rgb;return[255*r,255*s,255*l,h]}],rgb:[Ei,[we,we,we],oo],rgba:[Ei,[we,we,we,we],oo],has:{type:je,overloads:[[[Xe],(i,[t])=>lo(t.evaluate(i),i.properties())],[[Xe,nr],(i,[t,r])=>lo(t.evaluate(i),r.evaluate(i))]]},get:{type:Ge,overloads:[[[Xe],(i,[t])=>co(t.evaluate(i),i.properties())],[[Xe,nr],(i,[t,r])=>co(t.evaluate(i),r.evaluate(i))]]},"feature-state":[Ge,[Xe],(i,[t])=>co(t.evaluate(i),i.featureState||{})],properties:[nr,[],i=>i.properties()],"geometry-type":[Xe,[],i=>i.geometryType()],id:[Ge,[],i=>i.id()],zoom:[we,[],i=>i.globals.zoom],"heatmap-density":[we,[],i=>i.globals.heatmapDensity||0],"line-progress":[we,[],i=>i.globals.lineProgress||0],accumulated:[Ge,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[we,_a(we),(i,t)=>{let r=0;for(const s of t)r+=s.evaluate(i);return r}],"*":[we,_a(we),(i,t)=>{let r=1;for(const s of t)r*=s.evaluate(i);return r}],"-":{type:we,overloads:[[[we,we],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[we],(i,[t])=>-t.evaluate(i)]]},"/":[we,[we,we],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[we,[we,we],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[we,[],()=>Math.LN2],pi:[we,[],()=>Math.PI],e:[we,[],()=>Math.E],"^":[we,[we,we],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[we,[we],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[we,[we],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[we,[we],(i,[t])=>Math.log(t.evaluate(i))],log2:[we,[we],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[we,[we],(i,[t])=>Math.sin(t.evaluate(i))],cos:[we,[we],(i,[t])=>Math.cos(t.evaluate(i))],tan:[we,[we],(i,[t])=>Math.tan(t.evaluate(i))],asin:[we,[we],(i,[t])=>Math.asin(t.evaluate(i))],acos:[we,[we],(i,[t])=>Math.acos(t.evaluate(i))],atan:[we,[we],(i,[t])=>Math.atan(t.evaluate(i))],min:[we,_a(we),(i,t)=>Math.min(...t.map(r=>r.evaluate(i)))],max:[we,_a(we),(i,t)=>Math.max(...t.map(r=>r.evaluate(i)))],abs:[we,[we],(i,[t])=>Math.abs(t.evaluate(i))],round:[we,[we],(i,[t])=>{const r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[we,[we],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[we,[we],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[je,[Xe,Ge],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[je,[Ge],(i,[t])=>i.id()===t.value],"filter-type-==":[je,[Xe],(i,[t])=>i.geometryType()===t.value],"filter-<":[je,[Xe,Ge],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s<l}],"filter-id-<":[je,[Ge],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r<s}],"filter->":[je,[Xe,Ge],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s>l}],"filter-id->":[je,[Ge],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r>s}],"filter-<=":[je,[Xe,Ge],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[je,[Ge],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r<=s}],"filter->=":[je,[Xe,Ge],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[je,[Ge],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r>=s}],"filter-has":[je,[Ge],(i,[t])=>t.value in i.properties()],"filter-has-id":[je,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[je,[k(Xe)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[je,[k(Ge)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[je,[Xe,k(Ge)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[je,[Xe,k(Ge)],(i,[t,r])=>function(s,l,h,d){for(;h<=d;){const f=h+d>>1;if(l[f]===s)return!0;l[f]>s?d=f-1:h=f+1}return!1}(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:je,overloads:[[[je,je],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[_a(je),(i,t)=>{for(const r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:je,overloads:[[[je,je],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[_a(je),(i,t)=>{for(const r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[je,[je],(i,[t])=>!t.evaluate(i)],"is-supported-script":[je,[Xe],(i,[t])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[Xe,[Xe],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[Xe,[Xe],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[Xe,_a(Ge),(i,t)=>t.map(r=>ms(r.evaluate(i))).join("")],"resolved-locale":[Xe,[Er],(i,[t])=>t.evaluate(i).resolvedLocale()]});class ln{constructor(t,r){var s;this.expression=t,this._warningHistory={},this._evaluator=new Gs,this._defaultValue=r?(s=r).type==="color"&&nn(s.default)?new mt(0,0,0,0):s.type==="color"?mt.parse(s.default)||null:s.type==="padding"?Oi.parse(s.default)||null:s.type==="variableAnchorOffsetCollection"?Xi.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,s,l,h,d){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=d,this.expression.evaluate(this._evaluator)}evaluate(t,r,s,l,h,d){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=d||null;try{const f=this.expression.evaluate(this._evaluator);if(f==null||typeof f=="number"&&f!=f)return this._defaultValue;if(this._enumValues&&!(f in this._enumValues))throw new Nt(`Expected value to be one of ${Object.keys(this._enumValues).map(g=>JSON.stringify(g)).join(", ")}, but found ${JSON.stringify(f)} instead.`);return f}catch(f){return this._warningHistory[f.message]||(this._warningHistory[f.message]=!0,typeof console<"u"&&console.warn(f.message)),this._defaultValue}}}function cn(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ra}function Na(i,t){const r=new ua(Ra,ws,[],t?function(l){const h={color:Ei,string:Xe,number:we,enum:Xe,boolean:je,formatted:Fr,padding:Xr,resolvedImage:Sr,variableAnchorOffsetCollection:j};return l.type==="array"?k(h[l.value]||Ge,l.length):h[l.type]}(t):void 0),s=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?sn(new ln(s,t)):Fa(r.errors)}class Ua{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!Ba(r.expression)}evaluateWithoutErrorHandling(t,r,s,l,h,d){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,l,h,d)}evaluate(t,r,s,l,h,d){return this._styleExpression.evaluate(t,r,s,l,h,d)}}class ja{constructor(t,r,s,l){this.kind=t,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!Ba(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(t,r,s,l,h,d){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,l,h,d)}evaluate(t,r,s,l,h,d){return this._styleExpression.evaluate(t,r,s,l,h,d)}interpolationFactor(t,r,s){return this.interpolationType?Ti.interpolationFactor(this.interpolationType,t,r,s):0}}function ho(i,t){const r=Na(i,t);if(r.result==="error")return r;const s=r.value.expression,l=Es(s);if(!l&&!Oa(t))return Fa([new mi("","data expressions not supported")]);const h=Ss(s,["zoom"]);if(!h&&!vl(t))return Fa([new mi("","zoom expressions not supported")]);const d=Ts(s);return d||h?d instanceof mi?Fa([d]):d instanceof Ti&&!uo(t)?Fa([new mi("",'"interpolate" expressions cannot be used with this property')]):sn(d?new ja(l?"camera":"composite",r.value,d.labels,d instanceof Ti?d.interpolation:void 0):new Ua(l?"constant":"source",r.value)):Fa([new mi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class $a{constructor(t,r){this._parameters=t,this._specification=r,vr(this,wl(this._parameters,this._specification))}static deserialize(t){return new $a(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Ts(i){let t=null;if(i instanceof Kr)t=Ts(i.result);else if(i instanceof Ks){for(const r of i.args)if(t=Ts(r),t)break}else(i instanceof za||i instanceof Ti)&&i.input instanceof Ki&&i.input.name==="zoom"&&(t=i);return t instanceof mi||i.eachChild(r=>{const s=Ts(r);s instanceof mi?t=s:!t&&s?t=new mi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&s&&t!==s&&(t=new mi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function un(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!un(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const hn={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function po(i){if(i==null)return{filter:()=>!0,needGeometry:!1};un(i)||(i=dn(i));const t=Na(i,hn);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,l)=>t.value.evaluate(r,s,{},l),needGeometry:Il(i)}}function Ac(i,t){return i<t?-1:i>t?1:0}function Il(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(Il(i[t]))return!0;return!1}function dn(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?fo(i[1],i[2],"=="):t==="!="?si(fo(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?fo(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(dn))):t==="all"?["all"].concat(i.slice(1).map(dn)):t==="none"?["all"].concat(i.slice(1).map(dn).map(si)):t==="in"?Is(i[1],i.slice(2)):t==="!in"?si(Is(i[1],i.slice(2))):t==="has"?ks(i[1]):t!=="!has"||si(ks(i[1]));var r}function fo(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function Is(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",i,["literal",t.sort(Ac)]]:["filter-in-small",i,["literal",t]]}}function ks(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function si(i){return["!",i]}function ya(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let l="[";for(const h of i)l+=`${ya(h)},`;return`${l}]`}const r=Object.keys(i).sort();let s="{";for(let l=0;l<r.length;l++)s+=`${JSON.stringify(r[l])}:${ya(i[r[l]])},`;return`${s}}`}function kl(i){let t="";for(const r of la)t+=`/${ya(i[r])}`;return t}function Pl(i){const t=i.value;return t?[new ye(i.key,t,"constants have been deprecated as of v8")]:[]}function Ot(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function ur(i){if(Array.isArray(i))return i.map(ur);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const r in i)t[r]=ur(i[r]);return t}return Ot(i)}function Ni(i){const t=i.key,r=i.value,s=i.valueSpec||{},l=i.objectElementValidators||{},h=i.style,d=i.styleSpec,f=i.validateSpec;let g=[];const b=lt(r);if(b!=="object")return[new ye(t,r,`object expected, ${b} found`)];for(const x in r){const w=x.split(".")[0],T=s[w]||s["*"];let P;if(l[w])P=l[w];else if(s[w])P=f;else if(l["*"])P=l["*"];else{if(!s["*"]){g.push(new ye(t,r[x],`unknown property "${x}"`));continue}P=f}g=g.concat(P({key:(t&&`${t}.`)+x,value:r[x],valueSpec:T,style:h,styleSpec:d,object:r,objectKey:x,validateSpec:f},r))}for(const x in s)l[x]||s[x].required&&s[x].default===void 0&&r[x]===void 0&&g.push(new ye(t,r,`missing required property "${x}"`));return g}function Ps(i){const t=i.value,r=i.valueSpec,s=i.style,l=i.styleSpec,h=i.key,d=i.arrayElementValidator||i.validateSpec;if(lt(t)!=="array")return[new ye(h,t,`array expected, ${lt(t)} found`)];if(r.length&&t.length!==r.length)return[new ye(h,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new ye(h,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let f={type:r.value,values:r.values};l.$version<7&&(f.function=r.function),lt(r.value)==="object"&&(f=r.value);let g=[];for(let b=0;b<t.length;b++)g=g.concat(d({array:t,arrayIndex:b,value:t[b],valueSpec:f,validateSpec:i.validateSpec,style:s,styleSpec:l,key:`${h}[${b}]`}));return g}function mo(i){const t=i.key,r=i.value,s=i.valueSpec;let l=lt(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new ye(t,r,`number expected, ${l} found`)]:"minimum"in s&&r<s.minimum?[new ye(t,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new ye(t,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function pn(i){const t=i.valueSpec,r=Ot(i.value.type);let s,l,h,d={};const f=r!=="categorical"&&i.value.property===void 0,g=!f,b=lt(i.value.stops)==="array"&&lt(i.value.stops[0])==="array"&&lt(i.value.stops[0][0])==="object",x=Ni({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(P){if(r==="identity")return[new ye(P.key,P.value,'identity function may not have a "stops" property')];let M=[];const z=P.value;return M=M.concat(Ps({key:P.key,value:z,valueSpec:P.valueSpec,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:w})),lt(z)==="array"&&z.length===0&&M.push(new ye(P.key,z,"array must have at least one stop")),M},default:function(P){return P.validateSpec({key:P.key,value:P.value,valueSpec:t,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec})}}});return r==="identity"&&f&&x.push(new ye(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||x.push(new ye(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!uo(i.valueSpec)&&x.push(new ye(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(g&&!Oa(i.valueSpec)?x.push(new ye(i.key,i.value,"property functions not supported")):f&&!vl(i.valueSpec)&&x.push(new ye(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!b||i.value.property!==void 0||x.push(new ye(i.key,i.value,'"property" property is required')),x;function w(P){let M=[];const z=P.value,V=P.key;if(lt(z)!=="array")return[new ye(V,z,`array expected, ${lt(z)} found`)];if(z.length!==2)return[new ye(V,z,`array length 2 expected, length ${z.length} found`)];if(b){if(lt(z[0])!=="object")return[new ye(V,z,`object expected, ${lt(z[0])} found`)];if(z[0].zoom===void 0)return[new ye(V,z,"object stop key must have zoom")];if(z[0].value===void 0)return[new ye(V,z,"object stop key must have value")];if(h&&h>Ot(z[0].zoom))return[new ye(V,z[0].zoom,"stop zoom values must appear in ascending order")];Ot(z[0].zoom)!==h&&(h=Ot(z[0].zoom),l=void 0,d={}),M=M.concat(Ni({key:`${V}[0]`,value:z[0],valueSpec:{zoom:{}},validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:mo,value:T}}))}else M=M.concat(T({key:`${V}[0]`,value:z[0],validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec},z));return cn(ur(z[1]))?M.concat([new ye(`${V}[1]`,z[1],"expressions are not allowed in function stops.")]):M.concat(P.validateSpec({key:`${V}[1]`,value:z[1],valueSpec:t,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec}))}function T(P,M){const z=lt(P.value),V=Ot(P.value),$=P.value!==null?P.value:M;if(s){if(z!==s)return[new ye(P.key,$,`${z} stop domain type must match previous stop domain type ${s}`)]}else s=z;if(z!=="number"&&z!=="string"&&z!=="boolean")return[new ye(P.key,$,"stop domain value must be a number, string, or boolean")];if(z!=="number"&&r!=="categorical"){let te=`number expected, ${z} found`;return Oa(t)&&r===void 0&&(te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ye(P.key,$,te)]}return r!=="categorical"||z!=="number"||isFinite(V)&&Math.floor(V)===V?r!=="categorical"&&z==="number"&&l!==void 0&&V<l?[new ye(P.key,$,"stop domain values must appear in ascending order")]:(l=V,r==="categorical"&&V in d?[new ye(P.key,$,"stop domain values must be unique")]:(d[V]=!0,[])):[new ye(P.key,$,`integer expected, found ${V}`)]}}function qa(i){const t=(i.expressionContext==="property"?ho:Na)(ur(i.value),i.valueSpec);if(t.result==="error")return t.value.map(s=>new ye(`${i.key}${s.key}`,i.value,s.message));const r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new ye(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Ba(r))return[new ye(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Ba(r))return[new ye(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ss(r,["zoom","feature-state"]))return[new ye(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Es(r))return[new ye(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Vr(i){const t=i.key,r=i.value,s=i.valueSpec,l=[];return Array.isArray(s.values)?s.values.indexOf(Ot(r))===-1&&l.push(new ye(t,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(Ot(r))===-1&&l.push(new ye(t,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function go(i){return un(ur(i.value))?qa(vr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):fn(i)}function fn(i){const t=i.value,r=i.key;if(lt(t)!=="array")return[new ye(r,t,`array expected, ${lt(t)} found`)];const s=i.styleSpec;let l,h=[];if(t.length<1)return[new ye(r,t,"filter array must have at least 1 element")];switch(h=h.concat(Vr({key:`${r}[0]`,value:t[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),Ot(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ot(t[1])==="$type"&&h.push(new ye(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&h.push(new ye(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=lt(t[1]),l!=="string"&&h.push(new ye(`${r}[1]`,t[1],`string expected, ${l} found`)));for(let d=2;d<t.length;d++)l=lt(t[d]),Ot(t[1])==="$type"?h=h.concat(Vr({key:`${r}[${d}]`,value:t[d],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&h.push(new ye(`${r}[${d}]`,t[d],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let d=1;d<t.length;d++)h=h.concat(fn({key:`${r}[${d}]`,value:t[d],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=lt(t[1]),t.length!==2?h.push(new ye(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):l!=="string"&&h.push(new ye(`${r}[1]`,t[1],`string expected, ${l} found`))}return h}function _o(i,t){const r=i.key,s=i.validateSpec,l=i.style,h=i.styleSpec,d=i.value,f=i.objectKey,g=h[`${t}_${i.layerType}`];if(!g)return[];const b=f.match(/^(.*)-transition$/);if(t==="paint"&&b&&g[b[1]]&&g[b[1]].transition)return s({key:r,value:d,valueSpec:h.transition,style:l,styleSpec:h});const x=i.valueSpec||g[f];if(!x)return[new ye(r,d,`unknown property "${f}"`)];let w;if(lt(d)==="string"&&Oa(x)&&!x.tokens&&(w=/^{([^}]+)}$/.exec(d)))return[new ye(r,d,`"${f}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(w[1])} }\`.`)];const T=[];return i.layerType==="symbol"&&(f==="text-field"&&l&&!l.glyphs&&T.push(new ye(r,d,'use of "text-field" requires a style "glyphs" property')),f==="text-font"&&nn(ur(d))&&Ot(d.type)==="identity"&&T.push(new ye(r,d,'"text-font" does not support identity functions'))),T.concat(s({key:i.key,value:d,valueSpec:x,style:l,styleSpec:h,expressionContext:"property",propertyType:t,propertyKey:f}))}function mn(i){return _o(i,"paint")}function yo(i){return _o(i,"layout")}function bo(i){let t=[];const r=i.value,s=i.key,l=i.style,h=i.styleSpec;r.type||r.ref||t.push(new ye(s,r,'either "type" or "ref" is required'));let d=Ot(r.type);const f=Ot(r.ref);if(r.id){const g=Ot(r.id);for(let b=0;b<i.arrayIndex;b++){const x=l.layers[b];Ot(x.id)===g&&t.push(new ye(s,r.id,`duplicate layer id "${r.id}", previously used at line ${x.id.__line__}`))}}if("ref"in r){let g;["type","source","source-layer","filter","layout"].forEach(b=>{b in r&&t.push(new ye(s,r[b],`"${b}" is prohibited for ref layers`))}),l.layers.forEach(b=>{Ot(b.id)===f&&(g=b)}),g?g.ref?t.push(new ye(s,r.ref,"ref cannot reference another ref layer")):d=Ot(g.type):t.push(new ye(s,r.ref,`ref layer "${f}" not found`))}else if(d!=="background")if(r.source){const g=l.sources&&l.sources[r.source],b=g&&Ot(g.type);g?b==="vector"&&d==="raster"?t.push(new ye(s,r.source,`layer "${r.id}" requires a raster source`)):b!=="raster-dem"&&d==="hillshade"?t.push(new ye(s,r.source,`layer "${r.id}" requires a raster-dem source`)):b==="raster"&&d!=="raster"?t.push(new ye(s,r.source,`layer "${r.id}" requires a vector source`)):b!=="vector"||r["source-layer"]?b==="raster-dem"&&d!=="hillshade"?t.push(new ye(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):d!=="line"||!r.paint||!r.paint["line-gradient"]||b==="geojson"&&g.lineMetrics||t.push(new ye(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ye(s,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new ye(s,r.source,`source "${r.source}" not found`))}else t.push(new ye(s,r,'missing required property "source"'));return t=t.concat(Ni({key:s,value:r,valueSpec:h.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:r.type,valueSpec:h.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:go,layout:g=>Ni({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":b=>yo(vr({layerType:d},b))}}),paint:g=>Ni({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":b=>mn(vr({layerType:d},b))}})}})),t}function ba(i){const t=i.value,r=i.key,s=lt(t);return s!=="string"?[new ye(r,t,`string expected, ${s} found`)]:[]}const gn={promoteId:function({key:i,value:t}){if(lt(t)==="string")return ba({key:i,value:t});{const r=[];for(const s in t)r.push(...ba({key:`${i}.${s}`,value:t[s]}));return r}}};function Cs(i){const t=i.value,r=i.key,s=i.styleSpec,l=i.style,h=i.validateSpec;if(!t.type)return[new ye(r,t,'"type" is required')];const d=Ot(t.type);let f;switch(d){case"vector":case"raster":return f=Ni({key:r,value:t,valueSpec:s[`source_${d.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:gn,validateSpec:h}),f;case"raster-dem":return f=function(g){var b;const x=(b=g.sourceName)!==null&&b!==void 0?b:"",w=g.value,T=g.styleSpec,P=T.source_raster_dem,M=g.style;let z=[];const V=lt(w);if(w===void 0)return z;if(V!=="object")return z.push(new ye("source_raster_dem",w,`object expected, ${V} found`)),z;const $=Ot(w.encoding)==="custom",te=["redFactor","greenFactor","blueFactor","baseShift"],W=g.value.encoding?`"${g.value.encoding}"`:"Default";for(const Q in w)!$&&te.includes(Q)?z.push(new ye(Q,w[Q],`In "${x}": "${Q}" is only valid when "encoding" is set to "custom". ${W} encoding found`)):P[Q]?z=z.concat(g.validateSpec({key:Q,value:w[Q],valueSpec:P[Q],validateSpec:g.validateSpec,style:M,styleSpec:T})):z.push(new ye(Q,w[Q],`unknown property "${Q}"`));return z}({sourceName:r,value:t,style:i.style,styleSpec:s,validateSpec:h}),f;case"geojson":if(f=Ni({key:r,value:t,valueSpec:s.source_geojson,style:l,styleSpec:s,validateSpec:h,objectElementValidators:gn}),t.cluster)for(const g in t.clusterProperties){const[b,x]=t.clusterProperties[g],w=typeof b=="string"?[b,["accumulated"],["get",g]]:b;f.push(...qa({key:`${r}.${g}.map`,value:x,expressionContext:"cluster-map"})),f.push(...qa({key:`${r}.${g}.reduce`,value:w,expressionContext:"cluster-reduce"}))}return f;case"video":return Ni({key:r,value:t,valueSpec:s.source_video,style:l,validateSpec:h,styleSpec:s});case"image":return Ni({key:r,value:t,valueSpec:s.source_image,style:l,validateSpec:h,styleSpec:s});case"canvas":return[new ye(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Vr({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function xo(i){const t=i.value,r=i.styleSpec,s=r.light,l=i.style;let h=[];const d=lt(t);if(t===void 0)return h;if(d!=="object")return h=h.concat([new ye("light",t,`object expected, ${d} found`)]),h;for(const f in t){const g=f.match(/^(.*)-transition$/);h=h.concat(g&&s[g[1]]&&s[g[1]].transition?i.validateSpec({key:f,value:t[f],valueSpec:r.transition,validateSpec:i.validateSpec,style:l,styleSpec:r}):s[f]?i.validateSpec({key:f,value:t[f],valueSpec:s[f],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new ye(f,t[f],`unknown property "${f}"`)])}return h}function vo(i){const t=i.value,r=i.styleSpec,s=r.sky,l=i.style,h=lt(t);if(t===void 0)return[];if(h!=="object")return[new ye("sky",t,`object expected, ${h} found`)];let d=[];for(const f in t)d=d.concat(s[f]?i.validateSpec({key:f,value:t[f],valueSpec:s[f],style:l,styleSpec:r}):[new ye(f,t[f],`unknown property "${f}"`)]);return d}function wo(i){const t=i.value,r=i.styleSpec,s=r.terrain,l=i.style;let h=[];const d=lt(t);if(t===void 0)return h;if(d!=="object")return h=h.concat([new ye("terrain",t,`object expected, ${d} found`)]),h;for(const f in t)h=h.concat(s[f]?i.validateSpec({key:f,value:t[f],valueSpec:s[f],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new ye(f,t[f],`unknown property "${f}"`)]);return h}function Eo(i){let t=[];const r=i.value,s=i.key;if(Array.isArray(r)){const l=[],h=[];for(const d in r)r[d].id&&l.includes(r[d].id)&&t.push(new ye(s,r,`all the sprites' ids must be unique, but ${r[d].id} is duplicated`)),l.push(r[d].id),r[d].url&&h.includes(r[d].url)&&t.push(new ye(s,r,`all the sprites' URLs must be unique, but ${r[d].url} is duplicated`)),h.push(r[d].url),t=t.concat(Ni({key:`${s}[${d}]`,value:r[d],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return ba({key:s,value:r})}const _n={"*":()=>[],array:Ps,boolean:function(i){const t=i.value,r=i.key,s=lt(t);return s!=="boolean"?[new ye(r,t,`boolean expected, ${s} found`)]:[]},number:mo,color:function(i){const t=i.key,r=i.value,s=lt(r);return s!=="string"?[new ye(t,r,`color expected, ${s} found`)]:mt.parse(String(r))?[]:[new ye(t,r,`color expected, "${r}" found`)]},constants:Pl,enum:Vr,filter:go,function:pn,layer:bo,object:Ni,source:Cs,light:xo,sky:vo,terrain:wo,projection:function(i){const t=i.value,r=i.styleSpec,s=r.projection,l=i.style,h=lt(t);if(t===void 0)return[];if(h!=="object")return[new ye("projection",t,`object expected, ${h} found`)];let d=[];for(const f in t)d=d.concat(s[f]?i.validateSpec({key:f,value:t[f],valueSpec:s[f],style:l,styleSpec:r}):[new ye(f,t[f],`unknown property "${f}"`)]);return d},string:ba,formatted:function(i){return ba(i).length===0?[]:qa(i)},resolvedImage:function(i){return ba(i).length===0?[]:qa(i)},padding:function(i){const t=i.key,r=i.value;if(lt(r)==="array"){if(r.length<1||r.length>4)return[new ye(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let l=[];for(let h=0;h<r.length;h++)l=l.concat(i.validateSpec({key:`${t}[${h}]`,value:r[h],validateSpec:i.validateSpec,valueSpec:s}));return l}return mo({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,r=i.value,s=lt(r),l=i.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new ye(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let h=[];for(let d=0;d<r.length;d+=2)h=h.concat(Vr({key:`${t}[${d}]`,value:r[d],valueSpec:l.layout_symbol["text-anchor"]})),h=h.concat(Ps({key:`${t}[${d+1}]`,value:r[d+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:l}));return h},sprite:Eo};function As(i){const t=i.value,r=i.valueSpec,s=i.styleSpec;return i.validateSpec=As,r.expression&&nn(Ot(t))?pn(i):r.expression&&cn(ur(t))?qa(i):r.type&&_n[r.type]?_n[r.type](i):Ni(vr({},i,{valueSpec:r.type?s[r.type]:r}))}function Cl(i){const t=i.value,r=i.key,s=ba(i);return s.length||(t.indexOf("{fontstack}")===-1&&s.push(new ye(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&s.push(new ye(r,t,'"glyphs" url must include a "{range}" token'))),s}function Ji(i,t=oe){let r=[];return r=r.concat(As({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:As,objectElementValidators:{glyphs:Cl,"*":()=>[]}})),i.constants&&(r=r.concat(Pl({key:"constants",value:i.constants}))),So(r)}function Ir(i){return function(t){return i({...t,validateSpec:As})}}function So(i){return[].concat(i).sort((t,r)=>t.line-r.line)}function hr(i){return function(...t){return So(i.apply(this,t))}}Ji.source=hr(Ir(Cs)),Ji.sprite=hr(Ir(Eo)),Ji.glyphs=hr(Ir(Cl)),Ji.light=hr(Ir(xo)),Ji.sky=hr(Ir(vo)),Ji.terrain=hr(Ir(wo)),Ji.layer=hr(Ir(bo)),Ji.filter=hr(Ir(go)),Ji.paintProperty=hr(Ir(mn)),Ji.layoutProperty=hr(Ir(yo));const xa=Ji,Mc=xa.light,zc=xa.sky,Al=xa.paintProperty,Ml=xa.layoutProperty;function To(i,t){let r=!1;if(t&&t.length)for(const s of t)i.fire(new Gr(new Error(s.message))),r=!0;return r}class Za{constructor(t,r,s){const l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const d=new Int32Array(this.arrayBuffer);t=d[0],this.d=(r=d[1])+2*(s=d[2]);for(let g=0;g<this.d*this.d;g++){const b=d[3+g],x=d[3+g+1];l.push(b===x?null:d.subarray(b,x))}const f=d[3+l.length+1];this.keys=d.subarray(d[3+l.length],f),this.bboxes=d.subarray(f),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let d=0;d<this.d*this.d;d++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=s,this.scale=r/t,this.uid=0;const h=s/r*t;this.min=-h,this.max=t+h}insert(t,r,s,l,h){this._forEachCell(r,s,l,h,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(h)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,s,l,h,d){this.cells[h].push(d)}query(t,r,s,l,h){const d=this.min,f=this.max;if(t<=d&&r<=d&&f<=s&&f<=l&&!h)return Array.prototype.slice.call(this.keys);{const g=[];return this._forEachCell(t,r,s,l,this._queryCell,g,{},h),g}}_queryCell(t,r,s,l,h,d,f,g){const b=this.cells[h];if(b!==null){const x=this.keys,w=this.bboxes;for(let T=0;T<b.length;T++){const P=b[T];if(f[P]===void 0){const M=4*P;(g?g(w[M+0],w[M+1],w[M+2],w[M+3]):t<=w[M+2]&&r<=w[M+3]&&s>=w[M+0]&&l>=w[M+1])?(f[P]=!0,d.push(x[P])):f[P]=!1}}}}_forEachCell(t,r,s,l,h,d,f,g){const b=this._convertToCellCoord(t),x=this._convertToCellCoord(r),w=this._convertToCellCoord(s),T=this._convertToCellCoord(l);for(let P=b;P<=w;P++)for(let M=x;M<=T;M++){const z=this.d*M+P;if((!g||g(this._convertFromCellCoord(P),this._convertFromCellCoord(M),this._convertFromCellCoord(P+1),this._convertFromCellCoord(M+1)))&&h.call(this,t,r,s,l,z,d,f,g))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let s=0;for(let d=0;d<this.cells.length;d++)s+=this.cells[d].length;const l=new Int32Array(r+s+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let h=r;for(let d=0;d<t.length;d++){const f=t[d];l[3+d]=h,l.set(f,h),h+=f.length}return l[3+t.length]=h,l.set(this.keys,h),h+=this.keys.length,l[3+t.length+1]=h,l.set(this.bboxes,h),h+=this.bboxes.length,l.buffer}static serialize(t,r){const s=t.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(t){return new Za(t.buffer)}}const Yi={};function Me(i,t,r={}){if(Yi[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),Yi[i]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}Me("Object",Object),Me("TransferableGridIndex",Za),Me("Color",mt),Me("Error",Error),Me("AJAXError",Ht),Me("ResolvedImage",Vi),Me("StylePropertyFunction",$a),Me("StyleExpression",ln,{omit:["_evaluator"]}),Me("ZoomDependentExpression",ja),Me("ZoomConstantExpression",Ua),Me("CompoundExpression",Ki,{omit:["_evaluate"]});for(const i in Ra)Ra[i]._classRegistryKey||Me(`Expression_${i}`,Ra[i]);function yn(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Io(i){return i.$name||i.constructor._classRegistryKey}function zl(i){return!function(t){if(t===null||typeof t!="object")return!1;const r=Io(t);return!(!r||r==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||yn(i)||Bi(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function Ga(i,t){if(zl(i))return(yn(i)||Bi(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const h=[];for(const d of i)h.push(Ga(d,t));return h}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=Io(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Yi[r])throw new Error(`${r} is not registered.`);const{klass:s}=Yi[r],l=s.serialize?s.serialize(i,t):{};if(s.serialize){if(t&&l===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const h in i){if(!i.hasOwnProperty(h)||Yi[r].omit.indexOf(h)>=0)continue;const d=i[h];l[h]=Yi[r].shallow.indexOf(h)>=0?d:Ga(d,t)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(l.$name=r),l}function Ha(i){if(zl(i))return i;if(Array.isArray(i))return i.map(Ha);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=Io(i)||"Object";if(!Yi[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=Yi[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const l of Object.keys(i)){if(l==="$name")continue;const h=i[l];s[l]=Yi[t].shallow.indexOf(l)>=0?h:Ha(h)}return s}class ko{constructor(){this.first=!0}update(t,r){const s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))}}const it={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Po(i){for(const t of i)if(Ao(t.charCodeAt(0)))return!0;return!1}function Dc(i){for(const t of i)if(!Wa(t.charCodeAt(0)))return!1;return!0}function Co(i){const t=i.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const Lc=Co(["Arab","Dupl","Mong","Ougr","Syrc"]);function Wa(i){return!Lc.test(String.fromCodePoint(i))}const Dl=Co(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Ao(i){return!(i!==746&&i!==747&&(i<4352||!(it["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||it["CJK Compatibility"](i)||it["CJK Strokes"](i)||!(!it["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||it["Enclosed CJK Letters and Months"](i)||it["Ideographic Description Characters"](i)||it.Kanbun(i)||it.Katakana(i)&&i!==12540||!(!it["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!it["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||it["Vertical Forms"](i)||it["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||Dl.test(String.fromCodePoint(i)))))}function Ll(i){return!(Ao(i)||function(t){return!!(it["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||it["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||it["Letterlike Symbols"](t)||it["Number Forms"](t)||it["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||it["Control Pictures"](t)&&t!==9251||it["Optical Character Recognition"](t)||it["Enclosed Alphanumerics"](t)||it["Geometric Shapes"](t)||it["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||it["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||it["CJK Symbols and Punctuation"](t)||it.Katakana(t)||it["Private Use Area"](t)||it["CJK Compatibility Forms"](t)||it["Small Form Variants"](t)||it["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const Rc=Co(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Mo(i){return Rc.test(String.fromCodePoint(i))}function Bc(i,t){return!(!t&&Mo(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||it.Khmer(i))}function Fc(i){for(const t of i)if(Mo(t.charCodeAt(0)))return!0;return!1}const Ui=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class St{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ko,this.transition={})}isSupportedScript(t){return function(r,s){for(const l of r)if(!Bc(l.charCodeAt(0),s))return!1;return!0}(t,Ui.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class Xa{constructor(t,r){this.property=t,this.value=r,this.expression=function(s,l){if(nn(s))return new $a(s,l);if(cn(s)){const h=ho(s,l);if(h.result==="error")throw new Error(h.value.map(d=>`${d.key}: ${d.message}`).join(", "));return h.value}{let h=s;return l.type==="color"&&typeof s=="string"?h=mt.parse(s):l.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(s)&&(h=Xi.parse(s)):h=Oi.parse(s),{kind:"constant",evaluate:()=>h}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,s){return this.property.possiblyEvaluate(this,t,r,s)}}class bn{constructor(t){this.property=t,this.value=new Xa(t,void 0)}transitioned(t,r){return new Rl(this.property,this.value,r,ut({},t.transition,this.transition),t.now)}untransitioned(){return new Rl(this.property,this.value,null,{},0)}}class xn{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return at(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new bn(this._values[t].property)),this._values[t].value=new Xa(this._values[t].property,r===null?void 0:at(r))}getTransition(t){return at(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new bn(this._values[t].property)),this._values[t].transition=at(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s);const l=this.getTransition(r);l!==void 0&&(t[`${r}-transition`]=l)}return t}transitioned(t,r){const s=new Ms(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(t,r._values[l]);return s}untransitioned(){const t=new Ms(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class Rl{constructor(t,r,s,l,h){this.property=t,this.value=r,this.begin=h+l.delay||0,this.end=this.begin+l.duration||0,t.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(t,r,s){const l=t.now||0,h=this.value.possiblyEvaluate(t,r,s),d=this.prior;if(d){if(l>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(l<this.begin)return d.possiblyEvaluate(t,r,s);{const f=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(t,r,s),h,function(g){if(g<=0)return 0;if(g>=1)return 1;const b=g*g,x=b*g;return 4*(g<.5?x:3*(g-b)+x-.75)}(f))}}return h}}class Ms{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,s){const l=new Ds(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(t,r,s);return l}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class zs{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return at(this._values[t].value)}setValue(t,r){this._values[t]=new Xa(this._values[t].property,r===null?void 0:at(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s)}return t}possiblyEvaluate(t,r,s){const l=new Ds(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(t,r,s);return l}}class kr{constructor(t,r,s){this.property=t,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,s,l){return this.property.evaluate(this.value,this.parameters,t,r,s,l)}}class Ds{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class De{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,s){const l=Si[this.specification.type];return l?l(t,r,s):t}}class Ue{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,s,l){return new kr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},s,l)}:t.expression,r)}interpolate(t,r,s){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new kr(this,{kind:"constant",value:void 0},t.parameters);const l=Si[this.specification.type];if(l){const h=l(t.value.value,r.value.value,s);return new kr(this,{kind:"constant",value:h},t.parameters)}return t}evaluate(t,r,s,l,h,d){return t.kind==="constant"?t.value:t.evaluate(r,s,l,h,d)}}class vn extends Ue{possiblyEvaluate(t,r,s,l){if(t.value===void 0)return new kr(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const h=t.expression.evaluate(r,null,{},s,l),d=t.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,f=this._calculate(d,d,d,r);return new kr(this,{kind:"constant",value:f},r)}if(t.expression.kind==="camera"){const h=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new kr(this,{kind:"constant",value:h},r)}return new kr(this,t.expression,r)}evaluate(t,r,s,l,h,d){if(t.kind==="source"){const f=t.evaluate(r,s,l,h,d);return this._calculate(f,f,f,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},s,l),t.evaluate({zoom:Math.floor(r.zoom)},s,l),t.evaluate({zoom:Math.floor(r.zoom)+1},s,l),r):t.value}_calculate(t,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class wn{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,l){if(t.value!==void 0){if(t.expression.kind==="constant"){const h=t.expression.evaluate(r,null,{},s,l);return this._calculate(h,h,h,r)}return this._calculate(t.expression.evaluate(new St(Math.floor(r.zoom-1),r)),t.expression.evaluate(new St(Math.floor(r.zoom),r)),t.expression.evaluate(new St(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class zo{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,l){return!!t.expression.evaluate(r,null,{},s,l)}interpolate(){return!1}}class u{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const s=t[r];s.specification.overridable&&this.overridableProperties.push(r);const l=this.defaultPropertyValues[r]=new Xa(s,void 0),h=this.defaultTransitionablePropertyValues[r]=new bn(s);this.defaultTransitioningPropertyValues[r]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}Me("DataDrivenProperty",Ue),Me("DataConstantProperty",De),Me("CrossFadedDataDrivenProperty",vn),Me("CrossFadedProperty",wn),Me("ColorRampProperty",zo);const e="-transition";class a extends ka{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new zs(r.layout)),r.paint)){this._transitionablePaint=new xn(r.paint);for(const s in t.paint)this.setPaintProperty(s,t.paint[s],{validate:!1});for(const s in t.layout)this.setLayoutProperty(s,t.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ds(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,s={}){r!=null&&this._validate(Ml,`layers.${this.id}.layout.${t}`,t,r,s)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,s={}){if(r!=null&&this._validate(Al,`layers.${this.id}.paint.${t}`,t,r,s))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[t],h=l.property.specification["property-type"]==="cross-faded-data-driven",d=l.value.isDataDriven(),f=l.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const g=this._transitionablePaint._values[t].value;return g.isDataDriven()||d||h||this._handleOverridablePaintPropertyUpdate(t,f,g)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Li(t,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(t,r,s,l,h={}){return(!h||h.validate!==!1)&&To(this,t.call(xa,{key:r,layerType:this.type,objectKey:s,value:l,styleSpec:oe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof kr&&Oa(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const n={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class o{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class c{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function m(i,t=1){let r=0,s=0;return{members:i.map(l=>{const h=n[l.type].BYTES_PER_ELEMENT,d=r=_(r,Math.max(t,h)),f=l.components||1;return s=Math.max(s,h),r+=h*f,{name:l.name,type:l.type,components:f,offset:d}}),size:_(r,Math.max(s,t)),alignment:t}}function _(i,t){return Math.ceil(i/t)*t}class y extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.int16[l+0]=r,this.int16[l+1]=s,t}}y.prototype.bytesPerElement=4,Me("StructArrayLayout2i4",y);class v extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const h=3*t;return this.int16[h+0]=r,this.int16[h+1]=s,this.int16[h+2]=l,t}}v.prototype.bytesPerElement=6,Me("StructArrayLayout3i6",v);class E extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,s,l)}emplace(t,r,s,l,h){const d=4*t;return this.int16[d+0]=r,this.int16[d+1]=s,this.int16[d+2]=l,this.int16[d+3]=h,t}}E.prototype.bytesPerElement=8,Me("StructArrayLayout4i8",E);class S extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,h,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,s,l,h,d)}emplace(t,r,s,l,h,d,f){const g=6*t;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=l,this.int16[g+3]=h,this.int16[g+4]=d,this.int16[g+5]=f,t}}S.prototype.bytesPerElement=12,Me("StructArrayLayout2i4i12",S);class A extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,h,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,s,l,h,d)}emplace(t,r,s,l,h,d,f){const g=4*t,b=8*t;return this.int16[g+0]=r,this.int16[g+1]=s,this.uint8[b+4]=l,this.uint8[b+5]=h,this.uint8[b+6]=d,this.uint8[b+7]=f,t}}A.prototype.bytesPerElement=8,Me("StructArrayLayout2i4ub8",A);class L extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.float32[l+0]=r,this.float32[l+1]=s,t}}L.prototype.bytesPerElement=8,Me("StructArrayLayout2f8",L);class R extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,h,d,f,g,b,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,r,s,l,h,d,f,g,b,x)}emplace(t,r,s,l,h,d,f,g,b,x,w){const T=10*t;return this.uint16[T+0]=r,this.uint16[T+1]=s,this.uint16[T+2]=l,this.uint16[T+3]=h,this.uint16[T+4]=d,this.uint16[T+5]=f,this.uint16[T+6]=g,this.uint16[T+7]=b,this.uint16[T+8]=x,this.uint16[T+9]=w,t}}R.prototype.bytesPerElement=20,Me("StructArrayLayout10ui20",R);class U extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,h,d,f,g,b,x,w,T){const P=this.length;return this.resize(P+1),this.emplace(P,t,r,s,l,h,d,f,g,b,x,w,T)}emplace(t,r,s,l,h,d,f,g,b,x,w,T,P){const M=12*t;return this.int16[M+0]=r,this.int16[M+1]=s,this.int16[M+2]=l,this.int16[M+3]=h,this.uint16[M+4]=d,this.uint16[M+5]=f,this.uint16[M+6]=g,this.uint16[M+7]=b,this.int16[M+8]=x,this.int16[M+9]=w,this.int16[M+10]=T,this.int16[M+11]=P,t}}U.prototype.bytesPerElement=24,Me("StructArrayLayout4i4ui4i24",U);class q extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const h=3*t;return this.float32[h+0]=r,this.float32[h+1]=s,this.float32[h+2]=l,t}}q.prototype.bytesPerElement=12,Me("StructArrayLayout3f12",q);class Z extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}Z.prototype.bytesPerElement=4,Me("StructArrayLayout1ul4",Z);class H extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,h,d,f,g,b){const x=this.length;return this.resize(x+1),this.emplace(x,t,r,s,l,h,d,f,g,b)}emplace(t,r,s,l,h,d,f,g,b,x){const w=10*t,T=5*t;return this.int16[w+0]=r,this.int16[w+1]=s,this.int16[w+2]=l,this.int16[w+3]=h,this.int16[w+4]=d,this.int16[w+5]=f,this.uint32[T+3]=g,this.uint16[w+8]=b,this.uint16[w+9]=x,t}}H.prototype.bytesPerElement=20,Me("StructArrayLayout6i1ul2ui20",H);class F extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,h,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,s,l,h,d)}emplace(t,r,s,l,h,d,f){const g=6*t;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=l,this.int16[g+3]=h,this.int16[g+4]=d,this.int16[g+5]=f,t}}F.prototype.bytesPerElement=12,Me("StructArrayLayout2i2i2i12",F);class K extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,s,l,h)}emplace(t,r,s,l,h,d){const f=4*t,g=8*t;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=l,this.int16[g+6]=h,this.int16[g+7]=d,t}}K.prototype.bytesPerElement=16,Me("StructArrayLayout2f1f2i16",K);class Y extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,h,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,s,l,h,d)}emplace(t,r,s,l,h,d,f){const g=16*t,b=4*t,x=8*t;return this.uint8[g+0]=r,this.uint8[g+1]=s,this.float32[b+1]=l,this.float32[b+2]=h,this.int16[x+6]=d,this.int16[x+7]=f,t}}Y.prototype.bytesPerElement=16,Me("StructArrayLayout2ub2f2i16",Y);class re extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const h=3*t;return this.uint16[h+0]=r,this.uint16[h+1]=s,this.uint16[h+2]=l,t}}re.prototype.bytesPerElement=6,Me("StructArrayLayout3ui6",re);class de extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,h,d,f,g,b,x,w,T,P,M,z,V,$){const te=this.length;return this.resize(te+1),this.emplace(te,t,r,s,l,h,d,f,g,b,x,w,T,P,M,z,V,$)}emplace(t,r,s,l,h,d,f,g,b,x,w,T,P,M,z,V,$,te){const W=24*t,Q=12*t,le=48*t;return this.int16[W+0]=r,this.int16[W+1]=s,this.uint16[W+2]=l,this.uint16[W+3]=h,this.uint32[Q+2]=d,this.uint32[Q+3]=f,this.uint32[Q+4]=g,this.uint16[W+10]=b,this.uint16[W+11]=x,this.uint16[W+12]=w,this.float32[Q+7]=T,this.float32[Q+8]=P,this.uint8[le+36]=M,this.uint8[le+37]=z,this.uint8[le+38]=V,this.uint32[Q+10]=$,this.int16[W+22]=te,t}}de.prototype.bytesPerElement=48,Me("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",de);class _e extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,h,d,f,g,b,x,w,T,P,M,z,V,$,te,W,Q,le,me,Pe,Ne,Ie,Se,Be,ze){const Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,t,r,s,l,h,d,f,g,b,x,w,T,P,M,z,V,$,te,W,Q,le,me,Pe,Ne,Ie,Se,Be,ze)}emplace(t,r,s,l,h,d,f,g,b,x,w,T,P,M,z,V,$,te,W,Q,le,me,Pe,Ne,Ie,Se,Be,ze,Ae){const he=32*t,Fe=16*t;return this.int16[he+0]=r,this.int16[he+1]=s,this.int16[he+2]=l,this.int16[he+3]=h,this.int16[he+4]=d,this.int16[he+5]=f,this.int16[he+6]=g,this.int16[he+7]=b,this.uint16[he+8]=x,this.uint16[he+9]=w,this.uint16[he+10]=T,this.uint16[he+11]=P,this.uint16[he+12]=M,this.uint16[he+13]=z,this.uint16[he+14]=V,this.uint16[he+15]=$,this.uint16[he+16]=te,this.uint16[he+17]=W,this.uint16[he+18]=Q,this.uint16[he+19]=le,this.uint16[he+20]=me,this.uint16[he+21]=Pe,this.uint16[he+22]=Ne,this.uint32[Fe+12]=Ie,this.float32[Fe+13]=Se,this.float32[Fe+14]=Be,this.uint16[he+30]=ze,this.uint16[he+31]=Ae,t}}_e.prototype.bytesPerElement=64,Me("StructArrayLayout8i15ui1ul2f2ui64",_e);class Te extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}Te.prototype.bytesPerElement=4,Me("StructArrayLayout1f4",Te);class Ce extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const h=3*t;return this.uint16[6*t+0]=r,this.float32[h+1]=s,this.float32[h+2]=l,t}}Ce.prototype.bytesPerElement=12,Me("StructArrayLayout1ui2f12",Ce);class ve extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const h=4*t;return this.uint32[2*t+0]=r,this.uint16[h+2]=s,this.uint16[h+3]=l,t}}ve.prototype.bytesPerElement=8,Me("StructArrayLayout1ul2ui8",ve);class xe extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.uint16[l+0]=r,this.uint16[l+1]=s,t}}xe.prototype.bytesPerElement=4,Me("StructArrayLayout2ui4",xe);class Le extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}Le.prototype.bytesPerElement=2,Me("StructArrayLayout1ui2",Le);class Ze extends c{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,s,l)}emplace(t,r,s,l,h){const d=4*t;return this.float32[d+0]=r,this.float32[d+1]=s,this.float32[d+2]=l,this.float32[d+3]=h,t}}Ze.prototype.bytesPerElement=16,Me("StructArrayLayout4f16",Ze);class Ee extends o{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ge(this.anchorPointX,this.anchorPointY)}}Ee.prototype.size=20;class ke extends H{get(t){return new Ee(this,t)}}Me("CollisionBoxArray",ke);class $e extends o{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}$e.prototype.size=48;class Tt extends de{get(t){return new $e(this,t)}}Me("PlacedSymbolArray",Tt);class We extends o{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}We.prototype.size=64;class tt extends _e{get(t){return new We(this,t)}}Me("SymbolInstanceArray",tt);class It extends Te{getoffsetX(t){return this.float32[1*t+0]}}Me("GlyphOffsetArray",It);class ni extends v{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Me("SymbolLineVertexArray",ni);class dr extends o{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}dr.prototype.size=12;class kt extends Ce{get(t){return new dr(this,t)}}Me("TextAnchorOffsetArray",kt);class Ii extends o{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ii.prototype.size=8;class _i extends ve{get(t){return new Ii(this,t)}}Me("FeatureIndexArray",_i);class oi extends y{}class yi extends y{}class Pr extends y{}class Ka extends S{}class En extends A{}class Ja extends L{}class Qi extends R{}class Sn extends U{}class Do extends q{}class er extends Z{}class tr extends F{}class Yr extends Y{}class pr extends re{}class ri extends xe{}const li=m([{name:"a_pos",components:2,type:"Int16"}],4),{members:ji}=li;class rt{constructor(t=[]){this.segments=t}prepareSegment(t,r,s,l){let h=this.segments[this.segments.length-1];return t>rt.MAX_VERTEX_ARRAY_LENGTH&&Gt(`Max vertices per segment is ${rt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!h||h.vertexLength+t>rt.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==l)&&(h={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},l!==void 0&&(h.sortKey=l),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,s,l){return new rt([{vertexOffset:t,primitiveOffset:r,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function va(i,t){return 256*(i=Di(Math.floor(i),0,255))+Di(Math.floor(t),0,255)}rt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Me("SegmentVector",rt);const Ya=m([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Qa={exports:{}},Bl={exports:{}};Bl.exports=function(i,t){var r,s,l,h,d,f,g,b;for(s=i.length-(r=3&i.length),l=t,d=3432918353,f=461845907,b=0;b<s;)g=255&i.charCodeAt(b)|(255&i.charCodeAt(++b))<<8|(255&i.charCodeAt(++b))<<16|(255&i.charCodeAt(++b))<<24,++b,l=27492+(65535&(h=5*(65535&(l=(l^=g=(65535&(g=(g=(65535&g)*d+(((g>>>16)*d&65535)<<16)&4294967295)<<15|g>>>17))*f+(((g>>>16)*f&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(g=0,r){case 3:g^=(255&i.charCodeAt(b+2))<<16;case 2:g^=(255&i.charCodeAt(b+1))<<8;case 1:l^=g=(65535&(g=(g=(65535&(g^=255&i.charCodeAt(b)))*d+(((g>>>16)*d&65535)<<16)&4294967295)<<15|g>>>17))*f+(((g>>>16)*f&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var Oc=Bl.exports,Fl={exports:{}};Fl.exports=function(i,t){for(var r,s=i.length,l=t^s,h=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(h)|(255&i.charCodeAt(++h))<<8|(255&i.charCodeAt(++h))<<16|(255&i.charCodeAt(++h))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++h;switch(s){case 3:l^=(255&i.charCodeAt(h+2))<<16;case 2:l^=(255&i.charCodeAt(h+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(h)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var Qr=Oc,Ol=Fl.exports;Qa.exports=Qr,Qa.exports.murmur3=Qr,Qa.exports.murmur2=Ol;var Tn=Ye(Qa.exports);class Ls{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,s,l){this.ids.push(In(t)),this.positions.push(r,s,l)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=In(t);let s=0,l=this.ids.length-1;for(;s<l;){const d=s+l>>1;this.ids[d]>=r?l=d:s=d+1}const h=[];for(;this.ids[s]===r;)h.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return h}static serialize(t,r){const s=new Float64Array(t.ids),l=new Uint32Array(t.positions);return kn(s,l,0,s.length-1),r&&r.push(s.buffer,l.buffer),{ids:s,positions:l}}static deserialize(t){const r=new Ls;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function In(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Tn(String(i))}function kn(i,t,r,s){for(;r<s;){const l=i[r+s>>1];let h=r-1,d=s+1;for(;;){do h++;while(i[h]<l);do d--;while(i[d]>l);if(h>=d)break;es(i,h,d),es(t,3*h,3*d),es(t,3*h+1,3*d+1),es(t,3*h+2,3*d+2)}d-r<s-d?(kn(i,t,r,d),r=d+1):(kn(i,t,d+1,s),s=d)}}function es(i,t,r){const s=i[t];i[t]=i[r],i[r]=s}Me("FeaturePositionMap",Ls);class Rs{constructor(t,r){this.gl=t.gl,this.location=r}}class Vl extends Rs{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class $u extends Rs{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class qu extends Rs{constructor(t,r){super(t,r),this.current=mt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Kd=new Float32Array(16);function Vc(i){return[va(255*i.r,255*i.g),va(255*i.b,255*i.a)]}class Lo{constructor(t,r,s){this.value=t,this.uniformNames=r.map(l=>`u_${l}`),this.type=s}setUniform(t,r,s){t.set(s.constantOr(this.value))}getBinding(t,r,s){return this.type==="color"?new qu(t,r):new Vl(t,r)}}class Pn{constructor(t,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,s,l){const h=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;h&&t.set(h)}getBinding(t,r,s){return s.substr(0,9)==="u_pattern"?new $u(t,r):new Vl(t,r)}}class wa{constructor(t,r,s,l){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(h=>({name:`a_${h}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(t,r,s,l,h){const d=this.paintVertexArray.length,f=this.expression.evaluate(new St(0),r,{},l,[],h);this.paintVertexArray.resize(t),this._setPaintValue(d,t,f)}updatePaintArray(t,r,s,l){const h=this.expression.evaluate({zoom:0},s,l);this._setPaintValue(t,r,h)}_setPaintValue(t,r,s){if(this.type==="color"){const l=Vc(s);for(let h=t;h<r;h++)this.paintVertexArray.emplace(h,l[0],l[1])}else{for(let l=t;l<r;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Nr{constructor(t,r,s,l,h,d){this.expression=t,this.uniformNames=r.map(f=>`u_${f}_t`),this.type=s,this.useIntegerZoom=l,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,r,s,l,h){const d=this.expression.evaluate(new St(this.zoom),r,{},l,[],h),f=this.expression.evaluate(new St(this.zoom+1),r,{},l,[],h),g=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(g,t,d,f)}updatePaintArray(t,r,s,l){const h=this.expression.evaluate({zoom:this.zoom},s,l),d=this.expression.evaluate({zoom:this.zoom+1},s,l);this._setPaintValue(t,r,h,d)}_setPaintValue(t,r,s,l){if(this.type==="color"){const h=Vc(s),d=Vc(l);for(let f=t;f<r;f++)this.paintVertexArray.emplace(f,h[0],h[1],d[0],d[1])}else{for(let h=t;h<r;h++)this.paintVertexArray.emplace(h,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=Di(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(l)}getBinding(t,r,s){return new Vl(t,r)}}class ts{constructor(t,r,s,l,h,d){this.expression=t,this.type=r,this.useIntegerZoom=s,this.zoom=l,this.layerId=d,this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(t,r,s){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(l,t,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(t,r,s,l,h){this._setPaintValues(t,r,s.patterns&&s.patterns[this.layerId],h)}_setPaintValues(t,r,s,l){if(!l||!s)return;const{min:h,mid:d,max:f}=s,g=l[h],b=l[d],x=l[f];if(g&&b&&x)for(let w=t;w<r;w++)this.zoomInPaintVertexArray.emplace(w,b.tl[0],b.tl[1],b.br[0],b.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],b.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(w,b.tl[0],b.tl[1],b.br[0],b.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],b.pixelRatio,x.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ya.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ya.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Zu{constructor(t,r,s){this.binders={},this._buffers=[];const l=[];for(const h in t.paint._values){if(!s(h))continue;const d=t.paint.get(h);if(!(d instanceof kr&&Oa(d.property.specification)))continue;const f=Jd(h,t.type),g=d.value,b=d.property.specification.type,x=d.property.useIntegerZoom,w=d.property.specification["property-type"],T=w==="cross-faded"||w==="cross-faded-data-driven";if(g.kind==="constant")this.binders[h]=T?new Pn(g.value,f):new Lo(g.value,f,b),l.push(`/u_${h}`);else if(g.kind==="source"||T){const P=Gu(h,b,"source");this.binders[h]=T?new ts(g,b,x,r,P,t.id):new wa(g,f,b,P),l.push(`/a_${h}`)}else{const P=Gu(h,b,"composite");this.binders[h]=new Nr(g,f,b,x,r,P),l.push(`/z_${h}`)}}this.cacheKey=l.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof wa||r instanceof Nr?r.maxValue:0}populatePaintArrays(t,r,s,l,h){for(const d in this.binders){const f=this.binders[d];(f instanceof wa||f instanceof Nr||f instanceof ts)&&f.populatePaintArray(t,r,s,l,h)}}setConstantPatternPositions(t,r){for(const s in this.binders){const l=this.binders[s];l instanceof Pn&&l.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,s,l,h){let d=!1;for(const f in t){const g=r.getPositions(f);for(const b of g){const x=s.feature(b.index);for(const w in this.binders){const T=this.binders[w];if((T instanceof wa||T instanceof Nr||T instanceof ts)&&T.expression.isStateDependent===!0){const P=l.paint.get(w);T.expression=P.value,T.updatePaintArray(b.start,b.end,x,t[f],h),d=!0}}}}return d}defines(){const t=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Lo||s instanceof Pn)&&t.push(...s.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof wa||s instanceof Nr)for(let l=0;l<s.paintVertexAttributes.length;l++)t.push(s.paintVertexAttributes[l].name);else if(s instanceof ts)for(let l=0;l<Ya.members.length;l++)t.push(Ya.members[l].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Lo||s instanceof Pn||s instanceof Nr)for(const l of s.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const s=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Lo||h instanceof Pn||h instanceof Nr){for(const d of h.uniformNames)if(r[d]){const f=h.getBinding(t,r[d],d);s.push({name:d,property:l,binding:f})}}}return s}setUniforms(t,r,s,l){for(const{name:h,property:d,binding:f}of r)this.binders[d].setUniform(f,l,s.get(d),h)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(t&&s instanceof ts){const l=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(s instanceof wa||s instanceof Nr)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(t){for(const r in this.binders){const s=this.binders[r];(s instanceof wa||s instanceof Nr||s instanceof ts)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof wa||r instanceof Nr||r instanceof ts)&&r.destroy()}}}class Bs{constructor(t,r,s=()=>!0){this.programConfigurations={};for(const l of t)this.programConfigurations[l.id]=new Zu(l,r,s);this.needsUpload=!1,this._featureMap=new Ls,this._bufferOffset=0}populatePaintArrays(t,r,s,l,h,d){for(const f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(t,r,l,h,d);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,s,l){for(const h of s)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(t,this._featureMap,r,h,l)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Jd(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function Gu(i,t,r){const s={color:{source:L,composite:Ze},number:{source:Te,composite:L}},l=function(h){return{"line-pattern":{source:Qi,composite:Qi},"fill-pattern":{source:Qi,composite:Qi},"fill-extrusion-pattern":{source:Qi,composite:Qi}}[h]}(i);return l&&l[r]||s[t][r]}Me("ConstantBinder",Lo),Me("CrossFadedConstantBinder",Pn),Me("SourceExpressionBinder",wa),Me("CrossFadedCompositeBinder",ts),Me("CompositeExpressionBinder",Nr),Me("ProgramConfiguration",Zu,{omit:["_buffers"]}),Me("ProgramConfigurationSet",Bs);const qt=8192,Nc=Math.pow(2,14)-1,Hu=-Nc-1;function Fs(i){const t=qt/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const l=r[s];for(let h=0;h<l.length;h++){const d=l[h],f=Math.round(d.x*t),g=Math.round(d.y*t);d.x=Di(f,Hu,Nc),d.y=Di(g,Hu,Nc),(f<d.x||f>d.x+1||g<d.y||g>d.y+1)&&Gt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Os(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Fs(i):[]}}function Nl(i,t,r,s,l){i.emplaceBack(2*t+(s+1)/2,2*r+(l+1)/2)}class Uc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new yi,this.indexArray=new pr,this.segments=new rt,this.programConfigurations=new Bs(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){const l=this.layers[0],h=[];let d=null,f=!1;l.type==="circle"&&(d=l.layout.get("circle-sort-key"),f=!d.isConstant());for(const{feature:g,id:b,index:x,sourceLayerIndex:w}of t){const T=this.layers[0]._featureFilter.needGeometry,P=Os(g,T);if(!this.layers[0]._featureFilter.filter(new St(this.zoom),P,s))continue;const M=f?d.evaluate(P,{},s):void 0,z={id:b,properties:g.properties,type:g.type,sourceLayerIndex:w,index:x,geometry:T?P.geometry:Fs(g),patterns:{},sortKey:M};h.push(z)}f&&h.sort((g,b)=>g.sortKey-b.sortKey);for(const g of h){const{geometry:b,index:x,sourceLayerIndex:w}=g,T=t[x].feature;this.addFeature(g,b,x,s),r.featureIndex.insert(T,b,x,w,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ji),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,s,l){for(const h of r)for(const d of h){const f=d.x,g=d.y;if(f<0||f>=qt||g<0||g>=qt)continue;const b=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),x=b.vertexLength;Nl(this.layoutVertexArray,f,g,-1,-1),Nl(this.layoutVertexArray,f,g,1,-1),Nl(this.layoutVertexArray,f,g,1,1),Nl(this.layoutVertexArray,f,g,-1,1),this.indexArray.emplaceBack(x,x+1,x+2),this.indexArray.emplaceBack(x,x+3,x+2),b.vertexLength+=4,b.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},l)}}function Wu(i,t){for(let r=0;r<i.length;r++)if(Cn(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(Cn(i,t[r]))return!0;return!!jc(i,t)}function Yd(i,t,r){return!!Cn(i,t)||!!$c(t,i,r)}function Xu(i,t){if(i.length===1)return Ju(t,i[0]);for(let r=0;r<t.length;r++){const s=t[r];for(let l=0;l<s.length;l++)if(Cn(i,s[l]))return!0}for(let r=0;r<i.length;r++)if(Ju(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(jc(i,t[r]))return!0;return!1}function Qd(i,t,r){if(i.length>1){if(jc(i,t))return!0;for(let s=0;s<t.length;s++)if($c(t[s],i,r))return!0}for(let s=0;s<i.length;s++)if($c(i[s],t,r))return!0;return!1}function jc(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],l=i[r+1];for(let h=0;h<t.length-1;h++)if(ep(s,l,t[h],t[h+1]))return!0}return!1}function ep(i,t,r,s){return ei(i,r,s)!==ei(t,r,s)&&ei(i,t,r)!==ei(i,t,s)}function $c(i,t,r){const s=r*r;if(t.length===1)return i.distSqr(t[0])<s;for(let l=1;l<t.length;l++)if(Ku(i,t[l-1],t[l])<s)return!0;return!1}function Ku(i,t,r){const s=t.distSqr(r);if(s===0)return i.distSqr(t);const l=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/s;return i.distSqr(l<0?t:l>1?r:r.sub(t)._mult(l)._add(t))}function Ju(i,t){let r,s,l,h=!1;for(let d=0;d<i.length;d++){r=i[d];for(let f=0,g=r.length-1;f<r.length;g=f++)s=r[f],l=r[g],s.y>t.y!=l.y>t.y&&t.x<(l.x-s.x)*(t.y-s.y)/(l.y-s.y)+s.x&&(h=!h)}return h}function Cn(i,t){let r=!1;for(let s=0,l=i.length-1;s<i.length;l=s++){const h=i[s],d=i[l];h.y>t.y!=d.y>t.y&&t.x<(d.x-h.x)*(t.y-h.y)/(d.y-h.y)+h.x&&(r=!r)}return r}function tp(i,t,r){const s=r[0],l=r[2];if(i.x<s.x&&t.x<s.x||i.x>l.x&&t.x>l.x||i.y<s.y&&t.y<s.y||i.y>l.y&&t.y>l.y)return!1;const h=ei(i,t,r[0]);return h!==ei(i,t,r[1])||h!==ei(i,t,r[2])||h!==ei(i,t,r[3])}function Ro(i,t,r){const s=t.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(t.id).getMaxValue(i)}function Ul(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function jl(i,t,r,s,l){if(!t[0]&&!t[1])return i;const h=ge.convert(t)._mult(l);r==="viewport"&&h._rotate(-s);const d=[];for(let f=0;f<i.length;f++)d.push(i[f].sub(h));return d}let Yu,Qu;Me("CircleBucket",Uc,{omit:["layers"]});var ip={get paint(){return Qu=Qu||new u({"circle-radius":new Ue(oe.paint_circle["circle-radius"]),"circle-color":new Ue(oe.paint_circle["circle-color"]),"circle-blur":new Ue(oe.paint_circle["circle-blur"]),"circle-opacity":new Ue(oe.paint_circle["circle-opacity"]),"circle-translate":new De(oe.paint_circle["circle-translate"]),"circle-translate-anchor":new De(oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new De(oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new De(oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ue(oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ue(oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ue(oe.paint_circle["circle-stroke-opacity"])})},get layout(){return Yu=Yu||new u({"circle-sort-key":new Ue(oe.layout_circle["circle-sort-key"])})}},ki=1e-6,An=typeof Float32Array<"u"?Float32Array:Array;function qc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function eh(i,t,r){var s=t[0],l=t[1],h=t[2],d=t[3],f=t[4],g=t[5],b=t[6],x=t[7],w=t[8],T=t[9],P=t[10],M=t[11],z=t[12],V=t[13],$=t[14],te=t[15],W=r[0],Q=r[1],le=r[2],me=r[3];return i[0]=W*s+Q*f+le*w+me*z,i[1]=W*l+Q*g+le*T+me*V,i[2]=W*h+Q*b+le*P+me*$,i[3]=W*d+Q*x+le*M+me*te,i[4]=(W=r[4])*s+(Q=r[5])*f+(le=r[6])*w+(me=r[7])*z,i[5]=W*l+Q*g+le*T+me*V,i[6]=W*h+Q*b+le*P+me*$,i[7]=W*d+Q*x+le*M+me*te,i[8]=(W=r[8])*s+(Q=r[9])*f+(le=r[10])*w+(me=r[11])*z,i[9]=W*l+Q*g+le*T+me*V,i[10]=W*h+Q*b+le*P+me*$,i[11]=W*d+Q*x+le*M+me*te,i[12]=(W=r[12])*s+(Q=r[13])*f+(le=r[14])*w+(me=r[15])*z,i[13]=W*l+Q*g+le*T+me*V,i[14]=W*h+Q*b+le*P+me*$,i[15]=W*d+Q*x+le*M+me*te,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Bo,rp=eh;function $l(i,t,r){var s=t[0],l=t[1],h=t[2],d=t[3];return i[0]=r[0]*s+r[4]*l+r[8]*h+r[12]*d,i[1]=r[1]*s+r[5]*l+r[9]*h+r[13]*d,i[2]=r[2]*s+r[6]*l+r[10]*h+r[14]*d,i[3]=r[3]*s+r[7]*l+r[11]*h+r[15]*d,i}Bo=new An(4),An!=Float32Array&&(Bo[0]=0,Bo[1]=0,Bo[2]=0,Bo[3]=0);class ap extends a{constructor(t){super(t,ip)}createBucket(t){return new Uc(t)}queryRadius(t){const r=t;return Ro("circle-radius",this,r)+Ro("circle-stroke-width",this,r)+Ul(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,s,l,h,d,f,g){const b=jl(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,f),x=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),w=this.paint.get("circle-pitch-alignment")==="map",T=w?b:function(M,z){return M.map(V=>th(V,z))}(b,g),P=w?x*f:x;for(const M of l)for(const z of M){const V=w?z:th(z,g);let $=P;const te=$l([],[z.x,z.y,0,1],g);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?$*=te[3]/d.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&($*=d.cameraToCenterDistance/te[3]),Yd(T,V,$))return!0}return!1}}function th(i,t){const r=$l([],[i.x,i.y,0,1],t);return new ge(r[0]/r[3],r[1]/r[3])}class ih extends Uc{}let rh;Me("HeatmapBucket",ih,{omit:["layers"]});var sp={get paint(){return rh=rh||new u({"heatmap-radius":new Ue(oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ue(oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new De(oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new zo(oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new De(oe.paint_heatmap["heatmap-opacity"])})}};function Zc(i,{width:t,height:r},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*r*s)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${t*r*s}`)}else l=new Uint8Array(t*r*s);return i.width=t,i.height=r,i.data=l,i}function ah(i,{width:t,height:r},s){if(t===i.width&&r===i.height)return;const l=Zc({},{width:t,height:r},s);Gc(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,r)},s),i.width=t,i.height=r,i.data=l.data}function Gc(i,t,r,s,l,h){if(l.width===0||l.height===0)return t;if(l.width>i.width||l.height>i.height||r.x>i.width-l.width||r.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||s.x>t.width-l.width||s.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const d=i.data,f=t.data;if(d===f)throw new Error("srcData equals dstData, so image is already copied");for(let g=0;g<l.height;g++){const b=((r.y+g)*i.width+r.x)*h,x=((s.y+g)*t.width+s.x)*h;for(let w=0;w<l.width*h;w++)f[x+w]=d[b+w]}return t}class Fo{constructor(t,r){Zc(this,t,1,r)}resize(t){ah(this,t,1)}clone(){return new Fo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,l,h){Gc(t,r,s,l,h,1)}}class fr{constructor(t,r){Zc(this,t,4,r)}resize(t){ah(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new fr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,l,h){Gc(t,r,s,l,h,4)}}function sh(i){const t={},r=i.resolution||256,s=i.clips?i.clips.length:1,l=i.image||new fr({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const h=(d,f,g)=>{t[i.evaluationKey]=g;const b=i.expression.evaluate(t);l.data[d+f+0]=Math.floor(255*b.r/b.a),l.data[d+f+1]=Math.floor(255*b.g/b.a),l.data[d+f+2]=Math.floor(255*b.b/b.a),l.data[d+f+3]=Math.floor(255*b.a)};if(i.clips)for(let d=0,f=0;d<s;++d,f+=4*r)for(let g=0,b=0;g<r;g++,b+=4){const x=g/(r-1),{start:w,end:T}=i.clips[d];h(f,b,w*(1-x)+T*x)}else for(let d=0,f=0;d<r;d++,f+=4)h(0,f,d/(r-1));return l}Me("AlphaImage",Fo),Me("RGBAImage",fr);const Hc="big-fb";class np extends a{createBucket(t){return new ih(t)}constructor(t){super(t,sp),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=sh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Hc)&&this.heatmapFbos.delete(Hc)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let nh;var op={get paint(){return nh=nh||new u({"hillshade-illumination-direction":new De(oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new De(oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new De(oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new De(oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new De(oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new De(oe.paint_hillshade["hillshade-accent-color"])})}};class lp extends a{constructor(t){super(t,op)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const cp=m([{name:"a_pos",components:2,type:"Int16"}],4),{members:up}=cp;function oh(i,t,r=2){const s=t&&t.length,l=s?t[0]*r:i.length;let h=lh(i,0,l,r,!0);const d=[];if(!h||h.next===h.prev)return d;let f,g,b;if(s&&(h=function(x,w,T,P){const M=[];for(let z=0,V=w.length;z<V;z++){const $=lh(x,w[z]*P,z<V-1?w[z+1]*P:x.length,P,!1);$===$.next&&($.steiner=!0),M.push(yp($))}M.sort(mp);for(let z=0;z<M.length;z++)T=gp(M[z],T);return T}(i,t,h,r)),i.length>80*r){f=1/0,g=1/0;let x=-1/0,w=-1/0;for(let T=r;T<l;T+=r){const P=i[T],M=i[T+1];P<f&&(f=P),M<g&&(g=M),P>x&&(x=P),M>w&&(w=M)}b=Math.max(x-f,w-g),b=b!==0?32767/b:0}return Oo(h,d,r,f,g,b,0),d}function lh(i,t,r,s,l){let h;if(l===function(d,f,g,b){let x=0;for(let w=f,T=g-b;w<g;w+=b)x+=(d[T]-d[w])*(d[w+1]+d[T+1]),T=w;return x}(i,t,r,s)>0)for(let d=t;d<r;d+=s)h=hh(d/s|0,i[d],i[d+1],h);else for(let d=r-s;d>=t;d-=s)h=hh(d/s|0,i[d],i[d+1],h);return h&&ql(h,h.next)&&(No(h),h=h.next),h}function Vs(i,t){if(!i)return i;t||(t=i);let r,s=i;do if(r=!1,s.steiner||!ql(s,s.next)&&Ut(s.prev,s,s.next)!==0)s=s.next;else{if(No(s),s=t=s.prev,s===s.next)break;r=!0}while(r||s!==t);return t}function Oo(i,t,r,s,l,h,d){if(!i)return;!d&&h&&function(g,b,x,w){let T=g;do T.z===0&&(T.z=Wc(T.x,T.y,b,x,w)),T.prevZ=T.prev,T.nextZ=T.next,T=T.next;while(T!==g);T.prevZ.nextZ=null,T.prevZ=null,function(P){let M,z=1;do{let V,$=P;P=null;let te=null;for(M=0;$;){M++;let W=$,Q=0;for(let me=0;me<z&&(Q++,W=W.nextZ,W);me++);let le=z;for(;Q>0||le>0&&W;)Q!==0&&(le===0||!W||$.z<=W.z)?(V=$,$=$.nextZ,Q--):(V=W,W=W.nextZ,le--),te?te.nextZ=V:P=V,V.prevZ=te,te=V;$=W}te.nextZ=null,z*=2}while(M>1)}(T)}(i,s,l,h);let f=i;for(;i.prev!==i.next;){const g=i.prev,b=i.next;if(h?dp(i,s,l,h):hp(i))t.push(g.i,i.i,b.i),No(i),i=b.next,f=b.next;else if((i=b)===f){d?d===1?Oo(i=pp(Vs(i),t),t,r,s,l,h,2):d===2&&fp(i,t,r,s,l,h):Oo(Vs(i),t,r,s,l,h,1);break}}}function hp(i){const t=i.prev,r=i,s=i.next;if(Ut(t,r,s)>=0)return!1;const l=t.x,h=r.x,d=s.x,f=t.y,g=r.y,b=s.y,x=l<h?l<d?l:d:h<d?h:d,w=f<g?f<b?f:b:g<b?g:b,T=l>h?l>d?l:d:h>d?h:d,P=f>g?f>b?f:b:g>b?g:b;let M=s.next;for(;M!==t;){if(M.x>=x&&M.x<=T&&M.y>=w&&M.y<=P&&Mn(l,f,h,g,d,b,M.x,M.y)&&Ut(M.prev,M,M.next)>=0)return!1;M=M.next}return!0}function dp(i,t,r,s){const l=i.prev,h=i,d=i.next;if(Ut(l,h,d)>=0)return!1;const f=l.x,g=h.x,b=d.x,x=l.y,w=h.y,T=d.y,P=f<g?f<b?f:b:g<b?g:b,M=x<w?x<T?x:T:w<T?w:T,z=f>g?f>b?f:b:g>b?g:b,V=x>w?x>T?x:T:w>T?w:T,$=Wc(P,M,t,r,s),te=Wc(z,V,t,r,s);let W=i.prevZ,Q=i.nextZ;for(;W&&W.z>=$&&Q&&Q.z<=te;){if(W.x>=P&&W.x<=z&&W.y>=M&&W.y<=V&&W!==l&&W!==d&&Mn(f,x,g,w,b,T,W.x,W.y)&&Ut(W.prev,W,W.next)>=0||(W=W.prevZ,Q.x>=P&&Q.x<=z&&Q.y>=M&&Q.y<=V&&Q!==l&&Q!==d&&Mn(f,x,g,w,b,T,Q.x,Q.y)&&Ut(Q.prev,Q,Q.next)>=0))return!1;Q=Q.nextZ}for(;W&&W.z>=$;){if(W.x>=P&&W.x<=z&&W.y>=M&&W.y<=V&&W!==l&&W!==d&&Mn(f,x,g,w,b,T,W.x,W.y)&&Ut(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;Q&&Q.z<=te;){if(Q.x>=P&&Q.x<=z&&Q.y>=M&&Q.y<=V&&Q!==l&&Q!==d&&Mn(f,x,g,w,b,T,Q.x,Q.y)&&Ut(Q.prev,Q,Q.next)>=0)return!1;Q=Q.nextZ}return!0}function pp(i,t){let r=i;do{const s=r.prev,l=r.next.next;!ql(s,l)&&ch(s,r,r.next,l)&&Vo(s,l)&&Vo(l,s)&&(t.push(s.i,r.i,l.i),No(r),No(r.next),r=i=l),r=r.next}while(r!==i);return Vs(r)}function fp(i,t,r,s,l,h){let d=i;do{let f=d.next.next;for(;f!==d.prev;){if(d.i!==f.i&&bp(d,f)){let g=uh(d,f);return d=Vs(d,d.next),g=Vs(g,g.next),Oo(d,t,r,s,l,h,0),void Oo(g,t,r,s,l,h,0)}f=f.next}d=d.next}while(d!==i)}function mp(i,t){return i.x-t.x}function gp(i,t){const r=function(l,h){let d=h;const f=l.x,g=l.y;let b,x=-1/0;do{if(g<=d.y&&g>=d.next.y&&d.next.y!==d.y){const z=d.x+(g-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(z<=f&&z>x&&(x=z,b=d.x<d.next.x?d:d.next,z===f))return b}d=d.next}while(d!==h);if(!b)return null;const w=b,T=b.x,P=b.y;let M=1/0;d=b;do{if(f>=d.x&&d.x>=T&&f!==d.x&&Mn(g<P?f:x,g,T,P,g<P?x:f,g,d.x,d.y)){const z=Math.abs(g-d.y)/(f-d.x);Vo(d,l)&&(z<M||z===M&&(d.x>b.x||d.x===b.x&&_p(b,d)))&&(b=d,M=z)}d=d.next}while(d!==w);return b}(i,t);if(!r)return t;const s=uh(r,i);return Vs(s,s.next),Vs(r,r.next)}function _p(i,t){return Ut(i.prev,i,t.prev)<0&&Ut(t.next,i,i.next)<0}function Wc(i,t,r,s,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function yp(i){let t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function Mn(i,t,r,s,l,h,d,f){return(l-d)*(t-f)>=(i-d)*(h-f)&&(i-d)*(s-f)>=(r-d)*(t-f)&&(r-d)*(h-f)>=(l-d)*(s-f)}function bp(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(r,s){let l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==s.i&&l.next.i!==s.i&&ch(l,l.next,r,s))return!0;l=l.next}while(l!==r);return!1}(i,t)&&(Vo(i,t)&&Vo(t,i)&&function(r,s){let l=r,h=!1;const d=(r.x+s.x)/2,f=(r.y+s.y)/2;do l.y>f!=l.next.y>f&&l.next.y!==l.y&&d<(l.next.x-l.x)*(f-l.y)/(l.next.y-l.y)+l.x&&(h=!h),l=l.next;while(l!==r);return h}(i,t)&&(Ut(i.prev,i,t.prev)||Ut(i,t.prev,t))||ql(i,t)&&Ut(i.prev,i,i.next)>0&&Ut(t.prev,t,t.next)>0)}function Ut(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function ql(i,t){return i.x===t.x&&i.y===t.y}function ch(i,t,r,s){const l=Gl(Ut(i,t,r)),h=Gl(Ut(i,t,s)),d=Gl(Ut(r,s,i)),f=Gl(Ut(r,s,t));return l!==h&&d!==f||!(l!==0||!Zl(i,r,t))||!(h!==0||!Zl(i,s,t))||!(d!==0||!Zl(r,i,s))||!(f!==0||!Zl(r,t,s))}function Zl(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function Gl(i){return i>0?1:i<0?-1:0}function Vo(i,t){return Ut(i.prev,i,i.next)<0?Ut(i,t,i.next)>=0&&Ut(i,i.prev,t)>=0:Ut(i,t,i.prev)<0||Ut(i,i.next,t)<0}function uh(i,t){const r=Xc(i.i,i.x,i.y),s=Xc(t.i,t.x,t.y),l=i.next,h=t.prev;return i.next=t,t.prev=i,r.next=l,l.prev=r,s.next=r,r.prev=s,h.next=s,s.prev=h,s}function hh(i,t,r,s){const l=Xc(i,t,r);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function No(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Xc(i,t,r){return{i,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Kc(i,t,r){const s=r.patternDependencies;let l=!1;for(const h of t){const d=h.paint.get(`${i}-pattern`);d.isConstant()||(l=!0);const f=d.constantOr(null);f&&(l=!0,s[f.to]=!0,s[f.from]=!0)}return l}function Jc(i,t,r,s,l){const h=l.patternDependencies;for(const d of t){const f=d.paint.get(`${i}-pattern`).value;if(f.kind!=="constant"){let g=f.evaluate({zoom:s-1},r,{},l.availableImages),b=f.evaluate({zoom:s},r,{},l.availableImages),x=f.evaluate({zoom:s+1},r,{},l.availableImages);g=g&&g.name?g.name:g,b=b&&b.name?b.name:b,x=x&&x.name?x.name:x,h[g]=!0,h[b]=!0,h[x]=!0,r.patterns[d.id]={min:g,mid:b,max:x}}}return r}class Yc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Pr,this.indexArray=new pr,this.indexArray2=new ri,this.programConfigurations=new Bs(t.layers,t.zoom),this.segments=new rt,this.segments2=new rt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.hasPattern=Kc("fill",this.layers,r);const l=this.layers[0].layout.get("fill-sort-key"),h=!l.isConstant(),d=[];for(const{feature:f,id:g,index:b,sourceLayerIndex:x}of t){const w=this.layers[0]._featureFilter.needGeometry,T=Os(f,w);if(!this.layers[0]._featureFilter.filter(new St(this.zoom),T,s))continue;const P=h?l.evaluate(T,{},s,r.availableImages):void 0,M={id:g,properties:f.properties,type:f.type,sourceLayerIndex:x,index:b,geometry:w?T.geometry:Fs(f),patterns:{},sortKey:P};d.push(M)}h&&d.sort((f,g)=>f.sortKey-g.sortKey);for(const f of d){const{geometry:g,index:b,sourceLayerIndex:x}=f;if(this.hasPattern){const w=Jc("fill",this.layers,f,this.zoom,r);this.patternFeatures.push(w)}else this.addFeature(f,g,b,s,{});r.featureIndex.insert(t[b].feature,g,b,x,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,up),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,s,l,h){for(const d of en(r,500)){let f=0;for(const P of d)f+=P.length;const g=this.segments.prepareSegment(f,this.layoutVertexArray,this.indexArray),b=g.vertexLength,x=[],w=[];for(const P of d){if(P.length===0)continue;P!==d[0]&&w.push(x.length/2);const M=this.segments2.prepareSegment(P.length,this.layoutVertexArray,this.indexArray2),z=M.vertexLength;this.layoutVertexArray.emplaceBack(P[0].x,P[0].y),this.indexArray2.emplaceBack(z+P.length-1,z),x.push(P[0].x),x.push(P[0].y);for(let V=1;V<P.length;V++)this.layoutVertexArray.emplaceBack(P[V].x,P[V].y),this.indexArray2.emplaceBack(z+V-1,z+V),x.push(P[V].x),x.push(P[V].y);M.vertexLength+=P.length,M.primitiveLength+=P.length}const T=oh(x,w);for(let P=0;P<T.length;P+=3)this.indexArray.emplaceBack(b+T[P],b+T[P+1],b+T[P+2]);g.vertexLength+=f,g.primitiveLength+=T.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,h,l)}}let dh,ph;Me("FillBucket",Yc,{omit:["layers","patternFeatures"]});var xp={get paint(){return ph=ph||new u({"fill-antialias":new De(oe.paint_fill["fill-antialias"]),"fill-opacity":new Ue(oe.paint_fill["fill-opacity"]),"fill-color":new Ue(oe.paint_fill["fill-color"]),"fill-outline-color":new Ue(oe.paint_fill["fill-outline-color"]),"fill-translate":new De(oe.paint_fill["fill-translate"]),"fill-translate-anchor":new De(oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new vn(oe.paint_fill["fill-pattern"])})},get layout(){return dh=dh||new u({"fill-sort-key":new Ue(oe.layout_fill["fill-sort-key"])})}};class vp extends a{constructor(t){super(t,xp)}recalculate(t,r){super.recalculate(t,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Yc(t)}queryRadius(){return Ul(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,s,l,h,d,f){return Xu(jl(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,f),l)}isTileClipped(){return!0}}const wp=m([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ep=m([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Sp}=wp;var is={},Tp=Qe,fh=zn;function zn(i,t,r,s,l){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=l,i.readFields(Ip,this,t)}function Ip(i,t,r){i==1?t.id=r.readVarint():i==2?function(s,l){for(var h=s.readVarint()+s.pos;s.pos<h;){var d=l._keys[s.readVarint()],f=l._values[s.readVarint()];l.properties[d]=f}}(r,t):i==3?t.type=r.readVarint():i==4&&(t._geometry=r.pos)}function kp(i){for(var t,r,s=0,l=0,h=i.length,d=h-1;l<h;d=l++)s+=((r=i[d]).x-(t=i[l]).x)*(t.y+r.y);return s}zn.types=["Unknown","Point","LineString","Polygon"],zn.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,r=i.readVarint()+i.pos,s=1,l=0,h=0,d=0,f=[];i.pos<r;){if(l<=0){var g=i.readVarint();s=7&g,l=g>>3}if(l--,s===1||s===2)h+=i.readSVarint(),d+=i.readSVarint(),s===1&&(t&&f.push(t),t=[]),t.push(new Tp(h,d));else{if(s!==7)throw new Error("unknown command "+s);t&&t.push(t[0].clone())}}return t&&f.push(t),f},zn.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,r=1,s=0,l=0,h=0,d=1/0,f=-1/0,g=1/0,b=-1/0;i.pos<t;){if(s<=0){var x=i.readVarint();r=7&x,s=x>>3}if(s--,r===1||r===2)(l+=i.readSVarint())<d&&(d=l),l>f&&(f=l),(h+=i.readSVarint())<g&&(g=h),h>b&&(b=h);else if(r!==7)throw new Error("unknown command "+r)}return[d,g,f,b]},zn.prototype.toGeoJSON=function(i,t,r){var s,l,h=this.extent*Math.pow(2,r),d=this.extent*i,f=this.extent*t,g=this.loadGeometry(),b=zn.types[this.type];function x(P){for(var M=0;M<P.length;M++){var z=P[M];P[M]=[360*(z.x+d)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(z.y+f)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var w=[];for(s=0;s<g.length;s++)w[s]=g[s][0];x(g=w);break;case 2:for(s=0;s<g.length;s++)x(g[s]);break;case 3:for(g=function(P){var M=P.length;if(M<=1)return[P];for(var z,V,$=[],te=0;te<M;te++){var W=kp(P[te]);W!==0&&(V===void 0&&(V=W<0),V===W<0?(z&&$.push(z),z=[P[te]]):z.push(P[te]))}return z&&$.push(z),$}(g),s=0;s<g.length;s++)for(l=0;l<g[s].length;l++)x(g[s][l])}g.length===1?g=g[0]:b="Multi"+b;var T={type:"Feature",geometry:{type:b,coordinates:g},properties:this.properties};return"id"in this&&(T.id=this.id),T};var Pp=fh,mh=gh;function gh(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Cp,this,t),this.length=this._features.length}function Cp(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push(function(s){for(var l=null,h=s.readVarint()+s.pos;s.pos<h;){var d=s.readVarint()>>3;l=d===1?s.readString():d===2?s.readFloat():d===3?s.readDouble():d===4?s.readVarint64():d===5?s.readVarint():d===6?s.readSVarint():d===7?s.readBoolean():null}return l}(r))}gh.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new Pp(this._pbf,t,this.extent,this._keys,this._values)};var Ap=mh;function Mp(i,t,r){if(i===3){var s=new Ap(r,r.readVarint()+r.pos);s.length&&(t[s.name]=s)}}is.VectorTile=function(i,t){this.layers=i.readFields(Mp,{},t)},is.VectorTileFeature=fh,is.VectorTileLayer=mh;const zp=is.VectorTileFeature.types,Qc=Math.pow(2,13);function Uo(i,t,r,s,l,h,d,f){i.emplaceBack(t,r,2*Math.floor(s*Qc)+d,l*Qc*2,h*Qc*2,Math.round(f))}class eu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ka,this.centroidVertexArray=new oi,this.indexArray=new pr,this.programConfigurations=new Bs(t.layers,t.zoom),this.segments=new rt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.features=[],this.hasPattern=Kc("fill-extrusion",this.layers,r);for(const{feature:l,id:h,index:d,sourceLayerIndex:f}of t){const g=this.layers[0]._featureFilter.needGeometry,b=Os(l,g);if(!this.layers[0]._featureFilter.filter(new St(this.zoom),b,s))continue;const x={id:h,sourceLayerIndex:f,index:d,geometry:g?b.geometry:Fs(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(Jc("fill-extrusion",this.layers,x,this.zoom,r)):this.addFeature(x,x.geometry,d,s,{}),r.featureIndex.insert(l,x.geometry,d,f,this.index,!0)}}addFeatures(t,r,s){for(const l of this.features){const{geometry:h}=l;this.addFeature(l,h,l.index,r,s)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Sp),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Ep.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,s,l,h){for(const d of en(r,500)){const f={x:0,y:0,vertexCount:0};let g=0;for(const M of d)g+=M.length;let b=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const M of d){if(M.length===0||Lp(M))continue;let z=0;for(let V=0;V<M.length;V++){const $=M[V];if(V>=1){const te=M[V-1];if(!Dp($,te)){b.vertexLength+4>rt.MAX_VERTEX_ARRAY_LENGTH&&(b=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const W=$.sub(te)._perp()._unit(),Q=te.dist($);z+Q>32768&&(z=0),Uo(this.layoutVertexArray,$.x,$.y,W.x,W.y,0,0,z),Uo(this.layoutVertexArray,$.x,$.y,W.x,W.y,0,1,z),f.x+=2*$.x,f.y+=2*$.y,f.vertexCount+=2,z+=Q,Uo(this.layoutVertexArray,te.x,te.y,W.x,W.y,0,0,z),Uo(this.layoutVertexArray,te.x,te.y,W.x,W.y,0,1,z),f.x+=2*te.x,f.y+=2*te.y,f.vertexCount+=2;const le=b.vertexLength;this.indexArray.emplaceBack(le,le+2,le+1),this.indexArray.emplaceBack(le+1,le+2,le+3),b.vertexLength+=4,b.primitiveLength+=2}}}}if(b.vertexLength+g>rt.MAX_VERTEX_ARRAY_LENGTH&&(b=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray)),zp[t.type]!=="Polygon")continue;const x=[],w=[],T=b.vertexLength;for(const M of d)if(M.length!==0){M!==d[0]&&w.push(x.length/2);for(let z=0;z<M.length;z++){const V=M[z];Uo(this.layoutVertexArray,V.x,V.y,0,0,1,1,0),f.x+=V.x,f.y+=V.y,f.vertexCount+=1,x.push(V.x),x.push(V.y)}}const P=oh(x,w);for(let M=0;M<P.length;M+=3)this.indexArray.emplaceBack(T+P[M],T+P[M+2],T+P[M+1]);b.primitiveLength+=P.length/3,b.vertexLength+=g;for(let M=0;M<f.vertexCount;M++){const z=Math.floor(f.x/f.vertexCount),V=Math.floor(f.y/f.vertexCount);this.centroidVertexArray.emplaceBack(z,V)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,h,l)}}function Dp(i,t){return i.x===t.x&&(i.x<0||i.x>qt)||i.y===t.y&&(i.y<0||i.y>qt)}function Lp(i){return i.every(t=>t.x<0)||i.every(t=>t.x>qt)||i.every(t=>t.y<0)||i.every(t=>t.y>qt)}let _h;Me("FillExtrusionBucket",eu,{omit:["layers","features"]});var Rp={get paint(){return _h=_h||new u({"fill-extrusion-opacity":new De(oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ue(oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new De(oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new De(oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new vn(oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ue(oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ue(oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new De(oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Bp extends a{constructor(t){super(t,Rp)}createBucket(t){return new eu(t)}queryRadius(){return Ul(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,s,l,h,d,f,g){const b=jl(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,f),x=this.paint.get("fill-extrusion-height").evaluate(r,s),w=this.paint.get("fill-extrusion-base").evaluate(r,s),T=function(M,z,V,$){const te=[];for(const W of M){const Q=[W.x,W.y,0,1];$l(Q,Q,z),te.push(new ge(Q[0]/Q[3],Q[1]/Q[3]))}return te}(b,g),P=function(M,z,V,$){const te=[],W=[],Q=$[8]*z,le=$[9]*z,me=$[10]*z,Pe=$[11]*z,Ne=$[8]*V,Ie=$[9]*V,Se=$[10]*V,Be=$[11]*V;for(const ze of M){const Ae=[],he=[];for(const Fe of ze){const Re=Fe.x,qe=Fe.y,xt=$[0]*Re+$[4]*qe+$[12],bt=$[1]*Re+$[5]*qe+$[13],Xt=$[2]*Re+$[6]*qe+$[14],Cr=$[3]*Re+$[7]*qe+$[15],ui=Xt+me,Kt=Cr+Pe,Pi=xt+Ne,Ci=bt+Ie,Ai=Xt+Se,Vt=Cr+Be,Jt=new ge((xt+Q)/Kt,(bt+le)/Kt);Jt.z=ui/Kt,Ae.push(Jt);const bi=new ge(Pi/Vt,Ci/Vt);bi.z=Ai/Vt,he.push(bi)}te.push(Ae),W.push(he)}return[te,W]}(l,w,x,g);return function(M,z,V){let $=1/0;Xu(V,z)&&($=yh(V,z[0]));for(let te=0;te<z.length;te++){const W=z[te],Q=M[te];for(let le=0;le<W.length-1;le++){const me=W[le],Pe=[me,W[le+1],Q[le+1],Q[le],me];Wu(V,Pe)&&($=Math.min($,yh(V,Pe)))}}return $!==1/0&&$}(P[0],P[1],T)}}function jo(i,t){return i.x*t.x+i.y*t.y}function yh(i,t){if(i.length===1){let r=0;const s=t[r++];let l;for(;!l||s.equals(l);)if(l=t[r++],!l)return 1/0;for(;r<t.length;r++){const h=t[r],d=i[0],f=l.sub(s),g=h.sub(s),b=d.sub(s),x=jo(f,f),w=jo(f,g),T=jo(g,g),P=jo(b,f),M=jo(b,g),z=x*T-w*w,V=(T*P-w*M)/z,$=(x*M-w*P)/z,te=s.z*(1-V-$)+l.z*V+h.z*$;if(isFinite(te))return te}return 1/0}{let r=1/0;for(const s of t)r=Math.min(r,s.z);return r}}const Fp=m([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Op}=Fp,Vp=m([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Np}=Vp,Up=is.VectorTileFeature.types,jp=Math.cos(Math.PI/180*37.5),bh=Math.pow(2,14)/.5;class tu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new En,this.layoutVertexArray2=new Ja,this.indexArray=new pr,this.programConfigurations=new Bs(t.layers,t.zoom),this.segments=new rt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.hasPattern=Kc("line",this.layers,r);const l=this.layers[0].layout.get("line-sort-key"),h=!l.isConstant(),d=[];for(const{feature:f,id:g,index:b,sourceLayerIndex:x}of t){const w=this.layers[0]._featureFilter.needGeometry,T=Os(f,w);if(!this.layers[0]._featureFilter.filter(new St(this.zoom),T,s))continue;const P=h?l.evaluate(T,{},s):void 0,M={id:g,properties:f.properties,type:f.type,sourceLayerIndex:x,index:b,geometry:w?T.geometry:Fs(f),patterns:{},sortKey:P};d.push(M)}h&&d.sort((f,g)=>f.sortKey-g.sortKey);for(const f of d){const{geometry:g,index:b,sourceLayerIndex:x}=f;if(this.hasPattern){const w=Jc("line",this.layers,f,this.zoom,r);this.patternFeatures.push(w)}else this.addFeature(f,g,b,s,{});r.featureIndex.insert(t[b].feature,g,b,x,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Np)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Op),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,s,l,h){const d=this.layers[0].layout,f=d.get("line-join").evaluate(t,{}),g=d.get("line-cap"),b=d.get("line-miter-limit"),x=d.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const w of r)this.addLine(w,t,f,g,b,x);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,h,l)}addLine(t,r,s,l,h,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let $=0;$<t.length-1;$++)this.totalDistance+=t[$].dist(t[$+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const f=Up[r.type]==="Polygon";let g=t.length;for(;g>=2&&t[g-1].equals(t[g-2]);)g--;let b=0;for(;b<g-1&&t[b].equals(t[b+1]);)b++;if(g<(f?3:2))return;s==="bevel"&&(h=1.05);const x=this.overscaling<=16?15*qt/(512*this.overscaling):0,w=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray);let T,P,M,z,V;this.e1=this.e2=-1,f&&(T=t[g-2],V=t[b].sub(T)._unit()._perp());for(let $=b;$<g;$++){if(M=$===g-1?f?t[b+1]:void 0:t[$+1],M&&t[$].equals(M))continue;V&&(z=V),T&&(P=T),T=t[$],V=M?M.sub(T)._unit()._perp():z,z=z||V;let te=z.add(V);te.x===0&&te.y===0||te._unit();const W=z.x*V.x+z.y*V.y,Q=te.x*V.x+te.y*V.y,le=Q!==0?1/Q:1/0,me=2*Math.sqrt(2-2*Q),Pe=Q<jp&&P&&M,Ne=z.x*V.y-z.y*V.x>0;if(Pe&&$>b){const Be=T.dist(P);if(Be>2*x){const ze=T.sub(T.sub(P)._mult(x/Be)._round());this.updateDistance(P,ze),this.addCurrentVertex(ze,z,0,0,w),P=ze}}const Ie=P&&M;let Se=Ie?s:f?"butt":l;if(Ie&&Se==="round"&&(le<d?Se="miter":le<=2&&(Se="fakeround")),Se==="miter"&&le>h&&(Se="bevel"),Se==="bevel"&&(le>2&&(Se="flipbevel"),le<h&&(Se="miter")),P&&this.updateDistance(P,T),Se==="miter")te._mult(le),this.addCurrentVertex(T,te,0,0,w);else if(Se==="flipbevel"){if(le>100)te=V.mult(-1);else{const Be=le*z.add(V).mag()/z.sub(V).mag();te._perp()._mult(Be*(Ne?-1:1))}this.addCurrentVertex(T,te,0,0,w),this.addCurrentVertex(T,te.mult(-1),0,0,w)}else if(Se==="bevel"||Se==="fakeround"){const Be=-Math.sqrt(le*le-1),ze=Ne?Be:0,Ae=Ne?0:Be;if(P&&this.addCurrentVertex(T,z,ze,Ae,w),Se==="fakeround"){const he=Math.round(180*me/Math.PI/20);for(let Fe=1;Fe<he;Fe++){let Re=Fe/he;if(Re!==.5){const xt=Re-.5;Re+=Re*xt*(Re-1)*((1.0904+W*(W*(3.55645-1.43519*W)-3.2452))*xt*xt+(.848013+W*(.215638*W-1.06021)))}const qe=V.sub(z)._mult(Re)._add(z)._unit()._mult(Ne?-1:1);this.addHalfVertex(T,qe.x,qe.y,!1,Ne,0,w)}}M&&this.addCurrentVertex(T,V,-ze,-Ae,w)}else if(Se==="butt")this.addCurrentVertex(T,te,0,0,w);else if(Se==="square"){const Be=P?1:-1;this.addCurrentVertex(T,te,Be,Be,w)}else Se==="round"&&(P&&(this.addCurrentVertex(T,z,0,0,w),this.addCurrentVertex(T,z,1,1,w,!0)),M&&(this.addCurrentVertex(T,V,-1,-1,w,!0),this.addCurrentVertex(T,V,0,0,w)));if(Pe&&$<g-1){const Be=T.dist(M);if(Be>2*x){const ze=T.add(M.sub(T)._mult(x/Be)._round());this.updateDistance(T,ze),this.addCurrentVertex(ze,V,0,0,w),T=ze}}}}addCurrentVertex(t,r,s,l,h,d=!1){const f=r.y*l-r.x,g=-r.y-r.x*l;this.addHalfVertex(t,r.x+r.y*s,r.y-r.x*s,d,!1,s,h),this.addHalfVertex(t,f,g,d,!0,-l,h),this.distance>bh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,s,l,h,d))}addHalfVertex({x:t,y:r},s,l,h,d,f,g){const b=.5*(this.lineClips?this.scaledDistance*(bh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(h?1:0),(r<<1)+(d?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(f===0?0:f<0?-1:1)|(63&b)<<2,b>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const x=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),g.primitiveLength++),d?this.e2=x:this.e1=x}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let xh,vh;Me("LineBucket",tu,{omit:["layers","patternFeatures"]});var wh={get paint(){return vh=vh||new u({"line-opacity":new Ue(oe.paint_line["line-opacity"]),"line-color":new Ue(oe.paint_line["line-color"]),"line-translate":new De(oe.paint_line["line-translate"]),"line-translate-anchor":new De(oe.paint_line["line-translate-anchor"]),"line-width":new Ue(oe.paint_line["line-width"]),"line-gap-width":new Ue(oe.paint_line["line-gap-width"]),"line-offset":new Ue(oe.paint_line["line-offset"]),"line-blur":new Ue(oe.paint_line["line-blur"]),"line-dasharray":new wn(oe.paint_line["line-dasharray"]),"line-pattern":new vn(oe.paint_line["line-pattern"]),"line-gradient":new zo(oe.paint_line["line-gradient"])})},get layout(){return xh=xh||new u({"line-cap":new De(oe.layout_line["line-cap"]),"line-join":new Ue(oe.layout_line["line-join"]),"line-miter-limit":new De(oe.layout_line["line-miter-limit"]),"line-round-limit":new De(oe.layout_line["line-round-limit"]),"line-sort-key":new Ue(oe.layout_line["line-sort-key"])})}};class $p extends Ue{possiblyEvaluate(t,r){return r=new St(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,s,l){return r=ut({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,s,l)}}let Hl;class qp extends a{constructor(t){super(t,wh),this.gradientVersion=0,Hl||(Hl=new $p(wh.paint.properties["line-width"].specification),Hl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof za,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=Hl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new tu(t)}queryRadius(t){const r=t,s=Eh(Ro("line-width",this,r),Ro("line-gap-width",this,r)),l=Ro("line-offset",this,r);return s/2+Math.abs(l)+Ul(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,s,l,h,d,f){const g=jl(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,f),b=f/2*Eh(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),x=this.paint.get("line-offset").evaluate(r,s);return x&&(l=function(w,T){const P=[];for(let M=0;M<w.length;M++){const z=w[M],V=[];for(let $=0;$<z.length;$++){const te=z[$-1],W=z[$],Q=z[$+1],le=$===0?new ge(0,0):W.sub(te)._unit()._perp(),me=$===z.length-1?new ge(0,0):Q.sub(W)._unit()._perp(),Pe=le._add(me)._unit(),Ne=Pe.x*me.x+Pe.y*me.y;Ne!==0&&Pe._mult(1/Ne),V.push(Pe._mult(T)._add(W))}P.push(V)}return P}(l,x*f)),function(w,T,P){for(let M=0;M<T.length;M++){const z=T[M];if(w.length>=3){for(let V=0;V<z.length;V++)if(Cn(w,z[V]))return!0}if(Qd(w,z,P))return!0}return!1}(g,l,b)}isTileClipped(){return!0}}function Eh(i,t){return t>0?t+2*i:i}const Zp=m([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Gp=m([{name:"a_projected_pos",components:3,type:"Float32"}],4);m([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Hp=m([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);m([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Sh=m([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Wp=m([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Xp(i,t,r){return i.sections.forEach(s=>{s.text=function(l,h,d){const f=h.layout.get("text-transform").evaluate(d,{});return f==="uppercase"?l=l.toLocaleUpperCase():f==="lowercase"&&(l=l.toLocaleLowerCase()),Ui.applyArabicShaping&&(l=Ui.applyArabicShaping(l)),l}(s.text,t,r)}),i}m([{name:"triangle",components:3,type:"Uint16"}]),m([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),m([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),m([{type:"Float32",name:"offsetX"}]),m([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),m([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const $o={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Zt=24,Th=yt,Ih=function(i,t,r,s,l){var h,d,f=8*l-s-1,g=(1<<f)-1,b=g>>1,x=-7,w=l-1,T=-1,P=i[t+w];for(w+=T,h=P&(1<<-x)-1,P>>=-x,x+=f;x>0;h=256*h+i[t+w],w+=T,x-=8);for(d=h&(1<<-x)-1,h>>=-x,x+=s;x>0;d=256*d+i[t+w],w+=T,x-=8);if(h===0)h=1-b;else{if(h===g)return d?NaN:1/0*(P?-1:1);d+=Math.pow(2,s),h-=b}return(P?-1:1)*d*Math.pow(2,h-s)},kh=function(i,t,r,s,l,h){var d,f,g,b=8*h-l-1,x=(1<<b)-1,w=x>>1,T=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=0,M=1,z=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(f=isNaN(t)?1:0,d=x):(d=Math.floor(Math.log(t)/Math.LN2),t*(g=Math.pow(2,-d))<1&&(d--,g*=2),(t+=d+w>=1?T/g:T*Math.pow(2,1-w))*g>=2&&(d++,g/=2),d+w>=x?(f=0,d=x):d+w>=1?(f=(t*g-1)*Math.pow(2,l),d+=w):(f=t*Math.pow(2,w-1)*Math.pow(2,l),d=0));l>=8;i[r+P]=255&f,P+=M,f/=256,l-=8);for(d=d<<l|f,b+=l;b>0;i[r+P]=255&d,P+=M,d/=256,b-=8);i[r+P-M]|=128*z};function yt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}yt.Varint=0,yt.Fixed64=1,yt.Bytes=2,yt.Fixed32=5;var iu=4294967296,Ph=1/iu,Ch=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ea(i){return i.type===yt.Bytes?i.readVarint()+i.pos:i.pos+1}function Dn(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function Ah(i,t,r){var s=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(s);for(var l=r.pos-1;l>=i;l--)r.buf[l+s]=r.buf[l]}function Kp(i,t){for(var r=0;r<i.length;r++)t.writeVarint(i[r])}function Jp(i,t){for(var r=0;r<i.length;r++)t.writeSVarint(i[r])}function Yp(i,t){for(var r=0;r<i.length;r++)t.writeFloat(i[r])}function Qp(i,t){for(var r=0;r<i.length;r++)t.writeDouble(i[r])}function ef(i,t){for(var r=0;r<i.length;r++)t.writeBoolean(i[r])}function tf(i,t){for(var r=0;r<i.length;r++)t.writeFixed32(i[r])}function rf(i,t){for(var r=0;r<i.length;r++)t.writeSFixed32(i[r])}function af(i,t){for(var r=0;r<i.length;r++)t.writeFixed64(i[r])}function sf(i,t){for(var r=0;r<i.length;r++)t.writeSFixed64(i[r])}function Wl(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Ln(i,t,r){i[r]=t,i[r+1]=t>>>8,i[r+2]=t>>>16,i[r+3]=t>>>24}function Mh(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}yt.prototype={destroy:function(){this.buf=null},readFields:function(i,t,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),l=s>>3,h=this.pos;this.type=7&s,i(l,t,this),this.pos===h&&this.skip(s)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Wl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Mh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Wl(this.buf,this.pos)+Wl(this.buf,this.pos+4)*iu;return this.pos+=8,i},readSFixed64:function(){var i=Wl(this.buf,this.pos)+Mh(this.buf,this.pos+4)*iu;return this.pos+=8,i},readFloat:function(){var i=Ih(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Ih(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,r,s=this.buf;return t=127&(r=s[this.pos++]),r<128?t:(t|=(127&(r=s[this.pos++]))<<7,r<128?t:(t|=(127&(r=s[this.pos++]))<<14,r<128?t:(t|=(127&(r=s[this.pos++]))<<21,r<128?t:function(l,h,d){var f,g,b=d.buf;if(f=(112&(g=b[d.pos++]))>>4,g<128||(f|=(127&(g=b[d.pos++]))<<3,g<128)||(f|=(127&(g=b[d.pos++]))<<10,g<128)||(f|=(127&(g=b[d.pos++]))<<17,g<128)||(f|=(127&(g=b[d.pos++]))<<24,g<128)||(f|=(1&(g=b[d.pos++]))<<31,g<128))return Dn(l,f,h);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&Ch?function(r,s,l){return Ch.decode(r.subarray(s,l))}(this.buf,t,i):function(r,s,l){for(var h="",d=s;d<l;){var f,g,b,x=r[d],w=null,T=x>239?4:x>223?3:x>191?2:1;if(d+T>l)break;T===1?x<128&&(w=x):T===2?(192&(f=r[d+1]))==128&&(w=(31&x)<<6|63&f)<=127&&(w=null):T===3?(g=r[d+2],(192&(f=r[d+1]))==128&&(192&g)==128&&((w=(15&x)<<12|(63&f)<<6|63&g)<=2047||w>=55296&&w<=57343)&&(w=null)):T===4&&(g=r[d+2],b=r[d+3],(192&(f=r[d+1]))==128&&(192&g)==128&&(192&b)==128&&((w=(15&x)<<18|(63&f)<<12|(63&g)<<6|63&b)<=65535||w>=1114112)&&(w=null)),w===null?(w=65533,T=1):w>65535&&(w-=65536,h+=String.fromCharCode(w>>>10&1023|55296),w=56320|1023&w),h+=String.fromCharCode(w),d+=T}return h}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==yt.Bytes)return i.push(this.readVarint(t));var r=Ea(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==yt.Bytes)return i.push(this.readSVarint());var t=Ea(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==yt.Bytes)return i.push(this.readBoolean());var t=Ea(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==yt.Bytes)return i.push(this.readFloat());var t=Ea(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==yt.Bytes)return i.push(this.readDouble());var t=Ea(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==yt.Bytes)return i.push(this.readFixed32());var t=Ea(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==yt.Bytes)return i.push(this.readSFixed32());var t=Ea(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==yt.Bytes)return i.push(this.readFixed64());var t=Ea(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==yt.Bytes)return i.push(this.readSFixed64());var t=Ea(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===yt.Varint)for(;this.buf[this.pos++]>127;);else if(t===yt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===yt.Fixed32)this.pos+=4;else{if(t!==yt.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ln(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ln(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ln(this.buf,-1&i,this.pos),Ln(this.buf,Math.floor(i*Ph),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ln(this.buf,-1&i,this.pos),Ln(this.buf,Math.floor(i*Ph),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,r){var s,l;if(t>=0?(s=t%4294967296|0,l=t/4294967296|0):(l=~(-t/4294967296),4294967295^(s=~(-t%4294967296))?s=s+1|0:(s=0,l=l+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(h,d,f){f.buf[f.pos++]=127&h|128,h>>>=7,f.buf[f.pos++]=127&h|128,h>>>=7,f.buf[f.pos++]=127&h|128,h>>>=7,f.buf[f.pos++]=127&h|128,f.buf[f.pos]=127&(h>>>=7)}(s,0,r),function(h,d){var f=(7&h)<<4;d.buf[d.pos++]|=f|((h>>>=3)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h)))))}(l,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(s,l,h){for(var d,f,g=0;g<l.length;g++){if((d=l.charCodeAt(g))>55295&&d<57344){if(!f){d>56319||g+1===l.length?(s[h++]=239,s[h++]=191,s[h++]=189):f=d;continue}if(d<56320){s[h++]=239,s[h++]=191,s[h++]=189,f=d;continue}d=f-55296<<10|d-56320|65536,f=null}else f&&(s[h++]=239,s[h++]=191,s[h++]=189,f=null);d<128?s[h++]=d:(d<2048?s[h++]=d>>6|192:(d<65536?s[h++]=d>>12|224:(s[h++]=d>>18|240,s[h++]=d>>12&63|128),s[h++]=d>>6&63|128),s[h++]=63&d|128)}return h}(this.buf,i,this.pos);var r=this.pos-t;r>=128&&Ah(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),kh(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),kh(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,t){this.pos++;var r=this.pos;i(t,this);var s=this.pos-r;s>=128&&Ah(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,t,r){this.writeTag(i,yt.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,Kp,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,Jp,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,ef,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,Yp,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,Qp,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,tf,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,rf,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,af,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,sf,t)},writeBytesField:function(i,t){this.writeTag(i,yt.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,yt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,yt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,yt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,yt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,yt.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,yt.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,yt.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,yt.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,yt.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var ru=Ye(Th);const au=3;function nf(i,t,r){i===1&&r.readMessage(of,t)}function of(i,t,r){if(i===3){const{id:s,bitmap:l,width:h,height:d,left:f,top:g,advance:b}=r.readMessage(lf,{});t.push({id:s,bitmap:new Fo({width:h+2*au,height:d+2*au},l),metrics:{width:h,height:d,left:f,top:g,advance:b}})}}function lf(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}const zh=au;function Dh(i){let t=0,r=0;for(const d of i)t+=d.w*d.h,r=Math.max(r,d.w);i.sort((d,f)=>f.h-d.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let l=0,h=0;for(const d of i)for(let f=s.length-1;f>=0;f--){const g=s[f];if(!(d.w>g.w||d.h>g.h)){if(d.x=g.x,d.y=g.y,h=Math.max(h,d.y+d.h),l=Math.max(l,d.x+d.w),d.w===g.w&&d.h===g.h){const b=s.pop();f<s.length&&(s[f]=b)}else d.h===g.h?(g.x+=d.w,g.w-=d.w):d.w===g.w?(g.y+=d.h,g.h-=d.h):(s.push({x:g.x+d.w,y:g.y,w:g.w-d.w,h:d.h}),g.y+=d.h,g.h-=d.h);break}}return{w:l,h,fill:t/(l*h)||0}}const $i=1;class su{constructor(t,{pixelRatio:r,version:s,stretchX:l,stretchY:h,content:d,textFitWidth:f,textFitHeight:g}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=l,this.stretchY=h,this.content=d,this.version=s,this.textFitWidth=f,this.textFitHeight=g}get tl(){return[this.paddedRect.x+$i,this.paddedRect.y+$i]}get br(){return[this.paddedRect.x+this.paddedRect.w-$i,this.paddedRect.y+this.paddedRect.h-$i]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*$i)/this.pixelRatio,(this.paddedRect.h-2*$i)/this.pixelRatio]}}class Lh{constructor(t,r){const s={},l={};this.haveRenderCallbacks=[];const h=[];this.addImages(t,s,h),this.addImages(r,l,h);const{w:d,h:f}=Dh(h),g=new fr({width:d||1,height:f||1});for(const b in t){const x=t[b],w=s[b].paddedRect;fr.copy(x.data,g,{x:0,y:0},{x:w.x+$i,y:w.y+$i},x.data)}for(const b in r){const x=r[b],w=l[b].paddedRect,T=w.x+$i,P=w.y+$i,M=x.data.width,z=x.data.height;fr.copy(x.data,g,{x:0,y:0},{x:T,y:P},x.data),fr.copy(x.data,g,{x:0,y:z-1},{x:T,y:P-1},{width:M,height:1}),fr.copy(x.data,g,{x:0,y:0},{x:T,y:P+z},{width:M,height:1}),fr.copy(x.data,g,{x:M-1,y:0},{x:T-1,y:P},{width:1,height:z}),fr.copy(x.data,g,{x:0,y:0},{x:T+M,y:P},{width:1,height:z})}this.image=g,this.iconPositions=s,this.patternPositions=l}addImages(t,r,s){for(const l in t){const h=t[l],d={x:0,y:0,w:h.data.width+2*$i,h:h.data.height+2*$i};s.push(d),r[l]=new su(d,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),r)}patchUpdatedImage(t,r,s){if(!t||!r||t.version===r.version)return;t.version=r.version;const[l,h]=t.tl;s.update(r.data,void 0,{x:l,y:h})}}var rs;Me("ImagePosition",su),Me("ImageAtlas",Lh),C.ah=void 0,(rs=C.ah||(C.ah={}))[rs.none=0]="none",rs[rs.horizontal=1]="horizontal",rs[rs.vertical=2]="vertical",rs[rs.horizontalOnly=3]="horizontalOnly";const qo=-17;class Zo{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const s=new Zo;return s.scale=t||1,s.fontStack=r,s}static forImage(t){const r=new Zo;return r.imageName=t,r}}class Rn{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const s=new Rn;for(let l=0;l<t.sections.length;l++){const h=t.sections[l];h.image?s.addImageSection(h):s.addTextSection(h,r)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let s=0;s<t.length;s++){const l=t.charCodeAt(s+1)||null,h=t.charCodeAt(s-1)||null;r+=l&&Ll(l)&&!$o[t[s+1]]||h&&Ll(h)&&!$o[t[s-1]]||!$o[t[s]]?t[s]:$o[t[s]]}return r}(this.text)}trim(){let t=0;for(let s=0;s<this.text.length&&Kl[this.text.charCodeAt(s)];s++)t++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&Kl[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const s=new Rn;return s.text=this.text.substring(t,r),s.sectionIndex=this.sectionIndex.slice(t,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(Zo.forText(t.scale,t.fontStack||r));const s=this.sections.length-1;for(let l=0;l<t.text.length;++l)this.sectionIndex.push(s)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Gt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Zo.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Gt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Xl(i,t,r,s,l,h,d,f,g,b,x,w,T,P,M){const z=Rn.fromFeature(i,l);let V;w===C.ah.vertical&&z.verticalizePunctuation();const{processBidirectionalText:$,processStyledBidirectionalText:te}=Ui;if($&&z.sections.length===1){V=[];const le=$(z.toString(),nu(z,b,h,t,s,P));for(const me of le){const Pe=new Rn;Pe.text=me,Pe.sections=z.sections;for(let Ne=0;Ne<me.length;Ne++)Pe.sectionIndex.push(0);V.push(Pe)}}else if(te){V=[];const le=te(z.text,z.sectionIndex,nu(z,b,h,t,s,P));for(const me of le){const Pe=new Rn;Pe.text=me[0],Pe.sectionIndex=me[1],Pe.sections=z.sections,V.push(Pe)}}else V=function(le,me){const Pe=[],Ne=le.text;let Ie=0;for(const Se of me)Pe.push(le.substring(Ie,Se)),Ie=Se;return Ie<Ne.length&&Pe.push(le.substring(Ie,Ne.length)),Pe}(z,nu(z,b,h,t,s,P));const W=[],Q={positionedLines:W,text:z.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:w,iconsInText:!1,verticalizable:!1};return function(le,me,Pe,Ne,Ie,Se,Be,ze,Ae,he,Fe,Re){let qe=0,xt=qo,bt=0,Xt=0;const Cr=ze==="right"?1:ze==="left"?0:.5;let ui=0;for(const Vt of Ie){Vt.trim();const Jt=Vt.getMaxScale(),bi=(Jt-1)*Zt,hi={positionedGlyphs:[],lineOffset:0};le.positionedLines[ui]=hi;const Mi=hi.positionedGlyphs;let di=0;if(!Vt.length()){xt+=Se,++ui;continue}for(let qi=0;qi<Vt.length();qi++){const ct=Vt.getSection(qi),wt=Vt.getSectionIndex(qi),Pt=Vt.getCharCode(qi);let ir=0,Lt=null,Vn=null,ta=null,ia=Zt;const Ar=!(Ae===C.ah.horizontal||!Fe&&!Ao(Pt)||Fe&&(Kl[Pt]||(Kt=Pt,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Kt)))));if(ct.imageName){const _r=Ne[ct.imageName];if(!_r)continue;ta=ct.imageName,le.iconsInText=le.iconsInText||!0,Vn=_r.paddedRect;const ai=_r.displaySize;ct.scale=ct.scale*Zt/Re,Lt={width:ai[0],height:ai[1],left:$i,top:-zh,advance:Ar?ai[1]:ai[0]},ir=bi+(Zt-ai[1]*ct.scale),ia=Lt.advance;const Sa=Ar?ai[0]*ct.scale-Zt*Jt:ai[1]*ct.scale-Zt*Jt;Sa>0&&Sa>di&&(di=Sa)}else{const _r=Pe[ct.fontStack],ai=_r&&_r[Pt];if(ai&&ai.rect)Vn=ai.rect,Lt=ai.metrics;else{const Sa=me[ct.fontStack],Jo=Sa&&Sa[Pt];if(!Jo)continue;Lt=Jo.metrics}ir=(Jt-ct.scale)*Zt}Ar?(le.verticalizable=!0,Mi.push({glyph:Pt,imageName:ta,x:qe,y:xt+ir,vertical:Ar,scale:ct.scale,fontStack:ct.fontStack,sectionIndex:wt,metrics:Lt,rect:Vn}),qe+=ia*ct.scale+he):(Mi.push({glyph:Pt,imageName:ta,x:qe,y:xt+ir,vertical:Ar,scale:ct.scale,fontStack:ct.fontStack,sectionIndex:wt,metrics:Lt,rect:Vn}),qe+=Lt.advance*ct.scale+he)}Mi.length!==0&&(bt=Math.max(qe-he,bt),df(Mi,0,Mi.length-1,Cr,di)),qe=0;const gr=Se*Jt+di;hi.lineOffset=Math.max(di,bi),xt+=gr,Xt=Math.max(gr,Xt),++ui}var Kt;const Pi=xt-qo,{horizontalAlign:Ci,verticalAlign:Ai}=ou(Be);(function(Vt,Jt,bi,hi,Mi,di,gr,qi,ct){const wt=(Jt-bi)*Mi;let Pt=0;Pt=di!==gr?-qi*hi-qo:(-hi*ct+.5)*gr;for(const ir of Vt)for(const Lt of ir.positionedGlyphs)Lt.x+=wt,Lt.y+=Pt})(le.positionedLines,Cr,Ci,Ai,bt,Xt,Se,Pi,Ie.length),le.top+=-Ai*Pi,le.bottom=le.top+Pi,le.left+=-Ci*bt,le.right=le.left+bt}(Q,t,r,s,V,d,f,g,w,b,T,M),!function(le){for(const me of le)if(me.positionedGlyphs.length!==0)return!1;return!0}(W)&&Q}const Kl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},cf={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},uf={40:!0};function Rh(i,t,r,s,l,h){if(t.imageName){const d=s[t.imageName];return d?d.displaySize[0]*t.scale*Zt/h+l:0}{const d=r[t.fontStack],f=d&&d[i];return f?f.metrics.advance*t.scale+l:0}}function Bh(i,t,r,s){const l=Math.pow(i-t,2);return s?i<t?l/2:2*l:l+Math.abs(r)*r}function hf(i,t,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),t!==41&&t!==65289||(s+=50),s}function Fh(i,t,r,s,l,h){let d=null,f=Bh(t,r,l,h);for(const g of s){const b=Bh(t-g.x,r,l,h)+g.badness;b<=f&&(d=g,f=b)}return{index:i,x:t,priorBreak:d,badness:f}}function Oh(i){return i?Oh(i.priorBreak).concat(i.index):[]}function nu(i,t,r,s,l,h){if(!i)return[];const d=[],f=function(w,T,P,M,z,V){let $=0;for(let te=0;te<w.length();te++){const W=w.getSection(te);$+=Rh(w.getCharCode(te),W,M,z,T,V)}return $/Math.max(1,Math.ceil($/P))}(i,t,r,s,l,h),g=i.text.indexOf("​")>=0;let b=0;for(let w=0;w<i.length();w++){const T=i.getSection(w),P=i.getCharCode(w);if(Kl[P]||(b+=Rh(P,T,s,l,t,h)),w<i.length()-1){const M=!((x=P)<11904)&&(!!it["CJK Compatibility Forms"](x)||!!it["CJK Compatibility"](x)||!!it["CJK Strokes"](x)||!!it["CJK Symbols and Punctuation"](x)||!!it["Enclosed CJK Letters and Months"](x)||!!it["Halfwidth and Fullwidth Forms"](x)||!!it["Ideographic Description Characters"](x)||!!it["Vertical Forms"](x)||Dl.test(String.fromCodePoint(x)));(cf[P]||M||T.imageName||w!==i.length()-2&&uf[i.getCharCode(w+1)])&&d.push(Fh(w+1,b,f,d,hf(P,i.getCharCode(w+1),M&&g),!1))}}var x;return Oh(Fh(i.length(),b,f,d,0,!0))}function ou(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function df(i,t,r,s,l){if(!s&&!l)return;const h=i[r],d=(i[r].x+h.metrics.advance*h.scale)*s;for(let f=t;f<=r;f++)i[f].x-=d,i[f].y+=l}function pf(i,t,r){const{horizontalAlign:s,verticalAlign:l}=ou(r),h=t[0]-i.displaySize[0]*s,d=t[1]-i.displaySize[1]*l;return{image:i,top:d,bottom:d+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function Vh(i){var t,r;let s=i.left,l=i.top,h=i.right-s,d=i.bottom-l;const f=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",g=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",b=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(g==="proportional"){if(f==="stretchOnly"&&h/d<b||f==="proportional"){const x=Math.ceil(d*b);s*=x/h,h=x}}else if(f==="proportional"&&g==="stretchOnly"&&b!==0&&h/d>b){const x=Math.ceil(h/b);l*=x/d,d=x}return{x1:s,y1:l,x2:s+h,y2:l+d}}function Nh(i,t,r,s,l,h){const d=i.image;let f;if(d.content){const V=d.content,$=d.pixelRatio||1;f=[V[0]/$,V[1]/$,d.displaySize[0]-V[2]/$,d.displaySize[1]-V[3]/$]}const g=t.left*h,b=t.right*h;let x,w,T,P;r==="width"||r==="both"?(P=l[0]+g-s[3],w=l[0]+b+s[1]):(P=l[0]+(g+b-d.displaySize[0])/2,w=P+d.displaySize[0]);const M=t.top*h,z=t.bottom*h;return r==="height"||r==="both"?(x=l[1]+M-s[0],T=l[1]+z+s[2]):(x=l[1]+(M+z-d.displaySize[1])/2,T=x+d.displaySize[1]),{image:d,top:x,right:w,bottom:T,left:P,collisionPadding:f}}const Go=255,ea=128,as=Go*ea;function Uh(i,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new St(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=r;let h=0;for(;h<s.length&&s[h]<=i;)h++;h=Math.max(0,h-1);let d=h;for(;d<s.length&&s[d]<i+1;)d++;d=Math.min(s.length-1,d);const f=s[h],g=s[d];return r.kind==="composite"?{kind:"composite",minZoom:f,maxZoom:g,interpolationType:l}:{kind:"camera",minZoom:f,maxZoom:g,minSize:r.evaluate(new St(f)),maxSize:r.evaluate(new St(g)),interpolationType:l}}}function lu(i,t,r){let s="never";const l=i.get(t);return l?s=l:i.get(r)&&(s="always"),s}const ff=is.VectorTileFeature.types,mf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Jl(i,t,r,s,l,h,d,f,g,b,x,w,T){const P=f?Math.min(as,Math.round(f[0])):0,M=f?Math.min(as,Math.round(f[1])):0;i.emplaceBack(t,r,Math.round(32*s),Math.round(32*l),h,d,(P<<1)+(g?1:0),M,16*b,16*x,256*w,256*T)}function cu(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function gf(i){for(const t of i.sections)if(Fc(t.text))return!0;return!1}class uu{constructor(t){this.layoutVertexArray=new Sn,this.indexArray=new pr,this.programConfigurations=t,this.segments=new rt,this.dynamicLayoutVertexArray=new Do,this.opacityVertexArray=new er,this.hasVisibleVertices=!1,this.placedSymbolArray=new Tt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,s,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zp.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Gp.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,mf,!0),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Me("SymbolBuffers",uu);class hu{constructor(t,r,s){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new s,this.segments=new rt,this.collisionVertexArray=new Yr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Hp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Me("CollisionBuffers",hu);class Bn{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(d=>d.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=qc([]),this.placementViewportMatrix=qc([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Uh(this.zoom,r["text-size"]),this.iconSizeData=Uh(this.zoom,r["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),h=s.get("symbol-z-order");this.canOverlap=lu(s,"text-overlap","text-allow-overlap")!=="never"||lu(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(d=>C.ah[d])),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=t.sourceID}createArrays(){this.text=new uu(new Bs(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new uu(new Bs(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new It,this.lineVertexArray=new ni,this.symbolInstances=new tt,this.textAnchorOffsets=new kt}calculateGlyphDependencies(t,r,s,l,h){for(let d=0;d<t.length;d++)if(r[t.charCodeAt(d)]=!0,(s||l)&&h){const f=$o[t.charAt(d)];f&&(r[f.charCodeAt(0)]=!0)}}populate(t,r,s){const l=this.layers[0],h=l.layout,d=h.get("text-font"),f=h.get("text-field"),g=h.get("icon-image"),b=(f.value.kind!=="constant"||f.value.value instanceof Fi&&!f.value.value.isEmpty()||f.value.value.toString().length>0)&&(d.value.kind!=="constant"||d.value.value.length>0),x=g.value.kind!=="constant"||!!g.value.value||Object.keys(g.parameters).length>0,w=h.get("symbol-sort-key");if(this.features=[],!b&&!x)return;const T=r.iconDependencies,P=r.glyphDependencies,M=r.availableImages,z=new St(this.zoom);for(const{feature:V,id:$,index:te,sourceLayerIndex:W}of t){const Q=l._featureFilter.needGeometry,le=Os(V,Q);if(!l._featureFilter.filter(z,le,s))continue;let me,Pe;if(Q||(le.geometry=Fs(V)),b){const Ie=l.getValueAndResolveTokens("text-field",le,s,M),Se=Fi.factory(Ie),Be=this.hasRTLText=this.hasRTLText||gf(Se);(!Be||Ui.getRTLTextPluginStatus()==="unavailable"||Be&&Ui.isParsed())&&(me=Xp(Se,l,le))}if(x){const Ie=l.getValueAndResolveTokens("icon-image",le,s,M);Pe=Ie instanceof Vi?Ie:Vi.fromString(Ie)}if(!me&&!Pe)continue;const Ne=this.sortFeaturesByKey?w.evaluate(le,{},s):void 0;if(this.features.push({id:$,text:me,icon:Pe,index:te,sourceLayerIndex:W,geometry:le.geometry,properties:V.properties,type:ff[V.type],sortKey:Ne}),Pe&&(T[Pe.name]=!0),me){const Ie=d.evaluate(le,{},s).join(","),Se=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(C.ah.vertical)>=0;for(const Be of me.sections)if(Be.image)T[Be.image.name]=!0;else{const ze=Po(me.toString()),Ae=Be.fontStack||Ie,he=P[Ae]=P[Ae]||{};this.calculateGlyphDependencies(Be.text,he,Se,this.allowVerticalPlacement,ze)}}}h.get("symbol-placement")==="line"&&(this.features=function(V){const $={},te={},W=[];let Q=0;function le(Ie){W.push(V[Ie]),Q++}function me(Ie,Se,Be){const ze=te[Ie];return delete te[Ie],te[Se]=ze,W[ze].geometry[0].pop(),W[ze].geometry[0]=W[ze].geometry[0].concat(Be[0]),ze}function Pe(Ie,Se,Be){const ze=$[Se];return delete $[Se],$[Ie]=ze,W[ze].geometry[0].shift(),W[ze].geometry[0]=Be[0].concat(W[ze].geometry[0]),ze}function Ne(Ie,Se,Be){const ze=Be?Se[0][Se[0].length-1]:Se[0][0];return`${Ie}:${ze.x}:${ze.y}`}for(let Ie=0;Ie<V.length;Ie++){const Se=V[Ie],Be=Se.geometry,ze=Se.text?Se.text.toString():null;if(!ze){le(Ie);continue}const Ae=Ne(ze,Be),he=Ne(ze,Be,!0);if(Ae in te&&he in $&&te[Ae]!==$[he]){const Fe=Pe(Ae,he,Be),Re=me(Ae,he,W[Fe].geometry);delete $[Ae],delete te[he],te[Ne(ze,W[Re].geometry,!0)]=Re,W[Fe].geometry=null}else Ae in te?me(Ae,he,Be):he in $?Pe(Ae,he,Be):(le(Ie),$[Ae]=Q-1,te[he]=Q-1)}return W.filter(Ie=>Ie.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((V,$)=>V.sortKey-$.sortKey)}update(t,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const s=this.lineVertexArray.length;if(t.segment!==void 0){let l=t.dist(r[t.segment+1]),h=t.dist(r[t.segment]);const d={};for(let f=t.segment+1;f<r.length;f++)d[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:l},f<r.length-1&&(l+=r[f+1].dist(r[f]));for(let f=t.segment||0;f>=0;f--)d[f]={x:r[f].x,y:r[f].y,tileUnitDistanceFromAnchor:h},f>0&&(h+=r[f-1].dist(r[f]));for(let f=0;f<r.length;f++){const g=d[f];this.lineVertexArray.emplaceBack(g.x,g.y,g.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,r,s,l,h,d,f,g,b,x,w,T){const P=t.indexArray,M=t.layoutVertexArray,z=t.segments.prepareSegment(4*r.length,M,P,this.canOverlap?d.sortKey:void 0),V=this.glyphOffsetArray.length,$=z.vertexLength,te=this.allowVerticalPlacement&&f===C.ah.vertical?Math.PI/2:0,W=d.text&&d.text.sections;for(let Q=0;Q<r.length;Q++){const{tl:le,tr:me,bl:Pe,br:Ne,tex:Ie,pixelOffsetTL:Se,pixelOffsetBR:Be,minFontScaleX:ze,minFontScaleY:Ae,glyphOffset:he,isSDF:Fe,sectionIndex:Re}=r[Q],qe=z.vertexLength,xt=he[1];Jl(M,g.x,g.y,le.x,xt+le.y,Ie.x,Ie.y,s,Fe,Se.x,Se.y,ze,Ae),Jl(M,g.x,g.y,me.x,xt+me.y,Ie.x+Ie.w,Ie.y,s,Fe,Be.x,Se.y,ze,Ae),Jl(M,g.x,g.y,Pe.x,xt+Pe.y,Ie.x,Ie.y+Ie.h,s,Fe,Se.x,Be.y,ze,Ae),Jl(M,g.x,g.y,Ne.x,xt+Ne.y,Ie.x+Ie.w,Ie.y+Ie.h,s,Fe,Be.x,Be.y,ze,Ae),cu(t.dynamicLayoutVertexArray,g,te),P.emplaceBack(qe,qe+1,qe+2),P.emplaceBack(qe+1,qe+2,qe+3),z.vertexLength+=4,z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(he[0]),Q!==r.length-1&&Re===r[Q+1].sectionIndex||t.programConfigurations.populatePaintArrays(M.length,d,d.index,{},T,W&&W[Re])}t.placedSymbolArray.emplaceBack(g.x,g.y,V,this.glyphOffsetArray.length-V,$,b,x,g.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],f,0,!1,0,w)}_addCollisionDebugVertex(t,r,s,l,h,d){return r.emplaceBack(0,0),t.emplaceBack(s.x,s.y,l,h,Math.round(d.x),Math.round(d.y))}addCollisionDebugVertices(t,r,s,l,h,d,f){const g=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),b=g.vertexLength,x=h.layoutVertexArray,w=h.collisionVertexArray,T=f.anchorX,P=f.anchorY;this._addCollisionDebugVertex(x,w,d,T,P,new ge(t,r)),this._addCollisionDebugVertex(x,w,d,T,P,new ge(s,r)),this._addCollisionDebugVertex(x,w,d,T,P,new ge(s,l)),this._addCollisionDebugVertex(x,w,d,T,P,new ge(t,l)),g.vertexLength+=4;const M=h.indexArray;M.emplaceBack(b,b+1),M.emplaceBack(b+1,b+2),M.emplaceBack(b+2,b+3),M.emplaceBack(b+3,b),g.primitiveLength+=4}addDebugCollisionBoxes(t,r,s,l){for(let h=t;h<r;h++){const d=this.collisionBoxArray.get(h);this.addCollisionDebugVertices(d.x1,d.y1,d.x2,d.y2,l?this.textCollisionBox:this.iconCollisionBox,d.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new hu(tr,Sh.members,ri),this.iconCollisionBox=new hu(tr,Sh.members,ri);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,s,l,h,d,f,g,b){const x={};for(let w=r;w<s;w++){const T=t.get(w);x.textBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},x.textFeatureIndex=T.featureIndex;break}for(let w=l;w<h;w++){const T=t.get(w);x.verticalTextBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},x.verticalTextFeatureIndex=T.featureIndex;break}for(let w=d;w<f;w++){const T=t.get(w);x.iconBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},x.iconFeatureIndex=T.featureIndex;break}for(let w=g;w<b;w++){const T=t.get(w);x.verticalIconBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},x.verticalIconFeatureIndex=T.featureIndex;break}return x}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const s=t.placedSymbolArray.get(r),l=s.vertexStartIndex+4*s.numGlyphs;for(let h=s.vertexStartIndex;h<l;h+=4)t.indexArray.emplaceBack(h,h+1,h+2),t.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),s=Math.cos(t),l=[],h=[],d=[];for(let f=0;f<this.symbolInstances.length;++f){d.push(f);const g=this.symbolInstances.get(f);l.push(0|Math.round(r*g.anchorX+s*g.anchorY)),h.push(g.featureIndex)}return d.sort((f,g)=>l[f]-l[g]||h[g]-h[f]),d}addToSortKeyRanges(t,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((l,h,d)=>{l>=0&&d.indexOf(l)===h&&this.addIndicesForPlacedSymbol(this.text,l)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let jh,$h;Me("SymbolBucket",Bn,{omit:["layers","collisionBoxArray","features","compareText"]}),Bn.MAX_GLYPHS=65535,Bn.addDynamicAttributes=cu;var du={get paint(){return $h=$h||new u({"icon-opacity":new Ue(oe.paint_symbol["icon-opacity"]),"icon-color":new Ue(oe.paint_symbol["icon-color"]),"icon-halo-color":new Ue(oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ue(oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ue(oe.paint_symbol["icon-halo-blur"]),"icon-translate":new De(oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new De(oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ue(oe.paint_symbol["text-opacity"]),"text-color":new Ue(oe.paint_symbol["text-color"],{runtimeType:Ei,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ue(oe.paint_symbol["text-halo-color"]),"text-halo-width":new Ue(oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Ue(oe.paint_symbol["text-halo-blur"]),"text-translate":new De(oe.paint_symbol["text-translate"]),"text-translate-anchor":new De(oe.paint_symbol["text-translate-anchor"])})},get layout(){return jh=jh||new u({"symbol-placement":new De(oe.layout_symbol["symbol-placement"]),"symbol-spacing":new De(oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new De(oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ue(oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new De(oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new De(oe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new De(oe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new De(oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new De(oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new De(oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ue(oe.layout_symbol["icon-size"]),"icon-text-fit":new De(oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new De(oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ue(oe.layout_symbol["icon-image"]),"icon-rotate":new Ue(oe.layout_symbol["icon-rotate"]),"icon-padding":new Ue(oe.layout_symbol["icon-padding"]),"icon-keep-upright":new De(oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Ue(oe.layout_symbol["icon-offset"]),"icon-anchor":new Ue(oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new De(oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new De(oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new De(oe.layout_symbol["text-rotation-alignment"]),"text-field":new Ue(oe.layout_symbol["text-field"]),"text-font":new Ue(oe.layout_symbol["text-font"]),"text-size":new Ue(oe.layout_symbol["text-size"]),"text-max-width":new Ue(oe.layout_symbol["text-max-width"]),"text-line-height":new De(oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Ue(oe.layout_symbol["text-letter-spacing"]),"text-justify":new Ue(oe.layout_symbol["text-justify"]),"text-radial-offset":new Ue(oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new De(oe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ue(oe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ue(oe.layout_symbol["text-anchor"]),"text-max-angle":new De(oe.layout_symbol["text-max-angle"]),"text-writing-mode":new De(oe.layout_symbol["text-writing-mode"]),"text-rotate":new Ue(oe.layout_symbol["text-rotate"]),"text-padding":new De(oe.layout_symbol["text-padding"]),"text-keep-upright":new De(oe.layout_symbol["text-keep-upright"]),"text-transform":new Ue(oe.layout_symbol["text-transform"]),"text-offset":new Ue(oe.layout_symbol["text-offset"]),"text-allow-overlap":new De(oe.layout_symbol["text-allow-overlap"]),"text-overlap":new De(oe.layout_symbol["text-overlap"]),"text-ignore-placement":new De(oe.layout_symbol["text-ignore-placement"]),"text-optional":new De(oe.layout_symbol["text-optional"])})}};class qh{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Wr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Me("FormatSectionOverride",qh,{omit:["defaultValue"]});class Yl extends a{constructor(t){super(t,du)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const h of s)l.indexOf(h)<0&&l.push(h);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,s,l){const h=this.layout.get(t).evaluate(r,{},s,l),d=this._unevaluatedLayout._values[t];return d.isDataDriven()||cn(d.value)||!h?h:function(f,g){return g.replace(/{([^{}]+)}/g,(b,x)=>f&&x in f?String(f[x]):"")}(r.properties,h)}createBucket(t){return new Bn(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of du.paint.overridableProperties){if(!Yl.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),s=new qh(r),l=new ln(s,r.property.specification);let h=null;h=r.value.kind==="constant"||r.value.kind==="source"?new Ua("source",l):new ja("composite",l,r.value.zoomStops),this.paint._values[t]=new kr(r.property,h,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&Yl.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const s=t.get("text-field"),l=du.paint.properties[r];let h=!1;const d=f=>{for(const g of f)if(l.overrides&&l.overrides.hasOverride(g))return void(h=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Fi)d(s.value.value.sections);else if(s.value.kind==="source"){const f=b=>{h||(b instanceof or&&$t(b.value)===Fr?d(b.value.sections):b instanceof Ys?d(b.sections):b.eachChild(f))},g=s.value;g._styleExpression&&f(g._styleExpression.expression)}return h}}let Zh;var _f={get paint(){return Zh=Zh||new u({"background-color":new De(oe.paint_background["background-color"]),"background-pattern":new wn(oe.paint_background["background-pattern"]),"background-opacity":new De(oe.paint_background["background-opacity"])})}};class yf extends a{constructor(t){super(t,_f)}}let Gh;var bf={get paint(){return Gh=Gh||new u({"raster-opacity":new De(oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new De(oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new De(oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new De(oe.paint_raster["raster-brightness-max"]),"raster-saturation":new De(oe.paint_raster["raster-saturation"]),"raster-contrast":new De(oe.paint_raster["raster-contrast"]),"raster-resampling":new De(oe.paint_raster["raster-resampling"]),"raster-fade-duration":new De(oe.paint_raster["raster-fade-duration"])})}};class xf extends a{constructor(t){super(t,bf)}}class vf extends a{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class wf{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const pu=63710088e-1;class ss{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ss(Hi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,s=this.lat*r,l=t.lat*r,h=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((t.lng-this.lng)*r);return pu*Math.acos(Math.min(h,1))}static convert(t){if(t instanceof ss)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ss(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ss(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Hh=2*Math.PI*pu;function Wh(i){return Hh*Math.cos(i*Math.PI/180)}function Xh(i){return(180+i)/360}function Kh(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Jh(i,t){return i/Wh(t)}function fu(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Ho{constructor(t,r,s=0){this.x=+t,this.y=+r,this.z=+s}static fromLngLat(t,r=0){const s=ss.convert(t);return new Ho(Xh(s.lng),Kh(s.lat),Jh(r,s.lat))}toLngLat(){return new ss(360*this.x-180,fu(this.y))}toAltitude(){return this.z*Wh(fu(this.y))}meterInMercatorCoordinateUnits(){return 1/Hh*(t=fu(this.y),1/Math.cos(t*Math.PI/180));var t}}function Yh(i,t,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,t*s-2*Math.PI*6378137/2]}class mu{constructor(t,r,s){if(!function(l,h,d){return!(l<0||l>25||d<0||d>=Math.pow(2,l)||h<0||h>=Math.pow(2,l))}(t,r,s))throw new Error(`x=${r}, y=${s}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=s,this.key=Wo(0,t,t,r,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,s){const l=(d=this.y,f=this.z,g=Yh(256*(h=this.x),256*(d=Math.pow(2,f)-d-1),f),b=Yh(256*(h+1),256*(d+1),f),g[0]+","+g[1]+","+b[0]+","+b[1]);var h,d,f,g,b;const x=function(w,T,P){let M,z="";for(let V=w;V>0;V--)M=1<<V-1,z+=(T&M?1:0)+(P&M?2:0);return z}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,x).replace(/{bbox-epsg-3857}/g,l)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new ge((t.x*r-this.x)*qt,(t.y*r-this.y)*qt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Qh{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Wo(t,r.z,r.z,r.x,r.y)}}class mr{constructor(t,r,s,l,h){if(t<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${s}`);this.overscaledZ=t,this.wrap=r,this.canonical=new mu(s,+l,+h),this.key=Wo(r,t,s,l,h)}clone(){return new mr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new mr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new mr(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?Wo(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Wo(this.wrap*+r,t,t,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new mr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new mr(r,this.wrap,r,s,l),new mr(r,this.wrap,r,s+1,l),new mr(r,this.wrap,r,s,l+1),new mr(r,this.wrap,r,s+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new mr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new mr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Qh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ho(t.x-this.wrap,t.y))}}function Wo(i,t,r,s,l){(i*=2)<0&&(i=-1*i-1);const h=1<<r;return(h*h*i+h*l+s).toString(36)+r.toString(36)+t.toString(36)}Me("CanonicalTileID",mu),Me("OverscaledTileID",mr,{omit:["posMatrix"]});class ed{constructor(t,r,s,l=1,h=1,d=1,f=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void Gt(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const g=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=h,this.blueFactor=d,this.baseShift=f;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let b=0;b<g;b++)this.data[this._idx(-1,b)]=this.data[this._idx(0,b)],this.data[this._idx(g,b)]=this.data[this._idx(g-1,b)],this.data[this._idx(b,-1)]=this.data[this._idx(b,0)],this.data[this._idx(b,g)]=this.data[this._idx(b,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let b=0;b<g;b++)for(let x=0;x<g;x++){const w=this.get(b,x);w>this.max&&(this.max=w),w<this.min&&(this.min=w)}}get(t,r){const s=new Uint8Array(this.data.buffer),l=4*this._idx(t,r);return this.unpack(s[l],s[l+1],s[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,s){return t*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}getPixels(){return new fr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,h=r*this.dim+this.dim,d=s*this.dim,f=s*this.dim+this.dim;switch(r){case-1:l=h-1;break;case 1:h=l+1}switch(s){case-1:d=f-1;break;case 1:f=d+1}const g=-r*this.dim,b=-s*this.dim;for(let x=d;x<f;x++)for(let w=l;w<h;w++)this.data[this._idx(w,x)]=t.data[this._idx(w+g,x+b)]}}Me("DEMData",ed);class td{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const s=t[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class id{constructor(t,r,s,l,h){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=s,t._y=l,this.properties=t.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class rd{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Za(qt,16,0),this.grid3D=new Za(qt,16,0),this.featureIndexArray=new _i,this.promoteId=r}insert(t,r,s,l,h,d){const f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,h);const g=d?this.grid3D:this.grid;for(let b=0;b<r.length;b++){const x=r[b],w=[1/0,1/0,-1/0,-1/0];for(let T=0;T<x.length;T++){const P=x[T];w[0]=Math.min(w[0],P.x),w[1]=Math.min(w[1],P.y),w[2]=Math.max(w[2],P.x),w[3]=Math.max(w[3],P.y)}w[0]<qt&&w[1]<qt&&w[2]>=0&&w[3]>=0&&g.insert(f,w[0],w[1],w[2],w[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new is.VectorTile(new ru(this.rawTileData)).layers,this.sourceLayerCoder=new td(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,s,l){this.loadVTLayers();const h=t.params||{},d=qt/t.tileSize/t.scale,f=po(h.filter),g=t.queryGeometry,b=t.queryPadding*d,x=sd(g),w=this.grid.query(x.minX-b,x.minY-b,x.maxX+b,x.maxY+b),T=sd(t.cameraQueryGeometry),P=this.grid3D.query(T.minX-b,T.minY-b,T.maxX+b,T.maxY+b,(V,$,te,W)=>function(Q,le,me,Pe,Ne){for(const Se of Q)if(le<=Se.x&&me<=Se.y&&Pe>=Se.x&&Ne>=Se.y)return!0;const Ie=[new ge(le,me),new ge(le,Ne),new ge(Pe,Ne),new ge(Pe,me)];if(Q.length>2){for(const Se of Ie)if(Cn(Q,Se))return!0}for(let Se=0;Se<Q.length-1;Se++)if(tp(Q[Se],Q[Se+1],Ie))return!0;return!1}(t.cameraQueryGeometry,V-b,$-b,te+b,W+b));for(const V of P)w.push(V);w.sort(Ef);const M={};let z;for(let V=0;V<w.length;V++){const $=w[V];if($===z)continue;z=$;const te=this.featureIndexArray.get($);let W=null;this.loadMatchingFeature(M,te.bucketIndex,te.sourceLayerIndex,te.featureIndex,f,h.layers,h.availableImages,r,s,l,(Q,le,me)=>(W||(W=Fs(Q)),le.queryIntersectsFeature(g,Q,me,W,this.z,t.transform,d,t.pixelPosMatrix)))}return M}loadMatchingFeature(t,r,s,l,h,d,f,g,b,x,w){const T=this.bucketLayerIDs[r];if(d&&!function(V,$){for(let te=0;te<V.length;te++)if($.indexOf(V[te])>=0)return!0;return!1}(d,T))return;const P=this.sourceLayerCoder.decode(s),M=this.vtLayers[P].feature(l);if(h.needGeometry){const V=Os(M,!0);if(!h.filter(new St(this.tileID.overscaledZ),V,this.tileID.canonical))return}else if(!h.filter(new St(this.tileID.overscaledZ),M))return;const z=this.getId(M,P);for(let V=0;V<T.length;V++){const $=T[V];if(d&&d.indexOf($)<0)continue;const te=g[$];if(!te)continue;let W={};z&&x&&(W=x.getState(te.sourceLayer||"_geojsonTileLayer",z));const Q=ut({},b[$]);Q.paint=ad(Q.paint,te.paint,M,W,f),Q.layout=ad(Q.layout,te.layout,M,W,f);const le=!w||w(M,te,W);if(!le)continue;const me=new id(M,this.z,this.x,this.y,z);me.layer=Q;let Pe=t[$];Pe===void 0&&(Pe=t[$]=[]),Pe.push({featureIndex:l,feature:me,intersectionZ:le})}}lookupSymbolFeatures(t,r,s,l,h,d,f,g){const b={};this.loadVTLayers();const x=po(h);for(const w of t)this.loadMatchingFeature(b,s,l,w,x,d,f,g,r);return b}hasLayer(t){for(const r of this.bucketLayerIDs)for(const s of r)if(t===s)return!0;return!1}getId(t,r){let s=t.id;return this.promoteId&&(s=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function ad(i,t,r,s,l){return Qt(i,(h,d)=>{const f=t instanceof Ds?t.get(d):null;return f&&f.evaluate?f.evaluate(r,s,l):f})}function sd(i){let t=1/0,r=1/0,s=-1/0,l=-1/0;for(const h of i)t=Math.min(t,h.x),r=Math.min(r,h.y),s=Math.max(s,h.x),l=Math.max(l,h.y);return{minX:t,minY:r,maxX:s,maxY:l}}function Ef(i,t){return t-i}function nd(i,t,r,s,l){const h=[];for(let d=0;d<i.length;d++){const f=i[d];let g;for(let b=0;b<f.length-1;b++){let x=f[b],w=f[b+1];x.x<t&&w.x<t||(x.x<t?x=new ge(t,x.y+(t-x.x)/(w.x-x.x)*(w.y-x.y))._round():w.x<t&&(w=new ge(t,x.y+(t-x.x)/(w.x-x.x)*(w.y-x.y))._round()),x.y<r&&w.y<r||(x.y<r?x=new ge(x.x+(r-x.y)/(w.y-x.y)*(w.x-x.x),r)._round():w.y<r&&(w=new ge(x.x+(r-x.y)/(w.y-x.y)*(w.x-x.x),r)._round()),x.x>=s&&w.x>=s||(x.x>=s?x=new ge(s,x.y+(s-x.x)/(w.x-x.x)*(w.y-x.y))._round():w.x>=s&&(w=new ge(s,x.y+(s-x.x)/(w.x-x.x)*(w.y-x.y))._round()),x.y>=l&&w.y>=l||(x.y>=l?x=new ge(x.x+(l-x.y)/(w.y-x.y)*(w.x-x.x),l)._round():w.y>=l&&(w=new ge(x.x+(l-x.y)/(w.y-x.y)*(w.x-x.x),l)._round()),g&&x.equals(g[g.length-1])||(g=[x],h.push(g)),g.push(w)))))}}return h}Me("FeatureIndex",rd,{omit:["rawTileData","sourceLayerCoder"]});class ns extends ge{constructor(t,r,s,l){super(t,r),this.angle=s,l!==void 0&&(this.segment=l)}clone(){return new ns(this.x,this.y,this.angle,this.segment)}}function od(i,t,r,s,l){if(t.segment===void 0||r===0)return!0;let h=t,d=t.segment+1,f=0;for(;f>-r/2;){if(d--,d<0)return!1;f-=i[d].dist(h),h=i[d]}f+=i[d].dist(i[d+1]),d++;const g=[];let b=0;for(;f<r/2;){const x=i[d],w=i[d+1];if(!w)return!1;let T=i[d-1].angleTo(x)-x.angleTo(w);for(T=Math.abs((T+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:f,angleDelta:T}),b+=T;f-g[0].distance>s;)b-=g.shift().angleDelta;if(b>l)return!1;d++,f+=x.dist(w)}return!0}function ld(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function cd(i,t,r){return i?.6*t*r:0}function ud(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function Sf(i,t,r,s,l,h){const d=cd(r,l,h),f=ud(r,s)*h;let g=0;const b=ld(i)/2;for(let x=0;x<i.length-1;x++){const w=i[x],T=i[x+1],P=w.dist(T);if(g+P>b){const M=(b-g)/P,z=Si.number(w.x,T.x,M),V=Si.number(w.y,T.y,M),$=new ns(z,V,T.angleTo(w),x);return $._round(),!d||od(i,$,f,d,t)?$:void 0}g+=P}}function Tf(i,t,r,s,l,h,d,f,g){const b=cd(s,h,d),x=ud(s,l),w=x*d,T=i[0].x===0||i[0].x===g||i[0].y===0||i[0].y===g;return t-w<t/4&&(t=w+t/4),hd(i,T?t/2*f%t:(x/2+2*h)*d*f%t,t,b,r,w,T,!1,g)}function hd(i,t,r,s,l,h,d,f,g){const b=h/2,x=ld(i);let w=0,T=t-r,P=[];for(let M=0;M<i.length-1;M++){const z=i[M],V=i[M+1],$=z.dist(V),te=V.angleTo(z);for(;T+r<w+$;){T+=r;const W=(T-w)/$,Q=Si.number(z.x,V.x,W),le=Si.number(z.y,V.y,W);if(Q>=0&&Q<g&&le>=0&&le<g&&T-b>=0&&T+b<=x){const me=new ns(Q,le,te,M);me._round(),s&&!od(i,me,h,s,l)||P.push(me)}}w+=$}return f||P.length||d||(P=hd(i,w/2,r,s,l,h,d,!0,g)),P}Me("Anchor",ns);const Fn=$i;function dd(i,t,r,s){const l=[],h=i.image,d=h.pixelRatio,f=h.paddedRect.w-2*Fn,g=h.paddedRect.h-2*Fn;let b={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const x=h.stretchX||[[0,f]],w=h.stretchY||[[0,g]],T=(he,Fe)=>he+Fe[1]-Fe[0],P=x.reduce(T,0),M=w.reduce(T,0),z=f-P,V=g-M;let $=0,te=P,W=0,Q=M,le=0,me=z,Pe=0,Ne=V;if(h.content&&s){const he=h.content,Fe=he[2]-he[0],Re=he[3]-he[1];(h.textFitWidth||h.textFitHeight)&&(b=Vh(i)),$=Ql(x,0,he[0]),W=Ql(w,0,he[1]),te=Ql(x,he[0],he[2]),Q=Ql(w,he[1],he[3]),le=he[0]-$,Pe=he[1]-W,me=Fe-te,Ne=Re-Q}const Ie=b.x1,Se=b.y1,Be=b.x2-Ie,ze=b.y2-Se,Ae=(he,Fe,Re,qe)=>{const xt=ec(he.stretch-$,te,Be,Ie),bt=tc(he.fixed-le,me,he.stretch,P),Xt=ec(Fe.stretch-W,Q,ze,Se),Cr=tc(Fe.fixed-Pe,Ne,Fe.stretch,M),ui=ec(Re.stretch-$,te,Be,Ie),Kt=tc(Re.fixed-le,me,Re.stretch,P),Pi=ec(qe.stretch-W,Q,ze,Se),Ci=tc(qe.fixed-Pe,Ne,qe.stretch,M),Ai=new ge(xt,Xt),Vt=new ge(ui,Xt),Jt=new ge(ui,Pi),bi=new ge(xt,Pi),hi=new ge(bt/d,Cr/d),Mi=new ge(Kt/d,Ci/d),di=t*Math.PI/180;if(di){const ct=Math.sin(di),wt=Math.cos(di),Pt=[wt,-ct,ct,wt];Ai._matMult(Pt),Vt._matMult(Pt),bi._matMult(Pt),Jt._matMult(Pt)}const gr=he.stretch+he.fixed,qi=Fe.stretch+Fe.fixed;return{tl:Ai,tr:Vt,bl:bi,br:Jt,tex:{x:h.paddedRect.x+Fn+gr,y:h.paddedRect.y+Fn+qi,w:Re.stretch+Re.fixed-gr,h:qe.stretch+qe.fixed-qi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:hi,pixelOffsetBR:Mi,minFontScaleX:me/d/Be,minFontScaleY:Ne/d/ze,isSDF:r}};if(s&&(h.stretchX||h.stretchY)){const he=pd(x,z,P),Fe=pd(w,V,M);for(let Re=0;Re<he.length-1;Re++){const qe=he[Re],xt=he[Re+1];for(let bt=0;bt<Fe.length-1;bt++)l.push(Ae(qe,Fe[bt],xt,Fe[bt+1]))}}else l.push(Ae({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:g+1}));return l}function Ql(i,t,r){let s=0;for(const l of i)s+=Math.max(t,Math.min(r,l[1]))-Math.max(t,Math.min(r,l[0]));return s}function pd(i,t,r){const s=[{fixed:-Fn,stretch:0}];for(const[l,h]of i){const d=s[s.length-1];s.push({fixed:l-d.stretch,stretch:d.stretch}),s.push({fixed:l-d.stretch,stretch:d.stretch+(h-l)})}return s.push({fixed:t+Fn,stretch:r}),s}function ec(i,t,r,s){return i/t*r+s}function tc(i,t,r,s){return i-t*r/s}class ic{constructor(t,r,s,l,h,d,f,g,b,x){var w;if(this.boxStartIndex=t.length,b){let T=d.top,P=d.bottom;const M=d.collisionPadding;M&&(T-=M[1],P+=M[3]);let z=P-T;z>0&&(z=Math.max(10,z),this.circleDiameter=z)}else{const T=!((w=d.image)===null||w===void 0)&&w.content&&(d.image.textFitWidth||d.image.textFitHeight)?Vh(d):{x1:d.left,y1:d.top,x2:d.right,y2:d.bottom};T.y1=T.y1*f-g[0],T.y2=T.y2*f+g[2],T.x1=T.x1*f-g[3],T.x2=T.x2*f+g[1];const P=d.collisionPadding;if(P&&(T.x1-=P[0]*f,T.y1-=P[1]*f,T.x2+=P[2]*f,T.y2+=P[3]*f),x){const M=new ge(T.x1,T.y1),z=new ge(T.x2,T.y1),V=new ge(T.x1,T.y2),$=new ge(T.x2,T.y2),te=x*Math.PI/180;M._rotate(te),z._rotate(te),V._rotate(te),$._rotate(te),T.x1=Math.min(M.x,z.x,V.x,$.x),T.x2=Math.max(M.x,z.x,V.x,$.x),T.y1=Math.min(M.y,z.y,V.y,$.y),T.y2=Math.max(M.y,z.y,V.y,$.y)}t.emplaceBack(r.x,r.y,T.x1,T.y1,T.x2,T.y2,s,l,h)}this.boxEndIndex=t.length}}class If{constructor(t=[],r=(s,l)=>s<l?-1:s>l?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:s}=this,l=r[t];for(;t>0;){const h=t-1>>1,d=r[h];if(s(l,d)>=0)break;r[t]=d,t=h}r[t]=l}_down(t){const{data:r,compare:s}=this,l=this.length>>1,h=r[t];for(;t<l;){let d=1+(t<<1);const f=d+1;if(f<this.length&&s(r[f],r[d])<0&&(d=f),s(r[d],h)>=0)break;r[t]=r[d],t=d}r[t]=h}}function kf(i,t=1,r=!1){let s=1/0,l=1/0,h=-1/0,d=-1/0;const f=i[0];for(let P=0;P<f.length;P++){const M=f[P];(!P||M.x<s)&&(s=M.x),(!P||M.y<l)&&(l=M.y),(!P||M.x>h)&&(h=M.x),(!P||M.y>d)&&(d=M.y)}const g=Math.min(h-s,d-l);let b=g/2;const x=new If([],Pf);if(g===0)return new ge(s,l);for(let P=s;P<h;P+=g)for(let M=l;M<d;M+=g)x.push(new On(P+b,M+b,b,i));let w=function(P){let M=0,z=0,V=0;const $=P[0];for(let te=0,W=$.length,Q=W-1;te<W;Q=te++){const le=$[te],me=$[Q],Pe=le.x*me.y-me.x*le.y;z+=(le.x+me.x)*Pe,V+=(le.y+me.y)*Pe,M+=3*Pe}return new On(z/M,V/M,0,P)}(i),T=x.length;for(;x.length;){const P=x.pop();(P.d>w.d||!w.d)&&(w=P,r&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,T)),P.max-w.d<=t||(b=P.h/2,x.push(new On(P.p.x-b,P.p.y-b,b,i)),x.push(new On(P.p.x+b,P.p.y-b,b,i)),x.push(new On(P.p.x-b,P.p.y+b,b,i)),x.push(new On(P.p.x+b,P.p.y+b,b,i)),T+=4)}return r&&(console.log(`num probes: ${T}`),console.log(`best distance: ${w.d}`)),w.p}function Pf(i,t){return t.max-i.max}function On(i,t,r,s){this.p=new ge(i,t),this.h=r,this.d=function(l,h){let d=!1,f=1/0;for(let g=0;g<h.length;g++){const b=h[g];for(let x=0,w=b.length,T=w-1;x<w;T=x++){const P=b[x],M=b[T];P.y>l.y!=M.y>l.y&&l.x<(M.x-P.x)*(l.y-P.y)/(M.y-P.y)+P.x&&(d=!d),f=Math.min(f,Ku(l,P,M))}}return(d?1:-1)*Math.sqrt(f)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var ci;C.aq=void 0,(ci=C.aq||(C.aq={}))[ci.center=1]="center",ci[ci.left=2]="left",ci[ci.right=3]="right",ci[ci.top=4]="top",ci[ci.bottom=5]="bottom",ci[ci["top-left"]=6]="top-left",ci[ci["top-right"]=7]="top-right",ci[ci["bottom-left"]=8]="bottom-left",ci[ci["bottom-right"]=9]="bottom-right";const os=7,gu=Number.POSITIVE_INFINITY;function fd(i,t){return t[1]!==gu?function(r,s,l){let h=0,d=0;switch(s=Math.abs(s),l=Math.abs(l),r){case"top-right":case"top-left":case"top":d=l-os;break;case"bottom-right":case"bottom-left":case"bottom":d=-l+os}switch(r){case"top-right":case"bottom-right":case"right":h=-s;break;case"top-left":case"bottom-left":case"left":h=s}return[h,d]}(i,t[0],t[1]):function(r,s){let l=0,h=0;s<0&&(s=0);const d=s/Math.SQRT2;switch(r){case"top-right":case"top-left":h=d-os;break;case"bottom-right":case"bottom-left":h=-d+os;break;case"bottom":h=-s+os;break;case"top":h=s-os}switch(r){case"top-right":case"bottom-right":l=-d;break;case"top-left":case"bottom-left":l=d;break;case"left":l=s;break;case"right":l=-s}return[l,h]}(i,t[0])}function md(i,t,r){var s;const l=i.layout,h=(s=l.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(t,{},r);if(h){const f=h.values,g=[];for(let b=0;b<f.length;b+=2){const x=g[b]=f[b],w=f[b+1].map(T=>T*Zt);x.startsWith("top")?w[1]-=os:x.startsWith("bottom")&&(w[1]+=os),g[b+1]=w}return new Xi(g)}const d=l.get("text-variable-anchor");if(d){let f;f=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(t,{},r)*Zt,gu]:l.get("text-offset").evaluate(t,{},r).map(b=>b*Zt);const g=[];for(const b of d)g.push(b,fd(b,f));return new Xi(g)}return null}function _u(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Cf(i,t,r,s,l,h,d,f,g,b,x){let w=h.textMaxSize.evaluate(t,{});w===void 0&&(w=d);const T=i.layers[0].layout,P=T.get("icon-offset").evaluate(t,{},x),M=_d(r.horizontal),z=d/24,V=i.tilePixelRatio*z,$=i.tilePixelRatio*w/24,te=i.tilePixelRatio*f,W=i.tilePixelRatio*T.get("symbol-spacing"),Q=T.get("text-padding")*i.tilePixelRatio,le=function(he,Fe,Re,qe=1){const xt=he.get("icon-padding").evaluate(Fe,{},Re),bt=xt&&xt.values;return[bt[0]*qe,bt[1]*qe,bt[2]*qe,bt[3]*qe]}(T,t,x,i.tilePixelRatio),me=T.get("text-max-angle")/180*Math.PI,Pe=T.get("text-rotation-alignment")!=="viewport"&&T.get("symbol-placement")!=="point",Ne=T.get("icon-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",Ie=T.get("symbol-placement"),Se=W/2,Be=T.get("icon-text-fit");let ze;s&&Be!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(ze=Nh(s,r.vertical,Be,T.get("icon-text-fit-padding"),P,z)),M&&(s=Nh(s,M,Be,T.get("icon-text-fit-padding"),P,z)));const Ae=(he,Fe)=>{Fe.x<0||Fe.x>=qt||Fe.y<0||Fe.y>=qt||function(Re,qe,xt,bt,Xt,Cr,ui,Kt,Pi,Ci,Ai,Vt,Jt,bi,hi,Mi,di,gr,qi,ct,wt,Pt,ir,Lt,Vn){const ta=Re.addToLineVertexArray(qe,xt);let ia,Ar,_r,ai,Sa=0,Jo=0,vd=0,wd=0,Tu=-1,Iu=-1;const Ta={};let Ed=Tn("");if(Re.allowVerticalPlacement&&bt.vertical){const xi=Kt.layout.get("text-rotate").evaluate(wt,{},Lt)+90;_r=new ic(Pi,qe,Ci,Ai,Vt,bt.vertical,Jt,bi,hi,xi),ui&&(ai=new ic(Pi,qe,Ci,Ai,Vt,ui,di,gr,hi,xi))}if(Xt){const xi=Kt.layout.get("icon-rotate").evaluate(wt,{}),yr=Kt.layout.get("icon-text-fit")!=="none",Ns=dd(Xt,xi,ir,yr),jr=ui?dd(ui,xi,ir,yr):void 0;Ar=new ic(Pi,qe,Ci,Ai,Vt,Xt,di,gr,!1,xi),Sa=4*Ns.length;const Us=Re.iconSizeData;let ra=null;Us.kind==="source"?(ra=[ea*Kt.layout.get("icon-size").evaluate(wt,{})],ra[0]>as&&Gt(`${Re.layerIds[0]}: Value for "icon-size" is >= ${Go}. Reduce your "icon-size".`)):Us.kind==="composite"&&(ra=[ea*Pt.compositeIconSizes[0].evaluate(wt,{},Lt),ea*Pt.compositeIconSizes[1].evaluate(wt,{},Lt)],(ra[0]>as||ra[1]>as)&&Gt(`${Re.layerIds[0]}: Value for "icon-size" is >= ${Go}. Reduce your "icon-size".`)),Re.addSymbols(Re.icon,Ns,ra,ct,qi,wt,C.ah.none,qe,ta.lineStartIndex,ta.lineLength,-1,Lt),Tu=Re.icon.placedSymbolArray.length-1,jr&&(Jo=4*jr.length,Re.addSymbols(Re.icon,jr,ra,ct,qi,wt,C.ah.vertical,qe,ta.lineStartIndex,ta.lineLength,-1,Lt),Iu=Re.icon.placedSymbolArray.length-1)}const Sd=Object.keys(bt.horizontal);for(const xi of Sd){const yr=bt.horizontal[xi];if(!ia){Ed=Tn(yr.text);const jr=Kt.layout.get("text-rotate").evaluate(wt,{},Lt);ia=new ic(Pi,qe,Ci,Ai,Vt,yr,Jt,bi,hi,jr)}const Ns=yr.positionedLines.length===1;if(vd+=gd(Re,qe,yr,Cr,Kt,hi,wt,Mi,ta,bt.vertical?C.ah.horizontal:C.ah.horizontalOnly,Ns?Sd:[xi],Ta,Tu,Pt,Lt),Ns)break}bt.vertical&&(wd+=gd(Re,qe,bt.vertical,Cr,Kt,hi,wt,Mi,ta,C.ah.vertical,["vertical"],Ta,Iu,Pt,Lt));const zf=ia?ia.boxStartIndex:Re.collisionBoxArray.length,Df=ia?ia.boxEndIndex:Re.collisionBoxArray.length,Lf=_r?_r.boxStartIndex:Re.collisionBoxArray.length,Rf=_r?_r.boxEndIndex:Re.collisionBoxArray.length,Bf=Ar?Ar.boxStartIndex:Re.collisionBoxArray.length,Ff=Ar?Ar.boxEndIndex:Re.collisionBoxArray.length,Of=ai?ai.boxStartIndex:Re.collisionBoxArray.length,Vf=ai?ai.boxEndIndex:Re.collisionBoxArray.length;let Ur=-1;const ac=(xi,yr)=>xi&&xi.circleDiameter?Math.max(xi.circleDiameter,yr):yr;Ur=ac(ia,Ur),Ur=ac(_r,Ur),Ur=ac(Ar,Ur),Ur=ac(ai,Ur);const Td=Ur>-1?1:0;Td&&(Ur*=Vn/Zt),Re.glyphOffsetArray.length>=Bn.MAX_GLYPHS&&Gt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wt.sortKey!==void 0&&Re.addToSortKeyRanges(Re.symbolInstances.length,wt.sortKey);const Nf=md(Kt,wt,Lt),[Uf,jf]=function(xi,yr){const Ns=xi.length,jr=yr==null?void 0:yr.values;if((jr==null?void 0:jr.length)>0)for(let Us=0;Us<jr.length;Us+=2){const ra=jr[Us+1];xi.emplaceBack(C.aq[jr[Us]],ra[0],ra[1])}return[Ns,xi.length]}(Re.textAnchorOffsets,Nf);Re.symbolInstances.emplaceBack(qe.x,qe.y,Ta.right>=0?Ta.right:-1,Ta.center>=0?Ta.center:-1,Ta.left>=0?Ta.left:-1,Ta.vertical||-1,Tu,Iu,Ed,zf,Df,Lf,Rf,Bf,Ff,Of,Vf,Ci,vd,wd,Sa,Jo,Td,0,Jt,Ur,Uf,jf)}(i,Fe,he,r,s,l,ze,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,V,[Q,Q,Q,Q],Pe,g,te,le,Ne,P,t,h,b,x,d)};if(Ie==="line")for(const he of nd(t.geometry,0,0,qt,qt)){const Fe=Tf(he,W,me,r.vertical||M,s,24,$,i.overscaling,qt);for(const Re of Fe)M&&Af(i,M.text,Se,Re)||Ae(he,Re)}else if(Ie==="line-center"){for(const he of t.geometry)if(he.length>1){const Fe=Sf(he,me,r.vertical||M,s,24,$);Fe&&Ae(he,Fe)}}else if(t.type==="Polygon")for(const he of en(t.geometry,0)){const Fe=kf(he,16);Ae(he[0],new ns(Fe.x,Fe.y,0))}else if(t.type==="LineString")for(const he of t.geometry)Ae(he,new ns(he[0].x,he[0].y,0));else if(t.type==="Point")for(const he of t.geometry)for(const Fe of he)Ae([Fe],new ns(Fe.x,Fe.y,0))}function gd(i,t,r,s,l,h,d,f,g,b,x,w,T,P,M){const z=function(te,W,Q,le,me,Pe,Ne,Ie){const Se=le.layout.get("text-rotate").evaluate(Pe,{})*Math.PI/180,Be=[];for(const ze of W.positionedLines)for(const Ae of ze.positionedGlyphs){if(!Ae.rect)continue;const he=Ae.rect||{};let Fe=zh+1,Re=!0,qe=1,xt=0;const bt=(me||Ie)&&Ae.vertical,Xt=Ae.metrics.advance*Ae.scale/2;if(Ie&&W.verticalizable&&(xt=ze.lineOffset/2-(Ae.imageName?-(Zt-Ae.metrics.width*Ae.scale)/2:(Ae.scale-1)*Zt)),Ae.imageName){const ct=Ne[Ae.imageName];Re=ct.sdf,qe=ct.pixelRatio,Fe=$i/qe}const Cr=me?[Ae.x+Xt,Ae.y]:[0,0];let ui=me?[0,0]:[Ae.x+Xt+Q[0],Ae.y+Q[1]-xt],Kt=[0,0];bt&&(Kt=ui,ui=[0,0]);const Pi=Ae.metrics.isDoubleResolution?2:1,Ci=(Ae.metrics.left-Fe)*Ae.scale-Xt+ui[0],Ai=(-Ae.metrics.top-Fe)*Ae.scale+ui[1],Vt=Ci+he.w/Pi*Ae.scale/qe,Jt=Ai+he.h/Pi*Ae.scale/qe,bi=new ge(Ci,Ai),hi=new ge(Vt,Ai),Mi=new ge(Ci,Jt),di=new ge(Vt,Jt);if(bt){const ct=new ge(-Xt,Xt-qo),wt=-Math.PI/2,Pt=Zt/2-Xt,ir=new ge(5-qo-Pt,-(Ae.imageName?Pt:0)),Lt=new ge(...Kt);bi._rotateAround(wt,ct)._add(ir)._add(Lt),hi._rotateAround(wt,ct)._add(ir)._add(Lt),Mi._rotateAround(wt,ct)._add(ir)._add(Lt),di._rotateAround(wt,ct)._add(ir)._add(Lt)}if(Se){const ct=Math.sin(Se),wt=Math.cos(Se),Pt=[wt,-ct,ct,wt];bi._matMult(Pt),hi._matMult(Pt),Mi._matMult(Pt),di._matMult(Pt)}const gr=new ge(0,0),qi=new ge(0,0);Be.push({tl:bi,tr:hi,bl:Mi,br:di,tex:he,writingMode:W.writingMode,glyphOffset:Cr,sectionIndex:Ae.sectionIndex,isSDF:Re,pixelOffsetTL:gr,pixelOffsetBR:qi,minFontScaleX:0,minFontScaleY:0})}return Be}(0,r,f,l,h,d,s,i.allowVerticalPlacement),V=i.textSizeData;let $=null;V.kind==="source"?($=[ea*l.layout.get("text-size").evaluate(d,{})],$[0]>as&&Gt(`${i.layerIds[0]}: Value for "text-size" is >= ${Go}. Reduce your "text-size".`)):V.kind==="composite"&&($=[ea*P.compositeTextSizes[0].evaluate(d,{},M),ea*P.compositeTextSizes[1].evaluate(d,{},M)],($[0]>as||$[1]>as)&&Gt(`${i.layerIds[0]}: Value for "text-size" is >= ${Go}. Reduce your "text-size".`)),i.addSymbols(i.text,z,$,f,h,d,b,t,g.lineStartIndex,g.lineLength,T,M);for(const te of x)w[te]=i.text.placedSymbolArray.length-1;return 4*z.length}function _d(i){for(const t in i)return i[t];return null}function Af(i,t,r,s){const l=i.compareText;if(t in l){const h=l[t];for(let d=h.length-1;d>=0;d--)if(s.dist(h[d])<r)return!0}else l[t]=[];return l[t].push(s),!1}const yd=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class yu{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const h=yd[15&s];if(!h)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(t,2,1),[f]=new Uint32Array(t,4,1);return new yu(f,d,h,t)}constructor(t,r=64,s=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const h=yd.indexOf(this.ArrayType),d=2*t*this.ArrayType.BYTES_PER_ELEMENT,f=t*this.IndexArrayType.BYTES_PER_ELEMENT,g=(8-f%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+f+g,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+d+f+g),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+f+g,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=t,this.coords[this._pos++]=r,s}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return bu(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:d,nodeSize:f}=this,g=[0,h.length-1,0],b=[];for(;g.length;){const x=g.pop()||0,w=g.pop()||0,T=g.pop()||0;if(w-T<=f){for(let V=T;V<=w;V++){const $=d[2*V],te=d[2*V+1];$>=t&&$<=s&&te>=r&&te<=l&&b.push(h[V])}continue}const P=T+w>>1,M=d[2*P],z=d[2*P+1];M>=t&&M<=s&&z>=r&&z<=l&&b.push(h[P]),(x===0?t<=M:r<=z)&&(g.push(T),g.push(P-1),g.push(1-x)),(x===0?s>=M:l>=z)&&(g.push(P+1),g.push(w),g.push(1-x))}return b}within(t,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:h,nodeSize:d}=this,f=[0,l.length-1,0],g=[],b=s*s;for(;f.length;){const x=f.pop()||0,w=f.pop()||0,T=f.pop()||0;if(w-T<=d){for(let V=T;V<=w;V++)xd(h[2*V],h[2*V+1],t,r)<=b&&g.push(l[V]);continue}const P=T+w>>1,M=h[2*P],z=h[2*P+1];xd(M,z,t,r)<=b&&g.push(l[P]),(x===0?t-s<=M:r-s<=z)&&(f.push(T),f.push(P-1),f.push(1-x)),(x===0?t+s>=M:r+s>=z)&&(f.push(P+1),f.push(w),f.push(1-x))}return g}}function bu(i,t,r,s,l,h){if(l-s<=r)return;const d=s+l>>1;bd(i,t,d,s,l,h),bu(i,t,r,s,d-1,1-h),bu(i,t,r,d+1,l,1-h)}function bd(i,t,r,s,l,h){for(;l>s;){if(l-s>600){const b=l-s+1,x=r-s+1,w=Math.log(b),T=.5*Math.exp(2*w/3),P=.5*Math.sqrt(w*T*(b-T)/b)*(x-b/2<0?-1:1);bd(i,t,r,Math.max(s,Math.floor(r-x*T/b+P)),Math.min(l,Math.floor(r+(b-x)*T/b+P)),h)}const d=t[2*r+h];let f=s,g=l;for(Xo(i,t,s,r),t[2*l+h]>d&&Xo(i,t,s,l);f<g;){for(Xo(i,t,f,g),f++,g--;t[2*f+h]<d;)f++;for(;t[2*g+h]>d;)g--}t[2*s+h]===d?Xo(i,t,s,g):(g++,Xo(i,t,g,l)),g<=r&&(s=g+1),r<=g&&(l=g-1)}}function Xo(i,t,r,s){xu(i,r,s),xu(t,2*r,2*s),xu(t,2*r+1,2*s+1)}function xu(i,t,r){const s=i[t];i[t]=i[r],i[r]=s}function xd(i,t,r,s){const l=i-r,h=t-s;return l*l+h*h}var vu;C.bg=void 0,(vu=C.bg||(C.bg={})).create="create",vu.load="load",vu.fullLoad="fullLoad";let rc=null,Ko=[];const wu=1e3/60,Eu="loadTime",Su="fullLoadTime",Mf={mark(i){performance.mark(i)},frame(i){const t=i;rc!=null&&Ko.push(t-rc),rc=t},clearMetrics(){rc=null,Ko=[],performance.clearMeasures(Eu),performance.clearMeasures(Su);for(const i in C.bg)performance.clearMarks(C.bg[i])},getPerformanceMetrics(){performance.measure(Eu,C.bg.create,C.bg.load),performance.measure(Su,C.bg.create,C.bg.fullLoad);const i=performance.getEntriesByName(Eu)[0].duration,t=performance.getEntriesByName(Su)[0].duration,r=Ko.length,s=1/(Ko.reduce((h,d)=>h+d,0)/r/1e3),l=Ko.filter(h=>h>wu).reduce((h,d)=>h+(d-wu)/wu,0);return{loadTime:i,fullLoadTime:t,fps:s,percentDroppedFrames:l/(r+l)*100,totalFrames:r}}};C.$=class extends E{},C.A=An,C.B=zc,C.C=function(i){if(Lr==null){const t=i.navigator?i.navigator.userAgent:null;Lr=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Lr},C.D=De,C.E=ka,C.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new wf(()=>this.process()),this.subscription=function(r,s,l,h){return r.addEventListener(s,l,!1),{unsubscribe:()=>{r.removeEventListener(s,l,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=Ri(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((r,s)=>{const l=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[l]={resolve:r,reject:s},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[l];const f={id:l,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(f)},{once:!0});const h=[],d=Object.assign(Object.assign({},i),{id:l,sourceMapId:this.mapId,origin:location.origin,data:Ga(i.data,h)});this.target.postMessage(d,{transfer:h})})}receive(i){const t=i.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const s=this.abortControllers[r];return delete this.abortControllers[r],void(s&&s.abort())}if(Ri(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return p(this,void 0,void 0,function*(){if(t.type==="<response>"){const l=this.resolveRejects[i];return delete this.resolveRejects[i],l?void(t.error?l.reject(Ha(t.error)):l.resolve(Ha(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Ha(t.data),s=new AbortController;this.abortControllers[i]=s;try{const l=yield this.messageHandlers[t.type](t.sourceMapId,r,s);this.completeTask(i,null,l)}catch(l){this.completeTask(i,l)}})}completeTask(i,t,r){const s=[];delete this.abortControllers[i];const l={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Ga(t):null,data:Ga(r,s)};this.target.postMessage(l,{transfer:s})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},C.G=ar,C.H=function(){var i=new An(16);return An!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},C.I=su,C.J=function(i,t,r){var s,l,h,d,f,g,b,x,w,T,P,M,z=r[0],V=r[1],$=r[2];return t===i?(i[12]=t[0]*z+t[4]*V+t[8]*$+t[12],i[13]=t[1]*z+t[5]*V+t[9]*$+t[13],i[14]=t[2]*z+t[6]*V+t[10]*$+t[14],i[15]=t[3]*z+t[7]*V+t[11]*$+t[15]):(l=t[1],h=t[2],d=t[3],f=t[4],g=t[5],b=t[6],x=t[7],w=t[8],T=t[9],P=t[10],M=t[11],i[0]=s=t[0],i[1]=l,i[2]=h,i[3]=d,i[4]=f,i[5]=g,i[6]=b,i[7]=x,i[8]=w,i[9]=T,i[10]=P,i[11]=M,i[12]=s*z+f*V+w*$+t[12],i[13]=l*z+g*V+T*$+t[13],i[14]=h*z+b*V+P*$+t[14],i[15]=d*z+x*V+M*$+t[15]),i},C.K=function(i,t,r){var s=r[0],l=r[1],h=r[2];return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=t[3]*s,i[4]=t[4]*l,i[5]=t[5]*l,i[6]=t[6]*l,i[7]=t[7]*l,i[8]=t[8]*h,i[9]=t[9]*h,i[10]=t[10]*h,i[11]=t[11]*h,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},C.L=eh,C.M=function(i,t){const r={};for(let s=0;s<t.length;s++){const l=t[s];l in i&&(r[l]=i[l])}return r},C.N=ss,C.O=Xh,C.P=ge,C.Q=Kh,C.R=fr,C.S=mr,C.T=xn,C.U=Gi,C.V=aa,C.W=rr,C.X=qt,C.Y=m,C.Z=Ho,C._=p,C.a=ti,C.a$=function(i,t){var r=i[0],s=i[1],l=i[2],h=i[3],d=i[4],f=i[5],g=i[6],b=i[7],x=i[8],w=i[9],T=i[10],P=i[11],M=i[12],z=i[13],V=i[14],$=i[15],te=t[0],W=t[1],Q=t[2],le=t[3],me=t[4],Pe=t[5],Ne=t[6],Ie=t[7],Se=t[8],Be=t[9],ze=t[10],Ae=t[11],he=t[12],Fe=t[13],Re=t[14],qe=t[15];return Math.abs(r-te)<=ki*Math.max(1,Math.abs(r),Math.abs(te))&&Math.abs(s-W)<=ki*Math.max(1,Math.abs(s),Math.abs(W))&&Math.abs(l-Q)<=ki*Math.max(1,Math.abs(l),Math.abs(Q))&&Math.abs(h-le)<=ki*Math.max(1,Math.abs(h),Math.abs(le))&&Math.abs(d-me)<=ki*Math.max(1,Math.abs(d),Math.abs(me))&&Math.abs(f-Pe)<=ki*Math.max(1,Math.abs(f),Math.abs(Pe))&&Math.abs(g-Ne)<=ki*Math.max(1,Math.abs(g),Math.abs(Ne))&&Math.abs(b-Ie)<=ki*Math.max(1,Math.abs(b),Math.abs(Ie))&&Math.abs(x-Se)<=ki*Math.max(1,Math.abs(x),Math.abs(Se))&&Math.abs(w-Be)<=ki*Math.max(1,Math.abs(w),Math.abs(Be))&&Math.abs(T-ze)<=ki*Math.max(1,Math.abs(T),Math.abs(ze))&&Math.abs(P-Ae)<=ki*Math.max(1,Math.abs(P),Math.abs(Ae))&&Math.abs(M-he)<=ki*Math.max(1,Math.abs(M),Math.abs(he))&&Math.abs(z-Fe)<=ki*Math.max(1,Math.abs(z),Math.abs(Fe))&&Math.abs(V-Re)<=ki*Math.max(1,Math.abs(V),Math.abs(Re))&&Math.abs($-qe)<=ki*Math.max(1,Math.abs($),Math.abs(qe))},C.a0=rt,C.a1=mu,C.a2=ye,C.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const s of i){const l=window.document.createElement("source");oa(s)||(t.crossOrigin="Anonymous"),l.src=s,t.appendChild(l)}})},C.a4=function(){return Mt++},C.a5=ke,C.a6=Bn,C.a7=po,C.a8=Os,C.a9=id,C.aA=function(i){if(i.type==="custom")return new vf(i);switch(i.type){case"background":return new yf(i);case"circle":return new ap(i);case"fill":return new vp(i);case"fill-extrusion":return new Bp(i);case"heatmap":return new np(i);case"hillshade":return new lp(i);case"line":return new qp(i);case"raster":return new xf(i);case"symbol":return new Yl(i)}},C.aB=at,C.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let r=[];try{if(!ht(i.version,t.version))return[{command:"setStyle",args:[t]}];ht(i.center,t.center)||r.push({command:"setCenter",args:[t.center]}),ht(i.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),ht(i.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),ht(i.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),ht(i.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),ht(i.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),ht(i.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),ht(i.light,t.light)||r.push({command:"setLight",args:[t.light]}),ht(i.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),ht(i.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),ht(i.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const s={},l=[];(function(d,f,g,b){let x;for(x in f=f||{},d=d||{})Object.prototype.hasOwnProperty.call(d,x)&&(Object.prototype.hasOwnProperty.call(f,x)||Hr(x,g,b));for(x in f)Object.prototype.hasOwnProperty.call(f,x)&&(Object.prototype.hasOwnProperty.call(d,x)?ht(d[x],f[x])||(d[x].type==="geojson"&&f[x].type==="geojson"&&Pa(d,f,x)?zt(g,{command:"setGeoJSONSourceData",args:[x,f[x].data]}):Br(x,f,g,b)):ds(x,f,g))})(i.sources,t.sources,l,s);const h=[];i.layers&&i.layers.forEach(d=>{"source"in d&&s[d.source]?r.push({command:"removeLayer",args:[d.id]}):h.push(d)}),r=r.concat(l),function(d,f,g){f=f||[];const b=(d=d||[]).map(ps),x=f.map(ps),w=d.reduce(fs,{}),T=f.reduce(fs,{}),P=b.slice(),M=Object.create(null);let z,V,$,te,W;for(let Q=0,le=0;Q<b.length;Q++)z=b[Q],Object.prototype.hasOwnProperty.call(T,z)?le++:(zt(g,{command:"removeLayer",args:[z]}),P.splice(P.indexOf(z,le),1));for(let Q=0,le=0;Q<x.length;Q++)z=x[x.length-1-Q],P[P.length-1-Q]!==z&&(Object.prototype.hasOwnProperty.call(w,z)?(zt(g,{command:"removeLayer",args:[z]}),P.splice(P.lastIndexOf(z,P.length-le),1)):le++,te=P[P.length-Q],zt(g,{command:"addLayer",args:[T[z],te]}),P.splice(P.length-Q,0,z),M[z]=!0);for(let Q=0;Q<x.length;Q++)if(z=x[Q],V=w[z],$=T[z],!M[z]&&!ht(V,$))if(ht(V.source,$.source)&&ht(V["source-layer"],$["source-layer"])&&ht(V.type,$.type)){for(W in Wi(V.layout,$.layout,g,z,null,"setLayoutProperty"),Wi(V.paint,$.paint,g,z,null,"setPaintProperty"),ht(V.filter,$.filter)||zt(g,{command:"setFilter",args:[z,$.filter]}),ht(V.minzoom,$.minzoom)&&ht(V.maxzoom,$.maxzoom)||zt(g,{command:"setLayerZoomRange",args:[z,$.minzoom,$.maxzoom]}),V)Object.prototype.hasOwnProperty.call(V,W)&&W!=="layout"&&W!=="paint"&&W!=="filter"&&W!=="metadata"&&W!=="minzoom"&&W!=="maxzoom"&&(W.indexOf("paint.")===0?Wi(V[W],$[W],g,z,W.slice(6),"setPaintProperty"):ht(V[W],$[W])||zt(g,{command:"setLayerProperty",args:[z,W,$[W]]}));for(W in $)Object.prototype.hasOwnProperty.call($,W)&&!Object.prototype.hasOwnProperty.call(V,W)&&W!=="layout"&&W!=="paint"&&W!=="filter"&&W!=="metadata"&&W!=="minzoom"&&W!=="maxzoom"&&(W.indexOf("paint.")===0?Wi(V[W],$[W],g,z,W.slice(6),"setPaintProperty"):ht(V[W],$[W])||zt(g,{command:"setLayerProperty",args:[z,W,$[W]]}))}else zt(g,{command:"removeLayer",args:[z]}),te=P[P.lastIndexOf(z)+1],zt(g,{command:"addLayer",args:[$,te]})}(h,t.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:"setStyle",args:[t]}]}return r},C.aD=function(i){const t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},C.aE=function i(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(!i(t[s],r[s]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const s in t)if(!i(t[s],r[s]))return!1;return!0}return t===r},C.aF=Qt,C.aG=Li,C.aH=class extends Rs{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},C.aI=Vl,C.aJ=class extends Rs{constructor(i,t){super(i,t),this.current=Kd}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},C.aK=$u,C.aL=qu,C.aM=mt,C.aN=class extends Rs{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},C.aO=class extends Rs{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},C.aP=function(i,t,r,s,l,h,d){var f=1/(t-r),g=1/(s-l),b=1/(h-d);return i[0]=-2*f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*b,i[11]=0,i[12]=(t+r)*f,i[13]=(l+s)*g,i[14]=(d+h)*b,i[15]=1,i},C.aQ=rp,C.aR=class extends K{},C.aS=Wp,C.aT=class extends re{},C.aU=Hc,C.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},C.aW=sh,C.aX=oi,C.aY=pr,C.aZ=class extends Le{},C.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},C.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,l,h)=>{const d=l||h;return t[s]=!d||d.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},C.ab=function(i,t){const r=[];for(const s in i)s in t||r.push(s);return r},C.ac=Di,C.ad=function(i,t,r){var s=Math.sin(r),l=Math.cos(r),h=t[0],d=t[1],f=t[2],g=t[3],b=t[4],x=t[5],w=t[6],T=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=h*l+b*s,i[1]=d*l+x*s,i[2]=f*l+w*s,i[3]=g*l+T*s,i[4]=b*l-h*s,i[5]=x*l-d*s,i[6]=w*l-f*s,i[7]=T*l-g*s,i},C.ae=function(i){var t=new An(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},C.af=$l,C.ag=function(i,t){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:h,maxZoom:d}=i,f=l?Di(Ti.interpolationFactor(l,t,h,d),0,1):0;i.kind==="camera"?s=Si.number(i.minSize,i.maxSize,f):r=f}return{uSizeT:r,uSize:s}},C.ai=function(i,{uSize:t,uSizeT:r},{lowerSize:s,upperSize:l}){return i.kind==="source"?s/ea:i.kind==="composite"?Si.number(s/ea,l/ea,r):t},C.aj=cu,C.ak=function(i,t,r,s){const l=t.y-i.y,h=t.x-i.x,d=s.y-r.y,f=s.x-r.x,g=d*h-f*l;if(g===0)return null;const b=(f*(i.y-r.y)-d*(i.x-r.x))/g;return new ge(i.x+b*h,i.y+b*l)},C.al=nd,C.am=Wu,C.an=qc,C.ao=function(i){let t=1/0,r=1/0,s=-1/0,l=-1/0;for(const h of i)t=Math.min(t,h.x),r=Math.min(r,h.y),s=Math.max(s,h.x),l=Math.max(l,h.y);return[t,r,s,l]},C.ap=Zt,C.ar=lu,C.as=function(i,t){var r=t[0],s=t[1],l=t[2],h=t[3],d=t[4],f=t[5],g=t[6],b=t[7],x=t[8],w=t[9],T=t[10],P=t[11],M=t[12],z=t[13],V=t[14],$=t[15],te=r*f-s*d,W=r*g-l*d,Q=r*b-h*d,le=s*g-l*f,me=s*b-h*f,Pe=l*b-h*g,Ne=x*z-w*M,Ie=x*V-T*M,Se=x*$-P*M,Be=w*V-T*z,ze=w*$-P*z,Ae=T*$-P*V,he=te*Ae-W*ze+Q*Be+le*Se-me*Ie+Pe*Ne;return he?(i[0]=(f*Ae-g*ze+b*Be)*(he=1/he),i[1]=(l*ze-s*Ae-h*Be)*he,i[2]=(z*Pe-V*me+$*le)*he,i[3]=(T*me-w*Pe-P*le)*he,i[4]=(g*Se-d*Ae-b*Ie)*he,i[5]=(r*Ae-l*Se+h*Ie)*he,i[6]=(V*Q-M*Pe-$*W)*he,i[7]=(x*Pe-T*Q+P*W)*he,i[8]=(d*ze-f*Se+b*Ne)*he,i[9]=(s*Se-r*ze-h*Ne)*he,i[10]=(M*me-z*Q+$*te)*he,i[11]=(w*Q-x*me-P*te)*he,i[12]=(f*Ie-d*Be-g*Ne)*he,i[13]=(r*Be-s*Ie+l*Ne)*he,i[14]=(z*W-M*le-V*te)*he,i[15]=(x*le-w*W+T*te)*he,i):null},C.at=_u,C.au=ou,C.av=yu,C.aw=function(){const i={},t=oe.$version;for(const r in oe.$root){const s=oe.$root[r];if(s.required){let l=null;l=r==="version"?t:s.type==="array"?[]:{},l!=null&&(i[r]=l)}}return i},C.ax=ko,C.ay=sr,C.az=function(i){i=i.slice();const t=Object.create(null);for(let r=0;r<i.length;r++)t[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=hs(i[r],t[i[r].ref]));return i},C.b=Bi,C.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},C.b1=function(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i[3]=t[3]*r[3],i},C.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},C.b3=Hi,C.b4=Qh,C.b5=Jh,C.b6=function(i,t,r,s,l){var h,d=1/Math.tan(t/2);return i[0]=d/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+s)*(h=1/(s-l)),i[14]=2*l*s*h):(i[10]=-1,i[14]=-2*s),i},C.b7=function(i,t,r){var s=Math.sin(r),l=Math.cos(r),h=t[4],d=t[5],f=t[6],g=t[7],b=t[8],x=t[9],w=t[10],T=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=h*l+b*s,i[5]=d*l+x*s,i[6]=f*l+w*s,i[7]=g*l+T*s,i[8]=b*l-h*s,i[9]=x*l-d*s,i[10]=w*l-f*s,i[11]=T*l-g*s,i},C.b8=pi,C.b9=sa,C.bA=Th,C.bB=function(i){return i.message===Rt},C.bC=Na,C.bD=Ui,C.ba=function(i){return i*Math.PI/180},C.bb=function(i,t){const{x:r,y:s}=Ho.fromLngLat(t);return!(i<0||i>25||s<0||s>=1||r<0||r>=1)},C.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},C.bd=class extends v{},C.be=pu,C.bf=Mf,C.bh=Ht,C.bi=function(i,t){ti.REGISTERED_PROTOCOLS[i]=t},C.bj=function(i){delete ti.REGISTERED_PROTOCOLS[i]},C.bk=function(i,t){const r={};for(let l=0;l<i.length;l++){const h=t&&t[i[l].id]||kl(i[l]);t&&(t[i[l].id]=h);let d=r[h];d||(d=r[h]=[]),d.push(i[l])}const s=[];for(const l in r)s.push(r[l]);return s},C.bl=Me,C.bm=td,C.bn=rd,C.bo=Lh,C.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=qt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],r=t.layout,s=t._unevaluatedLayout._values,l={layoutIconSize:s["icon-size"].possiblyEvaluate(new St(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new St(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new St(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:b,maxZoom:x}=i.bucket.textSizeData;l.compositeTextSizes=[s["text-size"].possiblyEvaluate(new St(b),i.canonical),s["text-size"].possiblyEvaluate(new St(x),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:b,maxZoom:x}=i.bucket.iconSizeData;l.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new St(b),i.canonical),s["icon-size"].possiblyEvaluate(new St(x),i.canonical)]}const h=r.get("text-line-height")*Zt,d=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",f=r.get("text-keep-upright"),g=r.get("text-size");for(const b of i.bucket.features){const x=r.get("text-font").evaluate(b,{},i.canonical).join(","),w=g.evaluate(b,{},i.canonical),T=l.layoutTextSize.evaluate(b,{},i.canonical),P=l.layoutIconSize.evaluate(b,{},i.canonical),M={horizontal:{},vertical:void 0},z=b.text;let V,$=[0,0];if(z){const Q=z.toString(),le=r.get("text-letter-spacing").evaluate(b,{},i.canonical)*Zt,me=Dc(Q)?le:0,Pe=r.get("text-anchor").evaluate(b,{},i.canonical),Ne=md(t,b,i.canonical);if(!Ne){const ze=r.get("text-radial-offset").evaluate(b,{},i.canonical);$=ze?fd(Pe,[ze*Zt,gu]):r.get("text-offset").evaluate(b,{},i.canonical).map(Ae=>Ae*Zt)}let Ie=d?"center":r.get("text-justify").evaluate(b,{},i.canonical);const Se=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(b,{},i.canonical)*Zt:1/0,Be=()=>{i.bucket.allowVerticalPlacement&&Po(Q)&&(M.vertical=Xl(z,i.glyphMap,i.glyphPositions,i.imagePositions,x,Se,h,Pe,"left",me,$,C.ah.vertical,!0,T,w))};if(!d&&Ne){const ze=new Set;if(Ie==="auto")for(let he=0;he<Ne.values.length;he+=2)ze.add(_u(Ne.values[he]));else ze.add(Ie);let Ae=!1;for(const he of ze)if(!M.horizontal[he])if(Ae)M.horizontal[he]=M.horizontal[0];else{const Fe=Xl(z,i.glyphMap,i.glyphPositions,i.imagePositions,x,Se,h,"center",he,me,$,C.ah.horizontal,!1,T,w);Fe&&(M.horizontal[he]=Fe,Ae=Fe.positionedLines.length===1)}Be()}else{Ie==="auto"&&(Ie=_u(Pe));const ze=Xl(z,i.glyphMap,i.glyphPositions,i.imagePositions,x,Se,h,Pe,Ie,me,$,C.ah.horizontal,!1,T,w);ze&&(M.horizontal[Ie]=ze),Be(),Po(Q)&&d&&f&&(M.vertical=Xl(z,i.glyphMap,i.glyphPositions,i.imagePositions,x,Se,h,Pe,Ie,me,$,C.ah.vertical,!1,T,w))}}let te=!1;if(b.icon&&b.icon.name){const Q=i.imageMap[b.icon.name];Q&&(V=pf(i.imagePositions[b.icon.name],r.get("icon-offset").evaluate(b,{},i.canonical),r.get("icon-anchor").evaluate(b,{},i.canonical)),te=!!Q.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=te:i.bucket.sdfIcons!==te&&Gt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Q.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const W=_d(M.horizontal)||M.vertical;i.bucket.iconsInText=!!W&&W.iconsInText,(W||V)&&Cf(i.bucket,b,M,V,i.imageMap,l,T,P,$,te,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},C.bq=tu,C.br=Yc,C.bs=eu,C.bt=is,C.bu=ru,C.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},C.bw=function(i,t,r,s,l){return p(this,void 0,void 0,function*(){if(aa())try{return yield rr(i,t,r,s,l)}catch{}return function(h,d,f,g,b){const x=h.width,w=h.height;Et&&gt||(Et=new OffscreenCanvas(x,w),gt=Et.getContext("2d",{willReadFrequently:!0})),Et.width=x,Et.height=w,gt.drawImage(h,0,0,x,w);const T=gt.getImageData(d,f,g,b);return gt.clearRect(0,0,x,w),T.data}(i,t,r,s,l)})},C.bx=ed,C.by=Ye,C.bz=Qe,C.c=fi,C.d=i=>p(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),C.e=ut,C.f=i=>new Promise((t,r)=>{const s=new Image;s.onload=()=>{t(s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=Ia})},s.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const l=new Blob([new Uint8Array(i)],{type:"image/png"});s.src=i.byteLength?URL.createObjectURL(l):Ia}),C.g=Bt,C.h=(i,t)=>na(ut(i,{type:"json"}),t),C.i=Ri,C.j=Gr,C.k=Zr,C.l=(i,t)=>na(ut(i,{type:"arrayBuffer"}),t),C.m=na,C.n=function(i){return new ru(i).readFields(nf,[])},C.o=Fo,C.p=Dh,C.q=u,C.r=Mc,C.s=oa,C.t=To,C.u=xa,C.v=oe,C.w=Gt,C.x=function([i,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(r),y:i*Math.sin(t)*Math.sin(r),z:i*Math.cos(r)}},C.y=Si,C.z=St}),ae("worker",["./shared"],function(C){class p{constructor(k){this.keyCache={},k&&this.replace(k)}replace(k){this._layerConfigs={},this._layers={},this.update(k,[])}update(k,I){for(const N of k){this._layerConfigs[N.id]=N;const X=this._layers[N.id]=C.aA(N);X._featureFilter=C.a7(X.filter),this.keyCache[N.id]&&delete this.keyCache[N.id]}for(const N of I)delete this.keyCache[N],delete this._layerConfigs[N],delete this._layers[N];this.familiesBySource={};const D=C.bk(Object.values(this._layerConfigs),this.keyCache);for(const N of D){const X=N.map(ne=>this._layers[ne.id]),J=X[0];if(J.visibility==="none")continue;const ee=J.source||"";let G=this.familiesBySource[ee];G||(G=this.familiesBySource[ee]={});const ce=J.sourceLayer||"_geojsonTileLayer";let pe=G[ce];pe||(pe=G[ce]=[]),pe.push(X)}}}class Ye{constructor(k){const I={},D=[];for(const ee in k){const G=k[ee],ce=I[ee]={};for(const pe in G){const ne=G[+pe];if(!ne||ne.bitmap.width===0||ne.bitmap.height===0)continue;const be={x:0,y:0,w:ne.bitmap.width+2,h:ne.bitmap.height+2};D.push(be),ce[pe]={rect:be,metrics:ne.metrics}}}const{w:N,h:X}=C.p(D),J=new C.o({width:N||1,height:X||1});for(const ee in k){const G=k[ee];for(const ce in G){const pe=G[+ce];if(!pe||pe.bitmap.width===0||pe.bitmap.height===0)continue;const ne=I[ee][ce].rect;C.o.copy(pe.bitmap,J,{x:0,y:0},{x:ne.x+1,y:ne.y+1},pe.bitmap)}}this.image=J,this.positions=I}}C.bl("GlyphAtlas",Ye);class Qe{constructor(k){this.tileID=new C.S(k.tileID.overscaledZ,k.tileID.wrap,k.tileID.canonical.z,k.tileID.canonical.x,k.tileID.canonical.y),this.uid=k.uid,this.zoom=k.zoom,this.pixelRatio=k.pixelRatio,this.tileSize=k.tileSize,this.source=k.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=k.showCollisionBoxes,this.collectResourceTiming=!!k.collectResourceTiming,this.returnDependencies=!!k.returnDependencies,this.promoteId=k.promoteId,this.inFlightDependencies=[]}parse(k,I,D,N){return C._(this,void 0,void 0,function*(){this.status="parsing",this.data=k,this.collisionBoxArray=new C.a5;const X=new C.bm(Object.keys(k.layers).sort()),J=new C.bn(this.tileID,this.promoteId);J.bucketLayerIDs=[];const ee={},G={featureIndex:J,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:D},ce=I.familiesBySource[this.source];for(const Ke in ce){const ft=k.layers[Ke];if(!ft)continue;ft.version===1&&C.w(`Vector tile source "${this.source}" layer "${Ke}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ct=X.encode(Ke),Wt=[];for(let ii=0;ii<ft.length;ii++){const gi=ft.feature(ii),Ca=J.getId(gi,Ke);Wt.push({feature:gi,id:Ca,index:ii,sourceLayerIndex:Ct})}for(const ii of ce[Ke]){const gi=ii[0];gi.source!==this.source&&C.w(`layer.source = ${gi.source} does not equal this.source = ${this.source}`),gi.minzoom&&this.zoom<Math.floor(gi.minzoom)||gi.maxzoom&&this.zoom>=gi.maxzoom||gi.visibility!=="none"&&(At(ii,this.zoom,D),(ee[gi.id]=gi.createBucket({index:J.bucketLayerIDs.length,layers:ii,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ct,sourceID:this.source})).populate(Wt,G,this.tileID.canonical),J.bucketLayerIDs.push(ii.map(Ca=>Ca.id)))}}const pe=C.aF(G.glyphDependencies,Ke=>Object.keys(Ke).map(Number));this.inFlightDependencies.forEach(Ke=>Ke==null?void 0:Ke.abort()),this.inFlightDependencies=[];let ne=Promise.resolve({});if(Object.keys(pe).length){const Ke=new AbortController;this.inFlightDependencies.push(Ke),ne=N.sendAsync({type:"GG",data:{stacks:pe,source:this.source,tileID:this.tileID,type:"glyphs"}},Ke)}const be=Object.keys(G.iconDependencies);let Oe=Promise.resolve({});if(be.length){const Ke=new AbortController;this.inFlightDependencies.push(Ke),Oe=N.sendAsync({type:"GI",data:{icons:be,source:this.source,tileID:this.tileID,type:"icons"}},Ke)}const Ve=Object.keys(G.patternDependencies);let nt=Promise.resolve({});if(Ve.length){const Ke=new AbortController;this.inFlightDependencies.push(Ke),nt=N.sendAsync({type:"GI",data:{icons:Ve,source:this.source,tileID:this.tileID,type:"patterns"}},Ke)}const[He,ot,et]=yield Promise.all([ne,Oe,nt]),jt=new Ye(He),Dt=new C.bo(ot,et);for(const Ke in ee){const ft=ee[Ke];ft instanceof C.a6?(At(ft.layers,this.zoom,D),C.bp({bucket:ft,glyphMap:He,glyphPositions:jt.positions,imageMap:ot,imagePositions:Dt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ft.hasPattern&&(ft instanceof C.bq||ft instanceof C.br||ft instanceof C.bs)&&(At(ft.layers,this.zoom,D),ft.addFeatures(G,this.tileID.canonical,Dt.patternPositions))}return this.status="done",{buckets:Object.values(ee).filter(Ke=>!Ke.isEmpty()),featureIndex:J,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:jt.image,imageAtlas:Dt,glyphMap:this.returnDependencies?He:null,iconMap:this.returnDependencies?ot:null,glyphPositions:this.returnDependencies?jt.positions:null}})}}function At(j,k,I){const D=new C.z(k);for(const N of j)N.recalculate(D,I)}class ge{constructor(k,I,D){this.actor=k,this.layerIndex=I,this.availableImages=D,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(k,I){return C._(this,void 0,void 0,function*(){const D=yield C.l(k.request,I);try{return{vectorTile:new C.bt.VectorTile(new C.bu(D.data)),rawData:D.data,cacheControl:D.cacheControl,expires:D.expires}}catch(N){const X=new Uint8Array(D.data);let J=`Unable to parse the tile at ${k.request.url}, `;throw J+=X[0]===31&&X[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${N.message}`,new Error(J)}})}loadTile(k){return C._(this,void 0,void 0,function*(){const I=k.uid,D=!!(k&&k.request&&k.request.collectResourceTiming)&&new C.bv(k.request),N=new Qe(k);this.loading[I]=N;const X=new AbortController;N.abort=X;try{const J=yield this.loadVectorTile(k,X);if(delete this.loading[I],!J)return null;const ee=J.rawData,G={};J.expires&&(G.expires=J.expires),J.cacheControl&&(G.cacheControl=J.cacheControl);const ce={};if(D){const ne=D.finish();ne&&(ce.resourceTiming=JSON.parse(JSON.stringify(ne)))}N.vectorTile=J.vectorTile;const pe=N.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[I]=N,this.fetching[I]={rawTileData:ee,cacheControl:G,resourceTiming:ce};try{const ne=yield pe;return C.e({rawTileData:ee.slice(0)},ne,G,ce)}finally{delete this.fetching[I]}}catch(J){throw delete this.loading[I],N.status="done",this.loaded[I]=N,J}})}reloadTile(k){return C._(this,void 0,void 0,function*(){const I=k.uid;if(!this.loaded||!this.loaded[I])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const D=this.loaded[I];if(D.showCollisionBoxes=k.showCollisionBoxes,D.status==="parsing"){const N=yield D.parse(D.vectorTile,this.layerIndex,this.availableImages,this.actor);let X;if(this.fetching[I]){const{rawTileData:J,cacheControl:ee,resourceTiming:G}=this.fetching[I];delete this.fetching[I],X=C.e({rawTileData:J.slice(0)},N,ee,G)}else X=N;return X}if(D.status==="done"&&D.vectorTile)return D.parse(D.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(k){return C._(this,void 0,void 0,function*(){const I=this.loading,D=k.uid;I&&I[D]&&I[D].abort&&(I[D].abort.abort(),delete I[D])})}removeTile(k){return C._(this,void 0,void 0,function*(){this.loaded&&this.loaded[k.uid]&&delete this.loaded[k.uid]})}}class ue{constructor(){this.loaded={}}loadTile(k){return C._(this,void 0,void 0,function*(){const{uid:I,encoding:D,rawImageData:N,redFactor:X,greenFactor:J,blueFactor:ee,baseShift:G}=k,ce=N.width+2,pe=N.height+2,ne=C.b(N)?new C.R({width:ce,height:pe},yield C.bw(N,-1,-1,ce,pe)):N,be=new C.bx(I,ne,D,X,J,ee,G);return this.loaded=this.loaded||{},this.loaded[I]=be,be})}removeTile(k){const I=this.loaded,D=k.uid;I&&I[D]&&delete I[D]}}function Dr(j,k){if(j.length!==0){br(j[0],k);for(var I=1;I<j.length;I++)br(j[I],!k)}}function br(j,k){for(var I=0,D=0,N=0,X=j.length,J=X-1;N<X;J=N++){var ee=(j[N][0]-j[J][0])*(j[J][1]+j[N][1]),G=I+ee;D+=Math.abs(I)>=Math.abs(ee)?I-G+ee:ee-G+I,I=G}I+D>=0!=!!k&&j.reverse()}var Zi=C.by(function j(k,I){var D,N=k&&k.type;if(N==="FeatureCollection")for(D=0;D<k.features.length;D++)j(k.features[D],I);else if(N==="GeometryCollection")for(D=0;D<k.geometries.length;D++)j(k.geometries[D],I);else if(N==="Feature")j(k.geometry,I);else if(N==="Polygon")Dr(k.coordinates,I);else if(N==="MultiPolygon")for(D=0;D<k.coordinates.length;D++)Dr(k.coordinates[D],I);return k});const xr=C.bt.VectorTileFeature.prototype.toGeoJSON;var Gi={exports:{}},aa=C.bz,pi=C.bt.VectorTileFeature,sa=Di;function Di(j,k){this.options=k||{},this.features=j,this.length=j.length}function Hi(j,k){this.id=typeof j.id=="number"?j.id:void 0,this.type=j.type,this.rawGeometry=j.type===1?[j.geometry]:j.geometry,this.properties=j.tags,this.extent=k||4096}Di.prototype.feature=function(j){return new Hi(this.features[j],this.options.extent)},Hi.prototype.loadGeometry=function(){var j=this.rawGeometry;this.geometry=[];for(var k=0;k<j.length;k++){for(var I=j[k],D=[],N=0;N<I.length;N++)D.push(new aa(I[N][0],I[N][1]));this.geometry.push(D)}return this.geometry},Hi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var j=this.geometry,k=1/0,I=-1/0,D=1/0,N=-1/0,X=0;X<j.length;X++)for(var J=j[X],ee=0;ee<J.length;ee++){var G=J[ee];k=Math.min(k,G.x),I=Math.max(I,G.x),D=Math.min(D,G.y),N=Math.max(N,G.y)}return[k,D,I,N]},Hi.prototype.toGeoJSON=pi.prototype.toGeoJSON;var ut=C.bA,Mt=sa;function Qt(j){var k=new ut;return function(I,D){for(var N in I.layers)D.writeMessage(3,Li,I.layers[N])}(j,k),k.finish()}function Li(j,k){var I;k.writeVarintField(15,j.version||1),k.writeStringField(1,j.name||""),k.writeVarintField(5,j.extent||4096);var D={keys:[],values:[],keycache:{},valuecache:{}};for(I=0;I<j.length;I++)D.feature=j.feature(I),k.writeMessage(2,at,D);var N=D.keys;for(I=0;I<N.length;I++)k.writeStringField(3,N[I]);var X=D.values;for(I=0;I<X.length;I++)k.writeMessage(4,Lr,X[I])}function at(j,k){var I=j.feature;I.id!==void 0&&k.writeVarintField(1,I.id),k.writeMessage(2,wi,j),k.writeVarintField(3,I.type),k.writeMessage(4,Ri,I)}function wi(j,k){var I=j.feature,D=j.keys,N=j.values,X=j.keycache,J=j.valuecache;for(var ee in I.properties){var G=I.properties[ee],ce=X[ee];if(G!==null){ce===void 0&&(D.push(ee),X[ee]=ce=D.length-1),k.writeVarint(ce);var pe=typeof G;pe!=="string"&&pe!=="boolean"&&pe!=="number"&&(G=JSON.stringify(G));var ne=pe+":"+G,be=J[ne];be===void 0&&(N.push(G),J[ne]=be=N.length-1),k.writeVarint(be)}}}function Gt(j,k){return(k<<3)+(7&j)}function ei(j){return j<<1^j>>31}function Ri(j,k){for(var I=j.loadGeometry(),D=j.type,N=0,X=0,J=I.length,ee=0;ee<J;ee++){var G=I[ee],ce=1;D===1&&(ce=G.length),k.writeVarint(Gt(1,ce));for(var pe=D===3?G.length-1:G.length,ne=0;ne<pe;ne++){ne===1&&D!==1&&k.writeVarint(Gt(2,pe-1));var be=G[ne].x-N,Oe=G[ne].y-X;k.writeVarint(ei(be)),k.writeVarint(ei(Oe)),N+=be,X+=Oe}D===3&&k.writeVarint(Gt(7,1))}}function Lr(j,k){var I=typeof j;I==="string"?k.writeStringField(1,j):I==="boolean"?k.writeBooleanField(7,j):I==="number"&&(j%1!=0?k.writeDoubleField(3,j):j<0?k.writeSVarintField(6,j):k.writeVarintField(5,j))}Gi.exports=Qt,Gi.exports.fromVectorTileJs=Qt,Gi.exports.fromGeojsonVt=function(j,k){k=k||{};var I={};for(var D in j)I[D]=new Mt(j[D].features,k),I[D].name=D,I[D].version=k.version,I[D].extent=k.extent;return Qt({layers:I})},Gi.exports.GeoJSONWrapper=Mt;var Bi=C.by(Gi.exports);const Ia={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:j=>j},rr=Math.fround||(Et=new Float32Array(1),j=>(Et[0]=+j,Et[0]));var Et;const gt=3,Rt=5,fi=6;class ti{constructor(k){this.options=Object.assign(Object.create(Ia),k),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(k){const{log:I,minZoom:D,maxZoom:N}=this.options;I&&console.time("total time");const X=`prepare ${k.length} points`;I&&console.time(X),this.points=k;const J=[];for(let G=0;G<k.length;G++){const ce=k[G];if(!ce.geometry)continue;const[pe,ne]=ce.geometry.coordinates,be=rr(Ht(pe)),Oe=rr(sr(ne));J.push(be,Oe,1/0,G,-1,1),this.options.reduce&&J.push(0)}let ee=this.trees[N+1]=this._createTree(J);I&&console.timeEnd(X);for(let G=N;G>=D;G--){const ce=+Date.now();ee=this.trees[G]=this._createTree(this._cluster(ee,G)),I&&console.log("z%d: %d clusters in %dms",G,ee.numItems,+Date.now()-ce)}return I&&console.timeEnd("total time"),this}getClusters(k,I){let D=((k[0]+180)%360+360)%360-180;const N=Math.max(-90,Math.min(90,k[1]));let X=k[2]===180?180:((k[2]+180)%360+360)%360-180;const J=Math.max(-90,Math.min(90,k[3]));if(k[2]-k[0]>=360)D=-180,X=180;else if(D>X){const ne=this.getClusters([D,N,180,J],I),be=this.getClusters([-180,N,X,J],I);return ne.concat(be)}const ee=this.trees[this._limitZoom(I)],G=ee.range(Ht(D),sr(J),Ht(X),sr(N)),ce=ee.data,pe=[];for(const ne of G){const be=this.stride*ne;pe.push(ce[be+Rt]>1?Bt(ce,be,this.clusterProps):this.points[ce[be+gt]])}return pe}getChildren(k){const I=this._getOriginId(k),D=this._getOriginZoom(k),N="No cluster with the specified id.",X=this.trees[D];if(!X)throw new Error(N);const J=X.data;if(I*this.stride>=J.length)throw new Error(N);const ee=this.options.radius/(this.options.extent*Math.pow(2,D-1)),G=X.within(J[I*this.stride],J[I*this.stride+1],ee),ce=[];for(const pe of G){const ne=pe*this.stride;J[ne+4]===k&&ce.push(J[ne+Rt]>1?Bt(J,ne,this.clusterProps):this.points[J[ne+gt]])}if(ce.length===0)throw new Error(N);return ce}getLeaves(k,I,D){const N=[];return this._appendLeaves(N,k,I=I||10,D=D||0,0),N}getTile(k,I,D){const N=this.trees[this._limitZoom(k)],X=Math.pow(2,k),{extent:J,radius:ee}=this.options,G=ee/J,ce=(D-G)/X,pe=(D+1+G)/X,ne={features:[]};return this._addTileFeatures(N.range((I-G)/X,ce,(I+1+G)/X,pe),N.data,I,D,X,ne),I===0&&this._addTileFeatures(N.range(1-G/X,ce,1,pe),N.data,X,D,X,ne),I===X-1&&this._addTileFeatures(N.range(0,ce,G/X,pe),N.data,-1,D,X,ne),ne.features.length?ne:null}getClusterExpansionZoom(k){let I=this._getOriginZoom(k)-1;for(;I<=this.options.maxZoom;){const D=this.getChildren(k);if(I++,D.length!==1)break;k=D[0].properties.cluster_id}return I}_appendLeaves(k,I,D,N,X){const J=this.getChildren(I);for(const ee of J){const G=ee.properties;if(G&&G.cluster?X+G.point_count<=N?X+=G.point_count:X=this._appendLeaves(k,G.cluster_id,D,N,X):X<N?X++:k.push(ee),k.length===D)break}return X}_createTree(k){const I=new C.av(k.length/this.stride|0,this.options.nodeSize,Float32Array);for(let D=0;D<k.length;D+=this.stride)I.add(k[D],k[D+1]);return I.finish(),I.data=k,I}_addTileFeatures(k,I,D,N,X,J){for(const ee of k){const G=ee*this.stride,ce=I[G+Rt]>1;let pe,ne,be;if(ce)pe=ar(I,G,this.clusterProps),ne=I[G],be=I[G+1];else{const nt=this.points[I[G+gt]];pe=nt.properties;const[He,ot]=nt.geometry.coordinates;ne=Ht(He),be=sr(ot)}const Oe={type:1,geometry:[[Math.round(this.options.extent*(ne*X-D)),Math.round(this.options.extent*(be*X-N))]],tags:pe};let Ve;Ve=ce||this.options.generateId?I[G+gt]:this.points[I[G+gt]].id,Ve!==void 0&&(Oe.id=Ve),J.features.push(Oe)}}_limitZoom(k){return Math.max(this.options.minZoom,Math.min(Math.floor(+k),this.options.maxZoom+1))}_cluster(k,I){const{radius:D,extent:N,reduce:X,minPoints:J}=this.options,ee=D/(N*Math.pow(2,I)),G=k.data,ce=[],pe=this.stride;for(let ne=0;ne<G.length;ne+=pe){if(G[ne+2]<=I)continue;G[ne+2]=I;const be=G[ne],Oe=G[ne+1],Ve=k.within(G[ne],G[ne+1],ee),nt=G[ne+Rt];let He=nt;for(const ot of Ve){const et=ot*pe;G[et+2]>I&&(He+=G[et+Rt])}if(He>nt&&He>=J){let ot,et=be*nt,jt=Oe*nt,Dt=-1;const Ke=((ne/pe|0)<<5)+(I+1)+this.points.length;for(const ft of Ve){const Ct=ft*pe;if(G[Ct+2]<=I)continue;G[Ct+2]=I;const Wt=G[Ct+Rt];et+=G[Ct]*Wt,jt+=G[Ct+1]*Wt,G[Ct+4]=Ke,X&&(ot||(ot=this._map(G,ne,!0),Dt=this.clusterProps.length,this.clusterProps.push(ot)),X(ot,this._map(G,Ct)))}G[ne+4]=Ke,ce.push(et/He,jt/He,1/0,Ke,-1,He),X&&ce.push(Dt)}else{for(let ot=0;ot<pe;ot++)ce.push(G[ne+ot]);if(He>1)for(const ot of Ve){const et=ot*pe;if(!(G[et+2]<=I)){G[et+2]=I;for(let jt=0;jt<pe;jt++)ce.push(G[et+jt])}}}}return ce}_getOriginId(k){return k-this.points.length>>5}_getOriginZoom(k){return(k-this.points.length)%32}_map(k,I,D){if(k[I+Rt]>1){const J=this.clusterProps[k[I+fi]];return D?Object.assign({},J):J}const N=this.points[k[I+gt]].properties,X=this.options.map(N);return D&&X===N?Object.assign({},X):X}}function Bt(j,k,I){return{type:"Feature",id:j[k+gt],properties:ar(j,k,I),geometry:{type:"Point",coordinates:[(D=j[k],360*(D-.5)),na(j[k+1])]}};var D}function ar(j,k,I){const D=j[k+Rt],N=D>=1e4?`${Math.round(D/1e3)}k`:D>=1e3?Math.round(D/100)/10+"k":D,X=j[k+fi],J=X===-1?{}:Object.assign({},I[X]);return Object.assign(J,{cluster:!0,cluster_id:j[k+gt],point_count:D,point_count_abbreviated:N})}function Ht(j){return j/360+.5}function sr(j){const k=Math.sin(j*Math.PI/180),I=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return I<0?0:I>1?1:I}function na(j){const k=(180-360*j)*Math.PI/180;return 360*Math.atan(Math.exp(k))/Math.PI-90}function oa(j,k,I,D){let N=D;const X=k+(I-k>>1);let J,ee=I-k;const G=j[k],ce=j[k+1],pe=j[I],ne=j[I+1];for(let be=k+3;be<I;be+=3){const Oe=us(j[be],j[be+1],G,ce,pe,ne);if(Oe>N)J=be,N=Oe;else if(Oe===N){const Ve=Math.abs(be-X);Ve<ee&&(J=be,ee=Ve)}}N>D&&(J-k>3&&oa(j,k,J,D),j[J+2]=N,I-J>3&&oa(j,J,I,D))}function us(j,k,I,D,N,X){let J=N-I,ee=X-D;if(J!==0||ee!==0){const G=((j-I)*J+(k-D)*ee)/(J*J+ee*ee);G>1?(I=N,D=X):G>0&&(I+=J*G,D+=ee*G)}return J=j-I,ee=k-D,J*J+ee*ee}function Rr(j,k,I,D){const N={id:j??null,type:k,geometry:I,tags:D,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(k==="Point"||k==="MultiPoint"||k==="LineString")Zr(N,I);else if(k==="Polygon")Zr(N,I[0]);else if(k==="MultiLineString")for(const X of I)Zr(N,X);else if(k==="MultiPolygon")for(const X of I)Zr(N,X[0]);return N}function Zr(j,k){for(let I=0;I<k.length;I+=3)j.minX=Math.min(j.minX,k[I]),j.minY=Math.min(j.minY,k[I+1]),j.maxX=Math.max(j.maxX,k[I]),j.maxY=Math.max(j.maxY,k[I+1])}function Gr(j,k,I,D){if(!k.geometry)return;const N=k.geometry.coordinates;if(N&&N.length===0)return;const X=k.geometry.type,J=Math.pow(I.tolerance/((1<<I.maxZoom)*I.extent),2);let ee=[],G=k.id;if(I.promoteId?G=k.properties[I.promoteId]:I.generateId&&(G=D||0),X==="Point")ka(N,ee);else if(X==="MultiPoint")for(const ce of N)ka(ce,ee);else if(X==="LineString")oe(N,ee,J,!1);else if(X==="MultiLineString"){if(I.lineMetrics){for(const ce of N)ee=[],oe(ce,ee,J,!1),j.push(Rr(G,"LineString",ee,k.properties));return}la(N,ee,J,!1)}else if(X==="Polygon")la(N,ee,J,!0);else{if(X!=="MultiPolygon"){if(X==="GeometryCollection"){for(const ce of k.geometry.geometries)Gr(j,{id:G,geometry:ce,properties:k.properties},I,D);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ce of N){const pe=[];la(ce,pe,J,!0),ee.push(pe)}}j.push(Rr(G,X,ee,k.properties))}function ka(j,k){k.push(hs(j[0]),ht(j[1]),0)}function oe(j,k,I,D){let N,X,J=0;for(let G=0;G<j.length;G++){const ce=hs(j[G][0]),pe=ht(j[G][1]);k.push(ce,pe,0),G>0&&(J+=D?(N*pe-ce*X)/2:Math.sqrt(Math.pow(ce-N,2)+Math.pow(pe-X,2))),N=ce,X=pe}const ee=k.length-3;k[2]=1,oa(k,0,ee,I),k[ee+2]=1,k.size=Math.abs(J),k.start=0,k.end=k.size}function la(j,k,I,D){for(let N=0;N<j.length;N++){const X=[];oe(j[N],X,I,D),k.push(X)}}function hs(j){return j/360+.5}function ht(j){const k=Math.sin(j*Math.PI/180),I=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return I<0?0:I>1?1:I}function zt(j,k,I,D,N,X,J,ee){if(D/=k,X>=(I/=k)&&J<D)return j;if(J<I||X>=D)return null;const G=[];for(const ce of j){const pe=ce.geometry;let ne=ce.type;const be=N===0?ce.minX:ce.minY,Oe=N===0?ce.maxX:ce.maxY;if(be>=I&&Oe<D){G.push(ce);continue}if(Oe<I||be>=D)continue;let Ve=[];if(ne==="Point"||ne==="MultiPoint")ds(pe,Ve,I,D,N);else if(ne==="LineString")Hr(pe,Ve,I,D,N,!1,ee.lineMetrics);else if(ne==="MultiLineString")Pa(pe,Ve,I,D,N,!1);else if(ne==="Polygon")Pa(pe,Ve,I,D,N,!0);else if(ne==="MultiPolygon")for(const nt of pe){const He=[];Pa(nt,He,I,D,N,!0),He.length&&Ve.push(He)}if(Ve.length){if(ee.lineMetrics&&ne==="LineString"){for(const nt of Ve)G.push(Rr(ce.id,ne,nt,ce.tags));continue}ne!=="LineString"&&ne!=="MultiLineString"||(Ve.length===1?(ne="LineString",Ve=Ve[0]):ne="MultiLineString"),ne!=="Point"&&ne!=="MultiPoint"||(ne=Ve.length===3?"Point":"MultiPoint"),G.push(Rr(ce.id,ne,Ve,ce.tags))}}return G.length?G:null}function ds(j,k,I,D,N){for(let X=0;X<j.length;X+=3){const J=j[X+N];J>=I&&J<=D&&Wi(k,j[X],j[X+1],j[X+2])}}function Hr(j,k,I,D,N,X,J){let ee=Br(j);const G=N===0?ps:fs;let ce,pe,ne=j.start;for(let He=0;He<j.length-3;He+=3){const ot=j[He],et=j[He+1],jt=j[He+2],Dt=j[He+3],Ke=j[He+4],ft=N===0?ot:et,Ct=N===0?Dt:Ke;let Wt=!1;J&&(ce=Math.sqrt(Math.pow(ot-Dt,2)+Math.pow(et-Ke,2))),ft<I?Ct>I&&(pe=G(ee,ot,et,Dt,Ke,I),J&&(ee.start=ne+ce*pe)):ft>D?Ct<D&&(pe=G(ee,ot,et,Dt,Ke,D),J&&(ee.start=ne+ce*pe)):Wi(ee,ot,et,jt),Ct<I&&ft>=I&&(pe=G(ee,ot,et,Dt,Ke,I),Wt=!0),Ct>D&&ft<=D&&(pe=G(ee,ot,et,Dt,Ke,D),Wt=!0),!X&&Wt&&(J&&(ee.end=ne+ce*pe),k.push(ee),ee=Br(j)),J&&(ne+=ce)}let be=j.length-3;const Oe=j[be],Ve=j[be+1],nt=N===0?Oe:Ve;nt>=I&&nt<=D&&Wi(ee,Oe,Ve,j[be+2]),be=ee.length-3,X&&be>=3&&(ee[be]!==ee[0]||ee[be+1]!==ee[1])&&Wi(ee,ee[0],ee[1],ee[2]),ee.length&&k.push(ee)}function Br(j){const k=[];return k.size=j.size,k.start=j.start,k.end=j.end,k}function Pa(j,k,I,D,N,X){for(const J of j)Hr(J,k,I,D,N,X,!1)}function Wi(j,k,I,D){j.push(k,I,D)}function ps(j,k,I,D,N,X){const J=(X-k)/(D-k);return Wi(j,X,I+(N-I)*J,1),J}function fs(j,k,I,D,N,X){const J=(X-I)/(N-I);return Wi(j,k+(D-k)*J,X,1),J}function ye(j,k){const I=[];for(let D=0;D<j.length;D++){const N=j[D],X=N.type;let J;if(X==="Point"||X==="MultiPoint"||X==="LineString")J=vr(N.geometry,k);else if(X==="MultiLineString"||X==="Polygon"){J=[];for(const ee of N.geometry)J.push(vr(ee,k))}else if(X==="MultiPolygon"){J=[];for(const ee of N.geometry){const G=[];for(const ce of ee)G.push(vr(ce,k));J.push(G)}}I.push(Rr(N.id,X,J,N.tags))}return I}function vr(j,k){const I=[];I.size=j.size,j.start!==void 0&&(I.start=j.start,I.end=j.end);for(let D=0;D<j.length;D+=3)I.push(j[D]+k,j[D+1],j[D+2]);return I}function mi(j,k){if(j.transformed)return j;const I=1<<j.z,D=j.x,N=j.y;for(const X of j.features){const J=X.geometry,ee=X.type;if(X.geometry=[],ee===1)for(let G=0;G<J.length;G+=2)X.geometry.push(wr(J[G],J[G+1],k,I,D,N));else for(let G=0;G<J.length;G++){const ce=[];for(let pe=0;pe<J[G].length;pe+=2)ce.push(wr(J[G][pe],J[G][pe+1],k,I,D,N));X.geometry.push(ce)}}return j.transformed=!0,j}function wr(j,k,I,D,N,X){return[Math.round(I*(j*D-N)),Math.round(I*(k*D-X))]}function Wr(j,k,I,D,N){const X=k===N.maxZoom?0:N.tolerance/((1<<k)*N.extent),J={features:[],numPoints:0,numSimplified:0,numFeatures:j.length,source:null,x:I,y:D,z:k,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ee of j)we(J,ee,X,N);return J}function we(j,k,I,D){const N=k.geometry,X=k.type,J=[];if(j.minX=Math.min(j.minX,k.minX),j.minY=Math.min(j.minY,k.minY),j.maxX=Math.max(j.maxX,k.maxX),j.maxY=Math.max(j.maxY,k.maxY),X==="Point"||X==="MultiPoint")for(let ee=0;ee<N.length;ee+=3)J.push(N[ee],N[ee+1]),j.numPoints++,j.numSimplified++;else if(X==="LineString")Xe(J,N,j,I,!1,!1);else if(X==="MultiLineString"||X==="Polygon")for(let ee=0;ee<N.length;ee++)Xe(J,N[ee],j,I,X==="Polygon",ee===0);else if(X==="MultiPolygon")for(let ee=0;ee<N.length;ee++){const G=N[ee];for(let ce=0;ce<G.length;ce++)Xe(J,G[ce],j,I,!0,ce===0)}if(J.length){let ee=k.tags||null;if(X==="LineString"&&D.lineMetrics){ee={};for(const ce in k.tags)ee[ce]=k.tags[ce];ee.mapbox_clip_start=N.start/N.size,ee.mapbox_clip_end=N.end/N.size}const G={geometry:J,type:X==="Polygon"||X==="MultiPolygon"?3:X==="LineString"||X==="MultiLineString"?2:1,tags:ee};k.id!==null&&(G.id=k.id),j.features.push(G)}}function Xe(j,k,I,D,N,X){const J=D*D;if(D>0&&k.size<(N?J:D))return void(I.numPoints+=k.length/3);const ee=[];for(let G=0;G<k.length;G+=3)(D===0||k[G+2]>J)&&(I.numSimplified++,ee.push(k[G],k[G+1])),I.numPoints++;N&&function(G,ce){let pe=0;for(let ne=0,be=G.length,Oe=be-2;ne<be;Oe=ne,ne+=2)pe+=(G[ne]-G[Oe])*(G[ne+1]+G[Oe+1]);if(pe>0===ce)for(let ne=0,be=G.length;ne<be/2;ne+=2){const Oe=G[ne],Ve=G[ne+1];G[ne]=G[be-2-ne],G[ne+1]=G[be-1-ne],G[be-2-ne]=Oe,G[be-1-ne]=Ve}}(ee,X),j.push(ee)}const je={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ei{constructor(k,I){const D=(I=this.options=function(X,J){for(const ee in J)X[ee]=J[ee];return X}(Object.create(je),I)).debug;if(D&&console.time("preprocess data"),I.maxZoom<0||I.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(I.promoteId&&I.generateId)throw new Error("promoteId and generateId cannot be used together.");let N=function(X,J){const ee=[];if(X.type==="FeatureCollection")for(let G=0;G<X.features.length;G++)Gr(ee,X.features[G],J,G);else Gr(ee,X.type==="Feature"?X:{geometry:X},J);return ee}(k,I);this.tiles={},this.tileCoords=[],D&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",I.indexMaxZoom,I.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),N=function(X,J){const ee=J.buffer/J.extent;let G=X;const ce=zt(X,1,-1-ee,ee,0,-1,2,J),pe=zt(X,1,1-ee,2+ee,0,-1,2,J);return(ce||pe)&&(G=zt(X,1,-ee,1+ee,0,-1,2,J)||[],ce&&(G=ye(ce,1).concat(G)),pe&&(G=G.concat(ye(pe,-1)))),G}(N,I),N.length&&this.splitTile(N,0,0,0),D&&(N.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(k,I,D,N,X,J,ee){const G=[k,I,D,N],ce=this.options,pe=ce.debug;for(;G.length;){N=G.pop(),D=G.pop(),I=G.pop(),k=G.pop();const ne=1<<I,be=nr(I,D,N);let Oe=this.tiles[be];if(!Oe&&(pe>1&&console.time("creation"),Oe=this.tiles[be]=Wr(k,I,D,N,ce),this.tileCoords.push({z:I,x:D,y:N}),pe)){pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",I,D,N,Oe.numFeatures,Oe.numPoints,Oe.numSimplified),console.timeEnd("creation"));const Wt=`z${I}`;this.stats[Wt]=(this.stats[Wt]||0)+1,this.total++}if(Oe.source=k,X==null){if(I===ce.indexMaxZoom||Oe.numPoints<=ce.indexMaxPoints)continue}else{if(I===ce.maxZoom||I===X)continue;if(X!=null){const Wt=X-I;if(D!==J>>Wt||N!==ee>>Wt)continue}}if(Oe.source=null,k.length===0)continue;pe>1&&console.time("clipping");const Ve=.5*ce.buffer/ce.extent,nt=.5-Ve,He=.5+Ve,ot=1+Ve;let et=null,jt=null,Dt=null,Ke=null,ft=zt(k,ne,D-Ve,D+He,0,Oe.minX,Oe.maxX,ce),Ct=zt(k,ne,D+nt,D+ot,0,Oe.minX,Oe.maxX,ce);k=null,ft&&(et=zt(ft,ne,N-Ve,N+He,1,Oe.minY,Oe.maxY,ce),jt=zt(ft,ne,N+nt,N+ot,1,Oe.minY,Oe.maxY,ce),ft=null),Ct&&(Dt=zt(Ct,ne,N-Ve,N+He,1,Oe.minY,Oe.maxY,ce),Ke=zt(Ct,ne,N+nt,N+ot,1,Oe.minY,Oe.maxY,ce),Ct=null),pe>1&&console.timeEnd("clipping"),G.push(et||[],I+1,2*D,2*N),G.push(jt||[],I+1,2*D,2*N+1),G.push(Dt||[],I+1,2*D+1,2*N),G.push(Ke||[],I+1,2*D+1,2*N+1)}}getTile(k,I,D){k=+k,I=+I,D=+D;const N=this.options,{extent:X,debug:J}=N;if(k<0||k>24)return null;const ee=1<<k,G=nr(k,I=I+ee&ee-1,D);if(this.tiles[G])return mi(this.tiles[G],X);J>1&&console.log("drilling down to z%d-%d-%d",k,I,D);let ce,pe=k,ne=I,be=D;for(;!ce&&pe>0;)pe--,ne>>=1,be>>=1,ce=this.tiles[nr(pe,ne,be)];return ce&&ce.source?(J>1&&(console.log("found parent tile z%d-%d-%d",pe,ne,be),console.time("drilling down")),this.splitTile(ce.source,pe,ne,be,k,I,D),J>1&&console.timeEnd("drilling down"),this.tiles[G]?mi(this.tiles[G],X):null):null}}function nr(j,k,I){return 32*((1<<j)*I+k)+j}function Ge(j,k){return k?j.properties[k]:j.id}function Er(j,k){if(j==null)return!0;if(j.type==="Feature")return Ge(j,k)!=null;if(j.type==="FeatureCollection"){const I=new Set;for(const D of j.features){const N=Ge(D,k);if(N==null||I.has(N))return!1;I.add(N)}return!0}return!1}function Fr(j,k){const I=new Map;if(j!=null)if(j.type==="Feature")I.set(Ge(j,k),j);else for(const D of j.features)I.set(Ge(D,k),D);return I}class Xr extends ge{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(k,I){return C._(this,void 0,void 0,function*(){const D=k.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const N=this._geoJSONIndex.getTile(D.z,D.x,D.y);if(!N)return null;const X=new class{constructor(ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=C.X,this.length=ee.length,this._features=ee}feature(ee){return new class{constructor(G){this._feature=G,this.extent=C.X,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))}loadGeometry(){if(this._feature.type===1){const G=[];for(const ce of this._feature.geometry)G.push([new C.P(ce[0],ce[1])]);return G}{const G=[];for(const ce of this._feature.geometry){const pe=[];for(const ne of ce)pe.push(new C.P(ne[0],ne[1]));G.push(pe)}return G}}toGeoJSON(G,ce,pe){return xr.call(this,G,ce,pe)}}(this._features[ee])}}(N.features);let J=Bi(X);return J.byteOffset===0&&J.byteLength===J.buffer.byteLength||(J=new Uint8Array(J)),{vectorTile:X,rawData:J.buffer}})}loadData(k){return C._(this,void 0,void 0,function*(){var I;(I=this._pendingRequest)===null||I===void 0||I.abort();const D=!!(k&&k.request&&k.request.collectResourceTiming)&&new C.bv(k.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(k,this._pendingRequest),this._geoJSONIndex=k.cluster?new ti(function({superclusterOptions:J,clusterProperties:ee}){if(!ee||!J)return J;const G={},ce={},pe={accumulated:null,zoom:0},ne={properties:null},be=Object.keys(ee);for(const Oe of be){const[Ve,nt]=ee[Oe],He=C.bC(nt),ot=C.bC(typeof Ve=="string"?[Ve,["accumulated"],["get",Oe]]:Ve);G[Oe]=He.value,ce[Oe]=ot.value}return J.map=Oe=>{ne.properties=Oe;const Ve={};for(const nt of be)Ve[nt]=G[nt].evaluate(pe,ne);return Ve},J.reduce=(Oe,Ve)=>{ne.properties=Ve;for(const nt of be)pe.accumulated=Oe[nt],Oe[nt]=ce[nt].evaluate(pe,ne)},J}(k)).load((yield this._pendingData).features):(N=yield this._pendingData,new Ei(N,k.geojsonVtOptions)),this.loaded={};const X={};if(D){const J=D.finish();J&&(X.resourceTiming={},X.resourceTiming[k.source]=JSON.parse(JSON.stringify(J)))}return X}catch(X){if(delete this._pendingRequest,C.bB(X))return{abandoned:!0};throw X}var N})}getData(){return C._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(k){const I=this.loaded;return I&&I[k.uid]?super.reloadTile(k):this.loadTile(k)}loadAndProcessGeoJSON(k,I){return C._(this,void 0,void 0,function*(){let D=yield this.loadGeoJSON(k,I);if(delete this._pendingRequest,typeof D!="object")throw new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`);if(Zi(D,!0),k.filter){const N=C.bC(k.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(N.result==="error")throw new Error(N.value.map(J=>`${J.key}: ${J.message}`).join(", "));D={type:"FeatureCollection",features:D.features.filter(J=>N.value.evaluate({zoom:0},J))}}return D})}loadGeoJSON(k,I){return C._(this,void 0,void 0,function*(){const{promoteId:D}=k;if(k.request){const N=yield C.h(k.request,I);return this._dataUpdateable=Er(N.data,D)?Fr(N.data,D):void 0,N.data}if(typeof k.data=="string")try{const N=JSON.parse(k.data);return this._dataUpdateable=Er(N,D)?Fr(N,D):void 0,N}catch{throw new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`)}if(!k.dataDiff)throw new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${k.source}`);return function(N,X,J){var ee,G,ce,pe;if(X.removeAll&&N.clear(),X.remove)for(const ne of X.remove)N.delete(ne);if(X.add)for(const ne of X.add){const be=Ge(ne,J);be!=null&&N.set(be,ne)}if(X.update)for(const ne of X.update){let be=N.get(ne.id);if(be==null)continue;const Oe=!ne.removeAllProperties&&(((ee=ne.removeProperties)===null||ee===void 0?void 0:ee.length)>0||((G=ne.addOrUpdateProperties)===null||G===void 0?void 0:G.length)>0);if((ne.newGeometry||ne.removeAllProperties||Oe)&&(be=Object.assign({},be),N.set(ne.id,be),Oe&&(be.properties=Object.assign({},be.properties))),ne.newGeometry&&(be.geometry=ne.newGeometry),ne.removeAllProperties)be.properties={};else if(((ce=ne.removeProperties)===null||ce===void 0?void 0:ce.length)>0)for(const Ve of ne.removeProperties)Object.prototype.hasOwnProperty.call(be.properties,Ve)&&delete be.properties[Ve];if(((pe=ne.addOrUpdateProperties)===null||pe===void 0?void 0:pe.length)>0)for(const{key:Ve,value:nt}of ne.addOrUpdateProperties)be.properties[Ve]=nt}}(this._dataUpdateable,k.dataDiff,D),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(k){return C._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(k){return this._geoJSONIndex.getClusterExpansionZoom(k.clusterId)}getClusterChildren(k){return this._geoJSONIndex.getChildren(k.clusterId)}getClusterLeaves(k){return this._geoJSONIndex.getLeaves(k.clusterId,k.limit,k.offset)}}class Sr{constructor(k){this.self=k,this.actor=new C.F(k),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(I,D)=>{if(this.externalWorkerSourceTypes[I])throw new Error(`Worker source with name "${I}" already registered.`);this.externalWorkerSourceTypes[I]=D},this.self.addProtocol=C.bi,this.self.removeProtocol=C.bj,this.self.registerRTLTextPlugin=I=>{if(C.bD.isParsed())throw new Error("RTL text plugin already registered.");C.bD.setMethods(I)},this.actor.registerMessageHandler("LDT",(I,D)=>this._getDEMWorkerSource(I,D.source).loadTile(D)),this.actor.registerMessageHandler("RDT",(I,D)=>C._(this,void 0,void 0,function*(){this._getDEMWorkerSource(I,D.source).removeTile(D)})),this.actor.registerMessageHandler("GCEZ",(I,D)=>C._(this,void 0,void 0,function*(){return this._getWorkerSource(I,D.type,D.source).getClusterExpansionZoom(D)})),this.actor.registerMessageHandler("GCC",(I,D)=>C._(this,void 0,void 0,function*(){return this._getWorkerSource(I,D.type,D.source).getClusterChildren(D)})),this.actor.registerMessageHandler("GCL",(I,D)=>C._(this,void 0,void 0,function*(){return this._getWorkerSource(I,D.type,D.source).getClusterLeaves(D)})),this.actor.registerMessageHandler("LD",(I,D)=>this._getWorkerSource(I,D.type,D.source).loadData(D)),this.actor.registerMessageHandler("GD",(I,D)=>this._getWorkerSource(I,D.type,D.source).getData()),this.actor.registerMessageHandler("LT",(I,D)=>this._getWorkerSource(I,D.type,D.source).loadTile(D)),this.actor.registerMessageHandler("RT",(I,D)=>this._getWorkerSource(I,D.type,D.source).reloadTile(D)),this.actor.registerMessageHandler("AT",(I,D)=>this._getWorkerSource(I,D.type,D.source).abortTile(D)),this.actor.registerMessageHandler("RMT",(I,D)=>this._getWorkerSource(I,D.type,D.source).removeTile(D)),this.actor.registerMessageHandler("RS",(I,D)=>C._(this,void 0,void 0,function*(){if(!this.workerSources[I]||!this.workerSources[I][D.type]||!this.workerSources[I][D.type][D.source])return;const N=this.workerSources[I][D.type][D.source];delete this.workerSources[I][D.type][D.source],N.removeSource!==void 0&&N.removeSource(D)})),this.actor.registerMessageHandler("RM",I=>C._(this,void 0,void 0,function*(){delete this.layerIndexes[I],delete this.availableImages[I],delete this.workerSources[I],delete this.demWorkerSources[I]})),this.actor.registerMessageHandler("SR",(I,D)=>C._(this,void 0,void 0,function*(){this.referrer=D})),this.actor.registerMessageHandler("SRPS",(I,D)=>this._syncRTLPluginState(I,D)),this.actor.registerMessageHandler("IS",(I,D)=>C._(this,void 0,void 0,function*(){this.self.importScripts(D)})),this.actor.registerMessageHandler("SI",(I,D)=>this._setImages(I,D)),this.actor.registerMessageHandler("UL",(I,D)=>C._(this,void 0,void 0,function*(){this._getLayerIndex(I).update(D.layers,D.removedIds)})),this.actor.registerMessageHandler("SL",(I,D)=>C._(this,void 0,void 0,function*(){this._getLayerIndex(I).replace(D)}))}_setImages(k,I){return C._(this,void 0,void 0,function*(){this.availableImages[k]=I;for(const D in this.workerSources[k]){const N=this.workerSources[k][D];for(const X in N)N[X].availableImages=I}})}_syncRTLPluginState(k,I){return C._(this,void 0,void 0,function*(){if(C.bD.isParsed())return C.bD.getState();if(I.pluginStatus!=="loading")return C.bD.setState(I),I;const D=I.pluginURL;if(this.self.importScripts(D),C.bD.isParsed()){const N={pluginStatus:"loaded",pluginURL:D};return C.bD.setState(N),N}throw C.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${D}`)})}_getAvailableImages(k){let I=this.availableImages[k];return I||(I=[]),I}_getLayerIndex(k){let I=this.layerIndexes[k];return I||(I=this.layerIndexes[k]=new p),I}_getWorkerSource(k,I,D){if(this.workerSources[k]||(this.workerSources[k]={}),this.workerSources[k][I]||(this.workerSources[k][I]={}),!this.workerSources[k][I][D]){const N={sendAsync:(X,J)=>(X.targetMapId=k,this.actor.sendAsync(X,J))};switch(I){case"vector":this.workerSources[k][I][D]=new ge(N,this._getLayerIndex(k),this._getAvailableImages(k));break;case"geojson":this.workerSources[k][I][D]=new Xr(N,this._getLayerIndex(k),this._getAvailableImages(k));break;default:this.workerSources[k][I][D]=new this.externalWorkerSourceTypes[I](N,this._getLayerIndex(k),this._getAvailableImages(k))}}return this.workerSources[k][I][D]}_getDEMWorkerSource(k,I){return this.demWorkerSources[k]||(this.demWorkerSources[k]={}),this.demWorkerSources[k][I]||(this.demWorkerSources[k][I]=new ue),this.demWorkerSources[k][I]}}return C.i(self)&&(self.worker=new Sr(self)),Sr}),ae("index",["exports","./shared"],function(C,p){var Ye="4.7.1";let Qe,At;const ge={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:u=>new Promise((e,a)=>{const n=requestAnimationFrame(e);u.signal.addEventListener("abort",()=>{cancelAnimationFrame(n),a(p.c())})}),getImageData(u,e=0){return this.getImageCanvasContext(u).getImageData(-e,-e,u.width+2*e,u.height+2*e)},getImageCanvasContext(u){const e=window.document.createElement("canvas"),a=e.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return e.width=u.width,e.height=u.height,a.drawImage(u,0,0,u.width,u.height),a},resolveURL:u=>(Qe||(Qe=document.createElement("a")),Qe.href=u,Qe.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(At==null&&(At=matchMedia("(prefers-reduced-motion: reduce)")),At.matches)}};class ue{static testProp(e){if(!ue.docStyle)return e[0];for(let a=0;a<e.length;a++)if(e[a]in ue.docStyle)return e[a];return e[0]}static create(e,a,n){const o=window.document.createElement(e);return a!==void 0&&(o.className=a),n&&n.appendChild(o),o}static createNS(e,a){return window.document.createElementNS(e,a)}static disableDrag(){ue.docStyle&&ue.selectProp&&(ue.userSelect=ue.docStyle[ue.selectProp],ue.docStyle[ue.selectProp]="none")}static enableDrag(){ue.docStyle&&ue.selectProp&&(ue.docStyle[ue.selectProp]=ue.userSelect)}static setTransform(e,a){e.style[ue.transformProp]=a}static addEventListener(e,a,n,o={}){e.addEventListener(a,n,"passive"in o?o:o.capture)}static removeEventListener(e,a,n,o={}){e.removeEventListener(a,n,"passive"in o?o:o.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",ue.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ue.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",ue.suppressClickInternal,!0)},0)}static getScale(e){const a=e.getBoundingClientRect();return{x:a.width/e.offsetWidth||1,y:a.height/e.offsetHeight||1,boundingClientRect:a}}static getPoint(e,a,n){const o=a.boundingClientRect;return new p.P((n.clientX-o.left)/a.x-e.clientLeft,(n.clientY-o.top)/a.y-e.clientTop)}static mousePos(e,a){const n=ue.getScale(e);return ue.getPoint(e,n,a)}static touchPos(e,a){const n=[],o=ue.getScale(e);for(let c=0;c<a.length;c++)n.push(ue.getPoint(e,o,a[c]));return n}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}ue.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ue.selectProp=ue.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ue.transformProp=ue.testProp(["transform","WebkitTransform"]);const Dr={supported:!1,testSupport:function(u){!xr&&Zi&&(Gi?aa(u):br=u)}};let br,Zi,xr=!1,Gi=!1;function aa(u){const e=u.createTexture();u.bindTexture(u.TEXTURE_2D,e);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,Zi),u.isContextLost())return;Dr.supported=!0}catch{}u.deleteTexture(e),xr=!0}var pi;typeof document<"u"&&(Zi=document.createElement("img"),Zi.onload=()=>{br&&aa(br),br=null,Gi=!0},Zi.onerror=()=>{xr=!0,br=null},Zi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(u){let e,a,n,o;u.resetRequestQueue=()=>{e=[],a=0,n=0,o={}},u.addThrottleControl=y=>{const v=n++;return o[v]=y,v},u.removeThrottleControl=y=>{delete o[y],m()},u.getImage=(y,v,E=!0)=>new Promise((S,A)=>{Dr.supported&&(y.headers||(y.headers={}),y.headers.accept="image/webp,*/*"),p.e(y,{type:"image"}),e.push({abortController:v,requestParameters:y,supportImageRefresh:E,state:"queued",onError:L=>{A(L)},onSuccess:L=>{S(L)}}),m()});const c=y=>p._(this,void 0,void 0,function*(){y.state="running";const{requestParameters:v,supportImageRefresh:E,onError:S,onSuccess:A,abortController:L}=y,R=E===!1&&!p.i(self)&&!p.g(v.url)&&(!v.headers||Object.keys(v.headers).reduce((Z,H)=>Z&&H==="accept",!0));a++;const U=R?_(v,L):p.m(v,L);try{const Z=yield U;delete y.abortController,y.state="completed",Z.data instanceof HTMLImageElement||p.b(Z.data)?A(Z):Z.data&&A({data:yield(q=Z.data,typeof createImageBitmap=="function"?p.d(q):p.f(q)),cacheControl:Z.cacheControl,expires:Z.expires})}catch(Z){delete y.abortController,S(Z)}finally{a--,m()}var q}),m=()=>{const y=(()=>{for(const v of Object.keys(o))if(o[v]())return!0;return!1})()?p.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:p.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let v=a;v<y&&e.length>0;v++){const E=e.shift();E.abortController.signal.aborted?v--:c(E)}},_=(y,v)=>new Promise((E,S)=>{const A=new Image,L=y.url,R=y.credentials;R&&R==="include"?A.crossOrigin="use-credentials":(R&&R==="same-origin"||!p.s(L))&&(A.crossOrigin="anonymous"),v.signal.addEventListener("abort",()=>{A.src="",S(p.c())}),A.fetchPriority="high",A.onload=()=>{A.onerror=A.onload=null,E({data:A})},A.onerror=()=>{A.onerror=A.onload=null,v.signal.aborted||S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},A.src=L})}(pi||(pi={})),pi.resetRequestQueue();class sa{constructor(e){this._transformRequestFn=e}transformRequest(e,a){return this._transformRequestFn&&this._transformRequestFn(e,a)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Di(u){var e=new p.A(3);return e[0]=u[0],e[1]=u[1],e[2]=u[2],e}var Hi,ut=function(u,e,a){return u[0]=e[0]-a[0],u[1]=e[1]-a[1],u[2]=e[2]-a[2],u};Hi=new p.A(3),p.A!=Float32Array&&(Hi[0]=0,Hi[1]=0,Hi[2]=0);var Mt=function(u){var e=u[0],a=u[1];return e*e+a*a};function Qt(u){const e=[];if(typeof u=="string")e.push({id:"default",url:u});else if(u&&u.length>0){const a=[];for(const{id:n,url:o}of u){const c=`${n}${o}`;a.indexOf(c)===-1&&(a.push(c),e.push({id:n,url:o}))}}return e}function Li(u,e,a){const n=u.split("?");return n[0]+=`${e}${a}`,n.join("?")}(function(){var u=new p.A(2);p.A!=Float32Array&&(u[0]=0,u[1]=0)})();class at{constructor(e,a,n,o){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(a,o)}update(e,a,n){const{width:o,height:c}=e,m=!(this.size&&this.size[0]===o&&this.size[1]===c||n),{context:_}=this,{gl:y}=_;if(this.useMipmap=!!(a&&a.useMipmap),y.bindTexture(y.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!a||a.premultiply!==!1)),m)this.size=[o,c],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||p.b(e)?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,o,c,0,this.format,y.UNSIGNED_BYTE,e.data);else{const{x:v,y:E}=n||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||p.b(e)?y.texSubImage2D(y.TEXTURE_2D,0,v,E,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,v,E,o,c,y.RGBA,y.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&y.generateMipmap(y.TEXTURE_2D)}bind(e,a,n){const{context:o}=this,{gl:c}=o;c.bindTexture(c.TEXTURE_2D,this.texture),n!==c.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=c.LINEAR),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,n||e),this.filter=e),a!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,a),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function wi(u){const{userImage:e}=u;return!!(e&&e.render&&e.render())&&(u.data.replace(new Uint8Array(e.data.buffer)),!0)}class Gt extends p.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:a,promiseResolve:n}of this.requestors)n(this._getImagesForIds(a));this.requestors=[]}}getImage(e){const a=this.images[e];if(a&&!a.data&&a.spriteData){const n=a.spriteData;a.data=new p.R({width:n.width,height:n.height},n.context.getImageData(n.x,n.y,n.width,n.height).data),a.spriteData=null}return a}addImage(e,a){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,a)&&(this.images[e]=a)}_validate(e,a){let n=!0;const o=a.data||a.spriteData;return this._validateStretch(a.stretchX,o&&o.width)||(this.fire(new p.j(new Error(`Image "${e}" has invalid "stretchX" value`))),n=!1),this._validateStretch(a.stretchY,o&&o.height)||(this.fire(new p.j(new Error(`Image "${e}" has invalid "stretchY" value`))),n=!1),this._validateContent(a.content,a)||(this.fire(new p.j(new Error(`Image "${e}" has invalid "content" value`))),n=!1),n}_validateStretch(e,a){if(!e)return!0;let n=0;for(const o of e){if(o[0]<n||o[1]<o[0]||a<o[1])return!1;n=o[1]}return!0}_validateContent(e,a){if(!e)return!0;if(e.length!==4)return!1;const n=a.spriteData,o=n&&n.width||a.data.width,c=n&&n.height||a.data.height;return!(e[0]<0||o<e[0]||e[1]<0||c<e[1]||e[2]<0||o<e[2]||e[3]<0||c<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,a,n=!0){const o=this.getImage(e);if(n&&(o.data.width!==a.data.width||o.data.height!==a.data.height))throw new Error(`size mismatch between old image (${o.data.width}x${o.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=o.version+1,this.images[e]=a,this.updatedImages[e]=!0}removeImage(e){const a=this.images[e];delete this.images[e],delete this.patterns[e],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((a,n)=>{let o=!0;if(!this.isLoaded())for(const c of e)this.images[c]||(o=!1);this.isLoaded()||o?a(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:a})})}_getImagesForIds(e){const a={};for(const n of e){let o=this.getImage(n);o||(this.fire(new p.k("styleimagemissing",{id:n})),o=this.getImage(n)),o?a[n]={data:o.data.clone(),pixelRatio:o.pixelRatio,sdf:o.sdf,version:o.version,stretchX:o.stretchX,stretchY:o.stretchY,content:o.content,textFitWidth:o.textFitWidth,textFitHeight:o.textFitHeight,hasRenderCallback:!!(o.userImage&&o.userImage.render)}:p.w(`Image "${n}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:e,height:a}=this.atlasImage;return{width:e,height:a}}getPattern(e){const a=this.patterns[e],n=this.getImage(e);if(!n)return null;if(a&&a.position.version===n.version)return a.position;if(a)a.position.version=n.version;else{const o={w:n.data.width+2,h:n.data.height+2,x:0,y:0},c=new p.I(o,n);this.patterns[e]={bin:o,position:c}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const a=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new at(e,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const c in this.patterns)e.push(this.patterns[c].bin);const{w:a,h:n}=p.p(e),o=this.atlasImage;o.resize({width:a||1,height:n||1});for(const c in this.patterns){const{bin:m}=this.patterns[c],_=m.x+1,y=m.y+1,v=this.getImage(c).data,E=v.width,S=v.height;p.R.copy(v,o,{x:0,y:0},{x:_,y},{width:E,height:S}),p.R.copy(v,o,{x:0,y:S-1},{x:_,y:y-1},{width:E,height:1}),p.R.copy(v,o,{x:0,y:0},{x:_,y:y+S},{width:E,height:1}),p.R.copy(v,o,{x:E-1,y:0},{x:_-1,y},{width:1,height:S}),p.R.copy(v,o,{x:0,y:0},{x:_+E,y},{width:1,height:S})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const a of e){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const n=this.getImage(a);n||p.w(`Image with ID: "${a}" was not found`),wi(n)&&this.updateImage(a,n)}}}const ei=1e20;function Ri(u,e,a,n,o,c,m,_,y){for(let v=e;v<e+n;v++)Lr(u,a*c+v,c,o,m,_,y);for(let v=a;v<a+o;v++)Lr(u,v*c+e,1,n,m,_,y)}function Lr(u,e,a,n,o,c,m){c[0]=0,m[0]=-ei,m[1]=ei,o[0]=u[e];for(let _=1,y=0,v=0;_<n;_++){o[_]=u[e+_*a];const E=_*_;do{const S=c[y];v=(o[_]-o[S]+E-S*S)/(_-S)/2}while(v<=m[y]&&--y>-1);y++,c[y]=_,m[y]=v,m[y+1]=ei}for(let _=0,y=0;_<n;_++){for(;m[y+1]<_;)y++;const v=c[y],E=_-v;u[e+_*a]=o[v]+E*E}}class Bi{constructor(e,a){this.requestManager=e,this.localIdeographFontFamily=a,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return p._(this,void 0,void 0,function*(){const a=[];for(const c in e)for(const m of e[c])a.push(this._getAndCacheGlyphsPromise(c,m));const n=yield Promise.all(a),o={};for(const{stack:c,id:m,glyph:_}of n)o[c]||(o[c]={}),o[c][m]=_&&{id:_.id,bitmap:_.bitmap.clone(),metrics:_.metrics};return o})}_getAndCacheGlyphsPromise(e,a){return p._(this,void 0,void 0,function*(){let n=this.entries[e];n||(n=this.entries[e]={glyphs:{},requests:{},ranges:{}});let o=n.glyphs[a];if(o!==void 0)return{stack:e,id:a,glyph:o};if(o=this._tinySDF(n,e,a),o)return n.glyphs[a]=o,{stack:e,id:a,glyph:o};const c=Math.floor(a/256);if(256*c>65535)throw new Error("glyphs > 65535 not supported");if(n.ranges[c])return{stack:e,id:a,glyph:o};if(!this.url)throw new Error("glyphsUrl is not set");if(!n.requests[c]){const _=Bi.loadGlyphRange(e,c,this.url,this.requestManager);n.requests[c]=_}const m=yield n.requests[c];for(const _ in m)this._doesCharSupportLocalGlyph(+_)||(n.glyphs[+_]=m[+_]);return n.ranges[c]=!0,{stack:e,id:a,glyph:m[a]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,a,n){const o=this.localIdeographFontFamily;if(!o||!this._doesCharSupportLocalGlyph(n))return;let c=e.tinySDF;if(!c){let _="400";/bold/i.test(a)?_="900":/medium/i.test(a)?_="500":/light/i.test(a)&&(_="200"),c=e.tinySDF=new Bi.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:o,fontWeight:_})}const m=c.draw(String.fromCharCode(n));return{id:n,bitmap:new p.o({width:m.width||60,height:m.height||60},m.data),metrics:{width:m.glyphWidth/2||24,height:m.glyphHeight/2||24,left:m.glyphLeft/2+.5||0,top:m.glyphTop/2-27.5||-8,advance:m.glyphAdvance/2||24,isDoubleResolution:!0}}}}Bi.loadGlyphRange=function(u,e,a,n){return p._(this,void 0,void 0,function*(){const o=256*e,c=o+255,m=n.transformRequest(a.replace("{fontstack}",u).replace("{range}",`${o}-${c}`),"Glyphs"),_=yield p.l(m,new AbortController);if(!_||!_.data)throw new Error(`Could not load glyph range. range: ${e}, ${o}-${c}`);const y={};for(const v of p.n(_.data))y[v.id]=v;return y})},Bi.TinySDF=class{constructor({fontSize:u=24,buffer:e=3,radius:a=8,cutoff:n=.25,fontFamily:o="sans-serif",fontWeight:c="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=a;const _=this.size=u+4*e,y=this._createCanvas(_),v=this.ctx=y.getContext("2d",{willReadFrequently:!0});v.font=`${m} ${c} ${u}px ${o}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(u){const e=document.createElement("canvas");return e.width=e.height=u,e}draw(u){const{width:e,actualBoundingBoxAscent:a,actualBoundingBoxDescent:n,actualBoundingBoxLeft:o,actualBoundingBoxRight:c}=this.ctx.measureText(u),m=Math.ceil(a),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-o))),y=Math.min(this.size-this.buffer,m+Math.ceil(n)),v=_+2*this.buffer,E=y+2*this.buffer,S=Math.max(v*E,0),A=new Uint8ClampedArray(S),L={data:A,width:v,height:E,glyphWidth:_,glyphHeight:y,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(_===0||y===0)return L;const{ctx:R,buffer:U,gridInner:q,gridOuter:Z}=this;R.clearRect(U,U,_,y),R.fillText(u,U,U+m);const H=R.getImageData(U,U,_,y);Z.fill(ei,0,S),q.fill(0,0,S);for(let F=0;F<y;F++)for(let K=0;K<_;K++){const Y=H.data[4*(F*_+K)+3]/255;if(Y===0)continue;const re=(F+U)*v+K+U;if(Y===1)Z[re]=0,q[re]=ei;else{const de=.5-Y;Z[re]=de>0?de*de:0,q[re]=de<0?de*de:0}}Ri(Z,0,0,v,E,v,this.f,this.v,this.z),Ri(q,U,U,_,y,v,this.f,this.v,this.z);for(let F=0;F<S;F++){const K=Math.sqrt(Z[F])-Math.sqrt(q[F]);A[F]=Math.round(255-255*(K/this.radius+this.cutoff))}return L}};class Ia{constructor(){this.specification=p.v.light.position}possiblyEvaluate(e,a){return p.x(e.expression.evaluate(a))}interpolate(e,a,n){return{x:p.y.number(e.x,a.x,n),y:p.y.number(e.y,a.y,n),z:p.y.number(e.z,a.z,n)}}}let rr;class Et extends p.E{constructor(e){super(),rr=rr||new p.q({anchor:new p.D(p.v.light.anchor),position:new Ia,color:new p.D(p.v.light.color),intensity:new p.D(p.v.light.intensity)}),this._transitionable=new p.T(rr),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,a={}){if(!this._validate(p.r,e,a))for(const n in e){const o=e[n];n.endsWith("-transition")?this._transitionable.setTransition(n.slice(0,-11),o):this._transitionable.setValue(n,o)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,n){return(!n||n.validate!==!1)&&p.t(this,e.call(p.u,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:p.v}))}}const gt=new p.q({"sky-color":new p.D(p.v.sky["sky-color"]),"horizon-color":new p.D(p.v.sky["horizon-color"]),"fog-color":new p.D(p.v.sky["fog-color"]),"fog-ground-blend":new p.D(p.v.sky["fog-ground-blend"]),"horizon-fog-blend":new p.D(p.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new p.D(p.v.sky["sky-horizon-blend"]),"atmosphere-blend":new p.D(p.v.sky["atmosphere-blend"])});class Rt extends p.E{constructor(e){super(),this._transitionable=new p.T(gt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new p.z(0))}setSky(e,a={}){if(!this._validate(p.B,e,a)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const n in e){const o=e[n];n.endsWith("-transition")?this._transitionable.setTransition(n.slice(0,-11),o):this._transitionable.setValue(n,o)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,n={}){return(n==null?void 0:n.validate)!==!1&&p.t(this,e.call(p.u,p.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:p.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class fi{constructor(e,a){this.width=e,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,a){const n=e.join(",")+String(a);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(e,a)),this.dashEntry[n]}getDashRanges(e,a,n){const o=[];let c=e.length%2==1?-e[e.length-1]*n:0,m=e[0]*n,_=!0;o.push({left:c,right:m,isDash:_,zeroLength:e[0]===0});let y=e[0];for(let v=1;v<e.length;v++){_=!_;const E=e[v];c=y*n,y+=E,m=y*n,o.push({left:c,right:m,isDash:_,zeroLength:E===0})}return o}addRoundDash(e,a,n){const o=a/2;for(let c=-n;c<=n;c++){const m=this.width*(this.nextRow+n+c);let _=0,y=e[_];for(let v=0;v<this.width;v++){v/y.right>1&&(y=e[++_]);const E=Math.abs(v-y.left),S=Math.abs(v-y.right),A=Math.min(E,S);let L;const R=c/n*(o+1);if(y.isDash){const U=o-Math.abs(R);L=Math.sqrt(A*A+U*U)}else L=o-Math.sqrt(A*A+R*R);this.data[m+v]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e){for(let _=e.length-1;_>=0;--_){const y=e[_],v=e[_+1];y.zeroLength?e.splice(_,1):v&&v.isDash===y.isDash&&(v.left=y.left,e.splice(_,1))}const a=e[0],n=e[e.length-1];a.isDash===n.isDash&&(a.left=n.left-this.width,n.right=a.right+this.width);const o=this.width*this.nextRow;let c=0,m=e[c];for(let _=0;_<this.width;_++){_/m.right>1&&(m=e[++c]);const y=Math.abs(_-m.left),v=Math.abs(_-m.right),E=Math.min(y,v);this.data[o+_]=Math.max(0,Math.min(255,(m.isDash?E:-E)+128))}}addDash(e,a){const n=a?7:0,o=2*n+1;if(this.nextRow+o>this.height)return p.w("LineAtlas out of space"),null;let c=0;for(let _=0;_<e.length;_++)c+=e[_];if(c!==0){const _=this.width/c,y=this.getDashRanges(e,this.width,_);a?this.addRoundDash(y,_,n):this.addRegularDash(y)}const m={y:(this.nextRow+n+.5)/this.height,height:2*n/this.height,width:c};return this.nextRow+=o,this.dirty=!0,m}bind(e){const a=e.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const ti="maplibre_preloaded_worker_pool";class Bt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Bt.workerCount;)this.workers.push(new Worker(p.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ti]}numActive(){return Object.keys(this.active).length}}const ar=Math.floor(ge.hardwareConcurrency/2);let Ht,sr;function na(){return Ht||(Ht=new Bt),Ht}Bt.workerCount=p.C(globalThis)?Math.max(Math.min(ar,3),1):1;class oa{constructor(e,a){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=a;const n=this.workerPool.acquire(a);for(let o=0;o<n.length;o++){const c=new p.F(n[o],a);c.name=`Worker ${o}`,this.actors.push(c)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,a){const n=[];for(const o of this.actors)n.push(o.sendAsync({type:e,data:a}));return Promise.all(n)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,a){for(const n of this.actors)n.registerMessageHandler(e,a)}}function us(){return sr||(sr=new oa(na(),p.G),sr.registerMessageHandler("GR",(u,e,a)=>p.m(e,a))),sr}function Rr(u,e){const a=p.H();return p.J(a,a,[1,1,0]),p.K(a,a,[.5*u.width,.5*u.height,1]),p.L(a,a,u.calculatePosMatrix(e.toUnwrapped()))}function Zr(u,e,a,n,o,c){const m=function(S,A,L){if(S)for(const R of S){const U=A[R];if(U&&U.source===L&&U.type==="fill-extrusion")return!0}else for(const R in A){const U=A[R];if(U.source===L&&U.type==="fill-extrusion")return!0}return!1}(o&&o.layers,e,u.id),_=c.maxPitchScaleFactor(),y=u.tilesIn(n,_,m);y.sort(Gr);const v=[];for(const S of y)v.push({wrappedTileID:S.tileID.wrapped().key,queryResults:S.tile.queryRenderedFeatures(e,a,u._state,S.queryGeometry,S.cameraQueryGeometry,S.scale,o,c,_,Rr(u.transform,S.tileID))});const E=function(S){const A={},L={};for(const R of S){const U=R.queryResults,q=R.wrappedTileID,Z=L[q]=L[q]||{};for(const H in U){const F=U[H],K=Z[H]=Z[H]||{},Y=A[H]=A[H]||[];for(const re of F)K[re.featureIndex]||(K[re.featureIndex]=!0,Y.push(re))}}return A}(v);for(const S in E)E[S].forEach(A=>{const L=A.feature,R=u.getFeatureState(L.layer["source-layer"],L.id);L.source=L.layer.source,L.layer["source-layer"]&&(L.sourceLayer=L.layer["source-layer"]),L.state=R});return E}function Gr(u,e){const a=u.tileID,n=e.tileID;return a.overscaledZ-n.overscaledZ||a.canonical.y-n.canonical.y||a.wrap-n.wrap||a.canonical.x-n.canonical.x}function ka(u,e,a){return p._(this,void 0,void 0,function*(){let n=u;if(u.url?n=(yield p.h(e.transformRequest(u.url,"Source"),a)).data:yield ge.frameAsync(a),!n)return null;const o=p.M(p.e(n,u),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in n&&n.vector_layers&&(o.vectorLayerIds=n.vector_layers.map(c=>c.id)),o})}class oe{constructor(e,a){e&&(a?this.setSouthWest(e).setNorthEast(a):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof p.N?new p.N(e.lng,e.lat):p.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof p.N?new p.N(e.lng,e.lat):p.N.convert(e),this}extend(e){const a=this._sw,n=this._ne;let o,c;if(e instanceof p.N)o=e,c=e;else{if(!(e instanceof oe))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(oe.convert(e)):this.extend(p.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(p.N.convert(e)):this;if(o=e._sw,c=e._ne,!o||!c)return this}return a||n?(a.lng=Math.min(o.lng,a.lng),a.lat=Math.min(o.lat,a.lat),n.lng=Math.max(c.lng,n.lng),n.lat=Math.max(c.lat,n.lat)):(this._sw=new p.N(o.lng,o.lat),this._ne=new p.N(c.lng,c.lat)),this}getCenter(){return new p.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new p.N(this.getWest(),this.getNorth())}getSouthEast(){return new p.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:a,lat:n}=p.N.convert(e);let o=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(o=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&o}static convert(e){return e instanceof oe?e:e&&new oe(e)}static fromLngLat(e,a=0){const n=360*a/40075017,o=n/Math.cos(Math.PI/180*e.lat);return new oe(new p.N(e.lng-o,e.lat-n),new p.N(e.lng+o,e.lat+n))}adjustAntiMeridian(){const e=new p.N(this._sw.lng,this._sw.lat),a=new p.N(this._ne.lng,this._ne.lat);return new oe(e,e.lng>a.lng?new p.N(a.lng+360,a.lat):a)}}class la{constructor(e,a,n){this.bounds=oe.convert(this.validateBounds(e)),this.minzoom=a||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const a=Math.pow(2,e.z),n=Math.floor(p.O(this.bounds.getWest())*a),o=Math.floor(p.Q(this.bounds.getNorth())*a),c=Math.ceil(p.O(this.bounds.getEast())*a),m=Math.ceil(p.Q(this.bounds.getSouth())*a);return e.x>=n&&e.x<c&&e.y>=o&&e.y<m}}class hs extends p.E{constructor(e,a,n,o){if(super(),this.id=e,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.e(this,p.M(a,["url","scheme","tileSize","promoteId"])),this._options=p.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}load(){return p._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new p.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ka(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(p.e(this,e),e.bounds&&(this.tileBounds=new la(e.bounds,this.minzoom,this.maxzoom)),this.fire(new p.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new p.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return p.e({},this._options)}loadTile(e){return p._(this,void 0,void 0,function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),n={request:this.map._requestManager.transformRequest(a,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};n.request.collectResourceTiming=this._collectResourceTiming;let o="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((c,m)=>{e.reloadPromise={resolve:c,reject:m}})}else e.actor=this.dispatcher.getActor(),o="LT";e.abortController=new AbortController;try{const c=yield e.actor.sendAsync({type:o,data:n},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,c)}catch(c){if(delete e.abortController,e.aborted)return;if(c&&c.status!==404)throw c;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,a){if(a&&a.resourceTiming&&(e.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&e.setExpiryData(a),e.loadVectorData(a,this.map.painter),e.reloadPromise){const n=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(n.resolve).catch(n.reject)}}abortTile(e){return p._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return p._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ht extends p.E{constructor(e,a,n,o){super(),this.id=e,this.dispatcher=n,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.e({type:"raster"},a),p.e(this,p.M(a,["url","scheme","tileSize"]))}load(){return p._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new p.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ka(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(p.e(this,e),e.bounds&&(this.tileBounds=new la(e.bounds,this.minzoom,this.maxzoom)),this.fire(new p.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new p.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return p.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return p._(this,void 0,void 0,function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const n=yield pi.getImage(this.map._requestManager.transformRequest(a,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(n&&n.data){this.map._refreshExpiredTiles&&n.cacheControl&&n.expires&&e.setExpiryData({cacheControl:n.cacheControl,expires:n.expires});const o=this.map.painter.context,c=o.gl,m=n.data;e.texture=this.map.painter.getTileTexture(m.width),e.texture?e.texture.update(m,{useMipmap:!0}):(e.texture=new at(o,m,c.RGBA,{useMipmap:!0}),e.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE,c.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(n){if(delete e.abortController,e.aborted)e.state="unloaded";else if(n)throw e.state="errored",n}})}abortTile(e){return p._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return p._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class zt extends ht{constructor(e,a,n,o){super(e,a,n,o),this.type="raster-dem",this.maxzoom=22,this._options=p.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(e){return p._(this,void 0,void 0,function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),n=this.map._requestManager.transformRequest(a,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const o=yield pi.getImage(n,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(o&&o.data){const c=o.data;this.map._refreshExpiredTiles&&o.cacheControl&&o.expires&&e.setExpiryData({cacheControl:o.cacheControl,expires:o.expires});const m=p.b(c)&&p.U()?c:yield this.readImageNow(c),_={type:this.type,uid:e.uid,source:this.id,rawImageData:m,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const y=yield e.actor.sendAsync({type:"LDT",data:_});e.dem=y,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(o){if(delete e.abortController,e.aborted)e.state="unloaded";else if(o)throw e.state="errored",o}})}readImageNow(e){return p._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&p.V()){const a=e.width+2,n=e.height+2;try{return new p.R({width:a,height:n},yield p.W(e,-1,-1,a,n))}catch{}}return ge.getImageData(e,1)})}_getNeighboringTiles(e){const a=e.canonical,n=Math.pow(2,a.z),o=(a.x-1+n)%n,c=a.x===0?e.wrap-1:e.wrap,m=(a.x+1+n)%n,_=a.x+1===n?e.wrap+1:e.wrap,y={};return y[new p.S(e.overscaledZ,c,a.z,o,a.y).key]={backfilled:!1},y[new p.S(e.overscaledZ,_,a.z,m,a.y).key]={backfilled:!1},a.y>0&&(y[new p.S(e.overscaledZ,c,a.z,o,a.y-1).key]={backfilled:!1},y[new p.S(e.overscaledZ,e.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},y[new p.S(e.overscaledZ,_,a.z,m,a.y-1).key]={backfilled:!1}),a.y+1<n&&(y[new p.S(e.overscaledZ,c,a.z,o,a.y+1).key]={backfilled:!1},y[new p.S(e.overscaledZ,e.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},y[new p.S(e.overscaledZ,_,a.z,m,a.y+1).key]={backfilled:!1}),y}unloadTile(e){return p._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class ds extends p.E{constructor(e,a,n,o){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=n.getActor(),this.setEventedParent(o),this._data=a.data,this._options=p.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const c=p.X/this.tileSize;a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&p.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=p.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*c,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*c,extent:p.X,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:p.X,radius:(a.clusterRadius||50)*c,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return p._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return p._(this,void 0,void 0,function*(){const e=p.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,a,n){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:a,offset:n}})}_updateWorkerData(e){return p._(this,void 0,void 0,function*(){const a=p.e({type:this.type},this.workerOptions);e?a.dataDiff=e:typeof this._data=="string"?(a.request=this.map._requestManager.transformRequest(ge.resolveURL(this._data),"Source"),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new p.k("dataloading",{dataType:"source"}));try{const n=yield this.actor.sendAsync({type:"LD",data:a});if(this._pendingLoads--,this._removed||n.abandoned)return void this.fire(new p.k("dataabort",{dataType:"source"}));let o=null;n.resourceTiming&&n.resourceTiming[this.id]&&(o=n.resourceTiming[this.id].slice(0));const c={dataType:"source"};this._collectResourceTiming&&o&&o.length>0&&p.e(c,{resourceTiming:o}),this.fire(new p.k("data",Object.assign(Object.assign({},c),{sourceDataType:"metadata"}))),this.fire(new p.k("data",Object.assign(Object.assign({},c),{sourceDataType:"content"})))}catch(n){if(this._pendingLoads--,this._removed)return void this.fire(new p.k("dataabort",{dataType:"source"}));this.fire(new p.j(n))}})}loaded(){return this._pendingLoads===0}loadTile(e){return p._(this,void 0,void 0,function*(){const a=e.actor?"RT":"LT";e.actor=this.actor;const n={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const o=yield this.actor.sendAsync({type:a,data:n},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(o,this.map.painter,a==="RT")})}abortTile(e){return p._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return p._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return p.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Hr=p.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Br extends p.E{constructor(e,a,n,o){super(),this.id=e,this.dispatcher=n,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(o),this.options=a}load(e){return p._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new p.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield pi.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,e&&(this.coordinates=e),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,this.fire(new p.j(a))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const a=e.map(p.Z.fromLngLat);this.tileID=function(o){let c=1/0,m=1/0,_=-1/0,y=-1/0;for(const A of o)c=Math.min(c,A.x),m=Math.min(m,A.y),_=Math.max(_,A.x),y=Math.max(y,A.y);const v=Math.max(_-c,y-m),E=Math.max(0,Math.floor(-Math.log(v)/Math.LN2)),S=Math.pow(2,E);return new p.a1(E,Math.floor((c+_)/2*S),Math.floor((m+y)/2*S))}(a),this.minzoom=this.maxzoom=this.tileID.z;const n=a.map(o=>this.tileID.getTilePoint(o)._round());return this._boundsArray=new p.$,this._boundsArray.emplaceBack(n[0].x,n[0].y,0,0),this._boundsArray.emplaceBack(n[1].x,n[1].y,p.X,0),this._boundsArray.emplaceBack(n[3].x,n[3].y,0,p.X),this._boundsArray.emplaceBack(n[2].x,n[2].y,p.X,p.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new p.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,a=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Hr.members)),this.boundsSegments||(this.boundsSegments=p.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new at(e,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let n=!1;for(const o in this.tiles){const c=this.tiles[o];c.state!=="loaded"&&(c.state="loaded",c.texture=this.texture,n=!0)}n&&this.fire(new p.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return p._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Pa extends Br{constructor(e,a,n,o){super(e,a,n,o),this.roundZoom=!0,this.type="video",this.options=a}load(){return p._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const a of e.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield p.a3(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new p.j(a))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const a=this.video.seekable;e<a.start(0)||e>a.end(0)?this.fire(new p.j(new p.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,a=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Hr.members)),this.boundsSegments||(this.boundsSegments=p.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new at(e,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let n=!1;for(const o in this.tiles){const c=this.tiles[o];c.state!=="loaded"&&(c.state="loaded",c.texture=this.texture,n=!0)}n&&this.fire(new p.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Wi extends Br{constructor(e,a,n,o){super(e,a,n,o),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(c=>!Array.isArray(c)||c.length!==2||c.some(m=>typeof m!="number"))||this.fire(new p.j(new p.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.j(new p.a2(`sources.${e}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new p.j(new p.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new p.j(new p.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.j(new p.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return p._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,n=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,Hr.members)),this.boundsSegments||(this.boundsSegments=p.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new at(a,this.canvas,n.RGBA,{premultiply:!0});let o=!1;for(const c in this.tiles){const m=this.tiles[c];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,o=!0)}o&&this.fire(new p.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const ps={},fs=u=>{switch(u){case"geojson":return ds;case"image":return Br;case"raster":return ht;case"raster-dem":return zt;case"vector":return hs;case"video":return Pa;case"canvas":return Wi}return ps[u]},ye="RTLPluginLoaded";class vr extends p.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=us()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(a=>{throw this.status="error",a})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return p._(this,arguments,void 0,function*(a,n=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ge.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!n)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return p._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new p.k(ye))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let mi=null;function wr(){return mi||(mi=new vr),mi}class Wr{constructor(e,a){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=p.a4(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const a=e+this.timeAdded;a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,a,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(o,c){const m={};if(!c)return m;for(const _ of o){const y=_.layerIds.map(v=>c.getLayer(v)).filter(Boolean);if(y.length!==0){_.layers=y,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(v=>y.filter(E=>E.id===v)[0]));for(const v of y)m[v.id]=_}}return m}(e.buckets,a.style),this.hasSymbolBuckets=!1;for(const o in this.buckets){const c=this.buckets[o];if(c instanceof p.a6){if(this.hasSymbolBuckets=!0,!n)break;c.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const o in this.buckets){const c=this.buckets[o];if(c instanceof p.a6&&c.hasRTLText){this.hasRTLText=!0,wr().lazyLoad();break}}this.queryPadding=0;for(const o in this.buckets){const c=this.buckets[o];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(o).queryRadius(c))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new p.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const n in this.buckets){const o=this.buckets[n];o.uploadPending()&&o.upload(e)}const a=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new at(e,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new at(e,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,a,n,o,c,m,_,y,v,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:o,cameraQueryGeometry:c,scale:m,tileSize:this.tileSize,pixelPosMatrix:E,transform:y,params:_,queryPadding:this.queryPadding*v},e,a,n):{}}querySourceFeatures(e,a){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const o=n.loadVTLayers(),c=a&&a.sourceLayer?a.sourceLayer:"",m=o._geojsonTileLayer||o[c];if(!m)return;const _=p.a7(a&&a.filter),{z:y,x:v,y:E}=this.tileID.canonical,S={z:y,x:v,y:E};for(let A=0;A<m.length;A++){const L=m.feature(A);if(_.needGeometry){const q=p.a8(L,!0);if(!_.filter(new p.z(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!_.filter(new p.z(this.tileID.overscaledZ),L))continue;const R=n.getId(L,c),U=new p.a9(L,y,v,E,R);U.tile=S,e.push(U)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const a=this.expirationTime;if(e.cacheControl){const n=p.aa(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const n=Date.now();let o=!1;if(this.expirationTime>n)o=!1;else if(a)if(this.expirationTime<a)o=!0;else{const c=this.expirationTime-a;c?this.expirationTime=n+Math.max(c,3e4):o=!0}else o=!0;o?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const n=this.latestFeatureIndex.loadVTLayers();for(const o in this.buckets){if(!a.style.hasLayer(o))continue;const c=this.buckets[o],m=c.layers[0].sourceLayer||"_geojsonTileLayer",_=n[m],y=e[m];if(!_||!y||Object.keys(y).length===0)continue;c.update(y,_,this.imageAtlas&&this.imageAtlas.patternPositions||{});const v=a&&a.style&&a.style.getLayer(o);v&&(this.queryPadding=Math.max(this.queryPadding,v.queryRadius(c)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ge.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ge.now()+e}setDependencies(e,a){const n={};for(const o of a)n[o]=!0;this.dependencies[e]=n}hasDependency(e,a){for(const n of e){const o=this.dependencies[n];if(o){for(const c of a)if(o[c])return!0}}return!1}}class we{constructor(e,a){this.max=e,this.onRemove=a,this.reset()}reset(){for(const e in this.data)for(const a of this.data[e])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(e,a,n){const o=e.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const c={value:a,timeout:void 0};if(n!==void 0&&(c.timeout=setTimeout(()=>{this.remove(e,c)},n)),this.data[o].push(c),this.order.push(o),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const a=this.data[e].shift();return a.timeout&&clearTimeout(a.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),a.value}getByKey(e){const a=this.data[e];return a?a[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,a){if(!this.has(e))return this;const n=e.wrapped().key,o=a===void 0?0:this.data[n].indexOf(a),c=this.data[n][o];return this.data[n].splice(o,1),c.timeout&&clearTimeout(c.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(c.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(e){const a=[];for(const n in this.data)for(const o of this.data[n])e(o.value)||a.push(o);for(const n of a)this.remove(n.value.tileID,n)}}class Xe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,a,n){const o=String(a);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][o]=this.stateChanges[e][o]||{},p.e(this.stateChanges[e][o],n),this.deletedStates[e]===null){this.deletedStates[e]={};for(const c in this.state[e])c!==o&&(this.deletedStates[e][c]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][o]===null){this.deletedStates[e][o]={};for(const c in this.state[e][o])n[c]||(this.deletedStates[e][o][c]=null)}else for(const c in n)this.deletedStates[e]&&this.deletedStates[e][o]&&this.deletedStates[e][o][c]===null&&delete this.deletedStates[e][o][c]}removeFeatureState(e,a,n){if(this.deletedStates[e]===null)return;const o=String(a);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&a!==void 0)this.deletedStates[e][o]!==null&&(this.deletedStates[e][o]=this.deletedStates[e][o]||{},this.deletedStates[e][o][n]=null);else if(a!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][o])for(n in this.deletedStates[e][o]={},this.stateChanges[e][o])this.deletedStates[e][o][n]=null;else this.deletedStates[e][o]=null;else this.deletedStates[e]=null}getState(e,a){const n=String(a),o=p.e({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const c=this.deletedStates[e][a];if(c===null)return{};for(const m in c)delete o[m]}return o}initializeTileState(e,a){e.setFeatureState(this.state,a)}coalesceChanges(e,a){const n={};for(const o in this.stateChanges){this.state[o]=this.state[o]||{};const c={};for(const m in this.stateChanges[o])this.state[o][m]||(this.state[o][m]={}),p.e(this.state[o][m],this.stateChanges[o][m]),c[m]=this.state[o][m];n[o]=c}for(const o in this.deletedStates){this.state[o]=this.state[o]||{};const c={};if(this.deletedStates[o]===null)for(const m in this.state[o])c[m]={},this.state[o][m]={};else for(const m in this.deletedStates[o]){if(this.deletedStates[o][m]===null)this.state[o][m]={};else for(const _ of Object.keys(this.deletedStates[o][m]))delete this.state[o][m][_];c[m]=this.state[o][m]}n[o]=n[o]||{},p.e(n[o],c)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(const o in e)e[o].setFeatureState(n,a)}}class je extends p.E{constructor(e,a,n){super(),this.id=e,this.dispatcher=n,this.on("data",o=>this._dataHandler(o)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((o,c,m,_)=>{const y=new(fs(c.type))(o,c,m,_);if(y.id!==o)throw new Error(`Expected Source id to be ${o} instead of ${y.id}`);return y})(e,a,n,this),this._tiles={},this._cache=new we(0,o=>this._unloadTile(o)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Xe,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const a=this._tiles[e];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,a,n){return p._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,a,n)}catch(o){e.state="errored",o.status!==404?this._source.fire(new p.j(o,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new p.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const n=this._tiles[a];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Ei).map(e=>e.key)}getRenderableIds(e){const a=[];for(const n in this._tiles)this._isIdRenderable(n,e)&&a.push(this._tiles[n]);return e?a.sort((n,o)=>{const c=n.tileID,m=o.tileID,_=new p.P(c.canonical.x,c.canonical.y)._rotate(this.transform.angle),y=new p.P(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return c.overscaledZ-m.overscaledZ||y.y-_.y||y.x-_.x}).map(n=>n.tileID.key):a.map(n=>n.tileID).sort(Ei).map(n=>n.key)}hasRenderableParent(e){const a=this.findLoadedParent(e,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(e,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(a||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,a){return p._(this,void 0,void 0,function*(){const n=this._tiles[e];n&&(n.state!=="loading"&&(n.state=a),yield this._loadTile(n,e,a))})}_tileLoaded(e,a,n){e.timeAdded=ge.now(),n==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(a,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new p.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const a=this.getRenderableIds();for(let o=0;o<a.length;o++){const c=a[o];if(e.neighboringTiles&&e.neighboringTiles[c]){const m=this.getTileByID(c);n(e,m),n(m,e)}}function n(o,c){o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0;let m=c.tileID.canonical.x-o.tileID.canonical.x;const _=c.tileID.canonical.y-o.tileID.canonical.y,y=Math.pow(2,o.tileID.canonical.z),v=c.tileID.key;m===0&&_===0||Math.abs(_)>1||(Math.abs(m)>1&&(Math.abs(m+y)===1?m+=y:Math.abs(m-y)===1&&(m-=y)),c.dem&&o.dem&&(o.dem.backfillBorder(c.dem,m,_),o.neighboringTiles&&o.neighboringTiles[v]&&(o.neighboringTiles[v].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,a,n,o){for(const c in this._tiles){let m=this._tiles[c];if(o[c]||!m.hasData()||m.tileID.overscaledZ<=a||m.tileID.overscaledZ>n)continue;let _=m.tileID;for(;m&&m.tileID.overscaledZ>a+1;){const v=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[v.key],m&&m.hasData()&&(_=v)}let y=_;for(;y.overscaledZ>a;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){o[_.key]=_;break}}}findLoadedParent(e,a){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=a?n:null}for(let n=e.overscaledZ-1;n>=a;n--){const o=e.scaledTo(n),c=this._getLoadedTile(o);if(c)return c}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const a=this._tiles[e.key];return a&&a.hasData()?a:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const a=Math.ceil(e.width/this._source.tileSize)+1,n=Math.ceil(e.height/this._source.tileSize)+1,o=Math.floor(a*n*(this._maxTileCacheZoomLevels===null?p.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),c=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(c)}handleWrapJump(e){const a=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,a){const n={};for(const o in this._tiles){const c=this._tiles[o];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+a),n[c.tileID.key]=c}this._tiles=n;for(const o in this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(const o in this._tiles)this._setTileReloadTimer(o,this._tiles[o])}}_updateCoveredAndRetainedTiles(e,a,n,o,c,m){const _={},y={},v=Object.keys(e),E=ge.now();for(const S of v){const A=e[S],L=this._tiles[S];if(!L||L.fadeEndTime!==0&&L.fadeEndTime<=E)continue;const R=this.findLoadedParent(A,a),U=this.findLoadedSibling(A),q=R||U||null;q&&(this._addTile(q.tileID),_[q.tileID.key]=q.tileID),y[S]=A}this._retainLoadedChildren(y,o,n,e);for(const S in _)e[S]||(this._coveredTiles[S]=!0,e[S]=_[S]);if(m){const S={},A={};for(const L of c)this._tiles[L.key].hasData()?S[L.key]=L:A[L.key]=L;for(const L in A){const R=A[L].children(this._source.maxzoom);this._tiles[R[0].key]&&this._tiles[R[1].key]&&this._tiles[R[2].key]&&this._tiles[R[3].key]&&(S[R[0].key]=e[R[0].key]=R[0],S[R[1].key]=e[R[1].key]=R[1],S[R[2].key]=e[R[2].key]=R[2],S[R[3].key]=e[R[3].key]=R[3],delete A[L])}for(const L in A){const R=A[L],U=this.findLoadedParent(R,this._source.minzoom),q=this.findLoadedSibling(R),Z=U||q||null;if(Z){S[Z.tileID.key]=e[Z.tileID.key]=Z.tileID;for(const H in S)S[H].isChildOf(Z.tileID)&&delete S[H]}}for(const L in this._tiles)S[L]||(this._coveredTiles[L]=!0)}}update(e,a){if(!this._sourceLoaded||this._paused)return;let n;this.transform=e,this.terrain=a,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?n=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(E=>new p.S(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y)):(n=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a}),this._source.hasTile&&(n=n.filter(E=>this._source.hasTile(E)))):n=[];const o=e.coveringZoomLevel(this._source),c=Math.max(o-je.maxOverzooming,this._source.minzoom),m=Math.max(o+je.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const E={};for(const S of n)if(S.canonical.z>this._source.minzoom){const A=S.scaledTo(S.canonical.z-1);E[A.key]=A;const L=S.scaledTo(Math.max(this._source.minzoom,Math.min(S.canonical.z,5)));E[L.key]=L}n=n.concat(Object.values(E))}const _=n.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,_&&this.fire(new p.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const y=this._updateRetainedTiles(n,o);nr(this._source.type)&&this._updateCoveredAndRetainedTiles(y,c,m,o,n,a);for(const E in y)this._tiles[E].clearFadeHold();const v=p.ab(this._tiles,y);for(const E of v){const S=this._tiles[E];S.hasSymbolBuckets&&!S.holdingForFade()?S.setHoldDuration(this.map._fadeDuration):S.hasSymbolBuckets&&!S.symbolFadeFinished()||this._removeTile(E)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,a){var n;const o={},c={},m=Math.max(a-je.maxOverzooming,this._source.minzoom),_=Math.max(a+je.maxUnderzooming,this._source.minzoom),y={};for(const v of e){const E=this._addTile(v);o[v.key]=v,E.hasData()||a<this._source.maxzoom&&(y[v.key]=v)}this._retainLoadedChildren(y,a,_,o);for(const v of e){let E=this._tiles[v.key];if(E.hasData())continue;if(a+1>this._source.maxzoom){const A=v.children(this._source.maxzoom)[0],L=this.getTile(A);if(L&&L.hasData()){o[A.key]=A;continue}}else{const A=v.children(this._source.maxzoom);if(o[A[0].key]&&o[A[1].key]&&o[A[2].key]&&o[A[3].key])continue}let S=E.wasRequested();for(let A=v.overscaledZ-1;A>=m;--A){const L=v.scaledTo(A);if(c[L.key])break;if(c[L.key]=!0,E=this.getTile(L),!E&&S&&(E=this._addTile(L)),E){const R=E.hasData();if((R||!(!((n=this.map)===null||n===void 0)&&n.cancelPendingTileRequestsWhileZooming)||S)&&(o[L.key]=L),S=E.wasRequested(),R)break}}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const a=[];let n,o=this._tiles[e].tileID;for(;o.overscaledZ>0;){if(o.key in this._loadedParentTiles){n=this._loadedParentTiles[o.key];break}a.push(o.key);const c=o.scaledTo(o.overscaledZ-1);if(n=this._getLoadedTile(c),n)break;o=c}for(const c of a)this._loadedParentTiles[c]=n}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const a=this._tiles[e].tileID,n=this._getLoadedTile(a);this._loadedSiblingTiles[a.key]=n}}_addTile(e){let a=this._tiles[e.key];if(a)return a;a=this._cache.getAndRemove(e),a&&(this._setTileReloadTimer(e.key,a),a.tileID=e,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,a)));const n=a;return a||(a=new Wr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(a,e.key,a.state)),a.uses++,this._tiles[e.key]=a,n||this._source.fire(new p.k("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(e,a){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=a.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const a=this._tiles[e];a&&(a.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(e){const a=e.sourceDataType;e.dataType==="source"&&a==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&a==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,a,n){const o=[],c=this.transform;if(!c)return o;const m=n?c.getCameraQueryGeometry(e):e,_=e.map(R=>c.pointCoordinate(R,this.terrain)),y=m.map(R=>c.pointCoordinate(R,this.terrain)),v=this.getIds();let E=1/0,S=1/0,A=-1/0,L=-1/0;for(const R of y)E=Math.min(E,R.x),S=Math.min(S,R.y),A=Math.max(A,R.x),L=Math.max(L,R.y);for(let R=0;R<v.length;R++){const U=this._tiles[v[R]];if(U.holdingForFade())continue;const q=U.tileID,Z=Math.pow(2,c.zoom-U.tileID.overscaledZ),H=a*U.queryPadding*p.X/U.tileSize/Z,F=[q.getTilePoint(new p.Z(E,S)),q.getTilePoint(new p.Z(A,L))];if(F[0].x-H<p.X&&F[0].y-H<p.X&&F[1].x+H>=0&&F[1].y+H>=0){const K=_.map(re=>q.getTilePoint(re)),Y=y.map(re=>q.getTilePoint(re));o.push({tile:U,tileID:q,queryGeometry:K,cameraQueryGeometry:Y,scale:Z})}}return o}getVisibleCoordinates(e){const a=this.getRenderableIds(e).map(n=>this._tiles[n].tileID);for(const n of a)n.posMatrix=this.transform.calculatePosMatrix(n.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(nr(this._source.type)){const e=ge.now();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=e)return!0}return!1}setFeatureState(e,a,n){this._state.updateState(e=e||"_geojsonTileLayer",a,n)}removeFeatureState(e,a,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",a,n)}getFeatureState(e,a){return this._state.getState(e=e||"_geojsonTileLayer",a)}setDependencies(e,a,n){const o=this._tiles[e];o&&o.setDependencies(a,n)}reloadTilesForDependencies(e,a){for(const n in this._tiles)this._tiles[n].hasDependency(e,a)&&this._reloadTile(n,"reloading");this._cache.filter(n=>!n.hasDependency(e,a))}}function Ei(u,e){const a=Math.abs(2*u.wrap)-+(u.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return u.overscaledZ-e.overscaledZ||n-a||e.canonical.y-u.canonical.y||e.canonical.x-u.canonical.x}function nr(u){return u==="raster"||u==="image"||u==="video"}je.maxOverzooming=10,je.maxUnderzooming=3;class Ge{constructor(e,a){this.reset(e,a)}reset(e,a){this.points=e||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=p.ac(e,0,1);let a=1,n=this._distances[a];const o=e*this.paddedLength+this.padding;for(;n<o&&a<this._distances.length;)n=this._distances[++a];const c=a-1,m=this._distances[c],_=n-m,y=_>0?(o-m)/_:0;return this.points[c].mult(1-y).add(this.points[a].mult(y))}}function Er(u,e){let a=!0;return u==="always"||u!=="never"&&e!=="never"||(a=!1),a}class Fr{constructor(e,a,n){const o=this.boxCells=[],c=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(a/n);for(let m=0;m<this.xCellCount*this.yCellCount;m++)o.push([]),c.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=a,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,a,n,o,c){this._forEachCell(a,n,o,c,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(a),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c)}insertCircle(e,a,n,o){this._forEachCell(a-o,n-o,a+o,n+o,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(a),this.circles.push(n),this.circles.push(o)}_insertBoxCell(e,a,n,o,c,m){this.boxCells[c].push(m)}_insertCircleCell(e,a,n,o,c,m){this.circleCells[c].push(m)}_query(e,a,n,o,c,m,_){if(n<0||e>this.width||o<0||a>this.height)return[];const y=[];if(e<=0&&a<=0&&this.width<=n&&this.height<=o){if(c)return[{key:null,x1:e,y1:a,x2:n,y2:o}];for(let v=0;v<this.boxKeys.length;v++)y.push({key:this.boxKeys[v],x1:this.bboxes[4*v],y1:this.bboxes[4*v+1],x2:this.bboxes[4*v+2],y2:this.bboxes[4*v+3]});for(let v=0;v<this.circleKeys.length;v++){const E=this.circles[3*v],S=this.circles[3*v+1],A=this.circles[3*v+2];y.push({key:this.circleKeys[v],x1:E-A,y1:S-A,x2:E+A,y2:S+A})}}else this._forEachCell(e,a,n,o,this._queryCell,y,{hitTest:c,overlapMode:m,seenUids:{box:{},circle:{}}},_);return y}query(e,a,n,o){return this._query(e,a,n,o,!1,null)}hitTest(e,a,n,o,c,m){return this._query(e,a,n,o,!0,c,m).length>0}hitTestCircle(e,a,n,o,c){const m=e-n,_=e+n,y=a-n,v=a+n;if(_<0||m>this.width||v<0||y>this.height)return!1;const E=[];return this._forEachCell(m,y,_,v,this._queryCellCircle,E,{hitTest:!0,overlapMode:o,circle:{x:e,y:a,radius:n},seenUids:{box:{},circle:{}}},c),E.length>0}_queryCell(e,a,n,o,c,m,_,y){const{seenUids:v,hitTest:E,overlapMode:S}=_,A=this.boxCells[c];if(A!==null){const R=this.bboxes;for(const U of A)if(!v.box[U]){v.box[U]=!0;const q=4*U,Z=this.boxKeys[U];if(e<=R[q+2]&&a<=R[q+3]&&n>=R[q+0]&&o>=R[q+1]&&(!y||y(Z))&&(!E||!Er(S,Z.overlapMode))&&(m.push({key:Z,x1:R[q],y1:R[q+1],x2:R[q+2],y2:R[q+3]}),E))return!0}}const L=this.circleCells[c];if(L!==null){const R=this.circles;for(const U of L)if(!v.circle[U]){v.circle[U]=!0;const q=3*U,Z=this.circleKeys[U];if(this._circleAndRectCollide(R[q],R[q+1],R[q+2],e,a,n,o)&&(!y||y(Z))&&(!E||!Er(S,Z.overlapMode))){const H=R[q],F=R[q+1],K=R[q+2];if(m.push({key:Z,x1:H-K,y1:F-K,x2:H+K,y2:F+K}),E)return!0}}}return!1}_queryCellCircle(e,a,n,o,c,m,_,y){const{circle:v,seenUids:E,overlapMode:S}=_,A=this.boxCells[c];if(A!==null){const R=this.bboxes;for(const U of A)if(!E.box[U]){E.box[U]=!0;const q=4*U,Z=this.boxKeys[U];if(this._circleAndRectCollide(v.x,v.y,v.radius,R[q+0],R[q+1],R[q+2],R[q+3])&&(!y||y(Z))&&!Er(S,Z.overlapMode))return m.push(!0),!0}}const L=this.circleCells[c];if(L!==null){const R=this.circles;for(const U of L)if(!E.circle[U]){E.circle[U]=!0;const q=3*U,Z=this.circleKeys[U];if(this._circlesCollide(R[q],R[q+1],R[q+2],v.x,v.y,v.radius)&&(!y||y(Z))&&!Er(S,Z.overlapMode))return m.push(!0),!0}}}_forEachCell(e,a,n,o,c,m,_,y){const v=this._convertToXCellCoord(e),E=this._convertToYCellCoord(a),S=this._convertToXCellCoord(n),A=this._convertToYCellCoord(o);for(let L=v;L<=S;L++)for(let R=E;R<=A;R++)if(c.call(this,e,a,n,o,this.xCellCount*R+L,m,_,y))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,a,n,o,c,m){const _=o-e,y=c-a,v=n+m;return v*v>_*_+y*y}_circleAndRectCollide(e,a,n,o,c,m,_){const y=(m-o)/2,v=Math.abs(e-(o+y));if(v>y+n)return!1;const E=(_-c)/2,S=Math.abs(a-(c+E));if(S>E+n)return!1;if(v<=y||S<=E)return!0;const A=v-y,L=S-E;return A*A+L*L<=n*n}}function Xr(u,e,a,n,o){const c=p.H();return e?(p.K(c,c,[1/o,1/o,1]),a||p.ad(c,c,n.angle)):p.L(c,n.labelPlaneMatrix,u),c}function Sr(u,e,a,n,o){if(e){const c=p.ae(u);return p.K(c,c,[o,o,1]),a||p.ad(c,c,-n.angle),c}return n.glCoordMatrix}function j(u,e,a,n){let o;n?(o=[u,e,n(u,e),1],p.af(o,o,a)):(o=[u,e,0,1],nt(o,o,a));const c=o[3];return{point:new p.P(o[0]/c,o[1]/c),signedDistanceFromCamera:c,isOccluded:!1}}function k(u,e){return .5+u/e*.5}function I(u,e){return u.x>=-e[0]&&u.x<=e[0]&&u.y>=-e[1]&&u.y<=e[1]}function D(u,e,a,n,o,c,m,_,y,v,E,S,A,L,R){const U=n?u.textSizeData:u.iconSizeData,q=p.ag(U,a.transform.zoom),Z=[256/a.width*2+1,256/a.height*2+1],H=n?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;H.clear();const F=u.lineVertexArray,K=n?u.text.placedSymbolArray:u.icon.placedSymbolArray,Y=a.transform.width/a.transform.height;let re=!1;for(let de=0;de<K.length;de++){const _e=K.get(de);if(_e.hidden||_e.writingMode===p.ah.vertical&&!re){Ve(_e.numGlyphs,H);continue}re=!1;const Te=j(_e.anchorX,_e.anchorY,e,R);if(!I(Te.point,Z)){Ve(_e.numGlyphs,H);continue}const Ce=k(a.transform.cameraToCenterDistance,Te.signedDistanceFromCamera),ve=p.ai(U,q,_e),xe=m?ve/Ce:ve*Ce,Le={getElevation:R,labelPlaneMatrix:o,lineVertexArray:F,pitchWithMap:m,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:v,tileAnchorPoint:new p.P(_e.anchorX,_e.anchorY),unwrappedTileID:E,width:S,height:A,translation:L},Ze=J(Le,_e,xe,!1,_,e,c,u.glyphOffsetArray,H,Y,y);re=Ze.useVertical,(Ze.notEnoughRoom||re||Ze.needsFlipping&&J(Le,_e,xe,!0,_,e,c,u.glyphOffsetArray,H,Y,y).notEnoughRoom)&&Ve(_e.numGlyphs,H)}n?u.text.dynamicLayoutVertexBuffer.updateData(H):u.icon.dynamicLayoutVertexBuffer.updateData(H)}function N(u,e,a,n,o,c,m,_){const y=c.glyphStartIndex+c.numGlyphs,v=c.lineStartIndex,E=c.lineStartIndex+c.lineLength,S=e.getoffsetX(c.glyphStartIndex),A=e.getoffsetX(y-1),L=be(u*S,a,n,o,c.segment,v,E,_,m);if(!L)return null;const R=be(u*A,a,n,o,c.segment,v,E,_,m);return R?_.projectionCache.anyProjectionOccluded?null:{first:L,last:R}:null}function X(u,e,a,n){return u===p.ah.horizontal&&Math.abs(a.y-e.y)>Math.abs(a.x-e.x)*n?{useVertical:!0}:(u===p.ah.vertical?e.y<a.y:e.x>a.x)?{needsFlipping:!0}:null}function J(u,e,a,n,o,c,m,_,y,v,E){const S=a/24,A=e.lineOffsetX*S,L=e.lineOffsetY*S;let R;if(e.numGlyphs>1){const U=e.glyphStartIndex+e.numGlyphs,q=e.lineStartIndex,Z=e.lineStartIndex+e.lineLength,H=N(S,_,A,L,n,e,E,u);if(!H)return{notEnoughRoom:!0};const F=j(H.first.point.x,H.first.point.y,m,u.getElevation).point,K=j(H.last.point.x,H.last.point.y,m,u.getElevation).point;if(o&&!n){const Y=X(e.writingMode,F,K,v);if(Y)return Y}R=[H.first];for(let Y=e.glyphStartIndex+1;Y<U-1;Y++)R.push(be(S*_.getoffsetX(Y),A,L,n,e.segment,q,Z,u,E));R.push(H.last)}else{if(o&&!n){const q=j(u.tileAnchorPoint.x,u.tileAnchorPoint.y,c,u.getElevation).point,Z=e.lineStartIndex+e.segment+1,H=new p.P(u.lineVertexArray.getx(Z),u.lineVertexArray.gety(Z)),F=j(H.x,H.y,c,u.getElevation),K=F.signedDistanceFromCamera>0?F.point:function(re,de,_e,Te,Ce,ve){return ee(re,de,_e,1,Ce,ve)}(u.tileAnchorPoint,H,q,0,c,u),Y=X(e.writingMode,q,K,v);if(Y)return Y}const U=be(S*_.getoffsetX(e.glyphStartIndex),A,L,n,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,u,E);if(!U||u.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};R=[U]}for(const U of R)p.aj(y,U.point,U.angle);return{}}function ee(u,e,a,n,o,c){const m=u.add(u.sub(e)._unit()),_=o!==void 0?j(m.x,m.y,o,c.getElevation).point:ce(m.x,m.y,c).point,y=a.sub(_);return a.add(y._mult(n/y.mag()))}function G(u,e,a){const n=e.projectionCache;if(n.projections[u])return n.projections[u];const o=new p.P(e.lineVertexArray.getx(u),e.lineVertexArray.gety(u)),c=ce(o.x,o.y,e);if(c.signedDistanceFromCamera>0)return n.projections[u]=c.point,n.anyProjectionOccluded=n.anyProjectionOccluded||c.isOccluded,c.point;const m=u-a.direction;return function(_,y,v,E,S){return ee(_,y,v,E,void 0,S)}(a.distanceFromAnchor===0?e.tileAnchorPoint:new p.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),o,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,e)}function ce(u,e,a){const n=u+a.translation[0],o=e+a.translation[1];let c;return!a.pitchWithMap&&a.projection.useSpecialProjectionForSymbols?(c=a.projection.projectTileCoordinates(n,o,a.unwrappedTileID,a.getElevation),c.point.x=(.5*c.point.x+.5)*a.width,c.point.y=(.5*-c.point.y+.5)*a.height):(c=j(n,o,a.labelPlaneMatrix,a.getElevation),c.isOccluded=!1),c}function pe(u,e,a){return u._unit()._perp()._mult(e*a)}function ne(u,e,a,n,o,c,m,_,y){if(_.projectionCache.offsets[u])return _.projectionCache.offsets[u];const v=a.add(e);if(u+y.direction<n||u+y.direction>=o)return _.projectionCache.offsets[u]=v,v;const E=G(u+y.direction,_,y),S=pe(E.sub(a),m,y.direction),A=a.add(S),L=E.add(S);return _.projectionCache.offsets[u]=p.ak(c,v,A,L)||v,_.projectionCache.offsets[u]}function be(u,e,a,n,o,c,m,_,y){const v=n?u-e:u+e;let E=v>0?1:-1,S=0;n&&(E*=-1,S=Math.PI),E<0&&(S+=Math.PI);let A,L=E>0?c+o:c+o+1;_.projectionCache.cachedAnchorPoint?A=_.projectionCache.cachedAnchorPoint:(A=ce(_.tileAnchorPoint.x,_.tileAnchorPoint.y,_).point,_.projectionCache.cachedAnchorPoint=A);let R,U,q=A,Z=A,H=0,F=0;const K=Math.abs(v),Y=[];let re;for(;H+F<=K;){if(L+=E,L<c||L>=m)return null;H+=F,Z=q,U=R;const Te={absOffsetX:K,direction:E,distanceFromAnchor:H,previousVertex:Z};if(q=G(L,_,Te),a===0)Y.push(Z),re=q.sub(Z);else{let Ce;const ve=q.sub(Z);Ce=ve.mag()===0?pe(G(L+E,_,Te).sub(q),a,E):pe(ve,a,E),U||(U=Z.add(Ce)),R=ne(L,Ce,q,c,m,U,a,_,Te),Y.push(U),re=R.sub(U)}F=re.mag()}const de=re._mult((K-H)/F)._add(U||Z),_e=S+Math.atan2(q.y-Z.y,q.x-Z.x);return Y.push(de),{point:de,angle:y?_e:0,path:Y}}const Oe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ve(u,e){for(let a=0;a<u;a++){const n=e.length;e.resize(n+4),e.float32.set(Oe,3*n)}}function nt(u,e,a){const n=e[0],o=e[1];return u[0]=a[0]*n+a[4]*o+a[12],u[1]=a[1]*n+a[5]*o+a[13],u[3]=a[3]*n+a[7]*o+a[15],u}const He=100;class ot{constructor(e,a,n=new Fr(e.width+200,e.height+200,25),o=new Fr(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=a,this.grid=n,this.ignoredGrid=o,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+He,this.screenBottomBoundary=e.height+He,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,a,n,o,c,m,_,y,v,E,S){const A=e.anchorPointX+y[0],L=e.anchorPointY+y[1],R=this.projectAndGetPerspectiveRatio(o,A,L,c,E),U=n*R.perspectiveRatio;let q;if(m||_)q=this._projectCollisionBox(e,U,o,c,m,_,y,R,E,S);else{const Y=R.point.x+(S?S.x*U:0),re=R.point.y+(S?S.y*U:0);q={allPointsOccluded:!1,box:[Y+e.x1*U,re+e.y1*U,Y+e.x2*U,re+e.y2*U]}}const[Z,H,F,K]=q.box;return this.mapProjection.useSpecialProjectionForSymbols&&(m?q.allPointsOccluded:this.mapProjection.isOccluded(A,L,c))||R.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Z,H,F,K)||a!=="always"&&this.grid.hitTest(Z,H,F,K,a,v)?{box:[Z,H,F,K],placeable:!1,offscreen:!1}:{box:[Z,H,F,K],placeable:!0,offscreen:this.isOffscreen(Z,H,F,K)}}placeCollisionCircles(e,a,n,o,c,m,_,y,v,E,S,A,L,R,U,q){const Z=[],H=new p.P(a.anchorX,a.anchorY),F=this.getPerspectiveRatio(m,H.x,H.y,_,q),K=(S?c/F:c*F)/p.ap,Y={getElevation:q,labelPlaneMatrix:y,lineVertexArray:n,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:H,unwrappedTileID:_,width:this.transform.width,height:this.transform.height,translation:U},re=N(K,o,a.lineOffsetX*K,a.lineOffsetY*K,!1,a,!1,Y);let de=!1,_e=!1,Te=!0;if(re){const Ce=.5*L*F+R,ve=new p.P(-100,-100),xe=new p.P(this.screenRightBoundary,this.screenBottomBoundary),Le=new Ge,Ze=re.first,Ee=re.last;let ke=[];for(let We=Ze.path.length-1;We>=1;We--)ke.push(Ze.path[We]);for(let We=1;We<Ee.path.length;We++)ke.push(Ee.path[We]);const $e=2.5*Ce;if(v){const We=this.projectPathToScreenSpace(ke,Y,v);ke=We.some(tt=>tt.signedDistanceFromCamera<=0)?[]:We.map(tt=>tt.point)}let Tt=[];if(ke.length>0){const We=ke[0].clone(),tt=ke[0].clone();for(let It=1;It<ke.length;It++)We.x=Math.min(We.x,ke[It].x),We.y=Math.min(We.y,ke[It].y),tt.x=Math.max(tt.x,ke[It].x),tt.y=Math.max(tt.y,ke[It].y);Tt=We.x>=ve.x&&tt.x<=xe.x&&We.y>=ve.y&&tt.y<=xe.y?[ke]:tt.x<ve.x||We.x>xe.x||tt.y<ve.y||We.y>xe.y?[]:p.al([ke],ve.x,ve.y,xe.x,xe.y)}for(const We of Tt){Le.reset(We,.25*Ce);let tt=0;tt=Le.length<=.5*Ce?1:Math.ceil(Le.paddedLength/$e)+1;for(let It=0;It<tt;It++){const ni=It/Math.max(tt-1,1),dr=Le.lerp(ni),kt=dr.x+He,Ii=dr.y+He;Z.push(kt,Ii,Ce,0);const _i=kt-Ce,oi=Ii-Ce,yi=kt+Ce,Pr=Ii+Ce;if(Te=Te&&this.isOffscreen(_i,oi,yi,Pr),_e=_e||this.isInsideGrid(_i,oi,yi,Pr),e!=="always"&&this.grid.hitTestCircle(kt,Ii,Ce,e,A)&&(de=!0,!E))return{circles:[],offscreen:!1,collisionDetected:de}}}}return{circles:!E&&de||!_e||F<this.perspectiveRatioCutoff?[]:Z,offscreen:Te,collisionDetected:de}}projectPathToScreenSpace(e,a,n){return e.map(o=>j(o.x,o.y,n,a.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let n=1/0,o=1/0,c=-1/0,m=-1/0;for(const E of e){const S=new p.P(E.x+He,E.y+He);n=Math.min(n,S.x),o=Math.min(o,S.y),c=Math.max(c,S.x),m=Math.max(m,S.y),a.push(S)}const _=this.grid.query(n,o,c,m).concat(this.ignoredGrid.query(n,o,c,m)),y={},v={};for(const E of _){const S=E.key;if(y[S.bucketInstanceId]===void 0&&(y[S.bucketInstanceId]={}),y[S.bucketInstanceId][S.featureIndex])continue;const A=[new p.P(E.x1,E.y1),new p.P(E.x2,E.y1),new p.P(E.x2,E.y2),new p.P(E.x1,E.y2)];p.am(a,A)&&(y[S.bucketInstanceId][S.featureIndex]=!0,v[S.bucketInstanceId]===void 0&&(v[S.bucketInstanceId]=[]),v[S.bucketInstanceId].push(S.featureIndex))}return v}insertCollisionBox(e,a,n,o,c,m){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:c,collisionGroupID:m,overlapMode:a},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,a,n,o,c,m){const _=n?this.ignoredGrid:this.grid,y={bucketInstanceId:o,featureIndex:c,collisionGroupID:m,overlapMode:a};for(let v=0;v<e.length;v+=4)_.insertCircle(y,e[v],e[v+1],e[v+2])}projectAndGetPerspectiveRatio(e,a,n,o,c){let m;c?(m=[a,n,c(a,n),1],p.af(m,m,e)):(m=[a,n,0,1],nt(m,m,e));const _=m[3];return{point:new p.P((m[0]/_+1)/2*this.transform.width+He,(-m[1]/_+1)/2*this.transform.height+He),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_*.5,isOccluded:!1,signedDistanceFromCamera:_}}getPerspectiveRatio(e,a,n,o,c){const m=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(a,n,o,c):j(a,n,e,c);return .5+this.transform.cameraToCenterDistance/m.signedDistanceFromCamera*.5}isOffscreen(e,a,n,o){return n<He||e>=this.screenRightBoundary||o<He||a>this.screenBottomBoundary}isInsideGrid(e,a,n,o){return n>=0&&e<this.gridRightBoundary&&o>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const e=p.an([]);return p.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,a,n,o,c,m,_,y,v,E){let S=new p.P(1,0),A=new p.P(0,1);const L=new p.P(e.anchorPointX+_[0],e.anchorPointY+_[1]);if(m&&!c){const Te=this.projectAndGetPerspectiveRatio(n,L.x+1,L.y,o,v).point.sub(y.point).unit(),Ce=Math.atan(Te.y/Te.x)+(Te.x<0?Math.PI:0),ve=Math.sin(Ce),xe=Math.cos(Ce);S=new p.P(xe,ve),A=new p.P(-ve,xe)}else if(!m&&c){const Te=-this.transform.angle,Ce=Math.sin(Te),ve=Math.cos(Te);S=new p.P(ve,Ce),A=new p.P(-Ce,ve)}let R=y.point,U=a;if(c){R=L;const Te=this.transform.zoom-Math.floor(this.transform.zoom);U=Math.pow(2,-Te),U*=this.mapProjection.getPitchedTextCorrection(this.transform,L,o),E||(U*=p.ac(.5+y.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}E&&(R=R.add(S.mult(E.x*U)).add(A.mult(E.y*U)));const q=e.x1*U,Z=e.x2*U,H=(q+Z)/2,F=e.y1*U,K=e.y2*U,Y=(F+K)/2,re=[{offsetX:q,offsetY:F},{offsetX:H,offsetY:F},{offsetX:Z,offsetY:F},{offsetX:Z,offsetY:Y},{offsetX:Z,offsetY:K},{offsetX:H,offsetY:K},{offsetX:q,offsetY:K},{offsetX:q,offsetY:Y}];let de=[];for(const{offsetX:Te,offsetY:Ce}of re)de.push(new p.P(R.x+S.x*Te+A.x*Ce,R.y+S.y*Te+A.y*Ce));let _e=!1;if(c){const Te=de.map(Ce=>this.projectAndGetPerspectiveRatio(n,Ce.x,Ce.y,o,v));_e=Te.some(Ce=>!Ce.isOccluded),de=Te.map(Ce=>Ce.point)}else _e=!0;return{box:p.ao(de),allPointsOccluded:!_e}}}function et(u,e,a){return e*(p.X/(u.tileSize*Math.pow(2,a-u.tileID.overscaledZ)))}class jt{constructor(e,a,n,o){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?a:-a))):o&&n?1:0,this.placed=n}isHidden(){return this.opacity===0&&!this.placed}}class Dt{constructor(e,a,n,o,c){this.text=new jt(e?e.text:null,a,n,c),this.icon=new jt(e?e.icon:null,a,o,c)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ke{constructor(e,a,n){this.text=e,this.icon=a,this.skipFade=n}}class ft{constructor(){this.invProjMatrix=p.H(),this.viewportMatrix=p.H(),this.circles=[]}}class Ct{constructor(e,a,n,o,c){this.bucketInstanceId=e,this.featureIndex=a,this.sourceLayerIndex=n,this.bucketIndex=o,this.tileID=c}}class Wt{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const a=++this.maxGroupID;this.collisionGroups[e]={ID:a,predicate:n=>n.collisionGroupID===a}}return this.collisionGroups[e]}}function ii(u,e,a,n,o){const{horizontalAlign:c,verticalAlign:m}=p.au(u);return new p.P(-(c-.5)*e+n[0]*o,-(m-.5)*a+n[1]*o)}class gi{constructor(e,a,n,o,c,m){this.transform=e.clone(),this.terrain=n,this.collisionIndex=new ot(this.transform,a),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Wt(c),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const a=this.terrain;return a?(n,o)=>a.getElevation(e,n,o):null}getBucketParts(e,a,n,o){const c=n.getBucket(a),m=n.latestFeatureIndex;if(!c||!m||a.id!==c.layerIds[0])return;const _=n.collisionBoxArray,y=c.layers[0].layout,v=c.layers[0].paint,E=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),S=n.tileSize/p.X,A=n.tileID.toUnwrapped(),L=this.transform.calculatePosMatrix(A),R=y.get("text-pitch-alignment")==="map",U=y.get("text-rotation-alignment")==="map",q=et(n,1,this.transform.zoom),Z=this.collisionIndex.mapProjection.translatePosition(this.transform,n,v.get("text-translate"),v.get("text-translate-anchor")),H=this.collisionIndex.mapProjection.translatePosition(this.transform,n,v.get("icon-translate"),v.get("icon-translate-anchor")),F=Xr(L,R,U,this.transform,q);let K=null;if(R){const re=Sr(L,R,U,this.transform,q);K=p.L([],this.transform.labelPlaneMatrix,re)}this.retainedQueryData[c.bucketInstanceId]=new Ct(c.bucketInstanceId,m,c.sourceLayerIndex,c.index,n.tileID);const Y={bucket:c,layout:y,translationText:Z,translationIcon:H,posMatrix:L,unwrappedTileID:A,textLabelPlaneMatrix:F,labelToScreenMatrix:K,scale:E,textPixelRatio:S,holdingForFade:n.holdingForFade(),collisionBoxArray:_,partiallyEvaluatedTextSize:p.ag(c.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(c.sourceID)};if(o)for(const re of c.sortKeyRanges){const{sortKey:de,symbolInstanceStart:_e,symbolInstanceEnd:Te}=re;e.push({sortKey:de,symbolInstanceStart:_e,symbolInstanceEnd:Te,parameters:Y})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:c.symbolInstances.length,parameters:Y})}attemptAnchorPlacement(e,a,n,o,c,m,_,y,v,E,S,A,L,R,U,q,Z,H,F){const K=p.aq[e.textAnchor],Y=[e.textOffset0,e.textOffset1],re=ii(K,n,o,Y,c),de=this.collisionIndex.placeCollisionBox(a,A,y,v,E,_,m,q,S.predicate,F,re);if((!H||this.collisionIndex.placeCollisionBox(H,A,y,v,E,_,m,Z,S.predicate,F,re).placeable)&&de.placeable){let _e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID].text&&(_e=this.prevPlacement.variableOffsets[L.crossTileID].anchor),L.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[L.crossTileID]={textOffset:Y,width:n,height:o,anchor:K,textBoxScale:c,prevAnchor:_e},this.markUsedJustification(R,K,L,U),R.allowVerticalPlacement&&(this.markUsedOrientation(R,U,L),this.placedOrientations[L.crossTileID]=U),{shift:re,placedGlyphBoxes:de}}}placeLayerBucketPart(e,a,n){const{bucket:o,layout:c,translationText:m,translationIcon:_,posMatrix:y,unwrappedTileID:v,textLabelPlaneMatrix:E,labelToScreenMatrix:S,textPixelRatio:A,holdingForFade:L,collisionBoxArray:R,partiallyEvaluatedTextSize:U,collisionGroup:q}=e.parameters,Z=c.get("text-optional"),H=c.get("icon-optional"),F=p.ar(c,"text-overlap","text-allow-overlap"),K=F==="always",Y=p.ar(c,"icon-overlap","icon-allow-overlap"),re=Y==="always",de=c.get("text-rotation-alignment")==="map",_e=c.get("text-pitch-alignment")==="map",Te=c.get("icon-text-fit")!=="none",Ce=c.get("symbol-z-order")==="viewport-y",ve=K&&(re||!o.hasIconData()||H),xe=re&&(K||!o.hasTextData()||Z);!o.collisionArrays&&R&&o.deserializeCollisionBoxes(R);const Le=this._getTerrainElevationFunc(this.retainedQueryData[o.bucketInstanceId].tileID),Ze=(Ee,ke,$e)=>{var Tt,We;if(a[Ee.crossTileID])return;if(L)return void(this.placements[Ee.crossTileID]=new Ke(!1,!1,!1));let tt=!1,It=!1,ni=!0,dr=null,kt={box:null,placeable:!1,offscreen:null},Ii={placeable:!1},_i=null,oi=null,yi=null,Pr=0,Ka=0,En=0;ke.textFeatureIndex?Pr=ke.textFeatureIndex:Ee.useRuntimeCollisionCircles&&(Pr=Ee.featureIndex),ke.verticalTextFeatureIndex&&(Ka=ke.verticalTextFeatureIndex);const Ja=ke.textBox;if(Ja){const er=ri=>{let li=p.ah.horizontal;if(o.allowVerticalPlacement&&!ri&&this.prevPlacement){const ji=this.prevPlacement.placedOrientations[Ee.crossTileID];ji&&(this.placedOrientations[Ee.crossTileID]=ji,li=ji,this.markUsedOrientation(o,li,Ee))}return li},tr=(ri,li)=>{if(o.allowVerticalPlacement&&Ee.numVerticalGlyphVertices>0&&ke.verticalTextBox){for(const ji of o.writingModes)if(ji===p.ah.vertical?(kt=li(),Ii=kt):kt=ri(),kt&&kt.placeable)break}else kt=ri()},Yr=Ee.textAnchorOffsetStartIndex,pr=Ee.textAnchorOffsetEndIndex;if(pr===Yr){const ri=(li,ji)=>{const rt=this.collisionIndex.placeCollisionBox(li,F,A,y,v,_e,de,m,q.predicate,Le);return rt&&rt.placeable&&(this.markUsedOrientation(o,ji,Ee),this.placedOrientations[Ee.crossTileID]=ji),rt};tr(()=>ri(Ja,p.ah.horizontal),()=>{const li=ke.verticalTextBox;return o.allowVerticalPlacement&&Ee.numVerticalGlyphVertices>0&&li?ri(li,p.ah.vertical):{box:null,offscreen:null}}),er(kt&&kt.placeable)}else{let ri=p.aq[(We=(Tt=this.prevPlacement)===null||Tt===void 0?void 0:Tt.variableOffsets[Ee.crossTileID])===null||We===void 0?void 0:We.anchor];const li=(rt,va,Ya)=>{const Qa=rt.x2-rt.x1,Bl=rt.y2-rt.y1,Oc=Ee.textBoxScale,Fl=Te&&Y==="never"?va:null;let Qr=null,Ol=F==="never"?1:2,Tn="never";ri&&Ol++;for(let Ls=0;Ls<Ol;Ls++){for(let In=Yr;In<pr;In++){const kn=o.textAnchorOffsets.get(In);if(ri&&kn.textAnchor!==ri)continue;const es=this.attemptAnchorPlacement(kn,rt,Qa,Bl,Oc,de,_e,A,y,v,q,Tn,Ee,o,Ya,m,_,Fl,Le);if(es&&(Qr=es.placedGlyphBoxes,Qr&&Qr.placeable))return tt=!0,dr=es.shift,Qr}ri?ri=null:Tn=F}return n&&!Qr&&(Qr={box:this.collisionIndex.placeCollisionBox(Ja,"always",A,y,v,_e,de,m,q.predicate,Le,new p.P(0,0)).box,offscreen:!1,placeable:!1}),Qr};tr(()=>li(Ja,ke.iconBox,p.ah.horizontal),()=>{const rt=ke.verticalTextBox;return o.allowVerticalPlacement&&(!kt||!kt.placeable)&&Ee.numVerticalGlyphVertices>0&&rt?li(rt,ke.verticalIconBox,p.ah.vertical):{box:null,occluded:!0,offscreen:null}}),kt&&(tt=kt.placeable,ni=kt.offscreen);const ji=er(kt&&kt.placeable);if(!tt&&this.prevPlacement){const rt=this.prevPlacement.variableOffsets[Ee.crossTileID];rt&&(this.variableOffsets[Ee.crossTileID]=rt,this.markUsedJustification(o,rt.anchor,Ee,ji))}}}if(_i=kt,tt=_i&&_i.placeable,ni=_i&&_i.offscreen,Ee.useRuntimeCollisionCircles){const er=o.text.placedSymbolArray.get(Ee.centerJustifiedTextSymbolIndex),tr=p.ai(o.textSizeData,U,er),Yr=c.get("text-padding");oi=this.collisionIndex.placeCollisionCircles(F,er,o.lineVertexArray,o.glyphOffsetArray,tr,y,v,E,S,n,_e,q.predicate,Ee.collisionCircleDiameter,Yr,m,Le),oi.circles.length&&oi.collisionDetected&&!n&&p.w("Collisions detected, but collision boxes are not shown"),tt=K||oi.circles.length>0&&!oi.collisionDetected,ni=ni&&oi.offscreen}if(ke.iconFeatureIndex&&(En=ke.iconFeatureIndex),ke.iconBox){const er=tr=>this.collisionIndex.placeCollisionBox(tr,Y,A,y,v,_e,de,_,q.predicate,Le,Te&&dr?dr:void 0);Ii&&Ii.placeable&&ke.verticalIconBox?(yi=er(ke.verticalIconBox),It=yi.placeable):(yi=er(ke.iconBox),It=yi.placeable),ni=ni&&yi.offscreen}const Qi=Z||Ee.numHorizontalGlyphVertices===0&&Ee.numVerticalGlyphVertices===0,Sn=H||Ee.numIconVertices===0;Qi||Sn?Sn?Qi||(It=It&&tt):tt=It&&tt:It=tt=It&&tt;const Do=It&&yi.placeable;if(tt&&_i.placeable&&this.collisionIndex.insertCollisionBox(_i.box,F,c.get("text-ignore-placement"),o.bucketInstanceId,Ii&&Ii.placeable&&Ka?Ka:Pr,q.ID),Do&&this.collisionIndex.insertCollisionBox(yi.box,Y,c.get("icon-ignore-placement"),o.bucketInstanceId,En,q.ID),oi&&tt&&this.collisionIndex.insertCollisionCircles(oi.circles,F,c.get("text-ignore-placement"),o.bucketInstanceId,Pr,q.ID),n&&this.storeCollisionData(o.bucketInstanceId,$e,ke,_i,yi,oi),Ee.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(o.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ee.crossTileID]=new Ke(tt||ve,It||xe,ni||o.justReloaded),a[Ee.crossTileID]=!0};if(Ce){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ee=o.getSortedSymbolIndexes(this.transform.angle);for(let ke=Ee.length-1;ke>=0;--ke){const $e=Ee[ke];Ze(o.symbolInstances.get($e),o.collisionArrays[$e],$e)}}else for(let Ee=e.symbolInstanceStart;Ee<e.symbolInstanceEnd;Ee++)Ze(o.symbolInstances.get(Ee),o.collisionArrays[Ee],Ee);if(n&&o.bucketInstanceId in this.collisionCircleArrays){const Ee=this.collisionCircleArrays[o.bucketInstanceId];p.as(Ee.invProjMatrix,y),Ee.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}storeCollisionData(e,a,n,o,c,m){if(n.textBox||n.iconBox){let _,y;this.collisionBoxArrays.has(e)?_=this.collisionBoxArrays.get(e):(_=new Map,this.collisionBoxArrays.set(e,_)),_.has(a)?y=_.get(a):(y={text:null,icon:null},_.set(a,y)),n.textBox&&(y.text=o.box),n.iconBox&&(y.icon=c.box)}if(m){let _=this.collisionCircleArrays[e];_===void 0&&(_=this.collisionCircleArrays[e]=new ft);for(let y=0;y<m.circles.length;y+=4)_.circles.push(m.circles[y+0]),_.circles.push(m.circles[y+1]),_.circles.push(m.circles[y+2]),_.circles.push(m.collisionDetected?1:0)}}markUsedJustification(e,a,n,o){let c;c=o===p.ah.vertical?n.verticalPlacedTextSymbolIndex:{left:n.leftJustifiedTextSymbolIndex,center:n.centerJustifiedTextSymbolIndex,right:n.rightJustifiedTextSymbolIndex}[p.at(a)];const m=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex,n.verticalPlacedTextSymbolIndex];for(const _ of m)_>=0&&(e.text.placedSymbolArray.get(_).crossTileID=c>=0&&_!==c?0:n.crossTileID)}markUsedOrientation(e,a,n){const o=a===p.ah.horizontal||a===p.ah.horizontalOnly?a:0,c=a===p.ah.vertical?a:0,m=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex];for(const _ of m)e.text.placedSymbolArray.get(_).placedOrientation=o;n.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).placedOrientation=c)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let n=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const o=a?a.symbolFadeChange(e):1,c=a?a.opacities:{},m=a?a.variableOffsets:{},_=a?a.placedOrientations:{};for(const y in this.placements){const v=this.placements[y],E=c[y];E?(this.opacities[y]=new Dt(E,o,v.text,v.icon),n=n||v.text!==E.text.placed||v.icon!==E.icon.placed):(this.opacities[y]=new Dt(null,o,v.text,v.icon,v.skipFade),n=n||v.text||v.icon)}for(const y in c){const v=c[y];if(!this.opacities[y]){const E=new Dt(v,o,!1,!1);E.isHidden()||(this.opacities[y]=E,n=n||v.text.placed||v.icon.placed)}}for(const y in m)this.variableOffsets[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.variableOffsets[y]=m[y]);for(const y in _)this.placedOrientations[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.placedOrientations[y]=_[y]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");n?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:e)}updateLayerOpacities(e,a){const n={};for(const o of a){const c=o.getBucket(e);c&&o.latestFeatureIndex&&e.id===c.layerIds[0]&&this.updateBucketOpacities(c,o.tileID,n,o.collisionBoxArray)}}updateBucketOpacities(e,a,n,o){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const c=e.layers[0],m=c.layout,_=new Dt(null,0,!1,!1,!0),y=m.get("text-allow-overlap"),v=m.get("icon-allow-overlap"),E=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),S=m.get("text-rotation-alignment")==="map",A=m.get("text-pitch-alignment")==="map",L=m.get("icon-text-fit")!=="none",R=new Dt(null,0,y&&(v||!e.hasIconData()||m.get("icon-optional")),v&&(y||!e.hasTextData()||m.get("text-optional")),!0);!e.collisionArrays&&o&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(o);const U=(Z,H,F)=>{for(let K=0;K<H/4;K++)Z.opacityVertexArray.emplaceBack(F);Z.hasVisibleVertices=Z.hasVisibleVertices||F!==Aa},q=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Z=0;Z<e.symbolInstances.length;Z++){const H=e.symbolInstances.get(Z),{numHorizontalGlyphVertices:F,numVerticalGlyphVertices:K,crossTileID:Y}=H;let re=this.opacities[Y];n[Y]?re=_:re||(re=R,this.opacities[Y]=re),n[Y]=!0;const de=H.numIconVertices>0,_e=this.placedOrientations[H.crossTileID],Te=_e===p.ah.vertical,Ce=_e===p.ah.horizontal||_e===p.ah.horizontalOnly;if(F>0||K>0){const xe=Vi(re.text);U(e.text,F,Te?Aa:xe),U(e.text,K,Ce?Aa:xe);const Le=re.text.isHidden();[H.rightJustifiedTextSymbolIndex,H.centerJustifiedTextSymbolIndex,H.leftJustifiedTextSymbolIndex].forEach(ke=>{ke>=0&&(e.text.placedSymbolArray.get(ke).hidden=Le||Te?1:0)}),H.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(H.verticalPlacedTextSymbolIndex).hidden=Le||Ce?1:0);const Ze=this.variableOffsets[H.crossTileID];Ze&&this.markUsedJustification(e,Ze.anchor,H,_e);const Ee=this.placedOrientations[H.crossTileID];Ee&&(this.markUsedJustification(e,"left",H,Ee),this.markUsedOrientation(e,Ee,H))}if(de){const xe=Vi(re.icon),Le=!(L&&H.verticalPlacedIconSymbolIndex&&Te);H.placedIconSymbolIndex>=0&&(U(e.icon,H.numIconVertices,Le?xe:Aa),e.icon.placedSymbolArray.get(H.placedIconSymbolIndex).hidden=re.icon.isHidden()),H.verticalPlacedIconSymbolIndex>=0&&(U(e.icon,H.numVerticalIconVertices,Le?Aa:xe),e.icon.placedSymbolArray.get(H.verticalPlacedIconSymbolIndex).hidden=re.icon.isHidden())}const ve=q&&q.has(Z)?q.get(Z):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const xe=e.collisionArrays[Z];if(xe){let Le=new p.P(0,0);if(xe.textBox||xe.verticalTextBox){let Ze=!0;if(E){const Ee=this.variableOffsets[Y];Ee?(Le=ii(Ee.anchor,Ee.width,Ee.height,Ee.textOffset,Ee.textBoxScale),S&&Le._rotate(A?this.transform.angle:-this.transform.angle)):Ze=!1}if(xe.textBox||xe.verticalTextBox){let Ee;xe.textBox&&(Ee=Te),xe.verticalTextBox&&(Ee=Ce),Ca(e.textCollisionBox.collisionVertexArray,re.text.placed,!Ze||Ee,ve.text,Le.x,Le.y)}}if(xe.iconBox||xe.verticalIconBox){const Ze=!!(!Ce&&xe.verticalIconBox);let Ee;xe.iconBox&&(Ee=Ze),xe.verticalIconBox&&(Ee=!Ze),Ca(e.iconCollisionBox.collisionVertexArray,re.icon.placed,Ee,ve.icon,L?Le.x:0,L?Le.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const Z=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=Z.invProjMatrix,e.placementViewportMatrix=Z.viewportMatrix,e.collisionCircleArray=Z.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,a){const n=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*n>e}setStale(){this.stale=!0}}function Ca(u,e,a,n,o,c){n&&n.length!==0||(n=[0,0,0,0]);const m=n[0]-He,_=n[1]-He,y=n[2]-He,v=n[3]-He;u.emplaceBack(e?1:0,a?1:0,o||0,c||0,m,_),u.emplaceBack(e?1:0,a?1:0,o||0,c||0,y,_),u.emplaceBack(e?1:0,a?1:0,o||0,c||0,y,v),u.emplaceBack(e?1:0,a?1:0,o||0,c||0,m,v)}const mt=Math.pow(2,25),$n=Math.pow(2,24),qn=Math.pow(2,17),Fi=Math.pow(2,16),Oi=Math.pow(2,9),dc=Math.pow(2,8),Xi=Math.pow(2,1);function Vi(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const e=u.placed?1:0,a=Math.floor(127*u.opacity);return a*mt+e*$n+a*qn+e*Fi+a*Oi+e*dc+a*Xi+e}const Aa=0;function ca(){return{isOccluded:(u,e,a)=>!1,getPitchedTextCorrection:(u,e,a)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(u,e,a,n){throw new Error("Not implemented.")},translatePosition:(u,e,a,n)=>function(o,c,m,_,y=!1){if(!m[0]&&!m[1])return[0,0];const v=y?_==="map"?o.angle:0:_==="viewport"?-o.angle:0;if(v){const E=Math.sin(v),S=Math.cos(v);m=[m[0]*S-m[1]*E,m[0]*E+m[1]*S]}return[y?m[0]:et(c,m[0],o.zoom),y?m[1]:et(c,m[1],o.zoom)]}(u,e,a,n),getCircleRadiusCorrection:u=>1}}class $t{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,a,n,o,c){const m=this._bucketParts;for(;this._currentTileIndex<e.length;)if(a.getBucketParts(m,o,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,c())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,m.sort((_,y)=>_.sortKey-y.sortKey));this._currentPartIndex<m.length;)if(a.placeLayerBucketPart(m[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,c())return!0;return!1}}class ms{constructor(e,a,n,o,c,m,_,y){this.placement=new gi(e,ca(),a,m,_,y),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=c,this._done=!1}isDone(){return this._done}continuePlacement(e,a,n){const o=ge.now(),c=()=>!this._forceFullPlacement&&ge.now()-o>2;for(;this._currentPlacementIndex>=0;){const m=a[e[this._currentPlacementIndex]],_=this.placement.collisionIndex.transform.zoom;if(m.type==="symbol"&&(!m.minzoom||m.minzoom<=_)&&(!m.maxzoom||m.maxzoom>_)){if(this._inProgressLayer||(this._inProgressLayer=new $t(m)),this._inProgressLayer.continuePlacement(n[m.source],this.placement,this._showCollisionBoxes,m,c))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const or=512/p.X/2;class Nt{constructor(e,a,n){this.tileID=e,this.bucketInstanceId=n,this._symbolsByKey={};const o=new Map;for(let c=0;c<a.length;c++){const m=a.get(c),_=m.key,y=o.get(_);y?y.push(m):o.set(_,[m])}for(const[c,m]of o){const _={positions:m.map(y=>({x:Math.floor(y.anchorX*or),y:Math.floor(y.anchorY*or)})),crossTileIDs:m.map(y=>y.crossTileID)};if(_.positions.length>128){const y=new p.av(_.positions.length,16,Uint16Array);for(const{x:v,y:E}of _.positions)y.add(v,E);y.finish(),delete _.positions,_.index=y}this._symbolsByKey[c]=_}}getScaledCoordinates(e,a){const{x:n,y:o,z:c}=this.tileID.canonical,{x:m,y:_,z:y}=a.canonical,v=or/Math.pow(2,y-c),E=(_*p.X+e.anchorY)*v,S=o*p.X*or;return{x:Math.floor((m*p.X+e.anchorX)*v-n*p.X*or),y:Math.floor(E-S)}}findMatches(e,a,n){const o=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let c=0;c<e.length;c++){const m=e.get(c);if(m.crossTileID)continue;const _=this._symbolsByKey[m.key];if(!_)continue;const y=this.getScaledCoordinates(m,a);if(_.index){const v=_.index.range(y.x-o,y.y-o,y.x+o,y.y+o).sort();for(const E of v){const S=_.crossTileIDs[E];if(!n[S]){n[S]=!0,m.crossTileID=S;break}}}else if(_.positions)for(let v=0;v<_.positions.length;v++){const E=_.positions[v],S=_.crossTileIDs[v];if(Math.abs(E.x-y.x)<=o&&Math.abs(E.y-y.y)<=o&&!n[S]){n[S]=!0,m.crossTileID=S;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Zs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class lr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const a=Math.round((e-this.lng)/360);if(a!==0)for(const n in this.indexes){const o=this.indexes[n],c={};for(const m in o){const _=o[m];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+a),c[_.tileID.key]=_}this.indexes[n]=c}this.lng=e}addBucket(e,a,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let c=0;c<a.symbolInstances.length;c++)a.symbolInstances.get(c).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const o=this.usedCrossTileIDs[e.overscaledZ];for(const c in this.indexes){const m=this.indexes[c];if(Number(c)>e.overscaledZ)for(const _ in m){const y=m[_];y.tileID.isChildOf(e)&&y.findMatches(a.symbolInstances,e,o)}else{const _=m[e.scaledTo(Number(c)).key];_&&_.findMatches(a.symbolInstances,e,o)}}for(let c=0;c<a.symbolInstances.length;c++){const m=a.symbolInstances.get(c);m.crossTileID||(m.crossTileID=n.generate(),o[m.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Nt(e,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(e,a){for(const n of a.getCrossTileIDsLists())for(const o of n)delete this.usedCrossTileIDs[e][o]}removeStaleBuckets(e){let a=!1;for(const n in this.indexes){const o=this.indexes[n];for(const c in o)e[o[c].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,o[c]),delete o[c],a=!0)}return a}}class Zn{constructor(){this.layerIndexes={},this.crossTileIDs=new Zs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,a,n){let o=this.layerIndexes[e.id];o===void 0&&(o=this.layerIndexes[e.id]=new lr);let c=!1;const m={};o.handleWrapJump(n);for(const _ of a){const y=_.getBucket(e);y&&e.id===y.layerIds[0]&&(y.bucketInstanceId||(y.bucketInstanceId=++this.maxBucketInstanceId),o.addBucket(_.tileID,y,this.crossTileIDs)&&(c=!0),m[y.bucketInstanceId]=!0)}return o.removeStaleBuckets(m)&&(c=!0),c}pruneUnusedLayers(e){const a={};e.forEach(n=>{a[n]=!0});for(const n in this.layerIndexes)a[n]||delete this.layerIndexes[n]}}const cr=(u,e)=>p.t(u,e&&e.filter(a=>a.identifier!=="source.canvas")),pc=p.aw();class Gs extends p.E{constructor(e,a={}){super(),this._rtlPluginLoaded=()=>{for(const n in this.sourceCaches){const o=this.sourceCaches[n].getSource().type;o!=="vector"&&o!=="geojson"||this.sourceCaches[n].reload()}},this.map=e,this.dispatcher=new oa(na(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(n,o)=>this.getGlyphs(n,o)),this.dispatcher.registerMessageHandler("GI",(n,o)=>this.getImages(n,o)),this.imageManager=new Gt,this.imageManager.setEventedParent(this),this.glyphManager=new Bi(e._requestManager,a.localIdeographFontFamily),this.lineAtlas=new fi(256,512),this.crossTileSymbolIndex=new Zn,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new p.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",p.ay()),wr().on(ye,this._rtlPluginLoaded),this.on("data",n=>{if(n.dataType!=="source"||n.sourceDataType!=="metadata")return;const o=this.sourceCaches[n.sourceId];if(!o)return;const c=o.getSource();if(c&&c.vectorLayerIds)for(const m in this._layers){const _=this._layers[m];_.source===c.id&&this._validateLayer(_)}})}loadURL(e,a={},n){this.fire(new p.k("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const o=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const c=this._loadStyleRequest;p.h(o,this._loadStyleRequest).then(m=>{this._loadStyleRequest=null,this._load(m.data,a,n)}).catch(m=>{this._loadStyleRequest=null,m&&!c.signal.aborted&&this.fire(new p.j(m))})}loadJSON(e,a={},n){this.fire(new p.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ge.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(e,a,n)}).catch(()=>{})}loadEmpty(){this.fire(new p.k("dataloading",{dataType:"style"})),this._load(pc,{validate:!1})}_load(e,a,n){var o;const c=a.transformStyle?a.transformStyle(n,e):e;if(!a.validate||!cr(this,p.u(c))){this._loaded=!0,this.stylesheet=c;for(const m in c.sources)this.addSource(m,c.sources[m],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs),this._createLayers(),this.light=new Et(this.stylesheet.light),this.sky=new Rt(this.stylesheet.sky),this.map.setTerrain((o=this.stylesheet.terrain)!==null&&o!==void 0?o:null),this.fire(new p.k("data",{dataType:"style"})),this.fire(new p.k("style.load"))}}_createLayers(){const e=p.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(a=>a.id),this._layers={},this._serializedLayers=null;for(const a of e){const n=p.aA(a);n.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=n}}_loadSprite(e,a=!1,n=void 0){let o;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(c,m,_,y){return p._(this,void 0,void 0,function*(){const v=Qt(c),E=_>1?"@2x":"",S={},A={};for(const{id:L,url:R}of v){const U=m.transformRequest(Li(R,E,".json"),"SpriteJSON");S[L]=p.h(U,y);const q=m.transformRequest(Li(R,E,".png"),"SpriteImage");A[L]=pi.getImage(q,y)}return yield Promise.all([...Object.values(S),...Object.values(A)]),function(L,R){return p._(this,void 0,void 0,function*(){const U={};for(const q in L){U[q]={};const Z=ge.getImageCanvasContext((yield R[q]).data),H=(yield L[q]).data;for(const F in H){const{width:K,height:Y,x:re,y:de,sdf:_e,pixelRatio:Te,stretchX:Ce,stretchY:ve,content:xe,textFitWidth:Le,textFitHeight:Ze}=H[F];U[q][F]={data:null,pixelRatio:Te,sdf:_e,stretchX:Ce,stretchY:ve,content:xe,textFitWidth:Le,textFitHeight:Ze,spriteData:{width:K,height:Y,x:re,y:de,context:Z}}}}return U})}(S,A)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(c=>{if(this._spriteRequest=null,c)for(const m in c){this._spritesImagesIds[m]=[];const _=this._spritesImagesIds[m]?this._spritesImagesIds[m].filter(y=>!(y in c)):[];for(const y of _)this.imageManager.removeImage(y),this._changedImages[y]=!0;for(const y in c[m]){const v=m==="default"?y:`${m}:${y}`;this._spritesImagesIds[m].push(v),v in this.imageManager.images?this.imageManager.updateImage(v,c[m][y],!1):this.imageManager.addImage(v,c[m][y]),a&&(this._changedImages[v]=!0)}}}).catch(c=>{this._spriteRequest=null,o=c,this.fire(new p.j(o))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new p.k("data",{dataType:"style"})),n&&n(o)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new p.k("data",{dataType:"style"}))}_validateLayer(e){const a=this.sourceCaches[e.source];if(!a)return;const n=e.sourceLayer;if(!n)return;const o=a.getSource();(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(n)===-1)&&this.fire(new p.j(new Error(`Source layer "${n}" does not exist on source "${o.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,a=!1){const n=this._serializedAllLayers();if(!e||e.length===0)return Object.values(a?p.aB(n):n);const o=[];for(const c of e)if(n[c]){const m=a?p.aB(n[c]):n[c];o.push(m)}return o}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const a=Object.keys(this._layers);for(const n of a){const o=this._layers[n];o.type!=="custom"&&(e[n]=o.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const a=this._changed;if(a){const o=Object.keys(this._updatedLayers),c=Object.keys(this._removedLayers);(o.length||c.length)&&this._updateWorkerLayers(o,c);for(const m in this._updatedSources){const _=this._updatedSources[m];if(_==="reload")this._reloadSource(m);else{if(_!=="clear")throw new Error(`Invalid action ${_}`);this._clearSource(m)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const m in this._updatedPaintProps)this._layers[m].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const n={};for(const o in this.sourceCaches){const c=this.sourceCaches[o];n[o]=c.used,c.used=!1}for(const o of this._order){const c=this._layers[o];c.recalculate(e,this._availableImages),!c.isHidden(e.zoom)&&c.source&&(this.sourceCaches[c.source].used=!0)}for(const o in n){const c=this.sourceCaches[o];!!n[o]!=!!c.used&&c.fire(new p.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:o}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,a&&this.fire(new p.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,a={}){var n;this._checkLoaded();const o=this.serialize();if(e=a.transformStyle?a.transformStyle(o,e):e,((n=a.validate)===null||n===void 0||n)&&cr(this,p.u(e)))return!1;(e=p.aB(e)).layers=p.az(e.layers);const c=p.aC(o,e),m=this._getOperationsToPerform(c);if(m.unimplemented.length>0)throw new Error(`Unimplemented: ${m.unimplemented.join(", ")}.`);if(m.operations.length===0)return!1;for(const _ of m.operations)_();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const a=[],n=[];for(const o of e)switch(o.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":a.push(()=>this.addLayer.apply(this,o.args));break;case"removeLayer":a.push(()=>this.removeLayer.apply(this,o.args));break;case"setPaintProperty":a.push(()=>this.setPaintProperty.apply(this,o.args));break;case"setLayoutProperty":a.push(()=>this.setLayoutProperty.apply(this,o.args));break;case"setFilter":a.push(()=>this.setFilter.apply(this,o.args));break;case"addSource":a.push(()=>this.addSource.apply(this,o.args));break;case"removeSource":a.push(()=>this.removeSource.apply(this,o.args));break;case"setLayerZoomRange":a.push(()=>this.setLayerZoomRange.apply(this,o.args));break;case"setLight":a.push(()=>this.setLight.apply(this,o.args));break;case"setGeoJSONSourceData":a.push(()=>this.setGeoJSONSourceData.apply(this,o.args));break;case"setGlyphs":a.push(()=>this.setGlyphs.apply(this,o.args));break;case"setSprite":a.push(()=>this.setSprite.apply(this,o.args));break;case"setSky":a.push(()=>this.setSky.apply(this,o.args));break;case"setTerrain":a.push(()=>this.map.setTerrain.apply(this,o.args));break;case"setTransition":a.push(()=>{});break;default:n.push(o.command)}return{operations:a,unimplemented:n}}addImage(e,a){if(this.getImage(e))return this.fire(new p.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,a),this._afterImageUpdated(e)}updateImage(e,a){this.imageManager.updateImage(e,a)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new p.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new p.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,a,n={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(p.u.source,`sources.${e}`,a,null,n))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const o=this.sourceCaches[e]=new je(e,a,this.dispatcher);o.style=this,o.setEventedParent(this,()=>({isSourceLoaded:o.loaded(),source:o.serialize(),sourceId:e})),o.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const n in this._layers)if(this._layers[n].source===e)return this.fire(new p.j(new Error(`Source "${e}" cannot be removed while layer "${n}" is using it.`)));const a=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],a.fire(new p.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,a){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const n=this.sourceCaches[e].getSource();if(n.type!=="geojson")throw new Error(`geojsonSource.type is ${n.type}, which is !== 'geojson`);n.setData(a),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,a,n={}){this._checkLoaded();const o=e.id;if(this.getLayer(o))return void this.fire(new p.j(new Error(`Layer "${o}" already exists on this map.`)));let c;if(e.type==="custom"){if(cr(this,p.aD(e)))return;c=p.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(o,e.source),e=p.aB(e),e=p.e(e,{source:o})),this._validate(p.u.layer,`layers.${o}`,e,{arrayIndex:-1},n))return;c=p.aA(e),this._validateLayer(c),c.setEventedParent(this,{layer:{id:o}})}const m=a?this._order.indexOf(a):this._order.length;if(a&&m===-1)this.fire(new p.j(new Error(`Cannot add layer "${o}" before non-existing layer "${a}".`)));else{if(this._order.splice(m,0,o),this._layerOrderChanged=!0,this._layers[o]=c,this._removedLayers[o]&&c.source&&c.type!=="custom"){const _=this._removedLayers[o];delete this._removedLayers[o],_.type!==c.type?this._updatedSources[c.source]="clear":(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause())}this._updateLayer(c),c.onAdd&&c.onAdd(this.map)}}moveLayer(e,a){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new p.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===a)return;const n=this._order.indexOf(e);this._order.splice(n,1);const o=a?this._order.indexOf(a):this._order.length;a&&o===-1?this.fire(new p.j(new Error(`Cannot move layer "${e}" before non-existing layer "${a}".`))):(this._order.splice(o,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const a=this._layers[e];if(!a)return void this.fire(new p.j(new Error(`Cannot remove non-existing layer "${e}".`)));a.setEventedParent(null);const n=this._order.indexOf(e);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=a,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],a.onRemove&&a.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,a,n){this._checkLoaded();const o=this.getLayer(e);o?o.minzoom===a&&o.maxzoom===n||(a!=null&&(o.minzoom=a),n!=null&&(o.maxzoom=n),this._updateLayer(o)):this.fire(new p.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,a,n={}){this._checkLoaded();const o=this.getLayer(e);if(o){if(!p.aE(o.filter,a))return a==null?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(p.u.filter,`layers.${o.id}.filter`,a,null,n)||(o.filter=p.aB(a),this._updateLayer(o)))}else this.fire(new p.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return p.aB(this.getLayer(e).filter)}setLayoutProperty(e,a,n,o={}){this._checkLoaded();const c=this.getLayer(e);c?p.aE(c.getLayoutProperty(a),n)||(c.setLayoutProperty(a,n,o),this._updateLayer(c)):this.fire(new p.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,a){const n=this.getLayer(e);if(n)return n.getLayoutProperty(a);this.fire(new p.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,a,n,o={}){this._checkLoaded();const c=this.getLayer(e);c?p.aE(c.getPaintProperty(a),n)||(c.setPaintProperty(a,n,o)&&this._updateLayer(c),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new p.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,a){return this.getLayer(e).getPaintProperty(a)}setFeatureState(e,a){this._checkLoaded();const n=e.source,o=e.sourceLayer,c=this.sourceCaches[n];if(c===void 0)return void this.fire(new p.j(new Error(`The source '${n}' does not exist in the map's style.`)));const m=c.getSource().type;m==="geojson"&&o?this.fire(new p.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):m!=="vector"||o?(e.id===void 0&&this.fire(new p.j(new Error("The feature id parameter must be provided."))),c.setFeatureState(o,e.id,a)):this.fire(new p.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,a){this._checkLoaded();const n=e.source,o=this.sourceCaches[n];if(o===void 0)return void this.fire(new p.j(new Error(`The source '${n}' does not exist in the map's style.`)));const c=o.getSource().type,m=c==="vector"?e.sourceLayer:void 0;c!=="vector"||m?a&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new p.j(new Error("A feature id is required to remove its specific state property."))):o.removeFeatureState(m,e.id,a):this.fire(new p.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const a=e.source,n=e.sourceLayer,o=this.sourceCaches[a];if(o!==void 0)return o.getSource().type!=="vector"||n?(e.id===void 0&&this.fire(new p.j(new Error("The feature id parameter must be provided."))),o.getFeatureState(n,e.id)):void this.fire(new p.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new p.j(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return p.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=p.aF(this.sourceCaches,c=>c.serialize()),a=this._serializeByIds(this._order,!0),n=this.map.getTerrain()||void 0,o=this.stylesheet;return p.aG({version:o.version,name:o.name,metadata:o.metadata,light:o.light,sky:o.sky,center:o.center,zoom:o.zoom,bearing:o.bearing,pitch:o.pitch,sprite:o.sprite,glyphs:o.glyphs,transition:o.transition,sources:e,layers:a,terrain:n},c=>c!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const a=m=>this._layers[m].type==="fill-extrusion",n={},o=[];for(let m=this._order.length-1;m>=0;m--){const _=this._order[m];if(a(_)){n[_]=m;for(const y of e){const v=y[_];if(v)for(const E of v)o.push(E)}}}o.sort((m,_)=>_.intersectionZ-m.intersectionZ);const c=[];for(let m=this._order.length-1;m>=0;m--){const _=this._order[m];if(a(_))for(let y=o.length-1;y>=0;y--){const v=o[y].feature;if(n[v.layer.id]<m)break;c.push(v),o.pop()}else for(const y of e){const v=y[_];if(v)for(const E of v)c.push(E.feature)}}return c}queryRenderedFeatures(e,a,n){a&&a.filter&&this._validate(p.u.filter,"queryRenderedFeatures.filter",a.filter,null,a);const o={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new p.j(new Error("parameters.layers must be an Array."))),[];for(const _ of a.layers){const y=this._layers[_];if(!y)return this.fire(new p.j(new Error(`The layer '${_}' does not exist in the map's style and cannot be queried for features.`))),[];o[y.source]=!0}}const c=[];a.availableImages=this._availableImages;const m=this._serializedAllLayers();for(const _ in this.sourceCaches)a.layers&&!o[_]||c.push(Zr(this.sourceCaches[_],this._layers,m,e,a,n));return this.placement&&c.push(function(_,y,v,E,S,A,L){const R={},U=A.queryRenderedSymbols(E),q=[];for(const Z of Object.keys(U).map(Number))q.push(L[Z]);q.sort(Gr);for(const Z of q){const H=Z.featureIndex.lookupSymbolFeatures(U[Z.bucketInstanceId],y,Z.bucketIndex,Z.sourceLayerIndex,S.filter,S.layers,S.availableImages,_);for(const F in H){const K=R[F]=R[F]||[],Y=H[F];Y.sort((re,de)=>{const _e=Z.featureSortOrder;if(_e){const Te=_e.indexOf(re.featureIndex);return _e.indexOf(de.featureIndex)-Te}return de.featureIndex-re.featureIndex});for(const re of Y)K.push(re)}}for(const Z in R)R[Z].forEach(H=>{const F=H.feature,K=v[_[Z].source].getFeatureState(F.layer["source-layer"],F.id);F.source=F.layer.source,F.layer["source-layer"]&&(F.sourceLayer=F.layer["source-layer"]),F.state=K});return R}(this._layers,m,this.sourceCaches,e,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(c)}querySourceFeatures(e,a){a&&a.filter&&this._validate(p.u.filter,"querySourceFeatures.filter",a.filter,null,a);const n=this.sourceCaches[e];return n?function(o,c){const m=o.getRenderableIds().map(v=>o.getTileByID(v)),_=[],y={};for(let v=0;v<m.length;v++){const E=m[v],S=E.tileID.canonical.key;y[S]||(y[S]=!0,E.querySourceFeatures(_,c))}return _}(n,a):[]}getLight(){return this.light.getLight()}setLight(e,a={}){this._checkLoaded();const n=this.light.getLight();let o=!1;for(const m in e)if(!p.aE(e[m],n[m])){o=!0;break}if(!o)return;const c={now:ge.now(),transition:p.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,a),this.light.updateTransitions(c)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,a={}){const n=this.getSky();let o=!1;if(!e&&!n)return;if(e&&!n)o=!0;else if(!e&&n)o=!0;else for(const m in e)if(!p.aE(e[m],n[m])){o=!0;break}if(!o)return;const c={now:ge.now(),transition:p.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,a),this.sky.updateTransitions(c)}_validate(e,a,n,o,c={}){return(!c||c.validate!==!1)&&cr(this,e.call(p.u,p.e({key:a,style:this.serialize(),value:n,styleSpec:p.v},o)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),wr().off(ye,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const n=this.sourceCaches[a];n.setEventedParent(null),n.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const a in this.sourceCaches)this.sourceCaches[a].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,a,n,o,c=!1){let m=!1,_=!1;const y={};for(const v of this._order){const E=this._layers[v];if(E.type!=="symbol")continue;if(!y[E.source]){const A=this.sourceCaches[E.source];y[E.source]=A.getRenderableIds(!0).map(L=>A.getTileByID(L)).sort((L,R)=>R.tileID.overscaledZ-L.tileID.overscaledZ||(L.tileID.isLessThan(R.tileID)?-1:1))}const S=this.crossTileSymbolIndex.addLayer(E,y[E.source],e.center.lng);m=m||S}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((c=c||this._layerOrderChanged||n===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ge.now(),e.zoom))&&(this.pauseablePlacement=new ms(e,this.map.terrain,this._order,c,a,n,o,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ge.now()),_=!0),m&&this.pauseablePlacement.placement.setStale()),_||m)for(const v of this._order){const E=this._layers[v];E.type==="symbol"&&this.placement.updateLayerOpacities(E,y[E.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ge.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,a){return p._(this,void 0,void 0,function*(){const n=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const o=this.sourceCaches[a.source];return o&&o.setDependencies(a.tileID.key,a.type,a.icons),n})}getGlyphs(e,a){return p._(this,void 0,void 0,function*(){const n=yield this.glyphManager.getGlyphs(a.stacks),o=this.sourceCaches[a.source];return o&&o.setDependencies(a.tileID.key,a.type,[""]),n})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,a={}){this._checkLoaded(),e&&this._validate(p.u.glyphs,"glyphs",e,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,a,n={},o){this._checkLoaded();const c=[{id:e,url:a}],m=[...Qt(this.stylesheet.sprite),...c];this._validate(p.u.sprite,"sprite",m,null,n)||(this.stylesheet.sprite=m,this._loadSprite(c,!0,o))}removeSprite(e){this._checkLoaded();const a=Qt(this.stylesheet.sprite);if(a.find(n=>n.id===e)){if(this._spritesImagesIds[e])for(const n of this._spritesImagesIds[e])this.imageManager.removeImage(n),this._changedImages[n]=!0;a.splice(a.findIndex(n=>n.id===e),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new p.k("data",{dataType:"style"}))}else this.fire(new p.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Qt(this.stylesheet.sprite)}setSprite(e,a={},n){this._checkLoaded(),e&&this._validate(p.u.sprite,"sprite",e,null,a)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,n):(this._unloadSprite(),n&&n(null)))}}var ua=p.Y([{name:"a_pos",type:"Int16",components:2}]);const Kr={prelude:dt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:dt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:dt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:dt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:dt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:dt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:dt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:dt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:dt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:dt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:dt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:dt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:dt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:dt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:dt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:dt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:dt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:dt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:dt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:dt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:dt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:dt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:dt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:dt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:dt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:dt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:dt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:dt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:dt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:dt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function dt(u,e){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,n=e.match(/attribute ([\w]+) ([\w]+)/g),o=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),c=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=c?c.concat(o):o,_={};return{fragmentSource:u=u.replace(a,(y,v,E,S,A)=>(_[A]=!0,v==="define"?`
#ifndef HAS_UNIFORM_u_${A}
varying ${E} ${S} ${A};
#else
uniform ${E} ${S} u_${A};
#endif
`:`
#ifdef HAS_UNIFORM_u_${A}
    ${E} ${S} ${A} = u_${A};
#endif
`)),vertexSource:e=e.replace(a,(y,v,E,S,A)=>{const L=S==="float"?"vec2":"vec4",R=A.match(/color/)?"color":L;return _[A]?v==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
attribute ${E} ${L} a_${A};
varying ${E} ${S} ${A};
#else
uniform ${E} ${S} u_${A};
#endif
`:R==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = a_${A};
#else
    ${E} ${S} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = unpack_mix_${R}(a_${A}, u_${A}_t);
#else
    ${E} ${S} ${A} = u_${A};
#endif
`:v==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
attribute ${E} ${L} a_${A};
#else
uniform ${E} ${S} u_${A};
#endif
`:R==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${E} ${S} ${A} = a_${A};
#else
    ${E} ${S} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    ${E} ${S} ${A} = unpack_mix_${R}(a_${A}, u_${A}_t);
#else
    ${E} ${S} ${A} = u_${A};
#endif
`}),staticAttributes:n,staticUniforms:m}}class Gn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,a,n,o,c,m,_,y,v){this.context=e;let E=this.boundPaintVertexBuffers.length!==o.length;for(let S=0;!E&&S<o.length;S++)this.boundPaintVertexBuffers[S]!==o[S]&&(E=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==n||E||this.boundIndexBuffer!==c||this.boundVertexOffset!==m||this.boundDynamicVertexBuffer!==_||this.boundDynamicVertexBuffer2!==y||this.boundDynamicVertexBuffer3!==v?this.freshBind(a,n,o,c,m,_,y,v):(e.bindVertexArray.set(this.vao),_&&_.bind(),c&&c.dynamicDraw&&c.bind(),y&&y.bind(),v&&v.bind())}freshBind(e,a,n,o,c,m,_,y){const v=e.numAttributes,E=this.context,S=E.gl;this.vao&&this.destroy(),this.vao=E.createVertexArray(),E.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=o,this.boundVertexOffset=c,this.boundDynamicVertexBuffer=m,this.boundDynamicVertexBuffer2=_,this.boundDynamicVertexBuffer3=y,a.enableAttributes(S,e);for(const A of n)A.enableAttributes(S,e);m&&m.enableAttributes(S,e),_&&_.enableAttributes(S,e),y&&y.enableAttributes(S,e),a.bind(),a.setVertexAttribPointers(S,e,c);for(const A of n)A.bind(),A.setVertexAttribPointers(S,e,c);m&&(m.bind(),m.setVertexAttribPointers(S,e,c)),o&&o.bind(),_&&(_.bind(),_.setVertexAttribPointers(S,e,c)),y&&(y.bind(),y.setVertexAttribPointers(S,e,c)),E.currentNumAttributes=v}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Hn=(u,e,a,n,o)=>({u_matrix:u,u_texture:0,u_ele_delta:e,u_fog_matrix:a,u_fog_color:n?n.properties.get("fog-color"):p.aM.white,u_fog_ground_blend:n?n.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:n?n.calculateFogBlendOpacity(o):0,u_horizon_color:n?n.properties.get("horizon-color"):p.aM.white,u_horizon_fog_blend:n?n.properties.get("horizon-fog-blend"):1});function Ma(u){const e=[];for(let a=0;a<u.length;a++){if(u[a]===null)continue;const n=u[a].split(" ");e.push(n.pop())}return e}class Wn{constructor(e,a,n,o,c,m){const _=e.gl;this.program=_.createProgram();const y=Ma(a.staticAttributes),v=n?n.getBinderAttributes():[],E=y.concat(v),S=Kr.prelude.staticUniforms?Ma(Kr.prelude.staticUniforms):[],A=a.staticUniforms?Ma(a.staticUniforms):[],L=n?n.getBinderUniforms():[],R=S.concat(A).concat(L),U=[];for(const re of R)U.indexOf(re)<0&&U.push(re);const q=n?n.defines():[];c&&q.push("#define OVERDRAW_INSPECTOR;"),m&&q.push("#define TERRAIN3D;");const Z=q.concat(Kr.prelude.fragmentSource,a.fragmentSource).join(`
`),H=q.concat(Kr.prelude.vertexSource,a.vertexSource).join(`
`),F=_.createShader(_.FRAGMENT_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);if(_.shaderSource(F,Z),_.compileShader(F),!_.getShaderParameter(F,_.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${_.getShaderInfoLog(F)}`);_.attachShader(this.program,F);const K=_.createShader(_.VERTEX_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);if(_.shaderSource(K,H),_.compileShader(K),!_.getShaderParameter(K,_.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${_.getShaderInfoLog(K)}`);_.attachShader(this.program,K),this.attributes={};const Y={};this.numAttributes=E.length;for(let re=0;re<this.numAttributes;re++)E[re]&&(_.bindAttribLocation(this.program,re,E[re]),this.attributes[E[re]]=re);if(_.linkProgram(this.program),!_.getProgramParameter(this.program,_.LINK_STATUS))throw new Error(`Program failed to link: ${_.getProgramInfoLog(this.program)}`);_.deleteShader(K),_.deleteShader(F);for(let re=0;re<U.length;re++){const de=U[re];if(de&&!Y[de]){const _e=_.getUniformLocation(this.program,de);_e&&(Y[de]=_e)}}this.fixedUniforms=o(e,Y),this.terrainUniforms=((re,de)=>({u_depth:new p.aH(re,de.u_depth),u_terrain:new p.aH(re,de.u_terrain),u_terrain_dim:new p.aI(re,de.u_terrain_dim),u_terrain_matrix:new p.aJ(re,de.u_terrain_matrix),u_terrain_unpack:new p.aK(re,de.u_terrain_unpack),u_terrain_exaggeration:new p.aI(re,de.u_terrain_exaggeration)}))(e,Y),this.binderUniforms=n?n.getUniforms(e,Y):[]}draw(e,a,n,o,c,m,_,y,v,E,S,A,L,R,U,q,Z,H){const F=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(n),e.setStencilMode(o),e.setColorMode(c),e.setCullFace(m),y){e.activeTexture.set(F.TEXTURE2),F.bindTexture(F.TEXTURE_2D,y.depthTexture),e.activeTexture.set(F.TEXTURE3),F.bindTexture(F.TEXTURE_2D,y.texture);for(const Y in this.terrainUniforms)this.terrainUniforms[Y].set(y[Y])}for(const Y in this.fixedUniforms)this.fixedUniforms[Y].set(_[Y]);U&&U.setUniforms(e,this.binderUniforms,L,{zoom:R});let K=0;switch(a){case F.LINES:K=2;break;case F.TRIANGLES:K=3;break;case F.LINE_STRIP:K=1}for(const Y of A.get()){const re=Y.vaos||(Y.vaos={});(re[v]||(re[v]=new Gn)).bind(e,this,E,U?U.getPaintVertexBuffers():[],S,Y.vertexOffset,q,Z,H),F.drawElements(a,Y.primitiveLength*K,F.UNSIGNED_SHORT,Y.primitiveOffset*K*2)}}}function Hs(u,e,a){const n=1/et(a,1,e.transform.tileZoom),o=Math.pow(2,a.tileID.overscaledZ),c=a.tileSize*Math.pow(2,e.transform.tileZoom)/o,m=c*(a.tileID.canonical.x+a.tileID.wrap*o),_=c*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[n,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[m>>16,_>>16],u_pixel_coord_lower:[65535&m,65535&_]}}const gs=(u,e,a,n)=>{const o=e.style.light,c=o.properties.get("position"),m=[c.x,c.y,c.z],_=function(){var v=new p.A(9);return p.A!=Float32Array&&(v[1]=0,v[2]=0,v[3]=0,v[5]=0,v[6]=0,v[7]=0),v[0]=1,v[4]=1,v[8]=1,v}();o.properties.get("anchor")==="viewport"&&function(v,E){var S=Math.sin(E),A=Math.cos(E);v[0]=A,v[1]=S,v[2]=0,v[3]=-S,v[4]=A,v[5]=0,v[6]=0,v[7]=0,v[8]=1}(_,-e.transform.angle),function(v,E,S){var A=E[0],L=E[1],R=E[2];v[0]=A*S[0]+L*S[3]+R*S[6],v[1]=A*S[1]+L*S[4]+R*S[7],v[2]=A*S[2]+L*S[5]+R*S[8]}(m,m,_);const y=o.properties.get("color");return{u_matrix:u,u_lightpos:m,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[y.r,y.g,y.b],u_vertical_gradient:+a,u_opacity:n}},Ws=(u,e,a,n,o,c,m)=>p.e(gs(u,e,a,n),Hs(c,e,m),{u_height_factor:-Math.pow(2,o.overscaledZ)/m.tileSize/8}),za=u=>({u_matrix:u}),rl=(u,e,a,n)=>p.e(za(u),Hs(a,e,n)),fc=(u,e)=>({u_matrix:u,u_world:e}),al=(u,e,a,n,o)=>p.e(rl(u,e,a,n),{u_world:o}),mc=(u,e,a,n)=>{const o=u.transform;let c,m;if(n.paint.get("circle-pitch-alignment")==="map"){const _=et(a,1,o.zoom);c=!0,m=[_,_]}else c=!1,m=o.pixelsToGLUnits;return{u_camera_to_center_distance:o.cameraToCenterDistance,u_scale_with_map:+(n.paint.get("circle-pitch-scale")==="map"),u_matrix:u.translatePosMatrix(e.posMatrix,a,n.paint.get("circle-translate"),n.paint.get("circle-translate-anchor")),u_pitch_with_map:+c,u_device_pixel_ratio:u.pixelRatio,u_extrude_scale:m}},ha=(u,e,a)=>({u_matrix:u,u_inv_matrix:e,u_camera_to_center_distance:a.cameraToCenterDistance,u_viewport_size:[a.width,a.height]}),_s=(u,e,a=1)=>({u_matrix:u,u_color:e,u_overlay:0,u_overlay_scale:a}),Si=u=>({u_matrix:u}),Ti=(u,e,a,n)=>({u_matrix:u,u_extrude_scale:et(e,1,a),u_intensity:n}),Xs=(u,e,a,n)=>{const o=p.H();p.aP(o,0,u.width,u.height,0,0,1);const c=u.context.gl;return{u_matrix:o,u_world:[c.drawingBufferWidth,c.drawingBufferHeight],u_image:a,u_color_ramp:n,u_opacity:e.paint.get("heatmap-opacity")}};function Ks(u,e){const a=Math.pow(2,e.canonical.z),n=e.canonical.y;return[new p.Z(0,n/a).toLngLat().lat,new p.Z(0,(n+1)/a).toLngLat().lat]}const Js=(u,e,a,n)=>{const o=u.transform;return{u_matrix:ol(u,e,a,n),u_ratio:1/et(e,1,o.zoom),u_device_pixel_ratio:u.pixelRatio,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},sl=(u,e,a,n,o)=>p.e(Js(u,e,a,o),{u_image:0,u_image_height:n}),Da=(u,e,a,n,o)=>{const c=u.transform,m=nl(e,c);return{u_matrix:ol(u,e,a,o),u_texsize:e.imageAtlasTexture.size,u_ratio:1/et(e,1,c.zoom),u_device_pixel_ratio:u.pixelRatio,u_image:0,u_scale:[m,n.fromScale,n.toScale],u_fade:n.t,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},gc=(u,e,a,n,o,c)=>{const m=u.lineAtlas,_=nl(e,u.transform),y=a.layout.get("line-cap")==="round",v=m.getDash(n.from,y),E=m.getDash(n.to,y),S=v.width*o.fromScale,A=E.width*o.toScale;return p.e(Js(u,e,a,c),{u_patternscale_a:[_/S,-v.height/2],u_patternscale_b:[_/A,-E.height/2],u_sdfgamma:m.width/(256*Math.min(S,A)*u.pixelRatio)/2,u_image:0,u_tex_y_a:v.y,u_tex_y_b:E.y,u_mix:o.t})};function nl(u,e){return 1/et(u,1,e.tileZoom)}function ol(u,e,a,n){return u.translatePosMatrix(n?n.posMatrix:e.tileID.posMatrix,e,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const _c=(u,e,a,n,o)=>{return{u_matrix:u,u_tl_parent:e,u_scale_parent:a,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*o.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:o.paint.get("raster-brightness-min"),u_brightness_high:o.paint.get("raster-brightness-max"),u_saturation_factor:(m=o.paint.get("raster-saturation"),m>0?1-1/(1.001-m):-m),u_contrast_factor:(c=o.paint.get("raster-contrast"),c>0?1/(1-c):1+c),u_spin_weights:yc(o.paint.get("raster-hue-rotate"))};var c,m};function yc(u){u*=Math.PI/180;const e=Math.sin(u),a=Math.cos(u);return[(2*a+1)/3,(-Math.sqrt(3)*e-a+1)/3,(Math.sqrt(3)*e-a+1)/3]}const ll=(u,e,a,n,o,c,m,_,y,v,E,S,A,L)=>{const R=m.transform;return{u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:R.cameraToCenterDistance,u_pitch:R.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:R.width/R.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:y,u_coord_matrix:v,u_is_text:+S,u_pitch_with_map:+n,u_is_along_line:o,u_is_variable_anchor:c,u_texsize:A,u_texture:0,u_translation:E,u_pitched_scale:L}},ys=(u,e,a,n,o,c,m,_,y,v,E,S,A,L,R)=>{const U=m.transform;return p.e(ll(u,e,a,n,o,c,m,_,y,v,E,S,A,R),{u_gamma_scale:n?Math.cos(U._pitch)*U.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:1})},Xn=(u,e,a,n,o,c,m,_,y,v,E,S,A,L)=>p.e(ys(u,e,a,n,o,c,m,_,y,v,E,!0,S,!0,L),{u_texsize_icon:A,u_texture_icon:1}),Ys=(u,e,a)=>({u_matrix:u,u_opacity:e,u_color:a}),Kn=(u,e,a,n,o,c)=>p.e(function(m,_,y,v){const E=y.imageManager.getPattern(m.from.toString()),S=y.imageManager.getPattern(m.to.toString()),{width:A,height:L}=y.imageManager.getPixelSize(),R=Math.pow(2,v.tileID.overscaledZ),U=v.tileSize*Math.pow(2,y.transform.tileZoom)/R,q=U*(v.tileID.canonical.x+v.tileID.wrap*R),Z=U*v.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:E.tl,u_pattern_br_a:E.br,u_pattern_tl_b:S.tl,u_pattern_br_b:S.br,u_texsize:[A,L],u_mix:_.t,u_pattern_size_a:E.displaySize,u_pattern_size_b:S.displaySize,u_scale_a:_.fromScale,u_scale_b:_.toScale,u_tile_units_to_pixels:1/et(v,1,y.transform.tileZoom),u_pixel_coord_upper:[q>>16,Z>>16],u_pixel_coord_lower:[65535&q,65535&Z]}}(n,c,a,o),{u_matrix:u,u_opacity:e}),Jn={fillExtrusion:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_lightpos:new p.aN(u,e.u_lightpos),u_lightintensity:new p.aI(u,e.u_lightintensity),u_lightcolor:new p.aN(u,e.u_lightcolor),u_vertical_gradient:new p.aI(u,e.u_vertical_gradient),u_opacity:new p.aI(u,e.u_opacity)}),fillExtrusionPattern:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_lightpos:new p.aN(u,e.u_lightpos),u_lightintensity:new p.aI(u,e.u_lightintensity),u_lightcolor:new p.aN(u,e.u_lightcolor),u_vertical_gradient:new p.aI(u,e.u_vertical_gradient),u_height_factor:new p.aI(u,e.u_height_factor),u_image:new p.aH(u,e.u_image),u_texsize:new p.aO(u,e.u_texsize),u_pixel_coord_upper:new p.aO(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new p.aO(u,e.u_pixel_coord_lower),u_scale:new p.aN(u,e.u_scale),u_fade:new p.aI(u,e.u_fade),u_opacity:new p.aI(u,e.u_opacity)}),fill:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix)}),fillPattern:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_image:new p.aH(u,e.u_image),u_texsize:new p.aO(u,e.u_texsize),u_pixel_coord_upper:new p.aO(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new p.aO(u,e.u_pixel_coord_lower),u_scale:new p.aN(u,e.u_scale),u_fade:new p.aI(u,e.u_fade)}),fillOutline:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_world:new p.aO(u,e.u_world)}),fillOutlinePattern:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_world:new p.aO(u,e.u_world),u_image:new p.aH(u,e.u_image),u_texsize:new p.aO(u,e.u_texsize),u_pixel_coord_upper:new p.aO(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new p.aO(u,e.u_pixel_coord_lower),u_scale:new p.aN(u,e.u_scale),u_fade:new p.aI(u,e.u_fade)}),circle:(u,e)=>({u_camera_to_center_distance:new p.aI(u,e.u_camera_to_center_distance),u_scale_with_map:new p.aH(u,e.u_scale_with_map),u_pitch_with_map:new p.aH(u,e.u_pitch_with_map),u_extrude_scale:new p.aO(u,e.u_extrude_scale),u_device_pixel_ratio:new p.aI(u,e.u_device_pixel_ratio),u_matrix:new p.aJ(u,e.u_matrix)}),collisionBox:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_pixel_extrude_scale:new p.aO(u,e.u_pixel_extrude_scale)}),collisionCircle:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_inv_matrix:new p.aJ(u,e.u_inv_matrix),u_camera_to_center_distance:new p.aI(u,e.u_camera_to_center_distance),u_viewport_size:new p.aO(u,e.u_viewport_size)}),debug:(u,e)=>({u_color:new p.aL(u,e.u_color),u_matrix:new p.aJ(u,e.u_matrix),u_overlay:new p.aH(u,e.u_overlay),u_overlay_scale:new p.aI(u,e.u_overlay_scale)}),clippingMask:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix)}),heatmap:(u,e)=>({u_extrude_scale:new p.aI(u,e.u_extrude_scale),u_intensity:new p.aI(u,e.u_intensity),u_matrix:new p.aJ(u,e.u_matrix)}),heatmapTexture:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_world:new p.aO(u,e.u_world),u_image:new p.aH(u,e.u_image),u_color_ramp:new p.aH(u,e.u_color_ramp),u_opacity:new p.aI(u,e.u_opacity)}),hillshade:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_image:new p.aH(u,e.u_image),u_latrange:new p.aO(u,e.u_latrange),u_light:new p.aO(u,e.u_light),u_shadow:new p.aL(u,e.u_shadow),u_highlight:new p.aL(u,e.u_highlight),u_accent:new p.aL(u,e.u_accent)}),hillshadePrepare:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_image:new p.aH(u,e.u_image),u_dimension:new p.aO(u,e.u_dimension),u_zoom:new p.aI(u,e.u_zoom),u_unpack:new p.aK(u,e.u_unpack)}),line:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_ratio:new p.aI(u,e.u_ratio),u_device_pixel_ratio:new p.aI(u,e.u_device_pixel_ratio),u_units_to_pixels:new p.aO(u,e.u_units_to_pixels)}),lineGradient:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_ratio:new p.aI(u,e.u_ratio),u_device_pixel_ratio:new p.aI(u,e.u_device_pixel_ratio),u_units_to_pixels:new p.aO(u,e.u_units_to_pixels),u_image:new p.aH(u,e.u_image),u_image_height:new p.aI(u,e.u_image_height)}),linePattern:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_texsize:new p.aO(u,e.u_texsize),u_ratio:new p.aI(u,e.u_ratio),u_device_pixel_ratio:new p.aI(u,e.u_device_pixel_ratio),u_image:new p.aH(u,e.u_image),u_units_to_pixels:new p.aO(u,e.u_units_to_pixels),u_scale:new p.aN(u,e.u_scale),u_fade:new p.aI(u,e.u_fade)}),lineSDF:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_ratio:new p.aI(u,e.u_ratio),u_device_pixel_ratio:new p.aI(u,e.u_device_pixel_ratio),u_units_to_pixels:new p.aO(u,e.u_units_to_pixels),u_patternscale_a:new p.aO(u,e.u_patternscale_a),u_patternscale_b:new p.aO(u,e.u_patternscale_b),u_sdfgamma:new p.aI(u,e.u_sdfgamma),u_image:new p.aH(u,e.u_image),u_tex_y_a:new p.aI(u,e.u_tex_y_a),u_tex_y_b:new p.aI(u,e.u_tex_y_b),u_mix:new p.aI(u,e.u_mix)}),raster:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_tl_parent:new p.aO(u,e.u_tl_parent),u_scale_parent:new p.aI(u,e.u_scale_parent),u_buffer_scale:new p.aI(u,e.u_buffer_scale),u_fade_t:new p.aI(u,e.u_fade_t),u_opacity:new p.aI(u,e.u_opacity),u_image0:new p.aH(u,e.u_image0),u_image1:new p.aH(u,e.u_image1),u_brightness_low:new p.aI(u,e.u_brightness_low),u_brightness_high:new p.aI(u,e.u_brightness_high),u_saturation_factor:new p.aI(u,e.u_saturation_factor),u_contrast_factor:new p.aI(u,e.u_contrast_factor),u_spin_weights:new p.aN(u,e.u_spin_weights)}),symbolIcon:(u,e)=>({u_is_size_zoom_constant:new p.aH(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new p.aH(u,e.u_is_size_feature_constant),u_size_t:new p.aI(u,e.u_size_t),u_size:new p.aI(u,e.u_size),u_camera_to_center_distance:new p.aI(u,e.u_camera_to_center_distance),u_pitch:new p.aI(u,e.u_pitch),u_rotate_symbol:new p.aH(u,e.u_rotate_symbol),u_aspect_ratio:new p.aI(u,e.u_aspect_ratio),u_fade_change:new p.aI(u,e.u_fade_change),u_matrix:new p.aJ(u,e.u_matrix),u_label_plane_matrix:new p.aJ(u,e.u_label_plane_matrix),u_coord_matrix:new p.aJ(u,e.u_coord_matrix),u_is_text:new p.aH(u,e.u_is_text),u_pitch_with_map:new p.aH(u,e.u_pitch_with_map),u_is_along_line:new p.aH(u,e.u_is_along_line),u_is_variable_anchor:new p.aH(u,e.u_is_variable_anchor),u_texsize:new p.aO(u,e.u_texsize),u_texture:new p.aH(u,e.u_texture),u_translation:new p.aO(u,e.u_translation),u_pitched_scale:new p.aI(u,e.u_pitched_scale)}),symbolSDF:(u,e)=>({u_is_size_zoom_constant:new p.aH(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new p.aH(u,e.u_is_size_feature_constant),u_size_t:new p.aI(u,e.u_size_t),u_size:new p.aI(u,e.u_size),u_camera_to_center_distance:new p.aI(u,e.u_camera_to_center_distance),u_pitch:new p.aI(u,e.u_pitch),u_rotate_symbol:new p.aH(u,e.u_rotate_symbol),u_aspect_ratio:new p.aI(u,e.u_aspect_ratio),u_fade_change:new p.aI(u,e.u_fade_change),u_matrix:new p.aJ(u,e.u_matrix),u_label_plane_matrix:new p.aJ(u,e.u_label_plane_matrix),u_coord_matrix:new p.aJ(u,e.u_coord_matrix),u_is_text:new p.aH(u,e.u_is_text),u_pitch_with_map:new p.aH(u,e.u_pitch_with_map),u_is_along_line:new p.aH(u,e.u_is_along_line),u_is_variable_anchor:new p.aH(u,e.u_is_variable_anchor),u_texsize:new p.aO(u,e.u_texsize),u_texture:new p.aH(u,e.u_texture),u_gamma_scale:new p.aI(u,e.u_gamma_scale),u_device_pixel_ratio:new p.aI(u,e.u_device_pixel_ratio),u_is_halo:new p.aH(u,e.u_is_halo),u_translation:new p.aO(u,e.u_translation),u_pitched_scale:new p.aI(u,e.u_pitched_scale)}),symbolTextAndIcon:(u,e)=>({u_is_size_zoom_constant:new p.aH(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new p.aH(u,e.u_is_size_feature_constant),u_size_t:new p.aI(u,e.u_size_t),u_size:new p.aI(u,e.u_size),u_camera_to_center_distance:new p.aI(u,e.u_camera_to_center_distance),u_pitch:new p.aI(u,e.u_pitch),u_rotate_symbol:new p.aH(u,e.u_rotate_symbol),u_aspect_ratio:new p.aI(u,e.u_aspect_ratio),u_fade_change:new p.aI(u,e.u_fade_change),u_matrix:new p.aJ(u,e.u_matrix),u_label_plane_matrix:new p.aJ(u,e.u_label_plane_matrix),u_coord_matrix:new p.aJ(u,e.u_coord_matrix),u_is_text:new p.aH(u,e.u_is_text),u_pitch_with_map:new p.aH(u,e.u_pitch_with_map),u_is_along_line:new p.aH(u,e.u_is_along_line),u_is_variable_anchor:new p.aH(u,e.u_is_variable_anchor),u_texsize:new p.aO(u,e.u_texsize),u_texsize_icon:new p.aO(u,e.u_texsize_icon),u_texture:new p.aH(u,e.u_texture),u_texture_icon:new p.aH(u,e.u_texture_icon),u_gamma_scale:new p.aI(u,e.u_gamma_scale),u_device_pixel_ratio:new p.aI(u,e.u_device_pixel_ratio),u_is_halo:new p.aH(u,e.u_is_halo),u_translation:new p.aO(u,e.u_translation),u_pitched_scale:new p.aI(u,e.u_pitched_scale)}),background:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_opacity:new p.aI(u,e.u_opacity),u_color:new p.aL(u,e.u_color)}),backgroundPattern:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_opacity:new p.aI(u,e.u_opacity),u_image:new p.aH(u,e.u_image),u_pattern_tl_a:new p.aO(u,e.u_pattern_tl_a),u_pattern_br_a:new p.aO(u,e.u_pattern_br_a),u_pattern_tl_b:new p.aO(u,e.u_pattern_tl_b),u_pattern_br_b:new p.aO(u,e.u_pattern_br_b),u_texsize:new p.aO(u,e.u_texsize),u_mix:new p.aI(u,e.u_mix),u_pattern_size_a:new p.aO(u,e.u_pattern_size_a),u_pattern_size_b:new p.aO(u,e.u_pattern_size_b),u_scale_a:new p.aI(u,e.u_scale_a),u_scale_b:new p.aI(u,e.u_scale_b),u_pixel_coord_upper:new p.aO(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new p.aO(u,e.u_pixel_coord_lower),u_tile_units_to_pixels:new p.aI(u,e.u_tile_units_to_pixels)}),terrain:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_texture:new p.aH(u,e.u_texture),u_ele_delta:new p.aI(u,e.u_ele_delta),u_fog_matrix:new p.aJ(u,e.u_fog_matrix),u_fog_color:new p.aL(u,e.u_fog_color),u_fog_ground_blend:new p.aI(u,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new p.aI(u,e.u_fog_ground_blend_opacity),u_horizon_color:new p.aL(u,e.u_horizon_color),u_horizon_fog_blend:new p.aI(u,e.u_horizon_fog_blend)}),terrainDepth:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_ele_delta:new p.aI(u,e.u_ele_delta)}),terrainCoords:(u,e)=>({u_matrix:new p.aJ(u,e.u_matrix),u_texture:new p.aH(u,e.u_texture),u_terrain_coords_id:new p.aI(u,e.u_terrain_coords_id),u_ele_delta:new p.aI(u,e.u_ele_delta)}),sky:(u,e)=>({u_sky_color:new p.aL(u,e.u_sky_color),u_horizon_color:new p.aL(u,e.u_horizon_color),u_horizon:new p.aI(u,e.u_horizon),u_sky_horizon_blend:new p.aI(u,e.u_sky_horizon_blend)})};class Tr{constructor(e,a,n){this.context=e;const o=e.gl;this.buffer=o.createBuffer(),this.dynamicDraw=!!n,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Yn{constructor(e,a,n,o){this.length=a.length,this.attributes=n,this.itemSize=a.bytesPerElement,this.dynamicDraw=o,this.context=e;const c=e.gl;this.buffer=c.createBuffer(),e.bindVertexBuffer.set(this.buffer),c.bufferData(c.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,a){for(let n=0;n<this.attributes.length;n++){const o=a.attributes[this.attributes[n].name];o!==void 0&&e.enableVertexAttribArray(o)}}setVertexAttribPointers(e,a,n){for(let o=0;o<this.attributes.length;o++){const c=this.attributes[o],m=a.attributes[c.name];m!==void 0&&e.vertexAttribPointer(m,c.components,e[bc[c.type]],!1,this.itemSize,c.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const da=new WeakMap;function Jr(u){var e;if(da.has(u))return da.get(u);{const a=(e=u.getParameter(u.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return da.set(u,a),a}}class pt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Qs extends pt{getDefault(){return p.aM.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class xc extends pt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class La extends pt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class vc extends pt{getDefault(){return[!0,!0,!0,!0]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class cl extends pt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class wc extends pt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class ul extends pt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const a=this.current;(e.func!==a.func||e.ref!==a.ref||e.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Qn extends pt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class hl extends pt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=e,this.dirty=!1}}class dl extends pt{getDefault(){return[0,1]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class pl extends pt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=e,this.dirty=!1}}class fl extends pt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class pa extends pt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.BLEND):a.disable(a.BLEND),this.current=e,this.dirty=!1}}class ml extends pt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ec extends pt{getDefault(){return p.aM.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class gl extends pt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class bs extends pt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=e,this.dirty=!1}}class Sc extends pt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class en extends pt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Tc extends pt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Ic extends pt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class _l extends pt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class yl extends pt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class bl extends pt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class eo extends pt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class xl extends pt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class tn extends pt{getDefault(){return null}set(e){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Or extends pt{getDefault(){return null}set(e){var a;if(e===this.current&&!this.dirty)return;const n=this.gl;Jr(n)?n.bindVertexArray(e):(a=n.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class to extends pt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class io extends pt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class ro extends pt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class rn extends pt{constructor(e,a){super(e),this.context=e,this.parent=a}getDefault(){return null}}class ao extends rn{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class fa extends rn{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class so extends rn{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class kc{constructor(e,a,n,o,c){this.context=e,this.width=a,this.height=n;const m=e.gl,_=this.framebuffer=m.createFramebuffer();if(this.colorAttachment=new ao(e,_),o)this.depthAttachment=c?new so(e,_):new fa(e,_);else if(c)throw new Error("Stencil cannot be set without depth");if(m.checkFramebufferStatus(m.FRAMEBUFFER)!==m.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,a=this.colorAttachment.get();if(a&&e.deleteTexture(a),this.depthAttachment){const n=this.depthAttachment.get();n&&e.deleteRenderbuffer(n)}e.deleteFramebuffer(this.framebuffer)}}class Ft{constructor(e,a,n){this.blendFunction=e,this.blendColor=a,this.mask=n}}Ft.Replace=[1,0],Ft.disabled=new Ft(Ft.Replace,p.aM.transparent,[!1,!1,!1,!1]),Ft.unblended=new Ft(Ft.Replace,p.aM.transparent,[!0,!0,!0,!0]),Ft.alphaBlended=new Ft([1,771],p.aM.transparent,[!0,!0,!0,!0]);class Pc{constructor(e){var a,n;if(this.gl=e,this.clearColor=new Qs(this),this.clearDepth=new xc(this),this.clearStencil=new La(this),this.colorMask=new vc(this),this.depthMask=new cl(this),this.stencilMask=new wc(this),this.stencilFunc=new ul(this),this.stencilOp=new Qn(this),this.stencilTest=new hl(this),this.depthRange=new dl(this),this.depthTest=new pl(this),this.depthFunc=new fl(this),this.blend=new pa(this),this.blendFunc=new ml(this),this.blendColor=new Ec(this),this.blendEquation=new gl(this),this.cullFace=new bs(this),this.cullFaceSide=new Sc(this),this.frontFace=new en(this),this.program=new Tc(this),this.activeTexture=new Ic(this),this.viewport=new _l(this),this.bindFramebuffer=new yl(this),this.bindRenderbuffer=new bl(this),this.bindTexture=new eo(this),this.bindVertexBuffer=new xl(this),this.bindElementBuffer=new tn(this),this.bindVertexArray=new Or(this),this.pixelStoreUnpack=new to(this),this.pixelStoreUnpackPremultiplyAlpha=new io(this),this.pixelStoreUnpackFlipY=new ro(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Jr(e)){this.HALF_FLOAT=e.HALF_FLOAT;const o=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=e.RGBA16F)!==null&&a!==void 0?a:o==null?void 0:o.RGBA16F_EXT,this.RGB16F=(n=e.RGB16F)!==null&&n!==void 0?n:o==null?void 0:o.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const o=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=o==null?void 0:o.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,a){return new Tr(this,e,a)}createVertexBuffer(e,a,n){return new Yn(this,e,a,n)}createRenderbuffer(e,a,n){const o=this.gl,c=o.createRenderbuffer();return this.bindRenderbuffer.set(c),o.renderbufferStorage(o.RENDERBUFFER,e,a,n),this.bindRenderbuffer.set(null),c}createFramebuffer(e,a,n,o){return new kc(this,e,a,n,o)}clear({color:e,depth:a,stencil:n}){const o=this.gl;let c=0;e&&(c|=o.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(c|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),n!==void 0&&(c|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),o.clear(c)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){p.aE(e.blendFunction,Ft.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Jr(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var a;return Jr(this.gl)?this.gl.deleteVertexArray(e):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Je{constructor(e,a,n){this.func=e,this.mask=a,this.range=n}}Je.ReadOnly=!1,Je.ReadWrite=!0,Je.disabled=new Je(519,Je.ReadOnly,[0,1]);const an=7680;class vt{constructor(e,a,n,o,c,m){this.test=e,this.ref=a,this.mask=n,this.fail=o,this.depthFail=c,this.pass=m}}vt.disabled=new vt({func:519,mask:0},0,0,an,an,an);class _t{constructor(e,a,n){this.enable=e,this.mode=a,this.frontFace=n}}let ma;function xs(u,e,a,n,o){const c=u.context,m=c.gl,_=u.useProgram("collisionBox"),y=[];let v=0,E=0;for(let Z=0;Z<n.length;Z++){const H=n[Z],F=e.getTile(H).getBucket(a);if(!F)continue;const K=o?F.textCollisionBox:F.iconCollisionBox,Y=F.collisionCircleArray;if(Y.length>0){const re=p.H();p.aQ(re,F.placementInvProjMatrix,u.transform.glCoordMatrix),p.aQ(re,re,F.placementViewportMatrix),y.push({circleArray:Y,circleOffset:E,transform:H.posMatrix,invTransform:re,coord:H}),v+=Y.length/4,E=v}K&&_.draw(c,m.LINES,Je.disabled,vt.disabled,u.colorModeForRenderPass(),_t.disabled,{u_matrix:H.posMatrix,u_pixel_extrude_scale:[1/(S=u.transform).width,1/S.height]},u.style.map.terrain&&u.style.map.terrain.getTerrainData(H),a.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,null,u.transform.zoom,null,null,K.collisionVertexBuffer)}var S;if(!o||!y.length)return;const A=u.useProgram("collisionCircle"),L=new p.aR;L.resize(4*v),L._trim();let R=0;for(const Z of y)for(let H=0;H<Z.circleArray.length/4;H++){const F=4*H,K=Z.circleArray[F+0],Y=Z.circleArray[F+1],re=Z.circleArray[F+2],de=Z.circleArray[F+3];L.emplace(R++,K,Y,re,de,0),L.emplace(R++,K,Y,re,de,1),L.emplace(R++,K,Y,re,de,2),L.emplace(R++,K,Y,re,de,3)}(!ma||ma.length<2*v)&&(ma=function(Z){const H=2*Z,F=new p.aT;F.resize(H),F._trim();for(let K=0;K<H;K++){const Y=6*K;F.uint16[Y+0]=4*K+0,F.uint16[Y+1]=4*K+1,F.uint16[Y+2]=4*K+2,F.uint16[Y+3]=4*K+2,F.uint16[Y+4]=4*K+3,F.uint16[Y+5]=4*K+0}return F}(v));const U=c.createIndexBuffer(ma,!0),q=c.createVertexBuffer(L,p.aS.members,!0);for(const Z of y){const H=ha(Z.transform,Z.invTransform,u.transform);A.draw(c,m.TRIANGLES,Je.disabled,vt.disabled,u.colorModeForRenderPass(),_t.disabled,H,u.style.map.terrain&&u.style.map.terrain.getTerrainData(Z.coord),a.id,q,U,p.a0.simpleSegment(0,2*Z.circleOffset,Z.circleArray.length,Z.circleArray.length/2),null,u.transform.zoom,null,null,null)}q.destroy(),U.destroy()}_t.disabled=new _t(!1,1029,2305),_t.backCCW=new _t(!0,1029,2305);const vs=p.an(new Float32Array(16));function no(u,e,a,n,o,c){const{horizontalAlign:m,verticalAlign:_}=p.au(u);return new p.P((-(m-.5)*e/o+n[0])*c,(-(_-.5)*a/o+n[1])*c)}function ga(u,e,a,n,o,c){const m=e.tileAnchorPoint.add(new p.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let _=n.mult(c);a||(_=_.rotate(-o));const y=m.add(_);return j(y.x,y.y,e.labelPlaneMatrix,e.getElevation).point}if(a){const _=ce(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(u),y=Math.atan(_.y/_.x)+(_.x<0?Math.PI:0);return u.add(n.rotate(y))}return u.add(n)}function Ra(u,e,a,n,o,c,m,_,y,v,E,S,A,L){const R=u.text.placedSymbolArray,U=u.text.dynamicLayoutVertexArray,q=u.icon.dynamicLayoutVertexArray,Z={};U.clear();for(let H=0;H<R.length;H++){const F=R.get(H),K=F.hidden||!F.crossTileID||u.allowVerticalPlacement&&!F.placedOrientation?null:n[F.crossTileID];if(K){const Y=new p.P(F.anchorX,F.anchorY),re={getElevation:L,width:o.width,height:o.height,labelPlaneMatrix:c,pitchWithMap:a,projection:E,tileAnchorPoint:Y,translation:S,unwrappedTileID:A},de=a?j(Y.x,Y.y,m,L):ce(Y.x,Y.y,re),_e=k(o.cameraToCenterDistance,de.signedDistanceFromCamera);let Te=p.ai(u.textSizeData,y,F)*_e/p.ap;a&&(Te*=u.tilePixelRatio/_);const{width:Ce,height:ve,anchor:xe,textOffset:Le,textBoxScale:Ze}=K,Ee=no(xe,Ce,ve,Le,Ze,Te),ke=E.getPitchedTextCorrection(o,Y.add(new p.P(S[0],S[1])),A),$e=ga(de.point,re,e,Ee,o.angle,ke),Tt=u.allowVerticalPlacement&&F.placedOrientation===p.ah.vertical?Math.PI/2:0;for(let We=0;We<F.numGlyphs;We++)p.aj(U,$e,Tt);v&&F.associatedIconIndex>=0&&(Z[F.associatedIconIndex]={shiftedAnchor:$e,angle:Tt})}else Ve(F.numGlyphs,U)}if(v){q.clear();const H=u.icon.placedSymbolArray;for(let F=0;F<H.length;F++){const K=H.get(F);if(K.hidden)Ve(K.numGlyphs,q);else{const Y=Z[F];if(Y)for(let re=0;re<K.numGlyphs;re++)p.aj(q,Y.shiftedAnchor,Y.angle);else Ve(K.numGlyphs,q)}}u.icon.dynamicLayoutVertexBuffer.updateData(q)}u.text.dynamicLayoutVertexBuffer.updateData(U)}function Ki(u,e,a){return a.iconsInText&&e?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function oo(u,e,a,n,o,c,m,_,y,v,E,S){const A=u.context,L=A.gl,R=u.transform,U=ca(),q=_==="map",Z=y==="map",H=_!=="viewport"&&a.layout.get("symbol-placement")!=="point",F=q&&!Z&&!H,K=!Z&&H,Y=!a.layout.get("symbol-sort-key").isConstant();let re=!1;const de=u.depthModeForSublayer(0,Je.ReadOnly),_e=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Te=[],Ce=U.getCircleRadiusCorrection(R);for(const ve of n){const xe=e.getTile(ve),Le=xe.getBucket(a);if(!Le)continue;const Ze=o?Le.text:Le.icon;if(!Ze||!Ze.segments.get().length||!Ze.hasVisibleVertices)continue;const Ee=Ze.programConfigurations.get(a.id),ke=o||Le.sdfIcons,$e=o?Le.textSizeData:Le.iconSizeData,Tt=Z||R.pitch!==0,We=u.useProgram(Ki(ke,o,Le),Ee),tt=p.ag($e,R.zoom),It=u.style.map.terrain&&u.style.map.terrain.getTerrainData(ve);let ni,dr,kt,Ii,_i=[0,0],oi=null;if(o)dr=xe.glyphAtlasTexture,kt=L.LINEAR,ni=xe.glyphAtlasTexture.size,Le.iconsInText&&(_i=xe.imageAtlasTexture.size,oi=xe.imageAtlasTexture,Ii=Tt||u.options.rotating||u.options.zooming||$e.kind==="composite"||$e.kind==="camera"?L.LINEAR:L.NEAREST);else{const rt=a.layout.get("icon-size").constantOr(0)!==1||Le.iconsNeedLinear;dr=xe.imageAtlasTexture,kt=ke||u.options.rotating||u.options.zooming||rt||Tt?L.LINEAR:L.NEAREST,ni=xe.imageAtlasTexture.size}const yi=et(xe,1,u.transform.zoom),Pr=K?ve.posMatrix:vs,Ka=Xr(Pr,Z,q,u.transform,yi),En=Sr(Pr,Z,q,u.transform,yi),Ja=Sr(ve.posMatrix,Z,q,u.transform,yi),Qi=U.translatePosition(u.transform,xe,c,m),Sn=_e&&Le.hasTextData(),Do=a.layout.get("icon-text-fit")!=="none"&&Sn&&Le.hasIconData();if(H){const rt=u.style.map.terrain?(Ya,Qa)=>u.style.map.terrain.getElevation(ve,Ya,Qa):null,va=a.layout.get("text-rotation-alignment")==="map";D(Le,ve.posMatrix,u,o,Ka,Ja,Z,v,va,U,ve.toUnwrapped(),R.width,R.height,Qi,rt)}const er=ve.posMatrix,tr=o&&_e||Do,Yr=H||tr?vs:Ka,pr=En,ri=ke&&a.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let li;li=ke?Le.iconsInText?Xn($e.kind,tt,F,Z,H,tr,u,er,Yr,pr,Qi,ni,_i,Ce):ys($e.kind,tt,F,Z,H,tr,u,er,Yr,pr,Qi,o,ni,!0,Ce):ll($e.kind,tt,F,Z,H,tr,u,er,Yr,pr,Qi,o,ni,Ce);const ji={program:We,buffers:Ze,uniformValues:li,atlasTexture:dr,atlasTextureIcon:oi,atlasInterpolation:kt,atlasInterpolationIcon:Ii,isSDF:ke,hasHalo:ri};if(Y&&Le.canOverlap){re=!0;const rt=Ze.segments.get();for(const va of rt)Te.push({segments:new p.a0([va]),sortKey:va.sortKey,state:ji,terrainData:It})}else Te.push({segments:Ze.segments,sortKey:0,state:ji,terrainData:It})}re&&Te.sort((ve,xe)=>ve.sortKey-xe.sortKey);for(const ve of Te){const xe=ve.state;if(A.activeTexture.set(L.TEXTURE0),xe.atlasTexture.bind(xe.atlasInterpolation,L.CLAMP_TO_EDGE),xe.atlasTextureIcon&&(A.activeTexture.set(L.TEXTURE1),xe.atlasTextureIcon&&xe.atlasTextureIcon.bind(xe.atlasInterpolationIcon,L.CLAMP_TO_EDGE)),xe.isSDF){const Le=xe.uniformValues;xe.hasHalo&&(Le.u_is_halo=1,lo(xe.buffers,ve.segments,a,u,xe.program,de,E,S,Le,ve.terrainData)),Le.u_is_halo=0}lo(xe.buffers,ve.segments,a,u,xe.program,de,E,S,xe.uniformValues,ve.terrainData)}}function lo(u,e,a,n,o,c,m,_,y,v){const E=n.context;o.draw(E,E.gl.TRIANGLES,c,m,_,_t.disabled,y,v,a.id,u.layoutVertexBuffer,u.indexBuffer,e,a.paint,n.transform.zoom,u.programConfigurations.get(a.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function co(u,e,a,n){const o=u.context,c=o.gl,m=vt.disabled,_=new Ft([c.ONE,c.ONE],p.aM.transparent,[!0,!0,!0,!0]),y=e.getBucket(a);if(!y)return;const v=n.key;let E=a.heatmapFbos.get(v);E||(E=ws(o,e.tileSize,e.tileSize),a.heatmapFbos.set(v,E)),o.bindFramebuffer.set(E.framebuffer),o.viewport.set([0,0,e.tileSize,e.tileSize]),o.clear({color:p.aM.transparent});const S=y.programConfigurations.get(a.id),A=u.useProgram("heatmap",S),L=u.style.map.terrain.getTerrainData(n);A.draw(o,c.TRIANGLES,Je.disabled,m,_,_t.disabled,Ti(n.posMatrix,e,u.transform.zoom,a.paint.get("heatmap-intensity")),L,a.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,a.paint,u.transform.zoom,S)}function _a(u,e,a){const n=u.context,o=n.gl;n.setColorMode(u.colorModeForRenderPass());const c=Es(n,e),m=a.key,_=e.heatmapFbos.get(m);_&&(n.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,_.colorAttachment.get()),n.activeTexture.set(o.TEXTURE1),c.bind(o.LINEAR,o.CLAMP_TO_EDGE),u.useProgram("heatmapTexture").draw(n,o.TRIANGLES,Je.disabled,vt.disabled,u.colorModeForRenderPass(),_t.disabled,Xs(u,e,0,1),null,e.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments,e.paint,u.transform.zoom),_.destroy(),e.heatmapFbos.delete(m))}function ws(u,e,a){var n,o;const c=u.gl,m=c.createTexture();c.bindTexture(c.TEXTURE_2D,m),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);const _=(n=u.HALF_FLOAT)!==null&&n!==void 0?n:c.UNSIGNED_BYTE,y=(o=u.RGBA16F)!==null&&o!==void 0?o:c.RGBA;c.texImage2D(c.TEXTURE_2D,0,y,e,a,0,c.RGBA,_,null);const v=u.createFramebuffer(e,a,!1,!1);return v.colorAttachment.set(m),v}function Es(u,e){return e.colorRampTexture||(e.colorRampTexture=new at(u,e.colorRamp,u.gl.RGBA)),e.colorRampTexture}function Ba(u,e,a,n,o){if(!a||!n||!n.imageAtlas)return;const c=n.imageAtlas.patternPositions;let m=c[a.to.toString()],_=c[a.from.toString()];if(!m&&_&&(m=_),!_&&m&&(_=m),!m||!_){const y=o.getPaintProperty(e);m=c[y],_=c[y]}m&&_&&u.setConstantPatternPositions(m,_)}function Ss(u,e,a,n,o,c,m){const _=u.context.gl,y="fill-pattern",v=a.paint.get(y),E=v&&v.constantOr(1),S=a.getCrossfadeParameters();let A,L,R,U,q;m?(L=E&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",A=_.LINES):(L=E?"fillPattern":"fill",A=_.TRIANGLES);const Z=v.constantOr(null);for(const H of n){const F=e.getTile(H);if(E&&!F.patternsLoaded())continue;const K=F.getBucket(a);if(!K)continue;const Y=K.programConfigurations.get(a.id),re=u.useProgram(L,Y),de=u.style.map.terrain&&u.style.map.terrain.getTerrainData(H);E&&(u.context.activeTexture.set(_.TEXTURE0),F.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),Y.updatePaintBuffers(S)),Ba(Y,y,Z,F,a);const _e=de?H:null,Te=u.translatePosMatrix(_e?_e.posMatrix:H.posMatrix,F,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(m){U=K.indexBuffer2,q=K.segments2;const Ce=[_.drawingBufferWidth,_.drawingBufferHeight];R=L==="fillOutlinePattern"&&E?al(Te,u,S,F,Ce):fc(Te,Ce)}else U=K.indexBuffer,q=K.segments,R=E?rl(Te,u,S,F):za(Te);re.draw(u.context,A,o,u.stencilModeForClipping(H),c,_t.disabled,R,de,a.id,K.layoutVertexBuffer,U,q,a.paint,u.transform.zoom,Y)}}function sn(u,e,a,n,o,c,m){const _=u.context,y=_.gl,v="fill-extrusion-pattern",E=a.paint.get(v),S=E.constantOr(1),A=a.getCrossfadeParameters(),L=a.paint.get("fill-extrusion-opacity"),R=E.constantOr(null);for(const U of n){const q=e.getTile(U),Z=q.getBucket(a);if(!Z)continue;const H=u.style.map.terrain&&u.style.map.terrain.getTerrainData(U),F=Z.programConfigurations.get(a.id),K=u.useProgram(S?"fillExtrusionPattern":"fillExtrusion",F);S&&(u.context.activeTexture.set(y.TEXTURE0),q.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),F.updatePaintBuffers(A)),Ba(F,v,R,q,a);const Y=u.translatePosMatrix(U.posMatrix,q,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),re=a.paint.get("fill-extrusion-vertical-gradient"),de=S?Ws(Y,u,re,L,U,A,q):gs(Y,u,re,L);K.draw(_,_.gl.TRIANGLES,o,c,m,_t.backCCW,de,H,a.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,a.paint,u.transform.zoom,F,u.style.map.terrain&&Z.centroidVertexBuffer)}}function Fa(u,e,a,n,o,c,m){const _=u.context,y=_.gl,v=a.fbo;if(!v)return;const E=u.useProgram("hillshade"),S=u.style.map.terrain&&u.style.map.terrain.getTerrainData(e);_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,v.colorAttachment.get()),E.draw(_,y.TRIANGLES,o,c,m,_t.disabled,((A,L,R,U)=>{const q=R.paint.get("hillshade-shadow-color"),Z=R.paint.get("hillshade-highlight-color"),H=R.paint.get("hillshade-accent-color");let F=R.paint.get("hillshade-illumination-direction")*(Math.PI/180);R.paint.get("hillshade-illumination-anchor")==="viewport"&&(F-=A.transform.angle);const K=!A.options.moving;return{u_matrix:U?U.posMatrix:A.transform.calculatePosMatrix(L.tileID.toUnwrapped(),K),u_image:0,u_latrange:Ks(0,L.tileID),u_light:[R.paint.get("hillshade-exaggeration"),F],u_shadow:q,u_highlight:Z,u_accent:H}})(u,a,n,S?e:null),S,n.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}function Oa(u,e,a,n,o,c){const m=u.context,_=m.gl,y=e.dem;if(y&&y.data){const v=y.dim,E=y.stride,S=y.getPixels();if(m.activeTexture.set(_.TEXTURE1),m.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||u.getTileTexture(E),e.demTexture){const L=e.demTexture;L.update(S,{premultiply:!1}),L.bind(_.NEAREST,_.CLAMP_TO_EDGE)}else e.demTexture=new at(m,S,_.RGBA,{premultiply:!1}),e.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);m.activeTexture.set(_.TEXTURE0);let A=e.fbo;if(!A){const L=new at(m,{width:v,height:v,data:null},_.RGBA);L.bind(_.LINEAR,_.CLAMP_TO_EDGE),A=e.fbo=m.createFramebuffer(v,v,!0,!1),A.colorAttachment.set(L.texture)}m.bindFramebuffer.set(A.framebuffer),m.viewport.set([0,0,v,v]),u.useProgram("hillshadePrepare").draw(m,_.TRIANGLES,n,o,c,_t.disabled,((L,R)=>{const U=R.stride,q=p.H();return p.aP(q,0,p.X,-p.X,0,0,1),p.J(q,q,[0,-p.X,0]),{u_matrix:q,u_image:1,u_dimension:[U,U],u_zoom:L.overscaledZ,u_unpack:R.getUnpackVector()}})(e.tileID,y),null,a.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function vl(u,e,a,n,o,c){const m=n.paint.get("raster-fade-duration");if(!c&&m>0){const _=ge.now(),y=(_-u.timeAdded)/m,v=e?(_-e.timeAdded)/m:-1,E=a.getSource(),S=o.coveringZoomLevel({tileSize:E.tileSize,roundZoom:E.roundZoom}),A=!e||Math.abs(e.tileID.overscaledZ-S)>Math.abs(u.tileID.overscaledZ-S),L=A&&u.refreshedUponExpiration?1:p.ac(A?y:1-v,0,1);return u.refreshedUponExpiration&&y>=1&&(u.refreshedUponExpiration=!1),e?{opacity:1,mix:1-L}:{opacity:L,mix:0}}return{opacity:1,mix:0}}const uo=new p.aM(1,0,0,1),lt=new p.aM(0,1,0,1),nn=new p.aM(0,0,1,1),Cc=new p.aM(1,0,1,1),wl=new p.aM(0,1,1,1);function Va(u,e,a,n){on(u,0,e+a/2,u.transform.width,a,n)}function El(u,e,a,n){on(u,e-a/2,0,a,u.transform.height,n)}function on(u,e,a,n,o,c){const m=u.context,_=m.gl;_.enable(_.SCISSOR_TEST),_.scissor(e*u.pixelRatio,a*u.pixelRatio,n*u.pixelRatio,o*u.pixelRatio),m.clear({color:c}),_.disable(_.SCISSOR_TEST)}function Sl(u,e,a){const n=u.context,o=n.gl,c=a.posMatrix,m=u.useProgram("debug"),_=Je.disabled,y=vt.disabled,v=u.colorModeForRenderPass(),E="$debug",S=u.style.map.terrain&&u.style.map.terrain.getTerrainData(a);n.activeTexture.set(o.TEXTURE0);const A=e.getTileByID(a.key).latestRawTileData,L=Math.floor((A&&A.byteLength||0)/1024),R=e.getTile(a).tileSize,U=512/Math.min(R,512)*(a.overscaledZ/u.transform.zoom)*.5;let q=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(q+=` => ${a.overscaledZ}`),function(Z,H){Z.initDebugOverlayCanvas();const F=Z.debugOverlayCanvas,K=Z.context.gl,Y=Z.debugOverlayCanvas.getContext("2d");Y.clearRect(0,0,F.width,F.height),Y.shadowColor="white",Y.shadowBlur=2,Y.lineWidth=1.5,Y.strokeStyle="white",Y.textBaseline="top",Y.font="bold 36px Open Sans, sans-serif",Y.fillText(H,5,5),Y.strokeText(H,5,5),Z.debugOverlayTexture.update(F),Z.debugOverlayTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE)}(u,`${q} ${L}kB`),m.draw(n,o.TRIANGLES,_,y,Ft.alphaBlended,_t.disabled,_s(c,p.aM.transparent,U),null,E,u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments),m.draw(n,o.LINE_STRIP,_,y,v,_t.disabled,_s(c,p.aM.red),S,E,u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments)}function Tl(u,e,a){const n=u.context,o=n.gl,c=u.colorModeForRenderPass(),m=new Je(o.LEQUAL,Je.ReadWrite,u.depthRangeFor3D),_=u.useProgram("terrain"),y=e.getTerrainMesh();n.bindFramebuffer.set(null),n.viewport.set([0,0,u.width,u.height]);for(const v of a){const E=u.renderToTexture.getTexture(v),S=e.getTerrainData(v.tileID);n.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,E.texture);const A=u.transform.calculatePosMatrix(v.tileID.toUnwrapped()),L=e.getMeshFrameDelta(u.transform.zoom),R=u.transform.calculateFogMatrix(v.tileID.toUnwrapped()),U=Hn(A,L,R,u.style.sky,u.transform.pitch);_.draw(n,o.TRIANGLES,m,vt.disabled,c,_t.backCCW,U,S,"terrain",y.vertexBuffer,y.indexBuffer,y.segments)}}class ln{constructor(e,a,n){this.vertexBuffer=e,this.indexBuffer=a,this.segments=n}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class cn{constructor(e,a){this.context=new Pc(e),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:p.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=je.maxUnderzooming+je.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Zn}resize(e,a,n){if(this.width=Math.floor(e*n),this.height=Math.floor(a*n),this.pixelRatio=n,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const o of this.style._order)this.style._layers[o].resize()}setup(){const e=this.context,a=new p.aX;a.emplaceBack(0,0),a.emplaceBack(p.X,0),a.emplaceBack(0,p.X),a.emplaceBack(p.X,p.X),this.tileExtentBuffer=e.createVertexBuffer(a,ua.members),this.tileExtentSegments=p.a0.simpleSegment(0,0,4,2);const n=new p.aX;n.emplaceBack(0,0),n.emplaceBack(p.X,0),n.emplaceBack(0,p.X),n.emplaceBack(p.X,p.X),this.debugBuffer=e.createVertexBuffer(n,ua.members),this.debugSegments=p.a0.simpleSegment(0,0,4,5);const o=new p.$;o.emplaceBack(0,0,0,0),o.emplaceBack(p.X,0,p.X,0),o.emplaceBack(0,p.X,0,p.X),o.emplaceBack(p.X,p.X,p.X,p.X),this.rasterBoundsBuffer=e.createVertexBuffer(o,Hr.members),this.rasterBoundsSegments=p.a0.simpleSegment(0,0,4,2);const c=new p.aX;c.emplaceBack(0,0),c.emplaceBack(1,0),c.emplaceBack(0,1),c.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(c,ua.members),this.viewportSegments=p.a0.simpleSegment(0,0,4,2);const m=new p.aZ;m.emplaceBack(0),m.emplaceBack(1),m.emplaceBack(3),m.emplaceBack(2),m.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(m);const _=new p.aY;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(_);const y=this.context.gl;this.stencilClearMode=new vt({func:y.ALWAYS,mask:0},0,255,y.ZERO,y.ZERO,y.ZERO)}clearStencil(){const e=this.context,a=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const n=p.H();p.aP(n,0,this.width,this.height,0,0,1),p.K(n,n,[a.drawingBufferWidth,a.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,a.TRIANGLES,Je.disabled,this.stencilClearMode,Ft.disabled,_t.disabled,Si(n),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,a){if(this.currentStencilSource===e.source||!e.isTileClipped()||!a||!a.length)return;this.currentStencilSource=e.source;const n=this.context,o=n.gl;this.nextStencilID+a.length>256&&this.clearStencil(),n.setColorMode(Ft.disabled),n.setDepthMode(Je.disabled);const c=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const m of a){const _=this._tileClippingMaskIDs[m.key]=this.nextStencilID++,y=this.style.map.terrain&&this.style.map.terrain.getTerrainData(m);c.draw(n,o.TRIANGLES,Je.disabled,new vt({func:o.ALWAYS,mask:0},_,255,o.KEEP,o.KEEP,o.REPLACE),Ft.disabled,_t.disabled,Si(m.posMatrix),y,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,a=this.context.gl;return new vt({func:a.NOTEQUAL,mask:255},e,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(e){const a=this.context.gl;return new vt({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(e){const a=this.context.gl,n=e.sort((m,_)=>_.overscaledZ-m.overscaledZ),o=n[n.length-1].overscaledZ,c=n[0].overscaledZ-o+1;if(c>1){this.currentStencilSource=void 0,this.nextStencilID+c>256&&this.clearStencil();const m={};for(let _=0;_<c;_++)m[_+o]=new vt({func:a.GEQUAL,mask:255},_+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=c,[m,n]}return[{[o]:vt.disabled},n]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Ft([e.CONSTANT_COLOR,e.ONE],new p.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ft.unblended:Ft.alphaBlended}depthModeForSublayer(e,a,n){if(!this.opaquePassEnabledForLayer())return Je.disabled;const o=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Je(n||this.context.gl.LEQUAL,a,[o,o])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,a){this.style=e,this.options=a,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(ge.now()),this.imageManager.beginFrame();const n=this.style._order,o=this.style.sourceCaches,c={},m={},_={};for(const y in o){const v=o[y];v.used&&v.prepare(this.context),c[y]=v.getVisibleCoordinates(),m[y]=c[y].slice().reverse(),_[y]=v.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let y=0;y<n.length;y++)if(this.style._layers[n[y]].is3D()){this.opaquePassCutoff=y;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const y of n){const v=this.style._layers[y];if(!v.hasOffscreenPass()||v.isHidden(this.transform.zoom))continue;const E=m[v.source];(v.type==="custom"||E.length)&&this.renderLayer(this,o[v.source],v,E)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?p.aM.black:p.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(y,v){const E=y.context,S=E.gl,A=((Z,H,F)=>({u_sky_color:Z.properties.get("sky-color"),u_horizon_color:Z.properties.get("horizon-color"),u_horizon:(H.height/2+H.getHorizon())*F,u_sky_horizon_blend:Z.properties.get("sky-horizon-blend")*H.height/2*F}))(v,y.style.map.transform,y.pixelRatio),L=new Je(S.LEQUAL,Je.ReadWrite,[0,1]),R=vt.disabled,U=y.colorModeForRenderPass(),q=y.useProgram("sky");if(!v.mesh){const Z=new p.aX;Z.emplaceBack(-1,-1),Z.emplaceBack(1,-1),Z.emplaceBack(1,1),Z.emplaceBack(-1,1);const H=new p.aY;H.emplaceBack(0,1,2),H.emplaceBack(0,2,3),v.mesh=new ln(E.createVertexBuffer(Z,ua.members),E.createIndexBuffer(H),p.a0.simpleSegment(0,0,Z.length,H.length))}q.draw(E,S.TRIANGLES,L,R,U,_t.disabled,A,void 0,"sky",v.mesh.vertexBuffer,v.mesh.indexBuffer,v.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){const y=this.style._layers[n[this.currentLayer]],v=o[y.source],E=c[y.source];this._renderTileClippingMasks(y,E),this.renderLayer(this,v,y,E)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){const y=this.style._layers[n[this.currentLayer]],v=o[y.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(y))continue;const E=(y.type==="symbol"?_:m)[y.source];this._renderTileClippingMasks(y,c[y.source]),this.renderLayer(this,v,y,E)}if(this.options.showTileBoundaries){const y=function(v,E){let S=null;const A=Object.values(v._layers).flatMap(q=>q.source&&!q.isHidden(E)?[v.sourceCaches[q.source]]:[]),L=A.filter(q=>q.getSource().type==="vector"),R=A.filter(q=>q.getSource().type!=="vector"),U=q=>{(!S||S.getSource().maxzoom<q.getSource().maxzoom)&&(S=q)};return L.forEach(q=>U(q)),S||R.forEach(q=>U(q)),S}(this.style,this.transform.zoom);y&&function(v,E,S){for(let A=0;A<S.length;A++)Sl(v,E,S[A])}(this,y,y.getVisibleCoordinates())}this.options.showPadding&&function(y){const v=y.transform.padding;Va(y,y.transform.height-(v.top||0),3,uo),Va(y,v.bottom||0,3,lt),El(y,v.left||0,3,nn),El(y,y.transform.width-(v.right||0),3,Cc);const E=y.transform.centerPoint;(function(S,A,L,R){on(S,A-1,L-10,2,20,R),on(S,A-10,L-1,20,2,R)})(y,E.x,y.transform.height-E.y,wl)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,n=this.transform.modelViewProjectionMatrix;let o=this.terrainFacilitator.dirty;o||(o=e?!p.a_(a,n):!p.a$(a,n)),o||(o=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),o&&(p.b0(a,n),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(c,m){const _=c.context,y=_.gl,v=Ft.unblended,E=new Je(y.LEQUAL,Je.ReadWrite,[0,1]),S=m.getTerrainMesh(),A=m.sourceCache.getRenderableTiles(),L=c.useProgram("terrainDepth");_.bindFramebuffer.set(m.getFramebuffer("depth").framebuffer),_.viewport.set([0,0,c.width/devicePixelRatio,c.height/devicePixelRatio]),_.clear({color:p.aM.transparent,depth:1});for(const R of A){const U=m.getTerrainData(R.tileID),q={u_matrix:c.transform.calculatePosMatrix(R.tileID.toUnwrapped()),u_ele_delta:m.getMeshFrameDelta(c.transform.zoom)};L.draw(_,y.TRIANGLES,E,vt.disabled,v,_t.backCCW,q,U,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}_.bindFramebuffer.set(null),_.viewport.set([0,0,c.width,c.height])}(this,this.style.map.terrain),function(c,m){const _=c.context,y=_.gl,v=Ft.unblended,E=new Je(y.LEQUAL,Je.ReadWrite,[0,1]),S=m.getTerrainMesh(),A=m.getCoordsTexture(),L=m.sourceCache.getRenderableTiles(),R=c.useProgram("terrainCoords");_.bindFramebuffer.set(m.getFramebuffer("coords").framebuffer),_.viewport.set([0,0,c.width/devicePixelRatio,c.height/devicePixelRatio]),_.clear({color:p.aM.transparent,depth:1}),m.coordsIndex=[];for(const U of L){const q=m.getTerrainData(U.tileID);_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,A.texture);const Z={u_matrix:c.transform.calculatePosMatrix(U.tileID.toUnwrapped()),u_terrain_coords_id:(255-m.coordsIndex.length)/255,u_texture:0,u_ele_delta:m.getMeshFrameDelta(c.transform.zoom)};R.draw(_,y.TRIANGLES,E,vt.disabled,v,_t.backCCW,Z,q,"terrain",S.vertexBuffer,S.indexBuffer,S.segments),m.coordsIndex.push(U.tileID.key)}_.bindFramebuffer.set(null),_.viewport.set([0,0,c.width,c.height])}(this,this.style.map.terrain))}renderLayer(e,a,n,o){if(!n.isHidden(this.transform.zoom)&&(n.type==="background"||n.type==="custom"||(o||[]).length))switch(this.id=n.id,n.type){case"symbol":(function(c,m,_,y,v){if(c.renderPass!=="translucent")return;const E=vt.disabled,S=c.colorModeForRenderPass();(_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(A,L,R,U,q,Z,H,F,K){const Y=L.transform,re=ca(),de=q==="map",_e=Z==="map";for(const Te of A){const Ce=U.getTile(Te),ve=Ce.getBucket(R);if(!ve||!ve.text||!ve.text.segments.get().length)continue;const xe=p.ag(ve.textSizeData,Y.zoom),Le=et(Ce,1,L.transform.zoom),Ze=Xr(Te.posMatrix,_e,de,L.transform,Le),Ee=R.layout.get("icon-text-fit")!=="none"&&ve.hasIconData();if(xe){const ke=Math.pow(2,Y.zoom-Ce.tileID.overscaledZ),$e=L.style.map.terrain?(We,tt)=>L.style.map.terrain.getElevation(Te,We,tt):null,Tt=re.translatePosition(Y,Ce,H,F);Ra(ve,de,_e,K,Y,Ze,Te.posMatrix,ke,xe,Ee,re,Tt,Te.toUnwrapped(),$e)}}}(y,c,_,m,_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),v),_.paint.get("icon-opacity").constantOr(1)!==0&&oo(c,m,_,y,!1,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),_.layout.get("icon-rotation-alignment"),_.layout.get("icon-pitch-alignment"),_.layout.get("icon-keep-upright"),E,S),_.paint.get("text-opacity").constantOr(1)!==0&&oo(c,m,_,y,!0,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),_.layout.get("text-keep-upright"),E,S),m.map.showCollisionBoxes&&(xs(c,m,_,y,!0),xs(c,m,_,y,!1))})(e,a,n,o,this.style.placement.variableOffsets);break;case"circle":(function(c,m,_,y){if(c.renderPass!=="translucent")return;const v=_.paint.get("circle-opacity"),E=_.paint.get("circle-stroke-width"),S=_.paint.get("circle-stroke-opacity"),A=!_.layout.get("circle-sort-key").isConstant();if(v.constantOr(1)===0&&(E.constantOr(1)===0||S.constantOr(1)===0))return;const L=c.context,R=L.gl,U=c.depthModeForSublayer(0,Je.ReadOnly),q=vt.disabled,Z=c.colorModeForRenderPass(),H=[];for(let F=0;F<y.length;F++){const K=y[F],Y=m.getTile(K),re=Y.getBucket(_);if(!re)continue;const de=re.programConfigurations.get(_.id),_e=c.useProgram("circle",de),Te=re.layoutVertexBuffer,Ce=re.indexBuffer,ve=c.style.map.terrain&&c.style.map.terrain.getTerrainData(K),xe={programConfiguration:de,program:_e,layoutVertexBuffer:Te,indexBuffer:Ce,uniformValues:mc(c,K,Y,_),terrainData:ve};if(A){const Le=re.segments.get();for(const Ze of Le)H.push({segments:new p.a0([Ze]),sortKey:Ze.sortKey,state:xe})}else H.push({segments:re.segments,sortKey:0,state:xe})}A&&H.sort((F,K)=>F.sortKey-K.sortKey);for(const F of H){const{programConfiguration:K,program:Y,layoutVertexBuffer:re,indexBuffer:de,uniformValues:_e,terrainData:Te}=F.state;Y.draw(L,R.TRIANGLES,U,q,Z,_t.disabled,_e,Te,_.id,re,de,F.segments,_.paint,c.transform.zoom,K)}})(e,a,n,o);break;case"heatmap":(function(c,m,_,y){if(_.paint.get("heatmap-opacity")===0)return;const v=c.context;if(c.style.map.terrain){for(const E of y){const S=m.getTile(E);m.hasRenderableParent(E)||(c.renderPass==="offscreen"?co(c,S,_,E):c.renderPass==="translucent"&&_a(c,_,E))}v.viewport.set([0,0,c.width,c.height])}else c.renderPass==="offscreen"?function(E,S,A,L){const R=E.context,U=R.gl,q=vt.disabled,Z=new Ft([U.ONE,U.ONE],p.aM.transparent,[!0,!0,!0,!0]);(function(H,F,K){const Y=H.gl;H.activeTexture.set(Y.TEXTURE1),H.viewport.set([0,0,F.width/4,F.height/4]);let re=K.heatmapFbos.get(p.aU);re?(Y.bindTexture(Y.TEXTURE_2D,re.colorAttachment.get()),H.bindFramebuffer.set(re.framebuffer)):(re=ws(H,F.width/4,F.height/4),K.heatmapFbos.set(p.aU,re))})(R,E,A),R.clear({color:p.aM.transparent});for(let H=0;H<L.length;H++){const F=L[H];if(S.hasRenderableParent(F))continue;const K=S.getTile(F),Y=K.getBucket(A);if(!Y)continue;const re=Y.programConfigurations.get(A.id),de=E.useProgram("heatmap",re),{zoom:_e}=E.transform;de.draw(R,U.TRIANGLES,Je.disabled,q,Z,_t.disabled,Ti(F.posMatrix,K,_e,A.paint.get("heatmap-intensity")),null,A.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,A.paint,E.transform.zoom,re)}R.viewport.set([0,0,E.width,E.height])}(c,m,_,y):c.renderPass==="translucent"&&function(E,S){const A=E.context,L=A.gl;A.setColorMode(E.colorModeForRenderPass());const R=S.heatmapFbos.get(p.aU);R&&(A.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,R.colorAttachment.get()),A.activeTexture.set(L.TEXTURE1),Es(A,S).bind(L.LINEAR,L.CLAMP_TO_EDGE),E.useProgram("heatmapTexture").draw(A,L.TRIANGLES,Je.disabled,vt.disabled,E.colorModeForRenderPass(),_t.disabled,Xs(E,S,0,1),null,S.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,S.paint,E.transform.zoom))}(c,_)})(e,a,n,o);break;case"line":(function(c,m,_,y){if(c.renderPass!=="translucent")return;const v=_.paint.get("line-opacity"),E=_.paint.get("line-width");if(v.constantOr(1)===0||E.constantOr(1)===0)return;const S=c.depthModeForSublayer(0,Je.ReadOnly),A=c.colorModeForRenderPass(),L=_.paint.get("line-dasharray"),R=_.paint.get("line-pattern"),U=R.constantOr(1),q=_.paint.get("line-gradient"),Z=_.getCrossfadeParameters(),H=U?"linePattern":L?"lineSDF":q?"lineGradient":"line",F=c.context,K=F.gl;let Y=!0;for(const re of y){const de=m.getTile(re);if(U&&!de.patternsLoaded())continue;const _e=de.getBucket(_);if(!_e)continue;const Te=_e.programConfigurations.get(_.id),Ce=c.context.program.get(),ve=c.useProgram(H,Te),xe=Y||ve.program!==Ce,Le=c.style.map.terrain&&c.style.map.terrain.getTerrainData(re),Ze=R.constantOr(null);if(Ze&&de.imageAtlas){const $e=de.imageAtlas,Tt=$e.patternPositions[Ze.to.toString()],We=$e.patternPositions[Ze.from.toString()];Tt&&We&&Te.setConstantPatternPositions(Tt,We)}const Ee=Le?re:null,ke=U?Da(c,de,_,Z,Ee):L?gc(c,de,_,L,Z,Ee):q?sl(c,de,_,_e.lineClipsArray.length,Ee):Js(c,de,_,Ee);if(U)F.activeTexture.set(K.TEXTURE0),de.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Te.updatePaintBuffers(Z);else if(L&&(xe||c.lineAtlas.dirty))F.activeTexture.set(K.TEXTURE0),c.lineAtlas.bind(F);else if(q){const $e=_e.gradients[_.id];let Tt=$e.texture;if(_.gradientVersion!==$e.version){let We=256;if(_.stepInterpolant){const tt=m.getSource().maxzoom,It=re.canonical.z===tt?Math.ceil(1<<c.transform.maxZoom-re.canonical.z):1;We=p.ac(p.aV(_e.maxLineLength/p.X*1024*It),256,F.maxTextureSize)}$e.gradient=p.aW({expression:_.gradientExpression(),evaluationKey:"lineProgress",resolution:We,image:$e.gradient||void 0,clips:_e.lineClipsArray}),$e.texture?$e.texture.update($e.gradient):$e.texture=new at(F,$e.gradient,K.RGBA),$e.version=_.gradientVersion,Tt=$e.texture}F.activeTexture.set(K.TEXTURE0),Tt.bind(_.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}ve.draw(F,K.TRIANGLES,S,c.stencilModeForClipping(re),A,_t.disabled,ke,Le,_.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,_.paint,c.transform.zoom,Te,_e.layoutVertexBuffer2),Y=!1}})(e,a,n,o);break;case"fill":(function(c,m,_,y){const v=_.paint.get("fill-color"),E=_.paint.get("fill-opacity");if(E.constantOr(1)===0)return;const S=c.colorModeForRenderPass(),A=_.paint.get("fill-pattern"),L=c.opaquePassEnabledForLayer()&&!A.constantOr(1)&&v.constantOr(p.aM.transparent).a===1&&E.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===L){const R=c.depthModeForSublayer(1,c.renderPass==="opaque"?Je.ReadWrite:Je.ReadOnly);Ss(c,m,_,y,R,S,!1)}if(c.renderPass==="translucent"&&_.paint.get("fill-antialias")){const R=c.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,Je.ReadOnly);Ss(c,m,_,y,R,S,!0)}})(e,a,n,o);break;case"fill-extrusion":(function(c,m,_,y){const v=_.paint.get("fill-extrusion-opacity");if(v!==0&&c.renderPass==="translucent"){const E=new Je(c.context.gl.LEQUAL,Je.ReadWrite,c.depthRangeFor3D);if(v!==1||_.paint.get("fill-extrusion-pattern").constantOr(1))sn(c,m,_,y,E,vt.disabled,Ft.disabled),sn(c,m,_,y,E,c.stencilModeFor3D(),c.colorModeForRenderPass());else{const S=c.colorModeForRenderPass();sn(c,m,_,y,E,vt.disabled,S)}}})(e,a,n,o);break;case"hillshade":(function(c,m,_,y){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;const v=c.context,E=c.depthModeForSublayer(0,Je.ReadOnly),S=c.colorModeForRenderPass(),[A,L]=c.renderPass==="translucent"?c.stencilConfigForOverlap(y):[{},y];for(const R of L){const U=m.getTile(R);U.needsHillshadePrepare!==void 0&&U.needsHillshadePrepare&&c.renderPass==="offscreen"?Oa(c,U,_,E,vt.disabled,S):c.renderPass==="translucent"&&Fa(c,R,U,_,E,A[R.overscaledZ],S)}v.viewport.set([0,0,c.width,c.height])})(e,a,n,o);break;case"raster":(function(c,m,_,y){if(c.renderPass!=="translucent"||_.paint.get("raster-opacity")===0||!y.length)return;const v=c.context,E=v.gl,S=m.getSource(),A=c.useProgram("raster"),L=c.colorModeForRenderPass(),[R,U]=S instanceof Br?[{},y]:c.stencilConfigForOverlap(y),q=U[U.length-1].overscaledZ,Z=!c.options.moving;for(const H of U){const F=c.depthModeForSublayer(H.overscaledZ-q,_.paint.get("raster-opacity")===1?Je.ReadWrite:Je.ReadOnly,E.LESS),K=m.getTile(H);K.registerFadeDuration(_.paint.get("raster-fade-duration"));const Y=m.findLoadedParent(H,0),re=m.findLoadedSibling(H),de=vl(K,Y||re||null,m,_,c.transform,c.style.map.terrain);let _e,Te;const Ce=_.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;v.activeTexture.set(E.TEXTURE0),K.texture.bind(Ce,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),v.activeTexture.set(E.TEXTURE1),Y?(Y.texture.bind(Ce,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),_e=Math.pow(2,Y.tileID.overscaledZ-K.tileID.overscaledZ),Te=[K.tileID.canonical.x*_e%1,K.tileID.canonical.y*_e%1]):K.texture.bind(Ce,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),K.texture.useMipmap&&v.extTextureFilterAnisotropic&&c.transform.pitch>20&&E.texParameterf(E.TEXTURE_2D,v.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,v.extTextureFilterAnisotropicMax);const ve=c.style.map.terrain&&c.style.map.terrain.getTerrainData(H),xe=ve?H:null,Le=xe?xe.posMatrix:c.transform.calculatePosMatrix(H.toUnwrapped(),Z),Ze=_c(Le,Te||[0,0],_e||1,de,_);S instanceof Br?A.draw(v,E.TRIANGLES,F,vt.disabled,L,_t.disabled,Ze,ve,_.id,S.boundsBuffer,c.quadTriangleIndexBuffer,S.boundsSegments):A.draw(v,E.TRIANGLES,F,R[H.overscaledZ],L,_t.disabled,Ze,ve,_.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}})(e,a,n,o);break;case"background":(function(c,m,_,y){const v=_.paint.get("background-color"),E=_.paint.get("background-opacity");if(E===0)return;const S=c.context,A=S.gl,L=c.transform,R=L.tileSize,U=_.paint.get("background-pattern");if(c.isPatternMissing(U))return;const q=!U&&v.a===1&&E===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==q)return;const Z=vt.disabled,H=c.depthModeForSublayer(0,q==="opaque"?Je.ReadWrite:Je.ReadOnly),F=c.colorModeForRenderPass(),K=c.useProgram(U?"backgroundPattern":"background"),Y=y||L.coveringTiles({tileSize:R,terrain:c.style.map.terrain});U&&(S.activeTexture.set(A.TEXTURE0),c.imageManager.bind(c.context));const re=_.getCrossfadeParameters();for(const de of Y){const _e=y?de.posMatrix:c.transform.calculatePosMatrix(de.toUnwrapped()),Te=U?Kn(_e,E,c,U,{tileID:de,tileSize:R},re):Ys(_e,E,v),Ce=c.style.map.terrain&&c.style.map.terrain.getTerrainData(de);K.draw(S,A.TRIANGLES,H,Z,F,_t.disabled,Te,Ce,_.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}})(e,0,n,o);break;case"custom":(function(c,m,_){const y=c.context,v=_.implementation;if(c.renderPass==="offscreen"){const E=v.prerender;E&&(c.setCustomLayerDefaults(),y.setColorMode(c.colorModeForRenderPass()),E.call(v,y.gl,c.transform.customLayerMatrix()),y.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),y.setColorMode(c.colorModeForRenderPass()),y.setStencilMode(vt.disabled);const E=v.renderingMode==="3d"?new Je(c.context.gl.LEQUAL,Je.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,Je.ReadOnly);y.setDepthMode(E),v.render(y.gl,c.transform.customLayerMatrix(),{farZ:c.transform.farZ,nearZ:c.transform.nearZ,fov:c.transform._fov,modelViewProjectionMatrix:c.transform.modelViewProjectionMatrix,projectionMatrix:c.transform.projectionMatrix}),y.setDirty(),c.setBaseState(),y.bindFramebuffer.set(null)}})(e,0,n)}}translatePosMatrix(e,a,n,o,c){if(!n[0]&&!n[1])return e;const m=c?o==="map"?this.transform.angle:0:o==="viewport"?-this.transform.angle:0;if(m){const v=Math.sin(m),E=Math.cos(m);n=[n[0]*E-n[1]*v,n[0]*v+n[1]*E]}const _=[c?n[0]:et(a,n[0],this.transform.zoom),c?n[1]:et(a,n[1],this.transform.zoom),0],y=new Float32Array(16);return p.J(y,e,_),y}saveTileTexture(e){const a=this._tileTextures[e.size[0]];a?a.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const a=this._tileTextures[e];return a&&a.length>0?a.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const a=this.imageManager.getPattern(e.from.toString()),n=this.imageManager.getPattern(e.to.toString());return!a||!n}useProgram(e,a){this.cache=this.cache||{};const n=e+(a?a.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[n]||(this.cache[n]=new Wn(this.context,Kr[e],a,Jn[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[n]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new at(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:a}=this.context.gl;return this.width!==e||this.height!==a}}class Na{constructor(e,a){this.points=e,this.planes=a}static fromInvProjectionMatrix(e,a,n){const o=Math.pow(2,n),c=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(_=>{const y=1/(_=p.af([],_,e))[3]/a*o;return p.b1(_,_,[y,y,1/_[3],y])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(_=>{const y=function(A,L){var R=L[0],U=L[1],q=L[2],Z=R*R+U*U+q*q;return Z>0&&(Z=1/Math.sqrt(Z)),A[0]=L[0]*Z,A[1]=L[1]*Z,A[2]=L[2]*Z,A}([],function(A,L,R){var U=L[0],q=L[1],Z=L[2],H=R[0],F=R[1],K=R[2];return A[0]=q*K-Z*F,A[1]=Z*H-U*K,A[2]=U*F-q*H,A}([],ut([],c[_[0]],c[_[1]]),ut([],c[_[2]],c[_[1]]))),v=-((E=y)[0]*(S=c[_[1]])[0]+E[1]*S[1]+E[2]*S[2]);var E,S;return y.concat(v)});return new Na(c,m)}}class Ua{constructor(e,a){this.min=e,this.max=a,this.center=function(n,o,c){return n[0]=.5*o[0],n[1]=.5*o[1],n[2]=.5*o[2],n}([],function(n,o,c){return n[0]=o[0]+c[0],n[1]=o[1]+c[1],n[2]=o[2]+c[2],n}([],this.min,this.max))}quadrant(e){const a=[e%2==0,e<2],n=Di(this.min),o=Di(this.max);for(let c=0;c<a.length;c++)n[c]=a[c]?this.min[c]:this.center[c],o[c]=a[c]?this.center[c]:this.max[c];return o[2]=this.max[2],new Ua(n,o)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const a=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let n=!0;for(let o=0;o<e.planes.length;o++){const c=e.planes[o];let m=0;for(let _=0;_<a.length;_++)p.b2(c,a[_])>=0&&m++;if(m===0)return 0;m!==a.length&&(n=!1)}if(n)return 2;for(let o=0;o<3;o++){let c=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let _=0;_<e.points.length;_++){const y=e.points[_][o]-this.min[o];c=Math.min(c,y),m=Math.max(m,y)}if(m<0||c>this.max[o]-this.min[o])return 0}return 1}}class ja{constructor(e=0,a=0,n=0,o=0){if(isNaN(e)||e<0||isNaN(a)||a<0||isNaN(n)||n<0||isNaN(o)||o<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=a,this.left=n,this.right=o}interpolate(e,a,n){return a.top!=null&&e.top!=null&&(this.top=p.y.number(e.top,a.top,n)),a.bottom!=null&&e.bottom!=null&&(this.bottom=p.y.number(e.bottom,a.bottom,n)),a.left!=null&&e.left!=null&&(this.left=p.y.number(e.left,a.left,n)),a.right!=null&&e.right!=null&&(this.right=p.y.number(e.right,a.right,n)),this}getCenter(e,a){const n=p.ac((this.left+e-this.right)/2,0,e),o=p.ac((this.top+a-this.bottom)/2,0,a);return new p.P(n,o)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ja(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ho=85.051129;class $a{constructor(e,a,n,o,c){this.tileSize=512,this._renderWorldCopies=c===void 0||!!c,this._minZoom=e||0,this._maxZoom=a||22,this._minPitch=n??0,this._maxPitch=o??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ja,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new $a(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const a=-p.b3(e,-180,180)*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=function(){var n=new p.A(4);return p.A!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n}(),function(n,o,c){var m=o[0],_=o[1],y=o[2],v=o[3],E=Math.sin(c),S=Math.cos(c);n[0]=m*S+y*E,n[1]=_*S+v*E,n[2]=m*-E+y*S,n[3]=_*-E+v*S}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const a=p.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const a=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this.tileZoom=Math.max(0,Math.floor(a)),this.scale=this.zoomScale(a),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,a,n){this._unmodified=!1,this._edgeInsets.interpolate(e,a,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const a=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(e){const a=[new p.b4(0,e)];if(this._renderWorldCopies){const n=this.pointCoordinate(new p.P(0,0)),o=this.pointCoordinate(new p.P(this.width,0)),c=this.pointCoordinate(new p.P(this.width,this.height)),m=this.pointCoordinate(new p.P(0,this.height)),_=Math.floor(Math.min(n.x,o.x,c.x,m.x)),y=Math.floor(Math.max(n.x,o.x,c.x,m.x)),v=1;for(let E=_-v;E<=y+v;E++)E!==0&&a.push(new p.b4(E,e))}return a}coveringTiles(e){var a,n;let o=this.coveringZoomLevel(e);const c=o;if(e.minzoom!==void 0&&o<e.minzoom)return[];e.maxzoom!==void 0&&o>e.maxzoom&&(o=e.maxzoom);const m=this.pointCoordinate(this.getCameraPoint()),_=p.Z.fromLngLat(this.center),y=Math.pow(2,o),v=[y*m.x,y*m.y,0],E=[y*_.x,y*_.y,0],S=Na.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,o);let A=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(A=o);const L=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,R=F=>({aabb:new Ua([F*y,0,0],[(F+1)*y,y,0]),zoom:0,x:0,y:0,wrap:F,fullyVisible:!1}),U=[],q=[],Z=o,H=e.reparseOverscaled?c:o;if(this._renderWorldCopies)for(let F=1;F<=3;F++)U.push(R(-F)),U.push(R(F));for(U.push(R(0));U.length>0;){const F=U.pop(),K=F.x,Y=F.y;let re=F.fullyVisible;if(!re){const ve=F.aabb.intersects(S);if(ve===0)continue;re=ve===2}const de=e.terrain?v:E,_e=F.aabb.distanceX(de),Te=F.aabb.distanceY(de),Ce=Math.max(Math.abs(_e),Math.abs(Te));if(F.zoom===Z||Ce>L+(1<<Z-F.zoom)-2&&F.zoom>=A){const ve=Z-F.zoom,xe=v[0]-.5-(K<<ve),Le=v[1]-.5-(Y<<ve);q.push({tileID:new p.S(F.zoom===Z?H:F.zoom,F.wrap,F.zoom,K,Y),distanceSq:Mt([E[0]-.5-K,E[1]-.5-Y]),tileDistanceToCamera:Math.sqrt(xe*xe+Le*Le)})}else for(let ve=0;ve<4;ve++){const xe=(K<<1)+ve%2,Le=(Y<<1)+(ve>>1),Ze=F.zoom+1;let Ee=F.aabb.quadrant(ve);if(e.terrain){const ke=new p.S(Ze,F.wrap,Ze,xe,Le),$e=e.terrain.getMinMaxElevation(ke),Tt=(a=$e.minElevation)!==null&&a!==void 0?a:this.elevation,We=(n=$e.maxElevation)!==null&&n!==void 0?n:this.elevation;Ee=new Ua([Ee.min[0],Ee.min[1],Tt],[Ee.max[0],Ee.max[1],We])}U.push({aabb:Ee,zoom:Ze,x:xe,y:Le,wrap:F.wrap,fullyVisible:re})}}return q.sort((F,K)=>F.distanceSq-K.distanceSq).map(F=>F.tileID)}resize(e,a){this.width=e,this.height=a,this.pixelsToGLUnits=[2/e,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const a=p.ac(e.lat,-85.051129,ho);return new p.P(p.O(e.lng)*this.worldSize,p.Q(a)*this.worldSize)}unproject(e){return new p.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const a=this.elevation,n=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,o=this.pointLocation(this.centerPoint,e),c=e.getElevationForLngLatZoom(o,this.tileZoom);if(!(this.elevation-c))return;const m=n+a-c,_=Math.cos(this._pitch)*this.cameraToCenterDistance/m/p.b5(1,o.lat),y=this.scaleZoom(_/this.tileSize);this._elevation=c,this._center=o,this.zoom=y}setLocationAtPoint(e,a){const n=this.pointCoordinate(a),o=this.pointCoordinate(this.centerPoint),c=this.locationCoordinate(e),m=new p.Z(c.x-(n.x-o.x),c.y-(n.y-o.y));this.center=this.coordinateLocation(m),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,a){return a?this.coordinatePoint(this.locationCoordinate(e),a.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,a){return this.coordinateLocation(this.pointCoordinate(e,a))}locationCoordinate(e){return p.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,a){if(a){const A=a.pointCoordinate(e);if(A!=null)return A}const n=[e.x,e.y,0,1],o=[e.x,e.y,1,1];p.af(n,n,this.pixelMatrixInverse),p.af(o,o,this.pixelMatrixInverse);const c=n[3],m=o[3],_=n[1]/c,y=o[1]/m,v=n[2]/c,E=o[2]/m,S=v===E?0:(0-v)/(E-v);return new p.Z(p.y.number(n[0]/c,o[0]/m,S)/this.worldSize,p.y.number(_,y,S)/this.worldSize)}coordinatePoint(e,a=0,n=this.pixelMatrix){const o=[e.x*this.worldSize,e.y*this.worldSize,a,1];return p.af(o,o,n),new p.P(o[0]/o[3],o[1]/o[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new oe().extend(this.pointLocation(new p.P(0,e))).extend(this.pointLocation(new p.P(this.width,e))).extend(this.pointLocation(new p.P(this.width,this.height))).extend(this.pointLocation(new p.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new oe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,ho])}calculateTileMatrix(e){const a=e.canonical,n=this.worldSize/this.zoomScale(a.z),o=a.x+Math.pow(2,a.z)*e.wrap,c=p.an(new Float64Array(16));return p.J(c,c,[o*n,a.y*n,0]),p.K(c,c,[n/p.X,n/p.X,1]),c}calculatePosMatrix(e,a=!1){const n=e.key,o=a?this._alignedPosMatrixCache:this._posMatrixCache;if(o[n])return o[n];const c=this.calculateTileMatrix(e);return p.L(c,a?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,c),o[n]=new Float32Array(c),o[n]}calculateFogMatrix(e){const a=e.key,n=this._fogMatrixCache;if(n[a])return n[a];const o=this.calculateTileMatrix(e);return p.L(o,this.fogMatrix,o),n[a]=new Float32Array(o),n[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,a){a=p.ac(+a,this.minZoom,this.maxZoom);const n={center:new p.N(e.lng,e.lat),zoom:a};let o=this.lngRange;if(!this._renderWorldCopies&&o===null){const F=179.9999999999;o=[-F,F]}const c=this.tileSize*this.zoomScale(n.zoom);let m=0,_=c,y=0,v=c,E=0,S=0;const{x:A,y:L}=this.size;if(this.latRange){const F=this.latRange;m=p.Q(F[1])*c,_=p.Q(F[0])*c,_-m<L&&(E=L/(_-m))}o&&(y=p.b3(p.O(o[0])*c,0,c),v=p.b3(p.O(o[1])*c,0,c),v<y&&(v+=c),v-y<A&&(S=A/(v-y)));const{x:R,y:U}=this.project.call({worldSize:c},e);let q,Z;const H=Math.max(S||0,E||0);if(H){const F=new p.P(S?(v+y)/2:R,E?(_+m)/2:U);return n.center=this.unproject.call({worldSize:c},F).wrap(),n.zoom+=this.scaleZoom(H),n}if(this.latRange){const F=L/2;U-F<m&&(Z=m+F),U+F>_&&(Z=_-F)}if(o){const F=(y+v)/2;let K=R;this._renderWorldCopies&&(K=p.b3(R,F-c/2,F+c/2));const Y=A/2;K-Y<y&&(q=y+Y),K+Y>v&&(q=v-Y)}if(q!==void 0||Z!==void 0){const F=new p.P(q??R,Z??U);n.center=this.unproject.call({worldSize:c},F).wrap()}return n}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:a,zoom:n}=this.getConstrained(this.center,this.zoom);this.center=a,this.zoom=n,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,a=this.point.x,n=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=p.b5(1,this.center.lat)*this.worldSize;let o=p.an(new Float64Array(16));p.K(o,o,[this.width/2,-this.height/2,1]),p.J(o,o,[1,-1,0]),this.labelPlaneMatrix=o,o=p.an(new Float64Array(16)),p.K(o,o,[1,-1,1]),p.J(o,o,[-1,-1,0]),p.K(o,o,[2/this.width,2/this.height,1]),this.glCoordMatrix=o;const c=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),m=Math.min(this.elevation,this.minElevationForCurrentTile),_=c-m*this._pixelPerMeter/Math.cos(this._pitch),y=m<0?_:c,v=Math.PI/2+this._pitch,E=this._fov*(.5+e.y/this.height),S=Math.sin(E)*y/Math.sin(p.ac(Math.PI-v-E,.01,Math.PI-.01)),A=this.getHorizon(),L=2*Math.atan(A/this.cameraToCenterDistance)*(.5+e.y/(2*A)),R=Math.sin(L)*y/Math.sin(p.ac(Math.PI-v-L,.01,Math.PI-.01)),U=Math.min(S,R);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*U+y),this.nearZ=this.height/50,o=new Float64Array(16),p.b6(o,this._fov,this.width/this.height,this.nearZ,this.farZ),o[8]=2*-e.x/this.width,o[9]=2*e.y/this.height,this.projectionMatrix=p.ae(o),p.K(o,o,[1,-1,1]),p.J(o,o,[0,0,-this.cameraToCenterDistance]),p.b7(o,o,this._pitch),p.ad(o,o,this.angle),p.J(o,o,[-a,-n,0]),this.mercatorMatrix=p.K([],o,[this.worldSize,this.worldSize,this.worldSize]),p.K(o,o,[1,1,this._pixelPerMeter]),this.pixelMatrix=p.L(new Float64Array(16),this.labelPlaneMatrix,o),p.J(o,o,[0,0,-this.elevation]),this.modelViewProjectionMatrix=o,this.invModelViewProjectionMatrix=p.as([],o),this.fogMatrix=new Float64Array(16),p.b6(this.fogMatrix,this._fov,this.width/this.height,c,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,p.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),p.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),p.b7(this.fogMatrix,this.fogMatrix,this._pitch),p.ad(this.fogMatrix,this.fogMatrix,this.angle),p.J(this.fogMatrix,this.fogMatrix,[-a,-n,0]),p.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),p.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=p.L(new Float64Array(16),this.labelPlaneMatrix,o);const q=this.width%2/2,Z=this.height%2/2,H=Math.cos(this.angle),F=Math.sin(this.angle),K=a-Math.round(a)+H*q+F*Z,Y=n-Math.round(n)+H*Z+F*q,re=new Float64Array(o);if(p.J(re,re,[K>.5?K-1:K,Y>.5?Y-1:Y,0]),this.alignedModelViewProjectionMatrix=re,o=p.as(new Float64Array(16),this.pixelMatrix),!o)throw new Error("failed to invert matrix");this.pixelMatrixInverse=o,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new p.P(0,0)),a=[e.x*this.worldSize,e.y*this.worldSize,0,1];return p.af(a,a,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.P(0,e))}getCameraQueryGeometry(e){const a=this.getCameraPoint();if(e.length===1)return[e[0],a];{let n=a.x,o=a.y,c=a.x,m=a.y;for(const _ of e)n=Math.min(n,_.x),o=Math.min(o,_.y),c=Math.max(c,_.x),m=Math.max(m,_.y);return[new p.P(n,o),new p.P(c,o),new p.P(c,m),new p.P(n,m),new p.P(n,o)]}}lngLatToCameraDepth(e,a){const n=this.locationCoordinate(e),o=[n.x*this.worldSize,n.y*this.worldSize,a,1];return p.af(o,o,this.modelViewProjectionMatrix),o[2]/o[3]}}function Ts(u,e){let a,n=!1,o=null,c=null;const m=()=>{o=null,n&&(u.apply(c,a),o=setTimeout(m,e),n=!1)};return(..._)=>(n=!0,c=this,a=_,o||m(),o)}class un{constructor(e){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let n;return a.split("&").map(o=>o.split("=")).forEach(o=>{o[0]===this._hashName&&(n=o)}),(n&&n[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(a.length>=3&&!a.some(n=>isNaN(n))){const n=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:n,pitch:+(a[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const n=a.join("/");let o=n;o.split("&").length>0&&(o=o.split("&")[0]),this._hashName&&(o=`${this._hashName}=${n}`);let c=window.location.hash.replace(o,"");c.startsWith("#&")?c=c.slice(0,1)+c.slice(2):c==="#"&&(c="");let m=window.location.href.replace(/(#.+)?$/,c);m=m.replace("&&","&"),window.history.replaceState(window.history.state,null,m)},this._updateHash=Ts(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const a=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,o=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),c=Math.pow(10,o),m=Math.round(a.lng*c)/c,_=Math.round(a.lat*c)/c,y=this._map.getBearing(),v=this._map.getPitch();let E="";if(E+=e?`/${m}/${_}/${n}`:`${n}/${_}/${m}`,(y||v)&&(E+="/"+Math.round(10*y)/10),v&&(E+=`/${Math.round(v)}`),this._hashName){const S=this._hashName;let A=!1;const L=window.location.hash.slice(1).split("&").map(R=>{const U=R.split("=")[0];return U===S?(A=!0,`${U}=${E}`):R}).filter(R=>R);return A||L.push(`${S}=${E}`),`#${L.join("&")}`}return`#${E}`}}const hn={linearity:.3,easing:p.b8(0,0,.3,1)},po=p.e({deceleration:2500,maxSpeed:1400},hn),Ac=p.e({deceleration:20,maxSpeed:1400},hn),Il=p.e({deceleration:1e3,maxSpeed:360},hn),dn=p.e({deceleration:1e3,maxSpeed:90},hn);class fo{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ge.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,a=ge.now();for(;e.length>0&&a-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new p.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:c}of this._inertiaBuffer)a.zoom+=c.zoomDelta||0,a.bearing+=c.bearingDelta||0,a.pitch+=c.pitchDelta||0,c.panDelta&&a.pan._add(c.panDelta),c.around&&(a.around=c.around),c.pinchAround&&(a.pinchAround=c.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,o={};if(a.pan.mag()){const c=ks(a.pan.mag(),n,p.e({},po,e||{}));o.offset=a.pan.mult(c.amount/a.pan.mag()),o.center=this._map.transform.center,Is(o,c)}if(a.zoom){const c=ks(a.zoom,n,Ac);o.zoom=this._map.transform.zoom+c.amount,Is(o,c)}if(a.bearing){const c=ks(a.bearing,n,Il);o.bearing=this._map.transform.bearing+p.ac(c.amount,-179,179),Is(o,c)}if(a.pitch){const c=ks(a.pitch,n,dn);o.pitch=this._map.transform.pitch+c.amount,Is(o,c)}if(o.zoom||o.bearing){const c=a.pinchAround===void 0?a.around:a.pinchAround;o.around=c?this._map.unproject(c):this._map.getCenter()}return this.clear(),p.e(o,{noMoveStart:!0})}}function Is(u,e){(!u.duration||u.duration<e.duration)&&(u.duration=e.duration,u.easing=e.easing)}function ks(u,e,a){const{maxSpeed:n,linearity:o,deceleration:c}=a,m=p.ac(u*o/(e/1e3),-n,n),_=Math.abs(m)/(c*o);return{easing:a.easing,duration:1e3*_,amount:m*(_/2)}}class si extends p.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,n,o={}){const c=ue.mousePos(a.getCanvas(),n),m=a.unproject(c);super(e,p.e({point:c,lngLat:m,originalEvent:n},o)),this._defaultPrevented=!1,this.target=a}}class ya extends p.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,n){const o=e==="touchend"?n.changedTouches:n.touches,c=ue.touchPos(a.getCanvasContainer(),o),m=c.map(y=>a.unproject(y)),_=c.reduce((y,v,E,S)=>y.add(v.div(S.length)),new p.P(0,0));super(e,{points:c,point:_,lngLats:m,lngLat:a.unproject(_),originalEvent:n}),this._defaultPrevented=!1}}class kl extends p.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,n){super(e,{originalEvent:n}),this._defaultPrevented=!1}}class Pl{constructor(e,a){this._map=e,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new kl(e.type,this._map,e))}mousedown(e,a){return this._mousedownPos=a,this._firePreventable(new si(e.type,this._map,e))}mouseup(e){this._map.fire(new si(e.type,this._map,e))}click(e,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new si(e.type,this._map,e))}dblclick(e){return this._firePreventable(new si(e.type,this._map,e))}mouseover(e){this._map.fire(new si(e.type,this._map,e))}mouseout(e){this._map.fire(new si(e.type,this._map,e))}touchstart(e){return this._firePreventable(new ya(e.type,this._map,e))}touchmove(e){this._map.fire(new ya(e.type,this._map,e))}touchend(e){this._map.fire(new ya(e.type,this._map,e))}touchcancel(e){this._map.fire(new ya(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ot{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new si(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new si("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new si(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ur{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(p.P.convert(e),this._map.terrain)}}class Ni{constructor(e,a){this._map=e,this._tr=new ur(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,a){this.isEnabled()&&e.shiftKey&&e.button===0&&(ue.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(e,a){if(!this._active)return;const n=a;if(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)return;const o=this._startPos;this._lastPos=n,this._box||(this._box=ue.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const c=Math.min(o.x,n.x),m=Math.max(o.x,n.x),_=Math.min(o.y,n.y),y=Math.max(o.y,n.y);ue.setTransform(this._box,`translate(${c}px,${_}px)`),this._box.style.width=m-c+"px",this._box.style.height=y-_+"px"}mouseupWindow(e,a){if(!this._active||e.button!==0)return;const n=this._startPos,o=a;if(this.reset(),ue.suppressClick(),n.x!==o.x||n.y!==o.y)return this._map.fire(new p.k("boxzoomend",{originalEvent:e})),{cameraAnimation:c=>c.fitScreenCoordinates(n,o,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ue.remove(this._box),this._box=null),ue.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,a){return this._map.fire(new p.k(e,{originalEvent:a}))}}function Ps(u,e){if(u.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${u.length}, points ${e.length}`);const a={};for(let n=0;n<u.length;n++)a[u[n].identifier]=e[n];return a}class mo{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,a,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(o){const c=new p.P(0,0);for(const m of o)c._add(m);return c.div(o.length)}(a),this.touches=Ps(n,a)))}touchmove(e,a,n){if(this.aborted||!this.centroid)return;const o=Ps(n,a);for(const c in this.touches){const m=o[c];(!m||m.dist(this.touches[c])>30)&&(this.aborted=!0)}}touchend(e,a,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),n.length===0){const o=!this.aborted&&this.centroid;if(this.reset(),o)return o}}}class pn{constructor(e){this.singleTap=new mo(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,a,n){this.singleTap.touchstart(e,a,n)}touchmove(e,a,n){this.singleTap.touchmove(e,a,n)}touchend(e,a,n){const o=this.singleTap.touchend(e,a,n);if(o){const c=e.timeStamp-this.lastTime<500,m=!this.lastTap||this.lastTap.dist(o)<30;if(c&&m||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=o,this.count===this.numTaps)return this.reset(),o}}}class qa{constructor(e){this._tr=new ur(e),this._zoomIn=new pn({numTouches:1,numTaps:2}),this._zoomOut=new pn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,a,n){this._zoomIn.touchstart(e,a,n),this._zoomOut.touchstart(e,a,n)}touchmove(e,a,n){this._zoomIn.touchmove(e,a,n),this._zoomOut.touchmove(e,a,n)}touchend(e,a,n){const o=this._zoomIn.touchend(e,a,n),c=this._zoomOut.touchend(e,a,n),m=this._tr;return o?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:m.zoom+1,around:m.unproject(o)},{originalEvent:e})}):c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:m.zoom-1,around:m.unproject(c)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vr{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const a=this._moveFunction(...e);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(e,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=a.length?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,a){if(!this.isEnabled())return;const n=this._lastPoint;if(!n)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const o=a.length?a[0]:a;return!this._moved&&o.dist(n)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=o,this._move(n,o))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&ue.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const go={0:1,2:2};class fn{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const a=ue.mouseButton(e);this._eventButton=a}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(a,n){const o=go[n];return a.buttons===void 0||(a.buttons&o)!==o}(e,this._eventButton)}isValidEndEvent(e){return ue.mouseButton(e)===this._eventButton}}class _o{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const mn=u=>{u.mousedown=u.dragStart,u.mousemoveWindow=u.dragMove,u.mouseup=u.dragEnd,u.contextmenu=e=>{e.preventDefault()}},yo=({enable:u,clickTolerance:e,bearingDegreesPerPixelMoved:a=.8})=>{const n=new fn({checkCorrectEvent:o=>ue.mouseButton(o)===0&&o.ctrlKey||ue.mouseButton(o)===2});return new Vr({clickTolerance:e,move:(o,c)=>({bearingDelta:(c.x-o.x)*a}),moveStateManager:n,enable:u,assignEvents:mn})},bo=({enable:u,clickTolerance:e,pitchDegreesPerPixelMoved:a=-.5})=>{const n=new fn({checkCorrectEvent:o=>ue.mouseButton(o)===0&&o.ctrlKey||ue.mouseButton(o)===2});return new Vr({clickTolerance:e,move:(o,c)=>({pitchDelta:(c.y-o.y)*a}),moveStateManager:n,enable:u,assignEvents:mn})};class ba{constructor(e,a){this._clickTolerance=e.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new p.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,a,n){return this._calculateTransform(e,a,n)}touchmove(e,a,n){if(this._active){if(!this._shouldBePrevented(n.length))return e.preventDefault(),this._calculateTransform(e,a,n);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,a,n){this._calculateTransform(e,a,n),this._active&&this._shouldBePrevented(n.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,a,n){n.length>0&&(this._active=!0);const o=Ps(n,a),c=new p.P(0,0),m=new p.P(0,0);let _=0;for(const v in o){const E=o[v],S=this._touches[v];S&&(c._add(E),m._add(E.sub(S)),_++,o[v]=E)}if(this._touches=o,this._shouldBePrevented(_)||!m.mag())return;const y=m.div(_);return this._sum._add(y),this._sum.mag()<this._clickTolerance?void 0:{around:c.div(_),panDelta:y}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,a,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([a[0],a[1]]))}touchmove(e,a,n){if(!this._firstTwoTouches)return;e.preventDefault();const[o,c]=this._firstTwoTouches,m=Cs(n,a,o),_=Cs(n,a,c);if(!m||!_)return;const y=this._aroundCenter?null:m.add(_).div(2);return this._move([m,_],y,e)}touchend(e,a,n){if(!this._firstTwoTouches)return;const[o,c]=this._firstTwoTouches,m=Cs(n,a,o),_=Cs(n,a,c);m&&_||(this._active&&ue.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Cs(u,e,a){for(let n=0;n<u.length;n++)if(u[n].identifier===a)return e[n]}function xo(u,e){return Math.log(u/e)/Math.LN2}class vo extends gn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,a){const n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(xo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xo(this._distance,n),pinchAround:a}}}function wo(u,e){return 180*u.angleWith(e)/Math.PI}class Eo extends gn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,a,n){const o=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:wo(this._vector,o),pinchAround:a}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const a=25/(Math.PI*this._minDiameter)*360,n=wo(e,this._startVector);return Math.abs(n)<a}}function _n(u){return Math.abs(u.y)>Math.abs(u.x)}class As extends gn{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,a,n){super.touchstart(e,a,n),this._currentTouchCount=n.length}_start(e){this._lastPoints=e,_n(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,a,n){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const o=e[0].sub(this._lastPoints[0]),c=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(o,c,n.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(o.y+c.y)/2*-.5}):void 0}gestureBeginsVertically(e,a,n){if(this._valid!==void 0)return this._valid;const o=e.mag()>=2,c=a.mag()>=2;if(!o&&!c)return;if(!o||!c)return this._firstMove===void 0&&(this._firstMove=n),n-this._firstMove<100&&void 0;const m=e.y>0==a.y>0;return _n(e)&&_n(a)&&m}}const Cl={panStep:100,bearingStep:15,pitchStep:10};class Ji{constructor(e){this._tr=new ur(e);const a=Cl;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let a=0,n=0,o=0,c=0,m=0;switch(e.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),c=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),c=1);break;case 38:e.shiftKey?o=1:(e.preventDefault(),m=-1);break;case 40:e.shiftKey?o=-1:(e.preventDefault(),m=1);break;default:return}return this._rotationDisabled&&(n=0,o=0),{cameraAnimation:_=>{const y=this._tr;_.easeTo({duration:300,easeId:"keyboardHandler",easing:Ir,zoom:a?Math.round(y.zoom)+a*(e.shiftKey?2:1):y.zoom,bearing:y.bearing+n*this._bearingStep,pitch:y.pitch+o*this._pitchStep,offset:[-c*this._panStep,-m*this._panStep],center:y.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ir(u){return u*(2-u)}const So=4.000244140625;class hr{constructor(e,a){this._onTimeout=n=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)},this._map=e,this._tr=new ur(e),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let a=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const n=ge.now(),o=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,a!==0&&a%So==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":o>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(o*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),e.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=e,this._delta-=a,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=ue.mousePos(this._map.getCanvas(),e),n=this._tr;this._around=a.y>n.transform.height/2-n.transform.getHorizon()?p.N.convert(this._aroundCenter?n.center:n.unproject(a)):p.N.convert(n.center),this._aroundPoint=n.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const y=this._type==="wheel"&&Math.abs(this._delta)>So?this._wheelZoomRate:this._defaultZoomRate;let v=2/(1+Math.exp(-Math.abs(this._delta*y)));this._delta<0&&v!==0&&(v=1/v);const E=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(E*v))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,n=this._startZoom,o=this._easing;let c,m=!1;const _=ge.now()-this._lastWheelEventTime;if(this._type==="wheel"&&n&&o&&_){const y=Math.min(_/200,1),v=o(y);c=p.y.number(n,a,v),y<1?this._frameId||(this._frameId=!0):m=!0}else c=a,m=!0;return this._active=!0,m&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!m,zoomDelta:c-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let a=p.b9;if(this._prevEase){const n=this._prevEase,o=(ge.now()-n.start)/n.duration,c=n.easing(o+.01)-n.easing(o),m=.27/Math.sqrt(c*c+1e-4)*.01,_=Math.sqrt(.0729-m*m);a=p.b8(m,_,.25,1)}return this._prevEase={start:ge.now(),duration:e,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class xa{constructor(e,a){this._clickZoom=e,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Mc{constructor(e){this._tr=new ur(e),this.reset()}reset(){this._active=!1}dblclick(e,a){return e.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zc{constructor(){this._tap=new pn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,a,n){if(!this._swipePoint)if(this._tapTime){const o=a[0],c=e.timeStamp-this._tapTime<500,m=this._tapPoint.dist(o)<30;c&&m?n.length>0&&(this._swipePoint=o,this._swipeTouch=n[0].identifier):this.reset()}else this._tap.touchstart(e,a,n)}touchmove(e,a,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const o=a[0],c=o.y-this._swipePoint.y;return this._swipePoint=o,e.preventDefault(),this._active=!0,{zoomDelta:c/128}}}else this._tap.touchmove(e,a,n)}touchend(e,a,n){if(this._tapTime)this._swipePoint&&n.length===0&&this.reset();else{const o=this._tap.touchend(e,a,n);o&&(this._tapTime=e.timeStamp,this._tapPoint=o)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Al{constructor(e,a,n){this._el=e,this._mousePan=a,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ml{constructor(e,a,n){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=a,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class To{constructor(e,a,n,o){this._el=e,this._touchZoom=a,this._touchRotate=n,this._tapDragZoom=o,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Za{constructor(e,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=ue.create("div","maplibregl-cooperative-gesture-screen",e);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const n=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),o=document.createElement("div");o.className="maplibregl-desktop-message",o.textContent=a,this._container.appendChild(o);const c=document.createElement("div");c.className="maplibregl-mobile-message",c.textContent=n,this._container.appendChild(c),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(ue.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,a){this._enabled&&(this._map.fire(new p.k("cooperativegestureprevented",{gestureType:e,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Yi=u=>u.zoom||u.drag||u.pitch||u.rotate;class Me extends p.k{}function yn(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class Io{constructor(e,a){this.handleWindowEvent=o=>{this.handleEvent(o,`${o.type}Window`)},this.handleEvent=(o,c)=>{if(o.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const m=o.type==="renderFrame"?void 0:o,_={needsRenderFrame:!1},y={},v={},E=o.touches,S=E?this._getMapTouches(E):void 0,A=S?ue.touchPos(this._map.getCanvas(),S):ue.mousePos(this._map.getCanvas(),o);for(const{handlerName:U,handler:q,allowed:Z}of this._handlers){if(!q.isEnabled())continue;let H;this._blockedByActive(v,Z,U)?q.reset():q[c||o.type]&&(H=q[c||o.type](o,A,S),this.mergeHandlerResult(_,y,H,U,m),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||q.isActive())&&(v[U]=q)}const L={};for(const U in this._previousActiveHandlers)v[U]||(L[U]=m);this._previousActiveHandlers=v,(Object.keys(L).length||yn(_))&&(this._changes.push([_,y,L]),this._triggerRenderFrame()),(Object.keys(v).length||yn(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=_;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new fo(e),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[window,"blur",void 0]];for(const[o,c,m]of this._listeners)ue.addEventListener(o,c,o===document?this.handleWindowEvent:this.handleEvent,m)}destroy(){for(const[e,a,n]of this._listeners)ue.removeEventListener(e,a,e===document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(e){const a=this._map,n=a.getCanvasContainer();this._add("mapEvent",new Pl(a,e));const o=a.boxZoom=new Ni(a,e);this._add("boxZoom",o),e.interactive&&e.boxZoom&&o.enable();const c=a.cooperativeGestures=new Za(a,e.cooperativeGestures);this._add("cooperativeGestures",c),e.cooperativeGestures&&c.enable();const m=new qa(a),_=new Mc(a);a.doubleClickZoom=new xa(_,m),this._add("tapZoom",m),this._add("clickZoom",_),e.interactive&&e.doubleClickZoom&&a.doubleClickZoom.enable();const y=new zc;this._add("tapDragZoom",y);const v=a.touchPitch=new As(a);this._add("touchPitch",v),e.interactive&&e.touchPitch&&a.touchPitch.enable(e.touchPitch);const E=yo(e),S=bo(e);a.dragRotate=new Ml(e,E,S),this._add("mouseRotate",E,["mousePitch"]),this._add("mousePitch",S,["mouseRotate"]),e.interactive&&e.dragRotate&&a.dragRotate.enable();const A=(({enable:H,clickTolerance:F})=>{const K=new fn({checkCorrectEvent:Y=>ue.mouseButton(Y)===0&&!Y.ctrlKey});return new Vr({clickTolerance:F,move:(Y,re)=>({around:re,panDelta:re.sub(Y)}),activateOnStart:!0,moveStateManager:K,enable:H,assignEvents:mn})})(e),L=new ba(e,a);a.dragPan=new Al(n,A,L),this._add("mousePan",A),this._add("touchPan",L,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&a.dragPan.enable(e.dragPan);const R=new Eo,U=new vo;a.touchZoomRotate=new To(n,U,R,y),this._add("touchRotate",R,["touchPan","touchZoom"]),this._add("touchZoom",U,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&a.touchZoomRotate.enable(e.touchZoomRotate);const q=a.scrollZoom=new hr(a,()=>this._triggerRenderFrame());this._add("scrollZoom",q,["mousePan"]),e.interactive&&e.scrollZoom&&a.scrollZoom.enable(e.scrollZoom);const Z=a.keyboard=new Ji(a);this._add("keyboard",Z),e.interactive&&e.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new Ot(a))}_add(e,a,n){this._handlers.push({handlerName:e,handler:a,allowed:n}),this._handlersById[e]=a}stop(e){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Yi(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,a,n){for(const o in e)if(o!==n&&(!a||a.indexOf(o)<0))return!0;return!1}_getMapTouches(e){const a=[];for(const n of e)this._el.contains(n.target)&&a.push(n);return a}mergeHandlerResult(e,a,n,o,c){if(!n)return;p.e(e,n);const m={handlerName:o,originalEvent:n.originalEvent||c};n.zoomDelta!==void 0&&(a.zoom=m),n.panDelta!==void 0&&(a.drag=m),n.pitchDelta!==void 0&&(a.pitch=m),n.bearingDelta!==void 0&&(a.rotate=m)}_applyChanges(){const e={},a={},n={};for(const[o,c,m]of this._changes)o.panDelta&&(e.panDelta=(e.panDelta||new p.P(0,0))._add(o.panDelta)),o.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+o.zoomDelta),o.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+o.bearingDelta),o.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+o.pitchDelta),o.around!==void 0&&(e.around=o.around),o.pinchAround!==void 0&&(e.pinchAround=o.pinchAround),o.noInertia&&(e.noInertia=o.noInertia),p.e(a,c),p.e(n,m);this._updateMapTransform(e,a,n),this._changes=[]}_updateMapTransform(e,a,n){const o=this._map,c=o._getTransformForUpdate(),m=o.terrain;if(!(yn(e)||m&&this._terrainMovement))return this._fireEvents(a,n,!0);let{panDelta:_,zoomDelta:y,bearingDelta:v,pitchDelta:E,around:S,pinchAround:A}=e;A!==void 0&&(S=A),o._stop(!0),S=S||o.transform.centerPoint;const L=c.pointLocation(_?S.sub(_):S);v&&(c.bearing+=v),E&&(c.pitch+=E),y&&(c.zoom+=y),m?this._terrainMovement||!a.drag&&!a.zoom?a.drag&&this._terrainMovement?c.center=c.pointLocation(c.centerPoint.sub(_)):c.setLocationAtPoint(L,S):(this._terrainMovement=!0,this._map._elevationFreeze=!0,c.setLocationAtPoint(L,S)):c.setLocationAtPoint(L,S),o._applyUpdatedTransform(c),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(a,n,!0)}_fireEvents(e,a,n){const o=Yi(this._eventsInProgress),c=Yi(e),m={};for(const S in e){const{originalEvent:A}=e[S];this._eventsInProgress[S]||(m[`${S}start`]=A),this._eventsInProgress[S]=e[S]}!o&&c&&this._fireEvent("movestart",c.originalEvent);for(const S in m)this._fireEvent(S,m[S]);c&&this._fireEvent("move",c.originalEvent);for(const S in e){const{originalEvent:A}=e[S];this._fireEvent(S,A)}const _={};let y;for(const S in this._eventsInProgress){const{handlerName:A,originalEvent:L}=this._eventsInProgress[S];this._handlersById[A].isActive()||(delete this._eventsInProgress[S],y=a[A]||L,_[`${S}end`]=y)}for(const S in _)this._fireEvent(S,_[S]);const v=Yi(this._eventsInProgress),E=(o||c)&&!v;if(E&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const S=this._map._getTransformForUpdate();S.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(S)}if(n&&E){this._updatingCamera=!0;const S=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),A=L=>L!==0&&-this._bearingSnap<L&&L<this._bearingSnap;!S||!S.essential&&ge.prefersReducedMotion?(this._map.fire(new p.k("moveend",{originalEvent:y})),A(this._map.getBearing())&&this._map.resetNorth()):(A(S.bearing||this._map.getBearing())&&(S.bearing=0),S.freezeElevation=!0,this._map.easeTo(S,{originalEvent:y})),this._updatingCamera=!1}}_fireEvent(e,a){this._map.fire(new p.k(e,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Me("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class zl extends p.E{constructor(e,a){super(),this._renderFrameCallback=()=>{const n=Math.min((ge.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(n)),n<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=a.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new p.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,a){return this.jumpTo({center:e},a)}panBy(e,a,n){return e=p.P.convert(e).mult(-1),this.panTo(this.transform.center,p.e({offset:e},a),n)}panTo(e,a,n){return this.easeTo(p.e({center:e},a),n)}getZoom(){return this.transform.zoom}setZoom(e,a){return this.jumpTo({zoom:e},a),this}zoomTo(e,a,n){return this.easeTo(p.e({zoom:e},a),n)}zoomIn(e,a){return this.zoomTo(this.getZoom()+1,e,a),this}zoomOut(e,a){return this.zoomTo(this.getZoom()-1,e,a),this}getBearing(){return this.transform.bearing}setBearing(e,a){return this.jumpTo({bearing:e},a),this}getPadding(){return this.transform.padding}setPadding(e,a){return this.jumpTo({padding:e},a),this}rotateTo(e,a,n){return this.easeTo(p.e({bearing:e},a),n)}resetNorth(e,a){return this.rotateTo(0,p.e({duration:1e3},e),a),this}resetNorthPitch(e,a){return this.easeTo(p.e({bearing:0,pitch:0,duration:1e3},e),a),this}snapToNorth(e,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,a):this}getPitch(){return this.transform.pitch}setPitch(e,a){return this.jumpTo({pitch:e},a),this}cameraForBounds(e,a){e=oe.convert(e).adjustAntiMeridian();const n=a&&a.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),n,a)}_cameraForBoxAndBearing(e,a,n,o){const c={top:0,bottom:0,right:0,left:0};if(typeof(o=p.e({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=="number"){const ve=o.padding;o.padding={top:ve,bottom:ve,right:ve,left:ve}}o.padding=p.e(c,o.padding);const m=this.transform,_=m.padding,y=new oe(e,a),v=m.project(y.getNorthWest()),E=m.project(y.getNorthEast()),S=m.project(y.getSouthEast()),A=m.project(y.getSouthWest()),L=p.ba(-n),R=v.rotate(L),U=E.rotate(L),q=S.rotate(L),Z=A.rotate(L),H=new p.P(Math.max(R.x,U.x,Z.x,q.x),Math.max(R.y,U.y,Z.y,q.y)),F=new p.P(Math.min(R.x,U.x,Z.x,q.x),Math.min(R.y,U.y,Z.y,q.y)),K=H.sub(F),Y=(m.width-(_.left+_.right+o.padding.left+o.padding.right))/K.x,re=(m.height-(_.top+_.bottom+o.padding.top+o.padding.bottom))/K.y;if(re<0||Y<0)return void p.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const de=Math.min(m.scaleZoom(m.scale*Math.min(Y,re)),o.maxZoom),_e=p.P.convert(o.offset),Te=new p.P((o.padding.left-o.padding.right)/2,(o.padding.top-o.padding.bottom)/2).rotate(p.ba(n)),Ce=_e.add(Te).mult(m.scale/m.zoomScale(de));return{center:m.unproject(v.add(S).div(2).sub(Ce)),zoom:de,bearing:n}}fitBounds(e,a,n){return this._fitInternal(this.cameraForBounds(e,a),a,n)}fitScreenCoordinates(e,a,n,o,c){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(p.P.convert(e)),this.transform.pointLocation(p.P.convert(a)),n,o),o,c)}_fitInternal(e,a,n){return e?(delete(a=p.e(e,a)).padding,a.linear?this.easeTo(a,n):this.flyTo(a,n)):this}jumpTo(e,a){this.stop();const n=this._getTransformForUpdate();let o=!1,c=!1,m=!1;return"zoom"in e&&n.zoom!==+e.zoom&&(o=!0,n.zoom=+e.zoom),e.center!==void 0&&(n.center=p.N.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(c=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(m=!0,n.pitch=+e.pitch),e.padding==null||n.isPaddingEqual(e.padding)||(n.padding=e.padding),this._applyUpdatedTransform(n),this.fire(new p.k("movestart",a)).fire(new p.k("move",a)),o&&this.fire(new p.k("zoomstart",a)).fire(new p.k("zoom",a)).fire(new p.k("zoomend",a)),c&&this.fire(new p.k("rotatestart",a)).fire(new p.k("rotate",a)).fire(new p.k("rotateend",a)),m&&this.fire(new p.k("pitchstart",a)).fire(new p.k("pitch",a)).fire(new p.k("pitchend",a)),this.fire(new p.k("moveend",a))}calculateCameraOptionsFromTo(e,a,n,o=0){const c=p.Z.fromLngLat(e,a),m=p.Z.fromLngLat(n,o),_=m.x-c.x,y=m.y-c.y,v=m.z-c.z,E=Math.hypot(_,y,v);if(E===0)throw new Error("Can't calculate camera options with same From and To");const S=Math.hypot(_,y),A=this.transform.scaleZoom(this.transform.cameraToCenterDistance/E/this.transform.tileSize),L=180*Math.atan2(_,-y)/Math.PI;let R=180*Math.acos(S/E)/Math.PI;return R=v<0?90-R:90+R,{center:m.toLngLat(),zoom:A,pitch:R,bearing:L}}easeTo(e,a){var n;this._stop(!1,e.easeId),((e=p.e({offset:[0,0],duration:500,easing:p.b9},e)).animate===!1||!e.essential&&ge.prefersReducedMotion)&&(e.duration=0);const o=this._getTransformForUpdate(),c=o.zoom,m=o.bearing,_=o.pitch,y=o.padding,v="bearing"in e?this._normalizeBearing(e.bearing,m):m,E="pitch"in e?+e.pitch:_,S="padding"in e?e.padding:o.padding,A=p.P.convert(e.offset);let L=o.centerPoint.add(A);const R=o.pointLocation(L),{center:U,zoom:q}=o.getConstrained(p.N.convert(e.center||R),(n=e.zoom)!==null&&n!==void 0?n:c);this._normalizeCenter(U,o);const Z=o.project(R),H=o.project(U).sub(Z),F=o.zoomScale(q-c);let K,Y;e.around&&(K=p.N.convert(e.around),Y=o.locationPoint(K));const re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||q!==c,this._rotating=this._rotating||m!==v,this._pitching=this._pitching||E!==_,this._padding=!o.isPaddingEqual(S),this._easeId=e.easeId,this._prepareEase(a,e.noMoveStart,re),this.terrain&&this._prepareElevation(U),this._ease(de=>{if(this._zooming&&(o.zoom=p.y.number(c,q,de)),this._rotating&&(o.bearing=p.y.number(m,v,de)),this._pitching&&(o.pitch=p.y.number(_,E,de)),this._padding&&(o.interpolatePadding(y,S,de),L=o.centerPoint.add(A)),this.terrain&&!e.freezeElevation&&this._updateElevation(de),K)o.setLocationAtPoint(K,Y);else{const _e=o.zoomScale(o.zoom-c),Te=q>c?Math.min(2,F):Math.max(.5,F),Ce=Math.pow(Te,1-de),ve=o.unproject(Z.add(H.mult(de*Ce)).mult(_e));o.setLocationAtPoint(o.renderWorldCopies?ve.wrap():ve,L)}this._applyUpdatedTransform(o),this._fireMoveEvents(a)},de=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a,de)},e),this}_prepareEase(e,a,n={}){this._moving=!0,a||n.moving||this.fire(new p.k("movestart",e)),this._zooming&&!n.zooming&&this.fire(new p.k("zoomstart",e)),this._rotating&&!n.rotating&&this.fire(new p.k("rotatestart",e)),this._pitching&&!n.pitching&&this.fire(new p.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&a!==this._elevationTarget){const n=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(n-(a-(n*e+this._elevationStart))/(1-e)),this._elevationTarget=a}this.transform.elevation=p.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const a=e.getCameraPosition(),n=this.terrain.getElevationForLngLatZoom(a.lngLat,e.zoom);if(a.altitude<n){const o=this.calculateCameraOptionsFromTo(a.lngLat,n,e.center,e.elevation);return{pitch:o.pitch,zoom:o.zoom}}return{}}_applyUpdatedTransform(e){const a=[];if(this.terrain&&a.push(o=>this._elevateCameraIfInsideTerrain(o)),this.transformCameraUpdate&&a.push(o=>this.transformCameraUpdate(o)),!a.length)return;const n=e.clone();for(const o of a){const c=n.clone(),{center:m,zoom:_,pitch:y,bearing:v,elevation:E}=o(c);m&&(c.center=m),_!==void 0&&(c.zoom=_),y!==void 0&&(c.pitch=y),v!==void 0&&(c.bearing=v),E!==void 0&&(c.elevation=E),n.apply(c)}this.transform.apply(n)}_fireMoveEvents(e){this.fire(new p.k("move",e)),this._zooming&&this.fire(new p.k("zoom",e)),this._rotating&&this.fire(new p.k("rotate",e)),this._pitching&&this.fire(new p.k("pitch",e))}_afterEase(e,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const n=this._zooming,o=this._rotating,c=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new p.k("zoomend",e)),o&&this.fire(new p.k("rotateend",e)),c&&this.fire(new p.k("pitchend",e)),this.fire(new p.k("moveend",e))}flyTo(e,a){var n;if(!e.essential&&ge.prefersReducedMotion){const ke=p.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ke,a)}this.stop(),e=p.e({offset:[0,0],speed:1.2,curve:1.42,easing:p.b9},e);const o=this._getTransformForUpdate(),c=o.zoom,m=o.bearing,_=o.pitch,y=o.padding,v="bearing"in e?this._normalizeBearing(e.bearing,m):m,E="pitch"in e?+e.pitch:_,S="padding"in e?e.padding:o.padding,A=p.P.convert(e.offset);let L=o.centerPoint.add(A);const R=o.pointLocation(L),{center:U,zoom:q}=o.getConstrained(p.N.convert(e.center||R),(n=e.zoom)!==null&&n!==void 0?n:c);this._normalizeCenter(U,o);const Z=o.zoomScale(q-c),H=o.project(R),F=o.project(U).sub(H);let K=e.curve;const Y=Math.max(o.width,o.height),re=Y/Z,de=F.mag();if("minZoom"in e){const ke=p.ac(Math.min(e.minZoom,c,q),o.minZoom,o.maxZoom),$e=Y/o.zoomScale(ke-c);K=Math.sqrt($e/de*2)}const _e=K*K;function Te(ke){const $e=(re*re-Y*Y+(ke?-1:1)*_e*_e*de*de)/(2*(ke?re:Y)*_e*de);return Math.log(Math.sqrt($e*$e+1)-$e)}function Ce(ke){return(Math.exp(ke)-Math.exp(-ke))/2}function ve(ke){return(Math.exp(ke)+Math.exp(-ke))/2}const xe=Te(!1);let Le=function(ke){return ve(xe)/ve(xe+K*ke)},Ze=function(ke){return Y*((ve(xe)*(Ce($e=xe+K*ke)/ve($e))-Ce(xe))/_e)/de;var $e},Ee=(Te(!0)-xe)/K;if(Math.abs(de)<1e-6||!isFinite(Ee)){if(Math.abs(Y-re)<1e-6)return this.easeTo(e,a);const ke=re<Y?-1:1;Ee=Math.abs(Math.log(re/Y))/K,Ze=()=>0,Le=$e=>Math.exp(ke*K*$e)}return e.duration="duration"in e?+e.duration:1e3*Ee/("screenSpeed"in e?+e.screenSpeed/K:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=m!==v,this._pitching=E!==_,this._padding=!o.isPaddingEqual(S),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(U),this._ease(ke=>{const $e=ke*Ee,Tt=1/Le($e);o.zoom=ke===1?q:c+o.scaleZoom(Tt),this._rotating&&(o.bearing=p.y.number(m,v,ke)),this._pitching&&(o.pitch=p.y.number(_,E,ke)),this._padding&&(o.interpolatePadding(y,S,ke),L=o.centerPoint.add(A)),this.terrain&&!e.freezeElevation&&this._updateElevation(ke);const We=ke===1?U:o.unproject(H.add(F.mult(Ze($e))).mult(Tt));o.setLocationAtPoint(o.renderWorldCopies?We.wrap():We,L),this._applyUpdatedTransform(o),this._fireMoveEvents(a)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,a){var n;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const o=this._onEaseEnd;delete this._onEaseEnd,o.call(this,a)}return e||(n=this.handlers)===null||n===void 0||n.stop(!1),this}_ease(e,a,n){n.animate===!1||n.duration===0?(e(1),a()):(this._easeStart=ge.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,a){e=p.b3(e,-180,180);const n=Math.abs(e-a);return Math.abs(e-360-a)<n&&(e-=360),Math.abs(e+360-a)<n&&(e+=360),e}_normalizeCenter(e,a){if(!a.renderWorldCopies||a.lngRange)return;const n=e.lng-a.center.lng;e.lng+=n>180?-360:n<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(p.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const Ga={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ha{constructor(e=Ga){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=ue.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ue.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ue.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ue.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,a){const n=this._map._getUIString(`AttributionControl.${a}`);e.title=n,e.setAttribute("aria-label",n)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(o=>typeof o!="string"?"":o)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const o=this._map.style.stylesheet;this.styleOwner=o.owner,this.styleId=o.id}const a=this._map.style.sourceCaches;for(const o in a){const c=a[o];if(c.used||c.usedForTerrain){const m=c.getSource();m.attribution&&e.indexOf(m.attribution)<0&&e.push(m.attribution)}}e=e.filter(o=>String(o).trim()),e.sort((o,c)=>o.length-c.length),e=e.filter((o,c)=>{for(let m=c+1;m<e.length;m++)if(e[m].indexOf(o)>=0)return!1;return!0});const n=e.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,e.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ko{constructor(e={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const n=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&n.classList.add("maplibregl-compact"):n.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=ue.create("div","maplibregl-ctrl");const a=ue.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ue.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class it{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const a=++this._id;return this._queue.push({callback:e,id:a,cancelled:!1}),a}remove(e){const a=this._currentlyRunning,n=a?this._queue.concat(a):this._queue;for(const o of n)if(o.id===e)return void(o.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const n of a)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Po=p.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Dc extends p.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,a){this.sourceCache.update(e,a),this._renderableTilesKeys=[];const n={};for(const o of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a}))n[o.key]=!0,this._renderableTilesKeys.push(o.key),this._tiles[o.key]||(o.posMatrix=new Float64Array(16),p.aP(o.posMatrix,0,p.X,0,p.X,0,1),this._tiles[o.key]=new Wr(o,this.tileSize));for(const o in this._tiles)n[o]||delete this._tiles[o]}freeRtt(e){for(const a in this._tiles){const n=this._tiles[a];(!e||n.tileID.equals(e)||n.tileID.isChildOf(e)||e.isChildOf(n.tileID))&&(n.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const a={};for(const n of this._renderableTilesKeys){const o=this._tiles[n].tileID;if(o.canonical.equals(e.canonical)){const c=e.clone();c.posMatrix=new Float64Array(16),p.aP(c.posMatrix,0,p.X,0,p.X,0,1),a[n]=c}else if(o.canonical.isChildOf(e.canonical)){const c=e.clone();c.posMatrix=new Float64Array(16);const m=o.canonical.z-e.canonical.z,_=o.canonical.x-(o.canonical.x>>m<<m),y=o.canonical.y-(o.canonical.y>>m<<m),v=p.X>>m;p.aP(c.posMatrix,0,v,0,v,0,1),p.J(c.posMatrix,c.posMatrix,[-_*v,-y*v,0]),a[n]=c}else if(e.canonical.isChildOf(o.canonical)){const c=e.clone();c.posMatrix=new Float64Array(16);const m=e.canonical.z-o.canonical.z,_=e.canonical.x-(e.canonical.x>>m<<m),y=e.canonical.y-(e.canonical.y>>m<<m),v=p.X>>m;p.aP(c.posMatrix,0,p.X,0,p.X,0,1),p.J(c.posMatrix,c.posMatrix,[_*v,y*v,0]),p.K(c.posMatrix,c.posMatrix,[1/2**m,1/2**m,0]),a[n]=c}}return a}getSourceTile(e,a){const n=this.sourceCache._source;let o=e.overscaledZ-this.deltaZoom;if(o>n.maxzoom&&(o=n.maxzoom),o<n.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(o).key);let c=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!c||!c.dem)&&a)for(;o>=n.minzoom&&(!c||!c.dem);)c=this.sourceCache.getTileByID(e.scaledTo(o--).key);return c}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(a=>a.timeAdded>=e)}}class Co{constructor(e,a,n){this.painter=e,this.sourceCache=new Dc(a),this.options=n,this.exaggeration=typeof n.exaggeration=="number"?n.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,a,n,o=p.X){var c;if(!(a>=0&&a<o&&n>=0&&n<o))return 0;const m=this.getTerrainData(e),_=(c=m.tile)===null||c===void 0?void 0:c.dem;if(!_)return 0;const y=function(R,U,q){var Z=U[0],H=U[1];return R[0]=q[0]*Z+q[4]*H+q[12],R[1]=q[1]*Z+q[5]*H+q[13],R}([],[a/o*p.X,n/o*p.X],m.u_terrain_matrix),v=[y[0]*_.dim,y[1]*_.dim],E=Math.floor(v[0]),S=Math.floor(v[1]),A=v[0]-E,L=v[1]-S;return _.get(E,S)*(1-A)*(1-L)+_.get(E+1,S)*A*(1-L)+_.get(E,S+1)*(1-A)*L+_.get(E+1,S+1)*A*L}getElevationForLngLatZoom(e,a){if(!p.bb(a,e.wrap()))return 0;const{tileID:n,mercatorX:o,mercatorY:c}=this._getOverscaledTileIDFromLngLatZoom(e,a);return this.getElevation(n,o%p.X,c%p.X,p.X)}getElevation(e,a,n,o=p.X){return this.getDEMElevation(e,a,n,o)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const o=this.painter.context,c=new p.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new at(o,c,o.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new at(o,new p.R({width:1,height:1}),o.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=p.an([])}const a=this.sourceCache.getSourceTile(e,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const o=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new at(o,a.dem.getPixels(),o.gl.RGBA,{premultiply:!1}),a.demTexture.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const n=a&&a+a.tileID.key+e.key;if(n&&!this._demMatrixCache[n]){const o=this.sourceCache.sourceCache._source.maxzoom;let c=e.canonical.z-a.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=o?c=e.canonical.z-o:p.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const m=e.canonical.x-(e.canonical.x>>c<<c),_=e.canonical.y-(e.canonical.y>>c<<c),y=p.bc(new Float64Array(16),[1/(p.X<<c),1/(p.X<<c),0]);p.J(y,y,[m*p.X,_*p.X,0]),this._demMatrixCache[e.key]={matrix:y,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:n?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(e){const a=this.painter,n=a.width/devicePixelRatio,o=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===n&&this._fbo.height===o||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new at(a.context,{width:n,height:o,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new at(a.context,{width:n,height:o,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(n,o,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,n,o))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let c=0,m=0;c<this._coordsTextureSize;c++)for(let _=0;_<this._coordsTextureSize;_++,m+=4)a[m+0]=255&_,a[m+1]=255&c,a[m+2]=_>>8<<4|c>>8,a[m+3]=0;const n=new p.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),o=new at(e,n,e.gl.RGBA,{premultiply:!1});return o.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=o,o}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),n=this.painter.context,o=n.gl,c=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),m=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),_=Math.round(this.painter.height/devicePixelRatio);n.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),o.readPixels(c,_-m-1,1,1,o.RGBA,o.UNSIGNED_BYTE,a),n.bindFramebuffer.set(null);const y=a[0]+(a[2]>>4<<8),v=a[1]+((15&a[2])<<8),E=this.coordsIndex[255-a[3]],S=E&&this.sourceCache.getTileByID(E);if(!S)return null;const A=this._coordsTextureSize,L=(1<<S.tileID.canonical.z)*A;return new p.Z((S.tileID.canonical.x*A+y)/L+S.tileID.wrap,(S.tileID.canonical.y*A+v)/L,this.getElevation(S.tileID,y,v,A))}depthAtPoint(e){const a=new Uint8Array(4),n=this.painter.context,o=n.gl;return n.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),o.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,o.RGBA,o.UNSIGNED_BYTE,a),n.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,a=new p.bd,n=new p.aY,o=this.meshSize,c=p.X/o,m=o*o;for(let S=0;S<=o;S++)for(let A=0;A<=o;A++)a.emplaceBack(A*c,S*c,0);for(let S=0;S<m;S+=o+1)for(let A=0;A<o;A++)n.emplaceBack(A+S,o+A+S+1,o+A+S+2),n.emplaceBack(A+S,o+A+S+2,A+S+1);const _=a.length,y=_+2*(o+1);for(const S of[0,1])for(let A=0;A<=o;A++)for(const L of[0,1])a.emplaceBack(A*c,S*p.X,L);for(let S=0;S<2*o;S+=2)n.emplaceBack(y+S,y+S+1,y+S+3),n.emplaceBack(y+S,y+S+3,y+S+2),n.emplaceBack(_+S,_+S+3,_+S+1),n.emplaceBack(_+S,_+S+2,_+S+3);const v=a.length,E=v+2*(o+1);for(const S of[0,1])for(let A=0;A<=o;A++)for(const L of[0,1])a.emplaceBack(S*p.X,A*c,L);for(let S=0;S<2*o;S+=2)n.emplaceBack(v+S,v+S+1,v+S+3),n.emplaceBack(v+S,v+S+3,v+S+2),n.emplaceBack(E+S,E+S+3,E+S+1),n.emplaceBack(E+S,E+S+2,E+S+3);return this._mesh=new ln(e.createVertexBuffer(a,Po.members),e.createIndexBuffer(n),p.a0.simpleSegment(0,0,a.length,n.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*p.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,a){var n;const{tileID:o}=this._getOverscaledTileIDFromLngLatZoom(e,a);return(n=this.getMinMaxElevation(o).minElevation)!==null&&n!==void 0?n:0}getMinMaxElevation(e){const a=this.getTerrainData(e).tile,n={minElevation:null,maxElevation:null};return a&&a.dem&&(n.minElevation=a.dem.min*this.exaggeration,n.maxElevation=a.dem.max*this.exaggeration),n}_getOverscaledTileIDFromLngLatZoom(e,a){const n=p.Z.fromLngLat(e.wrap()),o=(1<<a)*p.X,c=n.x*o,m=n.y*o,_=Math.floor(c/p.X),y=Math.floor(m/p.X);return{tileID:new p.S(a,0,a,_,y),mercatorX:c,mercatorY:m}}}class Lc{constructor(e,a,n){this._context=e,this._size=a,this._tileSize=n,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),n=new at(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return n.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(n.texture),{id:e,fbo:a,texture:n,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>e.id!==a),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Wa={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Dl{constructor(e,a){this.painter=e,this.terrain=a,this.pool=new Lc(e.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(n=>!e._layers[n].isHidden(a)),this._coordsDescendingInv={};for(const n in e.sourceCaches){this._coordsDescendingInv[n]={};const o=e.sourceCaches[n].getVisibleCoordinates();for(const c of o){const m=this.terrain.sourceCache.getTerrainCoords(c);for(const _ in m)this._coordsDescendingInv[n][_]||(this._coordsDescendingInv[n][_]=[]),this._coordsDescendingInv[n][_].push(m[_])}}this._coordsDescendingInvStr={};for(const n of e._order){const o=e._layers[n],c=o.source;if(Wa[o.type]&&!this._coordsDescendingInvStr[c]){this._coordsDescendingInvStr[c]={};for(const m in this._coordsDescendingInv[c])this._coordsDescendingInvStr[c][m]=this._coordsDescendingInv[c][m].map(_=>_.key).sort().join()}}for(const n of this._renderableTiles)for(const o in this._coordsDescendingInvStr){const c=this._coordsDescendingInvStr[o][n.tileID.key];c&&c!==n.rttCoords[o]&&(n.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const a=e.type,n=this.painter,o=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Wa[a]&&(this._prevType&&Wa[this._prevType]||this._stacks.push([]),this._prevType=a,this._stacks[this._stacks.length-1].push(e.id),!o))return!0;if(Wa[this._prevType]||Wa[a]&&o){this._prevType=a;const c=this._stacks.length-1,m=this._stacks[c]||[];for(const _ of this._renderableTiles){if(this.pool.isFull()&&(Tl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(_),_.rtt[c]){const v=this.pool.getObjectForId(_.rtt[c].id);if(v.stamp===_.rtt[c].stamp){this.pool.useObject(v);continue}}const y=this.pool.getOrCreateFreeObject();this.pool.useObject(y),this.pool.stampObject(y),_.rtt[c]={id:y.id,stamp:y.stamp},n.context.bindFramebuffer.set(y.fbo.framebuffer),n.context.clear({color:p.aM.transparent,stencil:0}),n.currentStencilSource=void 0;for(let v=0;v<m.length;v++){const E=n.style._layers[m[v]],S=E.source?this._coordsDescendingInv[E.source][_.tileID.key]:[_.tileID];n.context.viewport.set([0,0,y.fbo.width,y.fbo.height]),n._renderTileClippingMasks(E,S),n.renderLayer(n,n.style.sourceCaches[E.source],E,S),E.source&&(_.rttCoords[E.source]=this._coordsDescendingInvStr[E.source][_.tileID.key])}}return Tl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Wa[a]}return!1}}const Ao={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ll=Ye,Rc={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ga,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:p.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Mo=u=>{u.touchstart=u.dragStart,u.touchmoveWindow=u.dragMove,u.touchend=u.dragEnd},Bc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Fc{constructor(e,a,n=!1){this.mousedown=m=>{this.startMouse(p.e({},m,{ctrlKey:!0,preventDefault:()=>m.preventDefault()}),ue.mousePos(this.element,m)),ue.addEventListener(window,"mousemove",this.mousemove),ue.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=m=>{this.moveMouse(m,ue.mousePos(this.element,m))},this.mouseup=m=>{this.mouseRotate.dragEnd(m),this.mousePitch&&this.mousePitch.dragEnd(m),this.offTemp()},this.touchstart=m=>{m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ue.touchPos(this.element,m.targetTouches)[0],this.startTouch(m,this._startPos),ue.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ue.addEventListener(window,"touchend",this.touchend))},this.touchmove=m=>{m.targetTouches.length!==1?this.reset():(this._lastPos=ue.touchPos(this.element,m.targetTouches)[0],this.moveTouch(m,this._lastPos))},this.touchend=m=>{m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const o=e.dragRotate._mouseRotate.getClickTolerance(),c=e.dragRotate._mousePitch.getClickTolerance();this.element=a,this.mouseRotate=yo({clickTolerance:o,enable:!0}),this.touchRotate=(({enable:m,clickTolerance:_,bearingDegreesPerPixelMoved:y=.8})=>{const v=new _o;return new Vr({clickTolerance:_,move:(E,S)=>({bearingDelta:(S.x-E.x)*y}),moveStateManager:v,enable:m,assignEvents:Mo})})({clickTolerance:o,enable:!0}),this.map=e,n&&(this.mousePitch=bo({clickTolerance:c,enable:!0}),this.touchPitch=(({enable:m,clickTolerance:_,pitchDegreesPerPixelMoved:y=-.5})=>{const v=new _o;return new Vr({clickTolerance:_,move:(E,S)=>({pitchDelta:(S.y-E.y)*y}),moveStateManager:v,enable:m,assignEvents:Mo})})({clickTolerance:c,enable:!0})),ue.addEventListener(a,"mousedown",this.mousedown),ue.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),ue.addEventListener(a,"touchcancel",this.reset)}startMouse(e,a){this.mouseRotate.dragStart(e,a),this.mousePitch&&this.mousePitch.dragStart(e,a),ue.disableDrag()}startTouch(e,a){this.touchRotate.dragStart(e,a),this.touchPitch&&this.touchPitch.dragStart(e,a),ue.disableDrag()}moveMouse(e,a){const n=this.map,{bearingDelta:o}=this.mouseRotate.dragMove(e,a)||{};if(o&&n.setBearing(n.getBearing()+o),this.mousePitch){const{pitchDelta:c}=this.mousePitch.dragMove(e,a)||{};c&&n.setPitch(n.getPitch()+c)}}moveTouch(e,a){const n=this.map,{bearingDelta:o}=this.touchRotate.dragMove(e,a)||{};if(o&&n.setBearing(n.getBearing()+o),this.touchPitch){const{pitchDelta:c}=this.touchPitch.dragMove(e,a)||{};c&&n.setPitch(n.getPitch()+c)}}off(){const e=this.element;ue.removeEventListener(e,"mousedown",this.mousedown),ue.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),ue.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ue.removeEventListener(window,"touchend",this.touchend),ue.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){ue.enableDrag(),ue.removeEventListener(window,"mousemove",this.mousemove),ue.removeEventListener(window,"mouseup",this.mouseup),ue.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ue.removeEventListener(window,"touchend",this.touchend)}}let Ui;function St(u,e,a){const n=new p.N(u.lng,u.lat);if(u=new p.N(u.lng,u.lat),e){const o=new p.N(u.lng-360,u.lat),c=new p.N(u.lng+360,u.lat),m=a.locationPoint(u).distSqr(e);a.locationPoint(o).distSqr(e)<m?u=o:a.locationPoint(c).distSqr(e)<m&&(u=c)}for(;Math.abs(u.lng-a.center.lng)>180;){const o=a.locationPoint(u);if(o.x>=0&&o.y>=0&&o.x<=a.width&&o.y<=a.height)break;u.lng>a.center.lng?u.lng-=360:u.lng+=360}return u.lng!==n.lng&&a.locationPoint(u).y>a.height/2-a.getHorizon()?u:n}const Xa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function bn(u,e,a){const n=u.classList;for(const o in Xa)n.remove(`maplibregl-${a}-anchor-${o}`);n.add(`maplibregl-${a}-anchor-${e}`)}class xn extends p.E{constructor(e){if(super(),this._onKeyPress=a=>{const n=a.code,o=a.charCode||a.keyCode;n!=="Space"&&n!=="Enter"&&o!==32&&o!==13||this.togglePopup()},this._onMapClick=a=>{const n=a.originalEvent.target,o=this._element;this._popup&&(n===o||o.contains(n))&&this.togglePopup()},this._update=a=>{var n;if(!this._map)return;const o=this._map.loaded()&&!this._map.isMoving();((a==null?void 0:a.type)==="terrain"||(a==null?void 0:a.type)==="render"&&!o)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?St(this._lngLat,this._flatPos,this._map.transform):(n=this._lngLat)===null||n===void 0?void 0:n.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?m="rotateX(0deg)":this._pitchAlignment==="map"&&(m=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),ue.setTransform(this._element,`${Xa[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${c}`),ge.frameAsync(new AbortController).then(()=>{this._updateOpacity(a&&a.type==="moveend")}).catch(()=>{})},this._onMove=a=>{if(!this._isDragging){const n=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=n}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new p.k("dragstart"))),this.fire(new p.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new p.k("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=p.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=ue.create("div");const a=ue.createNS("http://www.w3.org/2000/svg","svg"),n=41,o=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${n}px`),a.setAttributeNS(null,"width",`${o}px`),a.setAttributeNS(null,"viewBox",`0 0 ${o} ${n}`);const c=ue.createNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"stroke","none"),c.setAttributeNS(null,"stroke-width","1"),c.setAttributeNS(null,"fill","none"),c.setAttributeNS(null,"fill-rule","evenodd");const m=ue.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"fill-rule","nonzero");const _=ue.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(3.0, 29.0)"),_.setAttributeNS(null,"fill","#000000");const y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Z of y){const H=ue.createNS("http://www.w3.org/2000/svg","ellipse");H.setAttributeNS(null,"opacity","0.04"),H.setAttributeNS(null,"cx","10.5"),H.setAttributeNS(null,"cy","5.80029008"),H.setAttributeNS(null,"rx",Z.rx),H.setAttributeNS(null,"ry",Z.ry),_.appendChild(H)}const v=ue.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill",this._color);const E=ue.createNS("http://www.w3.org/2000/svg","path");E.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),v.appendChild(E);const S=ue.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"opacity","0.25"),S.setAttributeNS(null,"fill","#000000");const A=ue.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),S.appendChild(A);const L=ue.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(6.0, 7.0)"),L.setAttributeNS(null,"fill","#FFFFFF");const R=ue.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(8.0, 8.0)");const U=ue.createNS("http://www.w3.org/2000/svg","circle");U.setAttributeNS(null,"fill","#000000"),U.setAttributeNS(null,"opacity","0.25"),U.setAttributeNS(null,"cx","5.5"),U.setAttributeNS(null,"cy","5.5"),U.setAttributeNS(null,"r","5.4999962");const q=ue.createNS("http://www.w3.org/2000/svg","circle");q.setAttributeNS(null,"fill","#FFFFFF"),q.setAttributeNS(null,"cx","5.5"),q.setAttributeNS(null,"cy","5.5"),q.setAttributeNS(null,"r","5.4999962"),R.appendChild(U),R.appendChild(q),m.appendChild(_),m.appendChild(v),m.appendChild(S),m.appendChild(L),m.appendChild(R),a.appendChild(m),a.setAttributeNS(null,"height",n*this._scale+"px"),a.setAttributeNS(null,"width",o*this._scale+"px"),this._element.appendChild(a),this._offset=p.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),bn(this._element,this._anchor,"marker"),e&&e.className)for(const a of e.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ue.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=p.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const o=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[o,-1*(38.1-13.5+o)],"bottom-right":[-o,-1*(38.1-13.5+o)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var a,n;if(!(!((a=this._map)===null||a===void 0)&&a.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const o=this._map,c=o.terrain.depthAtPoint(this._pos),m=o.terrain.getElevationForLngLatZoom(this._lngLat,o.transform.tileZoom);if(o.transform.lngLatToCameraDepth(this._lngLat,m)-c<.006)return void(this._element.style.opacity=this._opacity);const _=-this._offset.y/o.transform._pixelPerMeter,y=Math.sin(o.getPitch()*Math.PI/180)*_,v=o.terrain.depthAtPoint(new p.P(this._pos.x,this._pos.y-this._offset.y)),E=o.transform.lngLatToCameraDepth(this._lngLat,m+y)-v>.006;!((n=this._popup)===null||n===void 0)&&n.isOpen()&&E&&this._popup.remove(),this._element.style.opacity=E?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=p.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,a){return e===void 0&&a===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const Rl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ms=0,zs=!1;const kr={maxWidth:100,unit:"metric"};function Ds(u,e,a){const n=a&&a.maxWidth||100,o=u._container.clientHeight/2,c=u.unproject([0,o]),m=u.unproject([n,o]),_=c.distanceTo(m);if(a&&a.unit==="imperial"){const y=3.2808*_;y>5280?De(e,n,y/5280,u._getUIString("ScaleControl.Miles")):De(e,n,y,u._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?De(e,n,_/1852,u._getUIString("ScaleControl.NauticalMiles")):_>=1e3?De(e,n,_/1e3,u._getUIString("ScaleControl.Kilometers")):De(e,n,_,u._getUIString("ScaleControl.Meters"))}function De(u,e,a,n){const o=function(c){const m=Math.pow(10,`${Math.floor(c)}`.length-1);let _=c/m;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:_>=1?1:function(y){const v=Math.pow(10,Math.ceil(-Math.log(y)/Math.LN10));return Math.round(y*v)/v}(_),m*_}(a);u.style.width=e*(o/a)+"px",u.innerHTML=`${o}&nbsp;${n}`}const Ue={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},vn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function wn(u){if(u){if(typeof u=="number"){const e=Math.round(Math.abs(u)/Math.SQRT2);return{center:new p.P(0,0),top:new p.P(0,u),"top-left":new p.P(e,e),"top-right":new p.P(-e,e),bottom:new p.P(0,-u),"bottom-left":new p.P(e,-e),"bottom-right":new p.P(-e,-e),left:new p.P(u,0),right:new p.P(-u,0)}}if(u instanceof p.P||Array.isArray(u)){const e=p.P.convert(u);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:p.P.convert(u.center||[0,0]),top:p.P.convert(u.top||[0,0]),"top-left":p.P.convert(u["top-left"]||[0,0]),"top-right":p.P.convert(u["top-right"]||[0,0]),bottom:p.P.convert(u.bottom||[0,0]),"bottom-left":p.P.convert(u["bottom-left"]||[0,0]),"bottom-right":p.P.convert(u["bottom-right"]||[0,0]),left:p.P.convert(u.left||[0,0]),right:p.P.convert(u.right||[0,0])}}return wn(new p.P(0,0))}const zo=Ye;C.AJAXError=p.bh,C.Evented=p.E,C.LngLat=p.N,C.MercatorCoordinate=p.Z,C.Point=p.P,C.addProtocol=p.bi,C.config=p.a,C.removeProtocol=p.bj,C.AttributionControl=Ha,C.BoxZoomHandler=Ni,C.CanvasSource=Wi,C.CooperativeGesturesHandler=Za,C.DoubleClickZoomHandler=xa,C.DragPanHandler=Al,C.DragRotateHandler=Ml,C.EdgeInsets=ja,C.FullscreenControl=class extends p.E{constructor(u={}){super(),this._onFullscreenChange=()=>{var e;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=a==null?void 0:a.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:p.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=ue.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ue.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const u=this._fullscreenButton=ue.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ue.create("span","maplibregl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new p.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new p.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},C.GeoJSONSource=ds,C.GeolocateControl=class extends p.E{constructor(u){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new p.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new p.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const a=new p.N(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,o=this._map.getBearing(),c=p.e({bearing:o},this.options.fitBoundsOptions),m=oe.fromLngLat(a,n);this._map.fitBounds(m,c,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const a=new p.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&zs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new p.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=ue.create("button","maplibregl-ctrl-geolocate",this._container),ue.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){p.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ue.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new xn({element:this._dotElement}),this._circleElement=ue.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new p.k("trackuserlocationend")),this.fire(new p.k("userlocationlostfocus")))})}},this.options=p.e({},Rl,u)}onAdd(u){return this._map=u,this._container=ue.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return p._(this,arguments,void 0,function*(e=!1){if(Ui!==void 0&&!e)return Ui;if(window.navigator.permissions===void 0)return Ui=!!window.navigator.geolocation,Ui;try{Ui=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ui=!!window.navigator.geolocation}return Ui})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ue.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ms=0,zs=!1}_isOutOfMapMaxBounds(u){const e=this._map.getMaxBounds(),a=u.coords;return e&&(a.longitude<e.getWest()||a.longitude>e.getEast()||a.latitude<e.getSouth()||a.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const u=this._map.getBounds(),e=u.getSouthEast(),a=u.getNorthEast(),n=e.distanceTo(a),o=Math.ceil(this._accuracy/(n/this._map._container.clientHeight)*2);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}trigger(){if(!this._setup)return p.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ms--,zs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new p.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.k("trackuserlocationstart")),this.fire(new p.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ms++,Ms>1?(u={maximumAge:6e5,timeout:0},zs=!0):(u=this.options.positionOptions,zs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},C.Hash=un,C.ImageSource=Br,C.KeyboardHandler=Ji,C.LngLatBounds=oe,C.LogoControl=ko,C.Map=class extends zl{constructor(u){p.bf.mark(p.bg.create);const e=Object.assign(Object.assign({},Rc),u);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new $a(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new it,this._controls=[],this._mapId=p.a4(),this._contextLost=a=>{a.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new p.k("webglcontextlost",{originalEvent:a}))},this._contextRestored=a=>{this._setupPainter(),this.resize(),this._update(),this.fire(new p.k("webglcontextrestored",{originalEvent:a}))},this._onMapScroll=a=>{if(a.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ao),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=pi.addThrottleControl(()=>this.isMoving()),this._requestManager=new sa(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let a=!1;const n=Ts(o=>{this._trackResize&&!this._removed&&(this.resize(o),this.redraw())},50);this._resizeObserver=new ResizeObserver(o=>{a?n(o):a=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Io(this,e),this._hash=e.hash&&new un(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,p.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Ha(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new ko,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new p.k(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new p.k(`${a.dataType}dataloading`,a))}),this.on("dataabort",a=>{this.fire(new p.k("sourcedataabort",a))})}_getMapId(){return this._mapId}addControl(u,e){if(e===void 0&&(e=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new p.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=u.onAdd(this);this._controls.push(u);const n=this._controlPositions[e];return e.indexOf("bottom")!==-1?n.insertBefore(a,n.firstChild):n.appendChild(a),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new p.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(u);return e>-1&&this._controls.splice(e,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}calculateCameraOptionsFromTo(u,e,a,n){return n==null&&this.terrain&&(n=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(u,e,a,n)}resize(u){var e;const a=this._containerDimensions(),n=a[0],o=a[1],c=this._getClampedPixelRatio(n,o);if(this._resizeCanvas(n,o,c),this.painter.resize(n,o,c),this.painter.overLimit()){const _=this.painter.context.gl;this._maxCanvasSize=[_.drawingBufferWidth,_.drawingBufferHeight];const y=this._getClampedPixelRatio(n,o);this._resizeCanvas(n,o,y),this.painter.resize(n,o,y)}this.transform.resize(n,o),(e=this._requestedCameraState)===null||e===void 0||e.resize(n,o);const m=!this._moving;return m&&(this.stop(),this.fire(new p.k("movestart",u)).fire(new p.k("move",u))),this.fire(new p.k("resize",u)),m&&this.fire(new p.k("moveend",u)),this}_getClampedPixelRatio(u,e){const{0:a,1:n}=this._maxCanvasSize,o=this.getPixelRatio(),c=u*o,m=e*o;return Math.min(c>a?a/c:1,m>n?n/m:1)*o}getPixelRatio(){var u;return(u=this._overridePixelRatio)!==null&&u!==void 0?u:devicePixelRatio}setPixelRatio(u){this._overridePixelRatio=u,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(u){return this.transform.setMaxBounds(oe.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u&&this.setZoom(u),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u&&this.setZoom(u),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u&&this.setPitch(u),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u&&this.setPitch(u),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this._update()}project(u){return this.transform.locationPoint(p.N.convert(u),this.style&&this.terrain)}unproject(u){return this.transform.pointLocation(p.P.convert(u),this.terrain)}isMoving(){var u;return this._moving||((u=this.handlers)===null||u===void 0?void 0:u.isMoving())}isZooming(){var u;return this._zooming||((u=this.handlers)===null||u===void 0?void 0:u.isZooming())}isRotating(){var u;return this._rotating||((u=this.handlers)===null||u===void 0?void 0:u.isRotating())}_createDelegatedListener(u,e,a){if(u==="mouseenter"||u==="mouseover"){let n=!1;return{layers:e,listener:a,delegates:{mousemove:c=>{const m=e.filter(y=>this.getLayer(y)),_=m.length!==0?this.queryRenderedFeatures(c.point,{layers:m}):[];_.length?n||(n=!0,a.call(this,new si(u,this,c.originalEvent,{features:_}))):n=!1},mouseout:()=>{n=!1}}}}if(u==="mouseleave"||u==="mouseout"){let n=!1;return{layers:e,listener:a,delegates:{mousemove:m=>{const _=e.filter(y=>this.getLayer(y));(_.length!==0?this.queryRenderedFeatures(m.point,{layers:_}):[]).length?n=!0:n&&(n=!1,a.call(this,new si(u,this,m.originalEvent)))},mouseout:m=>{n&&(n=!1,a.call(this,new si(u,this,m.originalEvent)))}}}}{const n=o=>{const c=e.filter(_=>this.getLayer(_)),m=c.length!==0?this.queryRenderedFeatures(o.point,{layers:c}):[];m.length&&(o.features=m,a.call(this,o),delete o.features)};return{layers:e,listener:a,delegates:{[u]:n}}}}_saveDelegatedListener(u,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(e)}_removeDelegatedListener(u,e,a){if(!this._delegatedListeners||!this._delegatedListeners[u])return;const n=this._delegatedListeners[u];for(let o=0;o<n.length;o++){const c=n[o];if(c.listener===a&&c.layers.length===e.length&&c.layers.every(m=>e.includes(m))){for(const m in c.delegates)this.off(m,c.delegates[m]);return void n.splice(o,1)}}}on(u,e,a){if(a===void 0)return super.on(u,e);const n=this._createDelegatedListener(u,typeof e=="string"?[e]:e,a);this._saveDelegatedListener(u,n);for(const o in n.delegates)this.on(o,n.delegates[o]);return this}once(u,e,a){if(a===void 0)return super.once(u,e);const n=typeof e=="string"?[e]:e,o=this._createDelegatedListener(u,n,a);for(const c in o.delegates){const m=o.delegates[c];o.delegates[c]=(..._)=>{this._removeDelegatedListener(u,n,a),m(..._)}}this._saveDelegatedListener(u,o);for(const c in o.delegates)this.once(c,o.delegates[c]);return this}off(u,e,a){return a===void 0?super.off(u,e):(this._removeDelegatedListener(u,typeof e=="string"?[e]:e,a),this)}queryRenderedFeatures(u,e){if(!this.style)return[];let a;const n=u instanceof p.P||Array.isArray(u),o=n?u:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(n?{}:u)||{},o instanceof p.P||typeof o[0]=="number")a=[p.P.convert(o)];else{const c=p.P.convert(o[0]),m=p.P.convert(o[1]);a=[c,new p.P(m.x,c.y),m,new p.P(c.x,m.y),c]}return this.style.queryRenderedFeatures(a,e,this.transform)}querySourceFeatures(u,e){return this.style.querySourceFeatures(u,e)}setStyle(u,e){return(e=p.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&u?(this._diffStyle(u,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(u,e))}setTransformRequest(u){return this._requestManager.setTransformRequest(u),this}_getUIString(u){const e=this._locale[u];if(e==null)throw new Error(`Missing UI string '${u}'`);return e}_updateStyle(u,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(u,e));const a=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!u)),u?(this.style=new Gs(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u,e,a):this.style.loadJSON(u,e,a),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Gs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,e){if(typeof u=="string"){const a=this._requestManager.transformRequest(u,"Style");p.h(a,new AbortController).then(n=>{this._updateDiff(n.data,e)}).catch(n=>{n&&this.fire(new p.j(n))})}else typeof u=="object"&&this._updateDiff(u,e)}_updateDiff(u,e){try{this.style.setState(u,e)&&this._update(!0)}catch(a){p.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(u,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():p.w("There is no style added to the map.")}addSource(u,e){return this._lazyInitEmptyStyle(),this.style.addSource(u,e),this._update(!0)}isSourceLoaded(u){const e=this.style&&this.style.sourceCaches[u];if(e!==void 0)return e.loaded();this.fire(new p.j(new Error(`There is no source with ID '${u}'`)))}setTerrain(u){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),u){const e=this.style.sourceCaches[u.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${u.source}`);this.terrain===null&&e.reload();for(const a in this.style._layers){const n=this.style._layers[a];n.type==="hillshade"&&n.source===u.source&&p.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Co(this.painter,e,u),this.painter.renderToTexture=new Dl(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=a=>{a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==u.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new p.k("terrain",{terrain:u})),this}getTerrain(){var u,e;return(e=(u=this.terrain)===null||u===void 0?void 0:u.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const u=this.style&&this.style.sourceCaches;for(const e in u){const a=u[e]._tiles;for(const n in a){const o=a[n];if(o.state!=="loaded"&&o.state!=="errored")return!1}}return!0}removeSource(u){return this.style.removeSource(u),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,e,a={}){const{pixelRatio:n=1,sdf:o=!1,stretchX:c,stretchY:m,content:_,textFitWidth:y,textFitHeight:v}=a;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||p.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new p.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:S,data:A}=e,L=e;return this.style.addImage(u,{data:new p.R({width:E,height:S},new Uint8Array(A)),pixelRatio:n,stretchX:c,stretchY:m,content:_,textFitWidth:y,textFitHeight:v,sdf:o,version:0,userImage:L}),L.onAdd&&L.onAdd(this,u),this}}{const{width:E,height:S,data:A}=ge.getImageData(e);this.style.addImage(u,{data:new p.R({width:E,height:S},A),pixelRatio:n,stretchX:c,stretchY:m,content:_,textFitWidth:y,textFitHeight:v,sdf:o,version:0})}}updateImage(u,e){const a=this.style.getImage(u);if(!a)return this.fire(new p.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=e instanceof HTMLImageElement||p.b(e)?ge.getImageData(e):e,{width:o,height:c,data:m}=n;if(o===void 0||c===void 0)return this.fire(new p.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==a.data.width||c!==a.data.height)return this.fire(new p.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const _=!(e instanceof HTMLImageElement||p.b(e));return a.data.replace(m,_),this.style.updateImage(u,a),this}getImage(u){return this.style.getImage(u)}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new p.j(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u){return pi.getImage(this._requestManager.transformRequest(u,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(u,e){return this._lazyInitEmptyStyle(),this.style.addLayer(u,e),this._update(!0)}moveLayer(u,e){return this.style.moveLayer(u,e),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(u,e,a){return this.style.setLayerZoomRange(u,e,a),this._update(!0)}setFilter(u,e,a={}){return this.style.setFilter(u,e,a),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,e,a,n={}){return this.style.setPaintProperty(u,e,a,n),this._update(!0)}getPaintProperty(u,e){return this.style.getPaintProperty(u,e)}setLayoutProperty(u,e,a,n={}){return this.style.setLayoutProperty(u,e,a,n),this._update(!0)}getLayoutProperty(u,e){return this.style.getLayoutProperty(u,e)}setGlyphs(u,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(u,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(u,e,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(u,e,a,n=>{n||this._update(!0)}),this}removeSprite(u){return this._lazyInitEmptyStyle(),this.style.removeSprite(u),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(u,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(u,e,a=>{a||this._update(!0)}),this}setLight(u,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(u){return this._lazyInitEmptyStyle(),this.style.setSky(u),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(u,e){return this.style.setFeatureState(u,e),this._update()}removeFeatureState(u,e){return this.style.removeFeatureState(u,e),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let u=0,e=0;return this._container&&(u=this._container.clientWidth||400,e=this._container.clientHeight||300),[u,e]}_setupContainer(){const u=this._container;u.classList.add("maplibregl-map");const e=this._canvasContainer=ue.create("div","maplibregl-canvas-container",u);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=ue.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),n=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],n);const o=this._controlContainer=ue.create("div","maplibregl-control-container",u),c=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{c[m]=ue.create("div",`maplibregl-ctrl-${m} `,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,e,a){this._canvas.width=Math.floor(a*u),this._canvas.height=Math.floor(a*e),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const u={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",n=>{e={requestedAttributes:u},n&&(e.statusMessage=n.statusMessage,e.type=n.type)},{once:!0});const a=this._canvas.getContext("webgl2",u)||this._canvas.getContext("webgl",u);if(!a){const n="Failed to initialize WebGL";throw e?(e.message=n,new Error(JSON.stringify(e))):new Error(n)}this.painter=new cn(a,this.transform),Dr.testSupport(a)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_render(u){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._removed)return;let a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const o=this.transform.zoom,c=ge.now();this.style.zoomHistory.update(o,c);const m=new p.z(o,{now:c,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),_=m.crossFadingFactor();_===1&&_===this._crossFadingFactor||(a=!0,this._crossFadingFactor=_),this.style.update(m)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new p.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,p.bf.mark(p.bg.load),this.fire(new p.k("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const n=this._sourcesDirty||this._styleDirty||this._placementDirty;return n||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new p.k("idle")),!this._loaded||this._fullyLoaded||n||(this._fullyLoaded=!0,p.bf.mark(p.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var u;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),pi.removeThrottleControl(this._imageQueueHandle),(u=this._resizeObserver)===null||u===void 0||u.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ue.remove(this._canvasContainer),ue.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),p.bf.clearMetrics(),this._removed=!0,this.fire(new p.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ge.frameAsync(this._frameRequest).then(u=>{p.bf.frame(u),this._frameRequest=null,this._render(u)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get version(){return Ll}getCameraTargetElevation(){return this.transform.elevation}},C.MapMouseEvent=si,C.MapTouchEvent=ya,C.MapWheelEvent=kl,C.Marker=xn,C.NavigationControl=class{constructor(u){this._updateZoomButtons=()=>{const e=this._map.getZoom(),a=e===this._map.getMaxZoom(),n=e===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,a)=>{const n=this._map._getUIString(`NavigationControl.${a}`);e.title=n,e.setAttribute("aria-label",n)},this.options=p.e({},Bc,u),this._container=ue.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),ue.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),ue.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=ue.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Fc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ue.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(u,e){const a=ue.create("button",u,this._container);return a.type="button",a.addEventListener("click",e),a}},C.Popup=class extends p.E{constructor(u){super(),this.remove=()=>(this._content&&ue.remove(this._content),this._container&&(ue.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new p.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var a;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ue.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ue.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const _ of this.options.className.split(" "))this._container.classList.add(_);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?St(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._trackPointer&&!e)return;const n=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let o=this.options.anchor;const c=wn(this.options.offset);if(!o){const _=this._container.offsetWidth,y=this._container.offsetHeight;let v;v=n.y+c.bottom.y<y?["top"]:n.y>this._map.transform.height-y?["bottom"]:[],n.x<_/2?v.push("left"):n.x>this._map.transform.width-_/2&&v.push("right"),o=v.length===0?"bottom":v.join("-")}let m=n.add(c[o]);this.options.subpixelPositioning||(m=m.round()),ue.setTransform(this._container,`${Xa[o]} translate(${m.x}px,${m.y}px)`),bn(this._container,o,"popup")},this._onClose=()=>{this.remove()},this.options=p.e(Object.create(Ue),u)}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new p.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=p.N.convert(u),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const e=document.createDocumentFragment(),a=document.createElement("body");let n;for(a.innerHTML=u;n=a.firstChild,n;)e.appendChild(n);return this.setDOMContent(e)}getMaxWidth(){var u;return(u=this._container)===null||u===void 0?void 0:u.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ue.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(u){return this._container&&this._container.classList.add(u),this}removeClassName(u){return this._container&&this._container.classList.remove(u),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){if(this._container)return this._container.classList.toggle(u)}setSubpixelPositioning(u){this.options.subpixelPositioning=u}_createCloseButton(){this.options.closeButton&&(this._closeButton=ue.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(vn);u&&u.focus()}},C.RasterDEMTileSource=zt,C.RasterTileSource=ht,C.ScaleControl=class{constructor(u){this._onMove=()=>{Ds(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Ds(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},kr),u)}getDefaultPosition(){return"bottom-left"}onAdd(u){return this._map=u,this._container=ue.create("div","maplibregl-ctrl maplibregl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ue.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},C.ScrollZoomHandler=hr,C.Style=Gs,C.TerrainControl=class{constructor(u){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=u}onAdd(u){return this._map=u,this._container=ue.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ue.create("button","maplibregl-ctrl-terrain",this._container),ue.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ue.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},C.TwoFingersTouchPitchHandler=As,C.TwoFingersTouchRotateHandler=Eo,C.TwoFingersTouchZoomHandler=vo,C.TwoFingersTouchZoomRotateHandler=To,C.VectorTileSource=hs,C.VideoSource=Pa,C.addSourceType=(u,e)=>p._(void 0,void 0,void 0,function*(){if(fs(u))throw new Error(`A source type called "${u}" already exists.`);((a,n)=>{ps[a]=n})(u,e)}),C.clearPrewarmedResources=function(){const u=Ht;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(ti),Ht=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},C.getMaxParallelImageRequests=function(){return p.a.MAX_PARALLEL_IMAGE_REQUESTS},C.getRTLTextPluginStatus=function(){return wr().getRTLTextPluginStatus()},C.getVersion=function(){return zo},C.getWorkerCount=function(){return Bt.workerCount},C.getWorkerUrl=function(){return p.a.WORKER_URL},C.importScriptInWorkers=function(u){return us().broadcast("IS",u)},C.prewarm=function(){na().acquire(ti)},C.setMaxParallelImageRequests=function(u){p.a.MAX_PARALLEL_IMAGE_REQUESTS=u},C.setRTLTextPlugin=function(u,e){return wr().setRTLTextPlugin(u,e)},C.setWorkerCount=function(u){Bt.workerCount=u},C.setWorkerUrl=function(u){p.a.WORKER_URL=u}});var fe=ie;return fe})})(Nd);var Pm=Nd.exports;const Mu=km(Pm),oc=vi(new Set);async function tg(){const{value:B}=await Yt.get({key:"favorites/stations"});if(B)try{const O=JSON.parse(B);Array.isArray(O)&&oc.set(new Set(O))}catch(O){console.error("Failed to parse favorites:",O)}}async function ig(B){const O=st(oc),ie=O.has(B);return ie?O.delete(B):O.add(B),oc.set(new Set(O)),await Yt.set({key:"favorites/stations",value:JSON.stringify([...O])}),!ie}const jd=Ld({value:[]}),$d=vi(null),rg=vi(!1);function ag(B){const O=B.getSource("points"),ie={type:"FeatureCollection",features:jd.value.map(p=>{const Ye=st(oc);return{type:"Feature",properties:{code:p.code,serialNumber:p.serialNumber,name:p.name,bikes:p.bikes,selected:p.serialNumber==st($d),inService:p.assetStatus==="active",docks:p.docks,freeDocks:p.docks-p.bikes,isFavorite:Ye.has(p.serialNumber)},geometry:{type:"Point",coordinates:[p.longitude,p.latitude]}}})};O instanceof Mu.GeoJSONSource?O.setData(ie):B.addSource("points",{type:"geojson",data:ie});const se=B.getSource("user-location"),ae=st($s),fe=ae?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:[ae.coords.longitude,ae.coords.latitude]}}]}:{type:"FeatureCollection",features:[]};se instanceof Mu.GeoJSONSource||B.addSource("user-location",{type:"geojson",data:fe}),B.getSource("trip-path")instanceof Mu.GeoJSONSource||B.addSource("trip-path",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}}})}async function Mr(B,O){let ie=await(await fetch(B)).text();return new Promise((se,ae)=>{if(O)for(const[C,p]of Object.entries(O))ie=ie.replace(new RegExp("{"+C+"}","g"),p);const fe=new Image;fe.onload=C=>se(fe),fe.onerror=ae,fe.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(ie)})}function sg(B){B.getLayer("points")==null&&(B.addLayer({id:"trip-path-outline",type:"line",source:"trip-path",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":qr("--color-background"),"line-width":10}},"building"),B.addLayer({id:"trip-path",type:"line",source:"trip-path",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":qr("--color-primary"),"line-width":6}},"building"),B.addLayer({id:"points",type:"symbol",source:"points",layout:{visibility:"visible","icon-image":["case",["get","isFavorite"],["case",["get","selected"],"bike_favorite_selected","bike_favorite"],["case",["get","selected"],["case",["get","inService"],"bike_selected","bike_inactive_selected"],["case",["get","inService"],"bike","bike_inactive"]]],"icon-size":["interpolate",["linear"],["zoom"],11,.3,13,.5],"icon-anchor":"bottom","icon-allow-overlap":!0,"icon-padding":0,"text-field":["concat",["get","bikes"],"/",["get","freeDocks"]],"text-font":["Inter Bold","Arial Unicode MS Bold"],"text-size":["interpolate",["linear"],["zoom"],11,10,13,14],"text-anchor":"center","text-offset":[0,-2.8],"text-allow-overlap":!0},paint:{"text-color":["case",["get","isFavorite"],"#E53935",qr("--color-primary")],"text-halo-color":qr("--color-background"),"text-halo-width":1.5}}),B.addLayer({id:"docks",type:"symbol",source:"points",layout:{visibility:"none","icon-image":["case",["get","isFavorite"],["case",["get","selected"],"dock_favorite_selected","dock_favorite"],["case",["get","selected"],["case",["get","inService"],"dock_selected","dock_inactive_selected"],["case",["get","inService"],"dock","dock_inactive"]]],"icon-size":["interpolate",["linear"],["zoom"],11,.3,13,.5],"icon-anchor":"bottom","icon-allow-overlap":!0,"icon-padding":0,"text-field":["concat",["get","bikes"],"/",["get","freeDocks"]],"text-font":["Inter Bold","Arial Unicode MS Bold"],"text-size":["interpolate",["linear"],["zoom"],11,10,13,14],"text-anchor":"center","text-offset":[0,-2.8],"text-allow-overlap":!0},paint:{"text-color":["case",["get","isFavorite"],"#E53935",qr("--color-primary")],"text-halo-color":qr("--color-background"),"text-halo-width":1.5}}),B.addLayer({id:"user-location",type:"symbol",source:"user-location",layout:{"icon-image":"pulsing-dot"}}))}async function ng(B){const ie={accent:qr("--color-primary"),background:qr("--color-background"),inactive:qr("--color-label"),shadow_strength:st(Tm)==="light"?"0.25":"1"};function se(p,Ye,Qe={}){B.hasImage(p)?B.updateImage(p,Ye):B.addImage(p,Ye,Qe)}se("pulsing-dot",Sm(B),{pixelRatio:2}),se("bike_inactive",await Mr("./assets/bike_marker_inactive.svg",ie)),se("bike_inactive_selected",await Mr("./assets/bike_marker_inactive_selected.svg",ie)),se("dock_inactive",await Mr("./assets/dock_marker_inactive.svg",ie)),se("dock_inactive_selected",await Mr("./assets/dock_marker_inactive_selected.svg",ie));const fe={...ie,accent:"#E53935"},C=performance.now();se("bike",await Mr("./assets/bike_marker.svg",ie)),se("bike_selected",await Mr("./assets/bike_marker_selected.svg",ie)),se("dock",await Mr("./assets/dock_marker.svg",ie)),se("dock_selected",await Mr("./assets/dock_marker_selected.svg",ie)),se("bike_favorite",await Mr("./assets/bike_marker.svg",fe)),se("bike_favorite_selected",await Mr("./assets/bike_marker_selected.svg",fe)),se("dock_favorite",await Mr("./assets/dock_marker.svg",fe)),se("dock_favorite_selected",await Mr("./assets/dock_marker_selected.svg",fe)),console.debug(`Loaded images in ${performance.now()-C}ms`)}async function Cm(){const B=await fm();Ou(B),Mm(B),zm(B),qd(B),Zd(B)}function tl(){um().then(qd)}async function og(){lm().then(Ou)}function Am(B){var ie;console.debug("ingesting trip message from ws",B);const O=st(zi);if(B.code==="no_trip"||B.bike==="dummy"){(O!=null&&O.confirmed||Date.now()-(((ie=O==null?void 0:O.startDate)==null?void 0:ie.getTime())??0)>3e4)&&tl();return}B.finished&&(B.canUsePoints?Ru(B.code):B.canPayWithMoney&&pm(B.code)),B.code===(O==null?void 0:O.code)?Dm(B):Lm(B)}function Ou(B){if(B.getStations===null||B.getStations===void 0)return;const O=[];B.getStations.forEach(ie=>{if(ie==null)return;const{code:se,name:ae,description:fe,latitude:C,longitude:p,bikes:Ye,docks:Qe,serialNumber:At,assetStatus:ge}=ie;if(se==null||ae===null||ae===void 0||fe===void 0||C===null||C===void 0||p===null||p===void 0||Ye===null||Ye===void 0||Qe===null||Qe===void 0||At===null||At===void 0||ge===null||ge===void 0){console.error("invalid station",ie);return}O.push({code:se,name:ae,description:fe,latitude:C,longitude:p,bikes:Ye,docks:Qe,serialNumber:At,assetStatus:ge})}),jd.value=O}function Mm(B){if(B.client===null||B.client===void 0||B.client.length<=0)return;const{balance:O,bonus:ie}=B.client[0];O==null||ie===null||ie===void 0||Uu.update(se=>({subscription:(se==null?void 0:se.subscription)??null,balance:O,bonus:ie}))}async function zm(B){if(B.activeUserSubscriptions===null||B.activeUserSubscriptions===void 0||B.activeUserSubscriptions.length<=0)return;const{active:O,expirationDate:ie,name:se,subscriptionStatus:ae,type:fe}=B.activeUserSubscriptions[0];Uu.update(C=>({balance:(C==null?void 0:C.balance)??0,bonus:(C==null?void 0:C.bonus)??0,subscription:{active:O,expirationDate:new Date(ie),name:se,subscriptionStatus:ae,type:fe??"unknown"}}))}function qd(B){var se;if(B.activeTrip===null||B.activeTrip===void 0||B.activeTrip.code==="no_trip"||B.activeTrip.asset==="dummy"){const ae=st(zi);(ae!=null&&ae.confirmed||Date.now()-(((se=ae==null?void 0:ae.startDate)==null?void 0:se.getTime())??0)>3e4)&&wm();return}const{startDate:O,code:ie}=B.activeTrip;zi.update(ae=>({code:ie,bikePlate:(ae==null?void 0:ae.bikePlate)??null,startPos:(ae==null?void 0:ae.startPos)??null,destination:(ae==null?void 0:ae.destination)??null,traveledDistanceKm:(ae==null?void 0:ae.traveledDistanceKm)??0,distanceLeft:(ae==null?void 0:ae.distanceLeft)??null,speed:(ae==null?void 0:ae.speed)??0,startDate:new Date(O),predictedEndDate:(ae==null?void 0:ae.predictedEndDate)??null,arrivalTime:(ae==null?void 0:ae.predictedEndDate)??null,finished:!1,confirmed:!0,pathTaken:(ae==null?void 0:ae.pathTaken)??[],lastUpdate:new Date}))}function Zd(B){if(B.unratedTrips===null||B.unratedTrips===void 0||B.unratedTrips.length<=0)return;const O=B.unratedTrips[0];if(O==null||O.code==null||O.asset==null)return;const ie=new Date().getTime()-new Date(O.endDate).getTime();if(O&&Ru(O.code),!(ie<24*60*60*1e3))return;let se;if(B.tripHistory!==null&&B.tripHistory!==void 0&&B.tripHistory.length>0){const ae=B.tripHistory[0];if(ae){const fe=ae==null?void 0:ae.code;if(se=ae.bikeName,fe!==O.code)return}}if(se==null){console.warn("ingestLastUnratedTrip: bike plate is null or undefined");return}Fu.set({currentRating:{code:O.code,bikePlate:se,startDate:new Date(O.startDate),endDate:new Date(O.endDate),tripPoints:O.costBonus||0}})}function Dm(B){B.finished?(zi.set(null),B.canceled||Fu.update(O=>(O.currentRating={code:B.code,bikePlate:B.bike,startDate:new Date(B.startDate),endDate:new Date(B.endDate??0),tripPoints:B.tripPoints??0},O))):zi.update(O=>{if(O===null)throw new Error("trip is null in impossible place");return{...O,startDate:new Date(B.startDate),bikePlate:B.bike,code:B.code,confirmed:!0,lastUpdate:new Date}})}function Lm(B){if(B.finished)return;const O=st($s);zi.set({startDate:new Date(B.startDate),bikePlate:B.bike,code:B.code,finished:B.finished,startPos:null,destination:null,traveledDistanceKm:0,distanceLeft:null,speed:0,predictedEndDate:null,arrivalTime:null,confirmed:!0,pathTaken:O?[{lat:O.coords.latitude,lng:O.coords.longitude,time:new Date}]:[],lastUpdate:new Date})}const Vu=vi(!0);Bu.getStatus().then(B=>Vu.set(B.connected));Bu.addListener("networkStatusChange",B=>{Vu.set(B.connected),B.connected&&ju().then(tl)});const sc=B=>B*(Math.PI/180);function Gd(B,O,ie,se){const fe=sc(ie-B),C=sc(se-O),p=Math.sin(fe/2)*Math.sin(fe/2)+Math.cos(sc(B))*Math.cos(sc(ie))*Math.sin(C/2)*Math.sin(C/2);return 6371*(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)))}function lg(B){return B<1?`${(B*1e3).toFixed(0)}m`:`${B.toLocaleString(void 0,{maximumFractionDigits:2,useGrouping:!1})}km`}function Ad(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,B=>{const O=Math.random()*16|0;return(B=="x"?O:O&3|8).toString(16)})}function qr(B){return getComputedStyle(document.documentElement).getPropertyValue(B)}const Md=5,Rm=1e3;async function il(B,O=!1){for(let ie=1;ie<=Md;ie++)try{const se=new Promise((fe,C)=>setTimeout(()=>C(new Error("Request timed out")),5e3)),ae=await Promise.race([rm.request({...B,readTimeout:5e3,connectTimeout:5e3}),se]);if(O&&(ae.status<200||ae.status>=300))throw ae;return ae}catch(se){const ae={...se.data,status:se.status};if(se instanceof Error&&se.message==="Request timed out")console.error(`Attempt ${ie}: Request timed out`);else{if(ae!=null&&ae.errors&&ae.errors.some(p=>{var Ye;return((Ye=Od[p.message])==null?void 0:Ye.retry)===!1}))throw console.error("Known error occurred:",ae),ae;console.error(`Attempt ${ie}:`,ae)}const fe=B.url.startsWith(cc),C=B.url.startsWith(Lu)||B.url.includes(uc.split("://")[1]);if(ie<Md)await new Promise(p=>setTimeout(p,Rm*ie));else throw console.error("Max attempts reached. Throwing error."),ae.status===void 0&&st(Vu)&&(fe?(ls.add(st(cs)("auth_api_communication_error"),5e3),el("auth_api_communication_error",JSON.stringify(se)),console.error("Auth API communication error:",se)):C&&(ls.add(st(cs)("gira_api_communication_error"),5e3),el("gira_api_communication_error",JSON.stringify(se)),console.error("Gira API communication error:",se))),ae}}async function Bm(B,O){const ie={url:cc+"/login",method:"post",headers:{"User-Agent":"Gira/3.4.3 (Android 34)","Content-Type":"application/json",Priority:"high"},data:{Provider:"EmailPassword",CredentialsEmailPassword:{email:B,password:O}}},se=await il(ie,!0);return se==null?void 0:se.data}async function Fm(B){const O={url:cc+"/token/refresh",method:"post",headers:{"User-Agent":"Gira/3.4.3 (Android 34)","Content-Type":"application/json"},data:{token:B.refreshToken}},ie=await il(O,!0);return ie==null?void 0:ie.data}async function Om(B){const O={url:cc+"/user",method:"get",headers:{"User-Agent":"Gira/3.4.3 (Android 34)","Content-Type":"application/json",Authorization:`Bearer ${B.accessToken}`}},ie=await il(O,!0);return ie==null?void 0:ie.data}let $r,zu=0;function Hd(){console.debug("Starting WebSocket connection");const B=st(zr),O=B==null?void 0:B.accessToken;if(!O){console.debug("No access token available, skipping WS connection");return}if($r&&($r.readyState===WebSocket.CONNECTING||$r.readyState===WebSocket.OPEN))return;$r=new WebSocket(uc+"/graphql","graphql-ws"),$r.onopen=()=>{zu=0,console.debug("WebSocket connected");const se={};$r.send(JSON.stringify({type:"connection_init",payload:{headers:se}})),$r.send(JSON.stringify({type:"start",id:Ad(),payload:{operationName:"activeTripSubscription",query:`subscription activeTripSubscription($_access_token: String) {
					activeTripSubscription(_access_token: $_access_token) {
						code bike startDate endDate cost finished
						canPayWithMoney canUsePoints clientPoints tripPoints
						canceled period periodTime error
					}
				}`,variables:{_access_token:O}}})),$r.send(JSON.stringify({type:"start",id:Ad(),payload:{operationName:"operationalStationsSubscription",query:`subscription operationalStationsSubscription {
					operationalStationsSubscription {
						assetCondition assetStatus assetType code description
						latitude longitude name bikes docks serialNumber stype
					}
				}`,variables:{_access_token:O}}}))},$r.onmessage=se=>{var fe;const ae=JSON.parse(se.data);if(console.debug("WebSocket message received",ae),ae.type==="data"&&((fe=ae.payload)!=null&&fe.data)){const{data:C}=ae.payload;C.operationalStationsSubscription?(console.debug("Stations updated via WebSocket"),Ou({getStations:C.operationalStationsSubscription})):C.activeTripSubscription?Am(C.activeTripSubscription):C.serverDate&&console.debug("Server time offset:",new Date(C.serverDate.date).getTime()-Date.now(),"ms")}};const ie=()=>{setTimeout(()=>{Hd(),zu+=1e3},zu)};$r.onclose=se=>{console.debug("WebSocket closed",se),ie()},$r.onerror=se=>{console.debug("WebSocket error",se),ie()}}const zr=vi(void 0),Nn=vi(null),Nu=vi(null),Uu=vi(null),Wd=vi(null);let Du=null;zr.subscribe(async B=>{if(!B)return;const O=JSON.parse(window.atob(B.accessToken.split(".")[1]));Hd(),st(Nu)===null&&(Cm(),Vm()),Du&&clearTimeout(Du),Du=setTimeout(ju,O.exp*1e3-Date.now()-1e3*30)});async function cg(){const B=(await Yt.get({key:"email"})).value,O=(await Yt.get({key:"password"})).value;B&&O?Nn.set({email:B,password:O}):zr.set(null),Nn.subscribe(async ie=>{if(!ie){await Yt.remove({key:"email"}),await Yt.remove({key:"password"});return}const se=await Xd(ie.email,ie.password);se!==0?(console.error("Login failed with code:",se),zr.set(null),se===100&&(await Yt.remove({key:"email"}),await Yt.remove({key:"password"})),Nn.set(null)):(await Yt.set({key:"email",value:ie.email}),await Yt.set({key:"password",value:ie.password}))})}async function Xd(B,O){const ie=await Bm(B,O);if(ie.error.code!==0)return ie.error.code;const{accessToken:se,refreshToken:ae,expiration:fe}=ie.data;return!se||!ae?ie.error.code:(zr.set({accessToken:se,refreshToken:ae,expiration:fe}),0)}async function ug(){zr.set(null),Nn.set(null),Uu.set(null),zi.set(null),Nu.set(null),$d.set(null),Fu.set({currentRating:null})}const zd=2e3,Dd=5;async function ju(){if(!(await Bu.getStatus()).connected)return!1;const O=st(zr);if(!O)return!1;for(let ie=0;ie<Dd;ie++){if(!st(Nn))return!1;const ae=await Fm(O);if(ae.error&&ae.error.code===0&&ae.data.accessToken&&ae.data.refreshToken){const{accessToken:fe,refreshToken:C,expiration:p}=ae.data;return zr.set({accessToken:fe,refreshToken:C,expiration:p}),!0}await new Promise(fe=>setTimeout(fe,zd))}for(let ie=0;ie<Dd;ie++){const se=st(Nn);if(!se)return!1;if(await Xd(se.email,se.password)===0)return!0;await new Promise(fe=>setTimeout(fe,zd))}return!1}async function Vm(){const B=st(zr);if(!B)return;const O=await Om(B),{email:ie,name:se}=O.data;Nu.set({email:ie,name:se})}export{Vu as $,am as A,Mu as B,nc as C,ng as D,ag as E,sg as F,Cu as G,eg as H,Uu as I,Nu as J,Gm as K,hm as L,_m as M,Wm as N,nm as O,ug as P,Ym as Q,ig as R,Hm as S,qm as T,Gd as U,Km as V,Fd as W,lg as X,ls as Y,qr as Z,Pu as _,tg as a,Zm as b,Jm as c,js as d,ju as e,og as f,sm as g,Xm as h,zr as i,jm as j,rg as k,cg as l,$s as m,cs as n,Xd as o,Nn as p,zi as q,qs as r,$m as s,Tm as t,tl as u,oc as v,Em as w,jd as x,$d as y,Qm as z};
